<!DOCTYPE html>
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" manifest="passlok.appcache">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>PassLok privacy</title>

    <meta name="Keywords" content="passlok, URSA, browser, encryption, decryption, symmetric, public key, signature, AES, ECDH, Diffie, Hellman, elliptic curve, advanced, javascript, PGP, PRISM">
    <meta name="Description" content="PassLok privacy">
    <meta name="author" content="F. Ruiz">
    <meta name="robots" content="index">
    <meta name="viewport" content="width=device-width, minimum-scale=1, maximum-scale=1, user-scalable=no">

	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="default">
	<link rel="apple-touch-icon" href="passlok-touch-icon.png">
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico">

<!--CSS styles go here-->
<style type="text/css">
		html {
	    -webkit-text-size-adjust: 100%;
		}
	    body {
		font-family: Sans-Serif;
		margin-left: 1%;
		margin-right: 1%;
		background-color: #FFFFFF;
		color: #000000;
		overflow: auto;
	    }
		.black_overlay{
			display: none;
			position: absolute;
			top: 0%;
			left: 0%;
			width: 100%;
			height: 100%;
			background-color: black;
			z-index:1001;
			-moz-opacity: 0.5;
			opacity:.50;
			filter: alpha(opacity=50);
		}
		.white_content {
			display: none;
			position: absolute;
			top: 10%;
			left: 10%;
			width: 80%;
			height: 80%;
			padding: 0px;
			border: 0px solid gray;
			background-color: white;
			z-index:1002;
			overflow: auto;
		}
		.block_page {
			display: none;
			position: absolute;
			top: 0%;
			left: 0%;
			width: 100%;
			height: 100%;
			padding: 0px;
			border: 0px solid gray;
			background-color: white;
			z-index:1002;
			overflow: auto;
		}
		input[type=checkbox]{
  		/* Larger checkboxes */
  			-ms-transform: scale(1.7); /* IE */
 			-moz-transform: scale(1.7); /* FF */
  			-webkit-transform: scale(1.7); /* Safari and Chrome */
  			-o-transform: scale(1.7); /* Opera */
  			padding: 0px;
			border:1px solid #dedede;
		}
		input[type=radio]{
  		/* Larger radio buttons */
  			-ms-transform: scale(1.7); /* IE */
 			-moz-transform: scale(1.7); /* FF */
  			-webkit-transform: scale(1.7); /* Safari and Chrome */
  			-o-transform: scale(1.7); /* Opera */
  			padding: 0px;
			border:1px solid #dedede;
		}
.cssbutton {
	-webkit-border-radius: 0;
  	-moz-border-radius: 0;
  	border-radius: 0;
  	font-family: Arial;
	font-size:18px;
  	color: #666666;
  	padding: 12px;
  	background: #e6e6e6;
  	text-decoration: none;
	border:0px;
	margin-right: -2px;
}
.cssbutton:hover {
	background: #efefef;
	text-decoration: none;
}
.cssbox {
	-webkit-border-radius: 0;
  	-moz-border-radius: 0;
  	border-radius: 0;
	font-size:18px;
  	color: #666666;
  	padding: 15px;
  	background: #ffffee;
  	text-decoration: none;
	border:1px solid #dedede;
	width: 100%;
	-webkit-appearance: none;
    box-sizing: border-box;
    -webkit-box-sizing:border-box;
    -moz-box-sizing: border-box;
	-webkit-box-shadow: none;
	-moz-box-shadow: none;
	box-shadow: none;
}
ul#tabs { margin: 0; text-align: center; padding: 11px; width: 100%; background-color: #c6d5c6; position: fixed; top: 0px; left: 0px; z-index:1 }
ul#tabs li { display: inline; width: auto; }
ul#tabs li a { font-size:18px; color: #42454a; background-color: #c6d5c6; border: none; ;text-decoration: none; padding: 10px;margin-left: -2px;}
ul#tabs li a:hover { background-color: #d7e6d7; }
ul#tabs li a.selected { color: #000; background-color: #ffffff; font-weight: bold; padding: 12px; border: none;}
div.tabContent { border: none; background-color: #ffffff; }
div.tabContent.hide { display: none; }

.custom-file-input{
	color: #ffffff;
}
.custom-file-input::-webkit-file-upload-button {
  visibility: hidden;
}
.custom-file-input::before {
  content: 'Select a file';
  display: inline-block;
  background: #e6e6e6;
	-webkit-border-radius: 0;
  	-moz-border-radius: 0;
  	border-radius: 0;
  	font-family: Arial;
	font-size:18px;
  	color: #666666;
  	padding: 12px;
  	background: #e6e6e6;
	border:0px;
  outline: none;
  white-space: nowrap;
  -webkit-user-select: none;
  cursor: pointer;
  text-decoration: none;
}
.custom-file-input:hover::before {
  background: #efefef;
}
.custom-file-input:active::before {
  background: #efefef;
}
select {
    -webkit-appearance: button;
    -moz-appearance: button;
    -webkit-user-select: none;
    -moz-user-select: none;
    border:1px solid #dedede;
    font-size: 18px;
	color: #666666;
	width: 30%;
	background: #ffffee;
    margin: 0;
    text-overflow: ellipsis;
    white-space: nowrap;
}
	</style>

<!--License notice and SSL force-->
<script>
        /*
		@source: https://passlok.com/index.html

        @licstart  The following is the entire license notice for the
        JavaScript code in this page.

        Copyright (C) 2014  Francisco Ruiz

        The JavaScript code in this page is free software: you can
        redistribute it and/or modify it under the terms of the GNU
        General Public License (GNU GPL) as published by the Free Software
        Foundation, either version 3 of the License, or (at your option)
        any later version.  The code is distributed WITHOUT ANY WARRANTY;
        without even the implied warranty of MERCHANTABILITY or FITNESS
        FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

        As additional permission under GNU GPL version 3 section 7, you
        may distribute non-source (e.g., minimized or compacted) forms of
        that code without the copy of the GNU GPL normally required by
        section 4, provided you include this license notice and a URL
        through which recipients can access the Corresponding Source.


        @licend  The above is the entire license notice
        for the JavaScript code in this page.
        */

    if (window.location.protocol == "http:") {				//force SSL/TLS

        var restOfUrl = window.location.href.substr(5);
        window.location = "https:" + restOfUrl;
    }
</script>

<!--Libraries merged into program:
SSSS-->
<script>
// secrets.js - by Alexander Stetsyuk - released under MIT License
//substantial edits by F. Ruiz: since RNG used is from SJCL, RNG check is left to SJCL: RNG checking code removed from here.

(function(exports, global){
var defaults = {
	bits: 8, // default number of bits
	radix: 16, // work with HEX by default
	minBits: 3,
	maxBits: 20, // this permits 1,048,575 shares, though going this high is NOT recommended in JS!

	bytesPerChar: 2,
	maxBytesPerChar: 6, // Math.pow(256,7) > Math.pow(2,53)

	// Primitive polynomials (in decimal form) for Galois Fields GF(2^n), for 2 <= n <= 30
	// The index of each term in the array corresponds to the n for that polynomial
	// i.e. to get the polynomial for n=16, use primitivePolynomials[16]
	primitivePolynomials: [null,null,1,3,3,5,3,3,29,17,9,5,83,27,43,3,45,9,39,39,9,5,3,33,27,9,71,39,9,5,83],

	// warning for insecure PRNG
	warning: 'WARNING:\nA secure random number generator was not found.\nUsing Math.random(), which is NOT cryptographically strong!'
};

// Protected settings object
var config = {};

function init(bits){
	if(bits && (typeof bits !== 'number' || bits%1 !== 0 || bits<defaults.minBits || bits>defaults.maxBits)){
		throw new Error('Number of bits must be an integer between ' + defaults.minBits + ' and ' + defaults.maxBits + ', inclusive.')
	}
	config.radix = defaults.radix;
	config.bits = bits || defaults.bits;
	config.size = Math.pow(2, config.bits);
	config.max = config.size - 1;

	// Construct the exp and log tables for multiplication.
	var logs = [], exps = [], x = 1, primitive = defaults.primitivePolynomials[config.bits];
	for(var i=0; i<config.size; i++){
		exps[i] = x;
		logs[x] = i;
		x <<= 1;
		if(x >= config.size){
			x ^= primitive;
			x &= config.max;
		}
	}
	config.logs = logs;
	config.exps = exps;
};


exports.init = init;

// Divides a `secret` number String str expressed in radix `inputRadix` (optional, default 16)
// into `numShares` shares, each expressed in radix `outputRadix` (optional, default to `inputRadix`),
// requiring `threshold` number of shares to reconstruct the secret.
// Optionally, zero-pads the secret to a length that is a multiple of padLength before sharing.

exports.share = function(secret, numShares, threshold, padLength){
	padLength =  padLength || 0;

	if(typeof secret !== 'string'){
		throw new Error('Secret must be a string.');
	}
	if(typeof numShares !== 'number' || numShares%1 !== 0 || numShares < 2){
		throw new Error('Number of shares must be an integer between 2 and 2^bits-1 (' + config.max + '), inclusive.')
	}
	if(numShares > config.max){
		var neededBits = Math.ceil(Math.log(numShares +1)/Math.LN2);
		throw new Error('Number of shares must be an integer between 2 and 2^bits-1 (' + config.max + '), inclusive. To create ' + numShares + ' shares, use at least ' + neededBits + ' bits.')
	}
	if(typeof threshold !== 'number' || threshold%1 !== 0 || threshold < 2){
		throw new Error('Threshold number of shares must be an integer between 2 and 2^bits-1 (' + config.max + '), inclusive.');
	}
	if(threshold > config.max){
		var neededBits = Math.ceil(Math.log(threshold +1)/Math.LN2);
		throw new Error('Threshold number of shares must be an integer between 2 and 2^bits-1 (' + config.max + '), inclusive.  To use a threshold of ' + threshold + ', use at least ' + neededBits + ' bits.');
	}
	if(typeof padLength !== 'number' || padLength%1 !== 0 ){
		throw new Error('Zero-pad length must be an integer greater than 1.');
	}
	secret = '1' + hex2bin(secret); // append a 1 so that we can preserve the correct number of leading zeros in our secret
	secret = split(secret, padLength);
	var x = new Array(numShares), y = new Array(numShares);
	for(var i=0, len = secret.length; i<len; i++){
		var subShares = this._getShares(secret[i], numShares, threshold);
		for(var j=0; j<numShares; j++){
			x[j] = x[j] || subShares[j].x.toString(config.radix);
			y[j] = padLeft(subShares[j].y.toString(2)) + (y[j] ? y[j] : '');
		}
	}
	var padding = config.max.toString(config.radix).length;
	for(var i=0; i<numShares; i++){
		x[i] = config.bits.toString(36) + padLeft(x[i],padding) + bin2hex(y[i]);
	}
	return x;
};

// This is the basic polynomial generation and evaluation function
// for a `config.bits`-length secret (NOT an arbitrary length)
// Note: no error-checking at this stage! If `secrets` is NOT
// a NUMBER less than 2^bits-1, the output will be incorrect!

exports._getShares = function(secret, numShares, threshold){
	var shares = [];
	var coeffs = [secret];
	var limit = Math.pow(2,config.bits);
	for(var i=1; i<threshold; i++){
//		coeffs[i] = parseInt(config.rng(config.bits),2);		//original random decimal number of maximum size 2^config.bits
		coeffs[i]=sjcl.bn.random(limit).limbs[0];				//using SJCL RNG
	}
	for(var i=1, len = numShares+1; i<len; i++){
		shares[i-1] = {
			x: i,
			y: horner(i, coeffs)
		}
	}
	return shares;
};

// Polynomial evaluation at `x` using Horner's Method
// TODO: this can possibly be sped up using other methods
// NOTE: fx=fx * x + coeff[i] ->  exp(log(fx) + log(x)) + coeff[i],
//       so if fx===0, just set fx to coeff[i] because
//       using the exp/log form will result in incorrect value
function horner(x, coeffs){
	var logx = config.logs[x];
	var fx = 0;
	for(var i=coeffs.length-1; i>=0; i--){
		if(fx === 0){
			fx = coeffs[i];
			continue;
		}
		fx = config.exps[ (logx + config.logs[fx]) % config.max ] ^ coeffs[i];
	}
	return fx;
};

function inArray(arr,val){
	for(var i = 0,len=arr.length; i < len; i++) {
		if(arr[i] === val){
   		 return true;
	 	}
 	}
	return false;
};

function processShare(share){

	var bits = parseInt(share[0], 36);
	if(bits && (typeof bits !== 'number' || bits%1 !== 0 || bits<defaults.minBits || bits>defaults.maxBits)){
		throw new Error('Number of bits must be an integer between ' + defaults.minBits + ' and ' + defaults.maxBits + ', inclusive.')
	}
	var max = Math.pow(2, bits) - 1;
	var idLength = max.toString(config.radix).length;

	var id = parseInt(share.substr(1, idLength), config.radix);
	if(typeof id !== 'number' || id%1 !== 0 || id<1 || id>max){
		throw new Error('Share id must be an integer between 1 and ' + config.max + ', inclusive.');
	}
	share = share.substr(idLength + 1);
	if(!share.length){
		throw new Error('Invalid share: zero-length share.')
	}
	return {
		'bits': bits,
		'id': id,
		'value': share
	};
};


secrets._processShare = processShare;

// Protected method that evaluates the Lagrange interpolation
// polynomial at x=`at` for individual config.bits-length
// segments of each share in the `shares` Array.
// Each share is expressed in base `inputRadix`. The output
// is expressed in base `outputRadix'
function combine(at, shares){
	var setBits, share, x = [], y = [], result = '', idx;

	for(var i=0, len = shares.length; i<len; i++){
		share = processShare(shares[i]);
		if(typeof setBits === 'undefined'){
			setBits = share['bits'];
		}else if(share['bits'] !== setBits){
			throw new Error('Mismatched shares: Different bit settings.')
		}
		if(config.bits !== setBits){
			init(setBits);
		}
		if(inArray(x, share['id'])){ // repeated x value?
			continue;
		}
		idx = x.push(share['id']) - 1;
		share = split(hex2bin(share['value']));
		for(var j=0, len2 = share.length; j<len2; j++){
			y[j] = y[j] || [];
			y[j][idx] = share[j];
		}
	}
	for(var i=0, len=y.length; i<len; i++){
		result = padLeft(lagrange(at, x, y[i]).toString(2)) + result;
	}
	if(at===0){// reconstructing the secret
		var idx = result.indexOf('1'); //find the first 1
		return bin2hex(result.slice(idx+1));
	}else{// generating a new share
		return bin2hex(result);
	}
};

// Combine `shares` Array into the original secret

exports.combine = function(shares){
	return combine(0, shares);
};

// Generate a new share with id `id` (a number between 1 and 2^bits-1)
// `id` can be a Number or a String in the default radix (16)

exports.newShare = function(id, shares){
	if(typeof id === 'string'){
		id = parseInt(id, config.radix);
	}

	var share = processShare(shares[0]);
	var max = Math.pow(2, share['bits']) - 1;

	if(typeof id !== 'number' || id%1 !== 0 || id<1 || id>max){
		throw new Error('Share id must be an integer between 1 and ' + config.max + ', inclusive.');
	}

	var padding = max.toString(config.radix).length;
	return config.bits.toString(36) + padLeft(id.toString(config.radix), padding) + combine(id, shares);
};

// Evaluate the Lagrange interpolation polynomial at x = `at`
// using x and y Arrays that are of the same length, with
// corresponding elements constituting points on the polynomial.
function lagrange(at, x, y){
	var sum = 0,
		product,
		i, j;

	for(var i=0, len = x.length; i<len; i++){
		if(!y[i]){
			continue;
		}
		product = config.logs[y[i]];
		for(var j=0; j<len; j++){
			if(i === j){ continue; }
			if(at === x[j]){ // happens when computing a share that is in the list of shares used to compute it
				product = -1; // fix for a zero product term, after which the sum should be sum^0 = sum, not sum^1
				break;
			}
			product = ( product + config.logs[at ^ x[j]] - config.logs[x[i] ^ x[j]] + config.max ) % config.max;
		}
		sum = product === -1 ? sum : sum ^ config.exps[product]; // though exps[-1]= undefined and undefined ^ anything = anything in chrome, this behavior may not hold everywhere, so do the check
	}
	return sum;
};


exports._lagrange = lagrange;

// Splits a number string `bits`-length segments, after first
// optionally zero-padding it to a length that is a multiple of `padLength.
// Returns array of integers (each less than 2^bits-1), with each element
// representing a `bits`-length segment of the input string from right to left,
// i.e. parts[0] represents the right-most `bits`-length segment of the input string.
function split(str, padLength){
	if(padLength){
		str = padLeft(str, padLength)
	}
	var parts = [];
	for(var i=str.length; i>config.bits; i-=config.bits){
		parts.push(parseInt(str.slice(i-config.bits, i), 2));
	}
	parts.push(parseInt(str.slice(0, i), 2));
	return parts;
};

// Pads a string `str` with zeros on the left so that its length is a multiple of `bits`
function padLeft(str, bits){
	bits = bits || config.bits
	var missing = str.length % bits;
	return (missing ? new Array(bits - missing + 1).join('0') : '') + str;
};

function hex2bin(str){
	var bin = '', num;
	for(var i=str.length - 1; i>=0; i--){
		num = parseInt(str[i], 16)
		if(isNaN(num)){
			throw new Error('Invalid hex character.')
		}
		bin = padLeft(num.toString(2), 4) + bin;
	}
	return bin;
}

function bin2hex(str){
	var hex = '', num;
	str = padLeft(str, 4);
	for(var i=str.length; i>=4; i-=4){
		num = parseInt(str.slice(i-4, i), 2);
		if(isNaN(num)){
			throw new Error('Invalid binary character.')
		}
		hex = num.toString(16) + hex;
	}
	return hex;
}

// by default, initialize without an RNG
exports.init();
})(typeof module !== 'undefined' && module['exports'] ? module['exports'] : (window['secrets'] = {}), typeof GLOBAL !== 'undefined' ? GLOBAL : window );

</script>

<!--steganography.js-->
<script>
/* 
 * steganography.js v1.0.1
 * 
 * Copyright (C) 2012, Peter Eigenschink (http://www.peter-eigenschink.at/)
 * Dual-licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
 * and the Beerware (http://en.wikipedia.org/wiki/Beerware) license.
 */
(function(g) {
  var util = {
    "isPrime" : function(n) {
      if (isNaN(n) || !isFinite(n) || n%1 || n<2) return false;
      if (n%2==0) return (n==2);
      if (n%3==0) return (n==3);
      var m=Math.sqrt(n);
      for (var i=5;i<=m;i+=6) {
        if (n%i==0) return false;
        if (n%(i+2)==0) return false;
      }
      return true;
    },
    "findNextPrime" : function(n) {
      for(var i=n; true; i+=1)
        if(util.isPrime(i)) return i;
    },
    "sum" : function(func, end, options) {
      var sum = 0;
      options = options || {};
      for(var i = options.start || 0; i < end; i+=(options.inc||1))
        sum += func(i) || 0;

      return (sum === 0 && options.defValue ? options.defValue : sum);
    },
    "product" : function(func, end, options) {
      var prod = 1;
      options = options || {};
      for(var i = options.start || 0; i < end; i+=(options.inc||1))
        prod *= func(i) || 1;

      return (prod === 1 && options.defValue ? options.defValue : prod);
    },
    "createArrayFromArgs" : function(args,index,threshold) {
      var ret = new Array(threshold-1);
      for(var i = 0; i < threshold; i+=1)
        ret[i] = args(i >= index ? i+1:i);

      return ret;
    }
  };
  
  function Cover() {};

  Cover.prototype = {
    "config": {
      "t": 3,
      "threshold": 1,
      "codeUnitSize": 16,
      "args": function(i) { return i+1; },
      "messageDelimiter": function(modMessage,threshold) {
                var delimiter = new Array(threshold*3);
                for(var i = 0; i < delimiter.length; i+=1)
                  delimiter[i] = 255;
                
                return delimiter;
              },
      "messageCompleted": function(data, i, threshold) {
                var done = true;
                for(var j = 0; j < 16 && done; j+=1) {
                  done = done && (data[i+j*4] === 255);
                }
                return done;
              }
    },
    "encode": function(message, image, options) {
      options = options || {};
      var config = this.config;

      var shadowCanvas = document.createElement('canvas'),
        shadowCtx = shadowCanvas.getContext('2d');

      shadowCanvas.style.display = 'none';

      if(image.length) {
        var dataURL = image;
        image = new Image();
        image.src = dataURL;
      }
      shadowCanvas.width = options.width || image.width;
      shadowCanvas.height = options.height || image.height;
      if(options.height && options.width) {
        shadowCtx.drawImage(image, 0, 0, options.width, options.height );
      } else {
        shadowCtx.drawImage(image, 0, 0);
      }
      

      var imageData = shadowCtx.getImageData(0, 0, shadowCanvas.width, shadowCanvas.height),
        data = imageData.data;
      // bundlesPerChar ... Count of full t-bit-sized bundles per Character
      // overlapping ... Count of bits of the currently handled character which are not handled during each run
      var t = options.t || config.t,
        threshold = options.threshold || config.threshold,
        codeUnitSize = options.codeUnitSize || config.codeUnitSize,
        bundlesPerChar = codeUnitSize/t >> 0,
        overlapping = codeUnitSize%t,
        messageDelimiter = options.messageDelimiter || config.messageDelimiter,
        args = options.args || config.args,
        prime = util.findNextPrime(Math.pow(2,t)),
        decM, oldDec, oldMask, modMessage = [], left, right;

      for(var i=0; i<=message.length; i+=1) {
        // dec ... UTF-16 Unicode of the i-th character of the message
        // curOverlapping ... The count of the bits of the previous character not handled in the previous run
        // mask ... The raw initial bitmask, will be changed every run and if bits are overlapping
        var dec = message.charCodeAt(i) || 0, curOverlapping = (overlapping*i)%t, mask;
        if(curOverlapping > 0 && oldDec) {
          mask = Math.pow(2,t-curOverlapping) - 1;
          oldMask = Math.pow(2, codeUnitSize) * (1 - Math.pow(2, -curOverlapping));
          left = (dec & mask) << curOverlapping;
          right = (oldDec & oldMask) >> (codeUnitSize - curOverlapping);
          modMessage.push(left+right);

          if(i<message.length) {
            mask = Math.pow(2,2*t-curOverlapping) * (1 - Math.pow(2, -t));
            for(var j=1; j<bundlesPerChar; j+=1) {
              decM = dec & mask;
              modMessage.push(decM >> (((j-1)*t)+(t-curOverlapping)));
              mask <<= t;
            }
            if((overlapping*(i+1))%t === 0) {
              mask = Math.pow(2, codeUnitSize) * (1 - Math.pow(2,-t));
              decM = dec & mask;
              modMessage.push(decM >> (codeUnitSize-t));
            }
            else if(((((overlapping*(i+1))%t) + (t-curOverlapping)) <= t)) {
              decM = dec & mask;
              modMessage.push(decM >> (((bundlesPerChar-1)*t)+(t-curOverlapping)));
            }
          }
        }
        else if(i<message.length) {
          mask = Math.pow(2,t) - 1;
          for(var j=0; j<bundlesPerChar; j+=1) {
            decM = dec & mask;
            modMessage.push(decM >> (j*t));
            mask <<= t;
          }
        }
        oldDec = dec;
      }

      // Write Data
      var offset, index, subOffset, delimiter = messageDelimiter(modMessage,threshold);
      for(offset = 0; (offset+threshold)*4 <= data.length && (offset+threshold) <= modMessage.length; offset += threshold) {
        var q, qS=[];
        for(var i=0; i<threshold && i+offset < modMessage.length; i+=1) {
          q = 0;
          for(var j=offset; j<threshold+offset && j<modMessage.length; j+=1)
            q+=modMessage[j]*Math.pow(args(i),j-offset);
          qS[i] = (255-prime+1)+(q%prime);
        }
        for(var i=offset*4; i<(offset+qS.length)*4 && i<data.length; i+=4)
          data[i+3] = qS[(i/4)%threshold];
        
        subOffset = qS.length;
      }
      // Write message-delimiter
      for(index = (offset+subOffset); index-(offset+subOffset)<delimiter.length && (offset+delimiter.length)*4<data.length; index+=1)
        data[(index*4)+3]=delimiter[index-(offset+subOffset)];
      // Clear remaining data
      for(var i=((index+1)*4)+3; i<data.length; i+=4) data[i] = 255;

      imageData.data = data;
      shadowCtx.putImageData(imageData, 0, 0);

      return shadowCanvas.toDataURL();
    },
    "decode": function(image, options) {
      options = options || {};
      var config = this.config;
      
      var t = options.t || config.t, threshold = options.threshold || config.threshold,
        codeUnitSize = options.codeUnitSize || config.codeUnitSize, prime = util.findNextPrime(Math.pow(2, t)),
        imageData, data, q, args = options.args || config.args, modMessage = [], 
        messageCompleted = options.messageCompleted || config.messageCompleted;

      if(!t || (t < 1 && t > 7)) throw "Error: Parameter t = " + t + " is not valid: 0 < t < 8";
        
      var shadowCanvas = document.createElement('canvas'),
        shadowCtx = shadowCanvas.getContext('2d');

      shadowCanvas.style.display = 'none';
      document.body.appendChild(shadowCanvas);

      if(image.length) {
        var dataURL = image;
        image = new Image();
        image.src = dataURL;
      }
      shadowCanvas.width = options.width || image.width;
      shadowCanvas.height = options.width || image.height;
      if(options.height && options.width) {
        shadowCtx.drawImage(image, 0, 0, options.width, options.height );
      } else {
        shadowCtx.drawImage(image, 0, 0);
      }

      imageData = shadowCtx.getImageData(0, 0, shadowCanvas.width, shadowCanvas.height);
      data = imageData.data;

      if (threshold === 1) {
        for(var i=3, done=false; !done && i<data.length && !done; i+=4) {
          done = messageCompleted(data, i, threshold);
          if(!done) modMessage.push(data[i]-(255-prime+1));
        }
      } else {
        for(var k = 0, done=false; !done; k+=1) {
          q = [];
          for(var i=(k*threshold*4)+3; i<(k+1)*threshold*4 && i<data.length && !done; i+=4) {
            done = messageCompleted(data,i,threshold);
            if(!done) q.push(data[i]-(255-prime+1)); // at Array index (i-((k*threshold*4)+3))/4
          }
          if(q.length === 0) continue;
          // Calculate the coefficients which are the same for any order of the variable, but different for each argument
          // i.e. for args[0] coeff=q[0]*(args[1]-args[2])*(args[1]-args[3])*...(args[1]-args[threshold-1])*...*(args[threshold-1]-args[1])*...*(args[threshold-1]-args[threshold-2])
          var variableCoefficients = (function(i) {
            if(i >= q.length) return [];
            return [q[i]*
            util.product(function(j) {
            if(j != i) {
              return util.product(function(l) {
              if(l != j) return (args(j) - args(l));
              }, q.length);
            }
            }, q.length)].concat(arguments.callee(i+1));
          }(0));
          // Calculate the coefficients which are different for each order of the variable and for each argument
          // i.e. for order=0 and args[0] coeff=args[1]*args[2]*...*args[threshold-1]
          var orderVariableCoefficients = function(order, varIndex) {
            var workingArgs = util.createArrayFromArgs(args,varIndex,q.length), maxRec = q.length - (order+1);
            return (function(startIndex, endIndex, recDepth) {
            var recall = arguments.callee;
            return util.sum(function(i) {
              if(recDepth < maxRec)
              return workingArgs[i]*recall(i+1,startIndex+order+2,recDepth+1);
            }, endIndex, {"start": startIndex, "defValue": 1});
            }(0,order+1,0));
          };
          // Calculate the common denominator of the whole term
          var commonDenominator = util.product(function(i) {
            return util.product(function(j) {
            if(j != i) return (args(i) - args(j));
            }, q.length);
          }, q.length);

          for(var i = 0; i < q.length; i+=1) {
            modMessage.push((((Math.pow(-1,q.length-(i+1))*util.sum(function(j) {
            return orderVariableCoefficients(i,j)*
            variableCoefficients[j];
            }, q.length))%prime)+prime)%prime); // ?divide by commonDenominator?
          }
        }
      }

      var message = "", charCode = 0, bitCount = 0, mask = Math.pow(2, codeUnitSize)-1;
      for(var i = 0; i < modMessage.length; i+=1) {
        charCode += modMessage[i] << bitCount;
        bitCount += t;
        if(bitCount >= codeUnitSize) {
          message += String.fromCharCode(charCode & mask);
          bitCount %= codeUnitSize;
          charCode = modMessage[i] >> (t-bitCount);
        }
      }
      if(charCode !== 0) message += String.fromCharCode(charCode & mask);

      return message;
    },
    "getHidingCapacity" : function(image, options) {
      options = options || {};
      var config = this.config;
    
      var width = options.width || image.width,
        height = options.height || image.height,
        t = options.t || config.t,
        codeUnitSize = options.codeUnitSize || config.codeUnitSize;
      return t*width*height/codeUnitSize >> 0;
    }
  };
  g.steganography = g.steg = new Cover();
})(window);
</script>

<!--FastClick, used only by iOS-->
<script>
/**
 * @preserve FastClick: polyfill to remove click delays on browsers with touch UIs.
 *
 * @version 1.0.2
 * @codingstandard ftlabs-jsv2
 * @copyright The Financial Times Limited [All Rights Reserved]
 * @license MIT License (see LICENSE.txt)
 */

/*jslint browser:true, node:true*/
/*global define, Event, Node*/


/**
 * Instantiate fast-clicking listeners on the specified layer.
 *
 * @constructor
 * @param {Element} layer The layer to listen on
 * @param {Object} options The options to override the defaults
 */
function FastClick(layer, options) {
	'use strict';
	var oldOnClick;

	options = options || {};

	/**
	 * Whether a click is currently being tracked.
	 *
	 * @type boolean
	 */
	this.trackingClick = false;


	/**
	 * Timestamp for when click tracking started.
	 *
	 * @type number
	 */
	this.trackingClickStart = 0;


	/**
	 * The element being tracked for a click.
	 *
	 * @type EventTarget
	 */
	this.targetElement = null;


	/**
	 * X-coordinate of touch start event.
	 *
	 * @type number
	 */
	this.touchStartX = 0;


	/**
	 * Y-coordinate of touch start event.
	 *
	 * @type number
	 */
	this.touchStartY = 0;


	/**
	 * ID of the last touch, retrieved from Touch.identifier.
	 *
	 * @type number
	 */
	this.lastTouchIdentifier = 0;


	/**
	 * Touchmove boundary, beyond which a click will be cancelled.
	 *
	 * @type number
	 */
	this.touchBoundary = options.touchBoundary || 10;


	/**
	 * The FastClick layer.
	 *
	 * @type Element
	 */
	this.layer = layer;

	/**
	 * The minimum time between tap(touchstart and touchend) events
	 *
	 * @type number
	 */
	this.tapDelay = options.tapDelay || 200;

	if (FastClick.notNeeded(layer)) {
		return;
	}

	// Some old versions of Android don't have Function.prototype.bind
	function bind(method, context) {
		return function() { return method.apply(context, arguments); };
	}


	var methods = ['onMouse', 'onClick', 'onTouchStart', 'onTouchMove', 'onTouchEnd', 'onTouchCancel'];
	var context = this;
	for (var i = 0, l = methods.length; i < l; i++) {
		context[methods[i]] = bind(context[methods[i]], context);
	}

	// Set up event handlers as required
	if (deviceIsAndroid) {
		layer.addEventListener('mouseover', this.onMouse, true);
		layer.addEventListener('mousedown', this.onMouse, true);
		layer.addEventListener('mouseup', this.onMouse, true);
	}

	layer.addEventListener('click', this.onClick, true);
	layer.addEventListener('touchstart', this.onTouchStart, false);
	layer.addEventListener('touchmove', this.onTouchMove, false);
	layer.addEventListener('touchend', this.onTouchEnd, false);
	layer.addEventListener('touchcancel', this.onTouchCancel, false);

	// Hack is required for browsers that don't support Event#stopImmediatePropagation (e.g. Android 2)
	// which is how FastClick normally stops click events bubbling to callbacks registered on the FastClick
	// layer when they are cancelled.
	if (!Event.prototype.stopImmediatePropagation) {
		layer.removeEventListener = function(type, callback, capture) {
			var rmv = Node.prototype.removeEventListener;
			if (type === 'click') {
				rmv.call(layer, type, callback.hijacked || callback, capture);
			} else {
				rmv.call(layer, type, callback, capture);
			}
		};

		layer.addEventListener = function(type, callback, capture) {
			var adv = Node.prototype.addEventListener;
			if (type === 'click') {
				adv.call(layer, type, callback.hijacked || (callback.hijacked = function(event) {
					if (!event.propagationStopped) {
						callback(event);
					}
				}), capture);
			} else {
				adv.call(layer, type, callback, capture);
			}
		};
	}

	// If a handler is already declared in the element's onclick attribute, it will be fired before
	// FastClick's onClick handler. Fix this by pulling out the user-defined handler function and
	// adding it as listener.
	if (typeof layer.onclick === 'function') {

		// Android browser on at least 3.2 requires a new reference to the function in layer.onclick
		// - the old one won't work if passed to addEventListener directly.
		oldOnClick = layer.onclick;
		layer.addEventListener('click', function(event) {
			oldOnClick(event);
		}, false);
		layer.onclick = null;
	}
}


/**
 * Android requires exceptions.
 *
 * @type boolean
 */
var deviceIsAndroid = navigator.userAgent.indexOf('Android') > 0;


/**
 * iOS requires exceptions.
 *
 * @type boolean
 */
var deviceIsIOS = /iP(ad|hone|od)/.test(navigator.userAgent);


/**
 * iOS 4 requires an exception for select elements.
 *
 * @type boolean
 */
var deviceIsIOS4 = deviceIsIOS && (/OS 4_\d(_\d)?/).test(navigator.userAgent);


/**
 * iOS 6.0(+?) requires the target element to be manually derived
 *
 * @type boolean
 */
var deviceIsIOSWithBadTarget = deviceIsIOS && (/OS ([6-9]|\d{2})_\d/).test(navigator.userAgent);

/**
 * BlackBerry requires exceptions.
 *
 * @type boolean
 */
var deviceIsBlackBerry10 = navigator.userAgent.indexOf('BB10') > 0;

/**
 * Determine whether a given element requires a native click.
 *
 * @param {EventTarget|Element} target Target DOM element
 * @returns {boolean} Returns true if the element needs a native click
 */
FastClick.prototype.needsClick = function(target) {
	'use strict';
	switch (target.nodeName.toLowerCase()) {

	// Don't send a synthetic click to disabled inputs (issue #62)
	case 'button':
	case 'select':
	case 'textarea':
		if (target.disabled) {
			return true;
		}

		break;
	case 'input':

		// File inputs need real clicks on iOS 6 due to a browser bug (issue #68)
		if ((deviceIsIOS && target.type === 'file') || target.disabled) {
			return true;
		}

		break;
	case 'label':
	case 'video':
		return true;
	}

	return (/\bneedsclick\b/).test(target.className);
};


/**
 * Determine whether a given element requires a call to focus to simulate click into element.
 *
 * @param {EventTarget|Element} target Target DOM element
 * @returns {boolean} Returns true if the element requires a call to focus to simulate native click.
 */
FastClick.prototype.needsFocus = function(target) {
	'use strict';
	switch (target.nodeName.toLowerCase()) {
	case 'textarea':
		return true;
	case 'select':
		return !deviceIsAndroid;
	case 'input':
		switch (target.type) {
		case 'button':
		case 'checkbox':
		case 'file':
		case 'image':
		case 'radio':
		case 'submit':
			return false;
		}

		// No point in attempting to focus disabled inputs
		return !target.disabled && !target.readOnly;
	default:
		return (/\bneedsfocus\b/).test(target.className);
	}
};


/**
 * Send a click event to the specified element.
 *
 * @param {EventTarget|Element} targetElement
 * @param {Event} event
 */
FastClick.prototype.sendClick = function(targetElement, event) {
	'use strict';
	var clickEvent, touch;

	// On some Android devices activeElement needs to be blurred otherwise the synthetic click will have no effect (#24)
	if (document.activeElement && document.activeElement !== targetElement) {
		document.activeElement.blur();
	}

	touch = event.changedTouches[0];

	// Synthesise a click event, with an extra attribute so it can be tracked
	clickEvent = document.createEvent('MouseEvents');
	clickEvent.initMouseEvent(this.determineEventType(targetElement), true, true, window, 1, touch.screenX, touch.screenY, touch.clientX, touch.clientY, false, false, false, false, 0, null);
	clickEvent.forwardedTouchEvent = true;
	targetElement.dispatchEvent(clickEvent);
};

FastClick.prototype.determineEventType = function(targetElement) {
	'use strict';

	//Issue #159: Android Chrome Select Box does not open with a synthetic click event
	if (deviceIsAndroid && targetElement.tagName.toLowerCase() === 'select') {
		return 'mousedown';
	}

	return 'click';
};


/**
 * @param {EventTarget|Element} targetElement
 */
FastClick.prototype.focus = function(targetElement) {
	'use strict';
	var length;

	// Issue #160: on iOS 7, some input elements (e.g. date datetime) throw a vague TypeError on setSelectionRange. These elements don't have an integer value for the selectionStart and selectionEnd properties, but unfortunately that can't be used for detection because accessing the properties also throws a TypeError. Just check the type instead. Filed as Apple bug #15122724.
	if (deviceIsIOS && targetElement.setSelectionRange && targetElement.type.indexOf('date') !== 0 && targetElement.type !== 'time') {
		length = targetElement.value.length;
		targetElement.setSelectionRange(length, length);
	} else {
		targetElement.focus();
	}
};


/**
 * Check whether the given target element is a child of a scrollable layer and if so, set a flag on it.
 *
 * @param {EventTarget|Element} targetElement
 */
FastClick.prototype.updateScrollParent = function(targetElement) {
	'use strict';
	var scrollParent, parentElement;

	scrollParent = targetElement.fastClickScrollParent;

	// Attempt to discover whether the target element is contained within a scrollable layer. Re-check if the
	// target element was moved to another parent.
	if (!scrollParent || !scrollParent.contains(targetElement)) {
		parentElement = targetElement;
		do {
			if (parentElement.scrollHeight > parentElement.offsetHeight) {
				scrollParent = parentElement;
				targetElement.fastClickScrollParent = parentElement;
				break;
			}

			parentElement = parentElement.parentElement;
		} while (parentElement);
	}

	// Always update the scroll top tracker if possible.
	if (scrollParent) {
		scrollParent.fastClickLastScrollTop = scrollParent.scrollTop;
	}
};


/**
 * @param {EventTarget} targetElement
 * @returns {Element|EventTarget}
 */
FastClick.prototype.getTargetElementFromEventTarget = function(eventTarget) {
	'use strict';

	// On some older browsers (notably Safari on iOS 4.1 - see issue #56) the event target may be a text node.
	if (eventTarget.nodeType === Node.TEXT_NODE) {
		return eventTarget.parentNode;
	}

	return eventTarget;
};


/**
 * On touch start, record the position and scroll offset.
 *
 * @param {Event} event
 * @returns {boolean}
 */
FastClick.prototype.onTouchStart = function(event) {
	'use strict';
	var targetElement, touch, selection;

	// Ignore multiple touches, otherwise pinch-to-zoom is prevented if both fingers are on the FastClick element (issue #111).
	if (event.targetTouches.length > 1) {
		return true;
	}

	targetElement = this.getTargetElementFromEventTarget(event.target);
	touch = event.targetTouches[0];

	if (deviceIsIOS) {

		// Only trusted events will deselect text on iOS (issue #49)
		selection = window.getSelection();
		if (selection.rangeCount && !selection.isCollapsed) {
			return true;
		}

		if (!deviceIsIOS4) {

			// Weird things happen on iOS when an alert or confirm dialog is opened from a click event callback (issue #23):
			// when the user next taps anywhere else on the page, new touchstart and touchend events are dispatched
			// with the same identifier as the touch event that previously triggered the click that triggered the alert.
			// Sadly, there is an issue on iOS 4 that causes some normal touch events to have the same identifier as an
			// immediately preceeding touch event (issue #52), so this fix is unavailable on that platform.
			if (touch.identifier === this.lastTouchIdentifier) {
				event.preventDefault();
				return false;
			}

			this.lastTouchIdentifier = touch.identifier;

			// If the target element is a child of a scrollable layer (using -webkit-overflow-scrolling: touch) and:
			// 1) the user does a fling scroll on the scrollable layer
			// 2) the user stops the fling scroll with another tap
			// then the event.target of the last 'touchend' event will be the element that was under the user's finger
			// when the fling scroll was started, causing FastClick to send a click event to that layer - unless a check
			// is made to ensure that a parent layer was not scrolled before sending a synthetic click (issue #42).
			this.updateScrollParent(targetElement);
		}
	}

	this.trackingClick = true;
	this.trackingClickStart = event.timeStamp;
	this.targetElement = targetElement;

	this.touchStartX = touch.pageX;
	this.touchStartY = touch.pageY;

	// Prevent phantom clicks on fast double-tap (issue #36)
	if ((event.timeStamp - this.lastClickTime) < this.tapDelay) {
		event.preventDefault();
	}

	return true;
};


/**
 * Based on a touchmove event object, check whether the touch has moved past a boundary since it started.
 *
 * @param {Event} event
 * @returns {boolean}
 */
FastClick.prototype.touchHasMoved = function(event) {
	'use strict';
	var touch = event.changedTouches[0], boundary = this.touchBoundary;

	if (Math.abs(touch.pageX - this.touchStartX) > boundary || Math.abs(touch.pageY - this.touchStartY) > boundary) {
		return true;
	}

	return false;
};


/**
 * Update the last position.
 *
 * @param {Event} event
 * @returns {boolean}
 */
FastClick.prototype.onTouchMove = function(event) {
	'use strict';
	if (!this.trackingClick) {
		return true;
	}

	// If the touch has moved, cancel the click tracking
	if (this.targetElement !== this.getTargetElementFromEventTarget(event.target) || this.touchHasMoved(event)) {
		this.trackingClick = false;
		this.targetElement = null;
	}

	return true;
};


/**
 * Attempt to find the labelled control for the given label element.
 *
 * @param {EventTarget|HTMLLabelElement} labelElement
 * @returns {Element|null}
 */
FastClick.prototype.findControl = function(labelElement) {
	'use strict';

	// Fast path for newer browsers supporting the HTML5 control attribute
	if (labelElement.control !== undefined) {
		return labelElement.control;
	}

	// All browsers under test that support touch events also support the HTML5 htmlFor attribute
	if (labelElement.htmlFor) {
		return document.getElementById(labelElement.htmlFor);
	}

	// If no for attribute exists, attempt to retrieve the first labellable descendant element
	// the list of which is defined here: http://www.w3.org/TR/html5/forms.html#category-label
	return labelElement.querySelector('button, input:not([type=hidden]), keygen, meter, output, progress, select, textarea');
};


/**
 * On touch end, determine whether to send a click event at once.
 *
 * @param {Event} event
 * @returns {boolean}
 */
FastClick.prototype.onTouchEnd = function(event) {
	'use strict';
	var forElement, trackingClickStart, targetTagName, scrollParent, touch, targetElement = this.targetElement;

	if (!this.trackingClick) {
		return true;
	}

	// Prevent phantom clicks on fast double-tap (issue #36)
	if ((event.timeStamp - this.lastClickTime) < this.tapDelay) {
		this.cancelNextClick = true;
		return true;
	}

	// Reset to prevent wrong click cancel on input (issue #156).
	this.cancelNextClick = false;

	this.lastClickTime = event.timeStamp;

	trackingClickStart = this.trackingClickStart;
	this.trackingClick = false;
	this.trackingClickStart = 0;

	// On some iOS devices, the targetElement supplied with the event is invalid if the layer
	// is performing a transition or scroll, and has to be re-detected manually. Note that
	// for this to function correctly, it must be called *after* the event target is checked!
	// See issue #57; also filed as rdar://13048589 .
	if (deviceIsIOSWithBadTarget) {
		touch = event.changedTouches[0];

		// In certain cases arguments of elementFromPoint can be negative, so prevent setting targetElement to null
		targetElement = document.elementFromPoint(touch.pageX - window.pageXOffset, touch.pageY - window.pageYOffset) || targetElement;
		targetElement.fastClickScrollParent = this.targetElement.fastClickScrollParent;
	}

	targetTagName = targetElement.tagName.toLowerCase();
	if (targetTagName === 'label') {
		forElement = this.findControl(targetElement);
		if (forElement) {
			this.focus(targetElement);
			if (deviceIsAndroid) {
				return false;
			}

			targetElement = forElement;
		}
	} else if (this.needsFocus(targetElement)) {

		// Case 1: If the touch started a while ago (best guess is 100ms based on tests for issue #36) then focus will be triggered anyway. Return early and unset the target element reference so that the subsequent click will be allowed through.
		// Case 2: Without this exception for input elements tapped when the document is contained in an iframe, then any inputted text won't be visible even though the value attribute is updated as the user types (issue #37).
		if ((event.timeStamp - trackingClickStart) > 100 || (deviceIsIOS && window.top !== window && targetTagName === 'input')) {
			this.targetElement = null;
			return false;
		}

		this.focus(targetElement);
		this.sendClick(targetElement, event);

		// Select elements need the event to go through on iOS 4, otherwise the selector menu won't open.
		// Also this breaks opening selects when VoiceOver is active on iOS6, iOS7 (and possibly others)
		if (!deviceIsIOS || targetTagName !== 'select') {
			this.targetElement = null;
			event.preventDefault();
		}

		return false;
	}

	if (deviceIsIOS && !deviceIsIOS4) {

		// Don't send a synthetic click event if the target element is contained within a parent layer that was scrolled
		// and this tap is being used to stop the scrolling (usually initiated by a fling - issue #42).
		scrollParent = targetElement.fastClickScrollParent;
		if (scrollParent && scrollParent.fastClickLastScrollTop !== scrollParent.scrollTop) {
			return true;
		}
	}

	// Prevent the actual click from going though - unless the target node is marked as requiring
	// real clicks or if it is in the whitelist in which case only non-programmatic clicks are permitted.
	if (!this.needsClick(targetElement)) {
		event.preventDefault();
		this.sendClick(targetElement, event);
	}

	return false;
};


/**
 * On touch cancel, stop tracking the click.
 *
 * @returns {void}
 */
FastClick.prototype.onTouchCancel = function() {
	'use strict';
	this.trackingClick = false;
	this.targetElement = null;
};


/**
 * Determine mouse events which should be permitted.
 *
 * @param {Event} event
 * @returns {boolean}
 */
FastClick.prototype.onMouse = function(event) {
	'use strict';

	// If a target element was never set (because a touch event was never fired) allow the event
	if (!this.targetElement) {
		return true;
	}

	if (event.forwardedTouchEvent) {
		return true;
	}

	// Programmatically generated events targeting a specific element should be permitted
	if (!event.cancelable) {
		return true;
	}

	// Derive and check the target element to see whether the mouse event needs to be permitted;
	// unless explicitly enabled, prevent non-touch click events from triggering actions,
	// to prevent ghost/doubleclicks.
	if (!this.needsClick(this.targetElement) || this.cancelNextClick) {

		// Prevent any user-added listeners declared on FastClick element from being fired.
		if (event.stopImmediatePropagation) {
			event.stopImmediatePropagation();
		} else {

			// Part of the hack for browsers that don't support Event#stopImmediatePropagation (e.g. Android 2)
			event.propagationStopped = true;
		}

		// Cancel the event
		event.stopPropagation();
		event.preventDefault();

		return false;
	}

	// If the mouse event is permitted, return true for the action to go through.
	return true;
};


/**
 * On actual clicks, determine whether this is a touch-generated click, a click action occurring
 * naturally after a delay after a touch (which needs to be cancelled to avoid duplication), or
 * an actual click which should be permitted.
 *
 * @param {Event} event
 * @returns {boolean}
 */
FastClick.prototype.onClick = function(event) {
	'use strict';
	var permitted;

	// It's possible for another FastClick-like library delivered with third-party code to fire a click event before FastClick does (issue #44). In that case, set the click-tracking flag back to false and return early. This will cause onTouchEnd to return early.
	if (this.trackingClick) {
		this.targetElement = null;
		this.trackingClick = false;
		return true;
	}

	// Very odd behaviour on iOS (issue #18): if a submit element is present inside a form and the user hits enter in the iOS simulator or clicks the Go button on the pop-up OS keyboard the a kind of 'fake' click event will be triggered with the submit-type input element as the target.
	if (event.target.type === 'submit' && event.detail === 0) {
		return true;
	}

	permitted = this.onMouse(event);

	// Only unset targetElement if the click is not permitted. This will ensure that the check for !targetElement in onMouse fails and the browser's click doesn't go through.
	if (!permitted) {
		this.targetElement = null;
	}

	// If clicks are permitted, return true for the action to go through.
	return permitted;
};


/**
 * Remove all FastClick's event listeners.
 *
 * @returns {void}
 */
FastClick.prototype.destroy = function() {
	'use strict';
	var layer = this.layer;

	if (deviceIsAndroid) {
		layer.removeEventListener('mouseover', this.onMouse, true);
		layer.removeEventListener('mousedown', this.onMouse, true);
		layer.removeEventListener('mouseup', this.onMouse, true);
	}

	layer.removeEventListener('click', this.onClick, true);
	layer.removeEventListener('touchstart', this.onTouchStart, false);
	layer.removeEventListener('touchmove', this.onTouchMove, false);
	layer.removeEventListener('touchend', this.onTouchEnd, false);
	layer.removeEventListener('touchcancel', this.onTouchCancel, false);
};


/**
 * Check whether FastClick is needed.
 *
 * @param {Element} layer The layer to listen on
 */
FastClick.notNeeded = function(layer) {
	'use strict';
	var metaViewport;
	var chromeVersion;
	var blackberryVersion;

	// Devices that don't support touch don't need FastClick
	if (typeof window.ontouchstart === 'undefined') {
		return true;
	}

	// Chrome version - zero for other browsers
	chromeVersion = +(/Chrome\/([0-9]+)/.exec(navigator.userAgent) || [,0])[1];

	if (chromeVersion) {

		if (deviceIsAndroid) {
			metaViewport = document.querySelector('meta[name=viewport]');

			if (metaViewport) {
				// Chrome on Android with user-scalable="no" doesn't need FastClick (issue #89)
				if (metaViewport.content.indexOf('user-scalable=no') !== -1) {
					return true;
				}
				// Chrome 32 and above with width=device-width or less don't need FastClick
				if (chromeVersion > 31 && document.documentElement.scrollWidth <= window.outerWidth) {
					return true;
				}
			}

		// Chrome desktop doesn't need FastClick (issue #15)
		} else {
			return true;
		}
	}

	if (deviceIsBlackBerry10) {
		blackberryVersion = navigator.userAgent.match(/Version\/([0-9]*)\.([0-9]*)/);

		// BlackBerry 10.3+ does not require Fastclick library.
		// https://github.com/ftlabs/fastclick/issues/251
		if (blackberryVersion[1] >= 10 && blackberryVersion[2] >= 3) {
			metaViewport = document.querySelector('meta[name=viewport]');

			if (metaViewport) {
				// user-scalable=no eliminates click delay.
				if (metaViewport.content.indexOf('user-scalable=no') !== -1) {
					return true;
				}
				// width=device-width (or less than device-width) eliminates click delay.
				if (document.documentElement.scrollWidth <= window.outerWidth) {
					return true;
				}
			}
		}
	}

	// IE10 with -ms-touch-action: none, which disables double-tap-to-zoom (issue #97)
	if (layer.style.msTouchAction === 'none') {
		return true;
	}

	return false;
};


/**
 * Factory method for creating a FastClick object
 *
 * @param {Element} layer The layer to listen on
 * @param {Object} options The options to override the defaults
 */
FastClick.attach = function(layer, options) {
	'use strict';
	return new FastClick(layer, options);
};


if (typeof define == 'function' && typeof define.amd == 'object' && define.amd) {

	// AMD. Register as an anonymous module.
	define(function() {
		'use strict';
		return FastClick;
	});
} else if (typeof module !== 'undefined' && module.exports) {
	module.exports = FastClick.attach;
	module.exports.FastClick = FastClick;
} else {
	window.FastClick = FastClick;
}
</script>

<!--SJCL libraries-->
<script>
/*SJCL.js begins
 *
 * @author Emily Stark
 * @author Mike Hamburg
 * @author Dan Boneh
 * @author Jeff Mott
 * @author Stefan Thomas
 */

"use strict";
var sjcl = {
    cipher: {},
    hash: {},
    keyexchange: {},
    mode: {},
    misc: {},
    codec: {},
    exception: {
	corrupt: function (a) {
	    this.toString = function () {
		return "CORRUPT: " + this.message
	    };
	    this.message = a
	},
	invalid: function (a) {
	    this.toString = function () {
		return "INVALID: " + this.message
	    };
	    this.message = a
	},
	bug: function (a) {
	    this.toString = function () {
		return "BUG: " + this.message
	    };
	    this.message = a
	},
	notReady: function (a) {
	    this.toString = function () {
		return "NOT READY: " + this.message
	    };
	    this.message = a
	}
    }
};
if (typeof module != "undefined" && module.exports) module.exports = sjcl;
sjcl.cipher.aes = function (a) {
    this.h[0][0][0] || this.z();
    var b, c, d, e, f = this.h[0][4],
	g = this.h[1];
    b = a.length;
    var h = 1;
    if (b !== 4 && b !== 6 && b !== 8) throw new sjcl.exception.invalid("invalid aes key size");
    this.a = [d = a.slice(0), e = []];
    for (a = b; a < 4 * b + 28; a++) {
	c = d[a - 1];
	if (a % b === 0 || b === 8 && a % b === 4) {
	    c = f[c >>> 24] << 24 ^ f[c >> 16 & 255] << 16 ^ f[c >> 8 & 255] << 8 ^ f[c & 255];
	    if (a % b === 0) {
		c = c << 8 ^ c >>> 24 ^ h << 24;
		h = h << 1 ^ (h >> 7) * 283
	    }
	}
	d[a] = d[a - b] ^ c
    }
    for (b = 0; a; b++, a--) {
	c = d[b & 3 ? a : a - 4];
	e[b] = a <= 4 || b < 4 ? c : g[0][f[c >>> 24]] ^ g[1][f[c >> 16 & 255]] ^ g[2][f[c >> 8 & 255]] ^ g[3][f[c & 255]]
    }
};
sjcl.cipher.aes.prototype = {
    encrypt: function (a) {
	return this.I(a, 0)
    },
    decrypt: function (a) {
	return this.I(a, 1)
    },
    h: [
	[
	    [],
	    [],
	    [],
	    [],
	    []
	],
	[
	    [],
	    [],
	    [],
	    [],
	    []
	]
    ],
    z: function () {
	var a = this.h[0],
	    b = this.h[1],
	    c = a[4],
	    d = b[4],
	    e, f, g, h = [],
	    i = [],
	    k, j, l, m;
	for (e = 0; e < 0x100; e++) i[(h[e] = e << 1 ^ (e >> 7) * 283) ^ e] = e;
	for (f = g = 0; !c[f]; f ^= k || 1, g = i[g] || 1) {
	    l = g ^ g << 1 ^ g << 2 ^ g << 3 ^ g << 4;
	    l = l >> 8 ^ l & 255 ^ 99;
	    c[f] = l;
	    d[l] = f;
	    j = h[e = h[k = h[f]]];
	    m = j * 0x1010101 ^ e * 0x10001 ^ k * 0x101 ^ f * 0x1010100;
	    j = h[l] * 0x101 ^ l * 0x1010100;
	    for (e = 0; e < 4; e++) {
		a[e][f] = j = j << 24 ^ j >>> 8;
		b[e][l] = m = m << 24 ^ m >>> 8
	    }
	}
	for (e = 0; e < 5; e++) {
	    a[e] = a[e].slice(0);
	    b[e] = b[e].slice(0)
	}
    },
    I: function (a, b) {
	if (a.length !== 4) throw new sjcl.exception.invalid("invalid aes block size");
	var c = this.a[b],
	    d = a[0] ^ c[0],
	    e = a[b ? 3 : 1] ^ c[1],
	    f = a[2] ^ c[2];
	a = a[b ? 1 : 3] ^ c[3];
	var g, h, i, k = c.length / 4 - 2,
	    j, l = 4,
	    m = [0, 0, 0, 0];
	g = this.h[b];
	var n = g[0],
	    o = g[1],
	    p = g[2],
	    q = g[3],
	    r = g[4];
	for (j = 0; j < k; j++) {
	    g = n[d >>> 24] ^ o[e >> 16 & 255] ^ p[f >> 8 & 255] ^ q[a & 255] ^ c[l];
	    h = n[e >>> 24] ^ o[f >> 16 & 255] ^ p[a >> 8 & 255] ^ q[d & 255] ^ c[l + 1];
	    i = n[f >>> 24] ^ o[a >> 16 & 255] ^ p[d >> 8 & 255] ^ q[e & 255] ^ c[l + 2];
	    a = n[a >>> 24] ^ o[d >> 16 & 255] ^ p[e >> 8 & 255] ^ q[f & 255] ^ c[l + 3];
	    l += 4;
	    d = g;
	    e = h;
	    f = i
	}
	for (j = 0; j < 4; j++) {
	    m[b ? 3 & -j : j] = r[d >>> 24] << 24 ^ r[e >> 16 & 255] << 16 ^ r[f >> 8 & 255] << 8 ^ r[a & 255] ^ c[l++];
	    g = d;
	    d = e;
	    e = f;
	    f = a;
	    a = g
	}
	return m
    }
};
sjcl.bitArray = {
    bitSlice: function (a, b, c) {
	a = sjcl.bitArray.P(a.slice(b / 32), 32 - (b & 31)).slice(1);
	return c === undefined ? a : sjcl.bitArray.clamp(a, c - b)
    },
    extract: function (a, b, c) {
	var d = Math.floor(-b - c & 31);
	return ((b + c - 1 ^ b) & -32 ? a[b / 32 | 0] << 32 - d ^ a[b / 32 + 1 | 0] >>> d : a[b / 32 | 0] >>> d) & (1 << c) - 1
    },
    concat: function (a, b) {
	if (a.length === 0 || b.length === 0) return a.concat(b);
	var c = a[a.length - 1],
	    d = sjcl.bitArray.getPartial(c);
	return d === 32 ? a.concat(b) : sjcl.bitArray.P(b, d, c | 0, a.slice(0, a.length - 1))
    },
    bitLength: function (a) {
	var b = a.length;
	if (b === 0) return 0;
	return (b - 1) * 32 + sjcl.bitArray.getPartial(a[b - 1])
    },
    clamp: function (a, b) {
	if (a.length * 32 < b) return a;
	a = a.slice(0, Math.ceil(b / 32));
	var c = a.length;
	b &= 31;
	if (c > 0 && b) a[c - 1] = sjcl.bitArray.partial(b, a[c - 1] & 2147483648 >> b - 1, 1);
	return a
    },
    partial: function (a, b, c) {
	if (a === 32) return b;
	return (c ? b | 0 : b << 32 - a) + a * 0x10000000000
    },
    getPartial: function (a) {
	return Math.round(a / 0x10000000000) || 32
    },
    equal: function (a, b) {
	if (sjcl.bitArray.bitLength(a) !== sjcl.bitArray.bitLength(b)) return false;
	var c = 0,
	    d;
	for (d = 0; d < a.length; d++) c |= a[d] ^ b[d];
	return c === 0
    },
    P: function (a, b, c, d) {
	var e;
	e = 0;
	if (d === undefined) d = [];
	for (; b >= 32; b -= 32) {
	    d.push(c);
	    c = 0
	}
	if (b === 0) return d.concat(a);
	for (e = 0; e < a.length; e++) {
	    d.push(c | a[e] >>> b);
	    c = a[e] << 32 - b
	}
	e = a.length ? a[a.length - 1] : 0;
	a = sjcl.bitArray.getPartial(e);
	d.push(sjcl.bitArray.partial(b + a & 31, b + a > 32 ? c : d.pop(), 1));
	return d
    },
    k: function (a, b) {
	return [a[0] ^ b[0], a[1] ^ b[1], a[2] ^ b[2], a[3] ^ b[3]]
    }
};
sjcl.codec.utf8String = {
    fromBits: function (a) {
	var b = "",
	    c = sjcl.bitArray.bitLength(a),
	    d, e;
	for (d = 0; d < c / 8; d++) {
	    if ((d & 3) === 0) e = a[d / 4];
	    b += String.fromCharCode(e >>> 24);
	    e <<= 8
	}
	return decodeURIComponent(escape(b))
    },
    toBits: function (a) {
	a = unescape(encodeURIComponent(a));
	var b = [],
	    c, d = 0;
	for (c = 0; c < a.length; c++) {
	    d = d << 8 | a.charCodeAt(c);
	    if ((c & 3) === 3) {
		b.push(d);
		d = 0
	    }
	}
	c & 3 && b.push(sjcl.bitArray.partial(8 * (c & 3), d));
	return b
    }
};
sjcl.codec.hex = {
    fromBits: function (a) {
	var b = "",
	    c;
	for (c = 0; c < a.length; c++) b += ((a[c] | 0) + 0xf00000000000).toString(16).substr(4);
	return b.substr(0, sjcl.bitArray.bitLength(a) / 4)
    },
    toBits: function (a) {
	var b, c = [],
	    d;
	a = a.replace(/\s|0x/g, "");
	d = a.length;
	a += "00000000";
	for (b = 0; b < a.length; b += 8) c.push(parseInt(a.substr(b, 8), 16) ^ 0);
	return sjcl.bitArray.clamp(c, d * 4)
    }
};
sjcl.codec.base64 = {
    F: "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",
    fromBits: function (a, b, c) {
	var d = "",
	    e = 0,
	    f = sjcl.codec.base64.F,
	    g = 0,
	    h = sjcl.bitArray.bitLength(a);
	if (c) f = f.substr(0, 62) + "-_";
	for (c = 0; d.length * 6 < h;) {
	    d += f.charAt((g ^ a[c] >>> e) >>> 26);
	    if (e < 6) {
		g = a[c] << 6 - e;
		e += 26;
		c++
	    } else {
		g <<= 6;
		e -= 6
	    }
	}
	for (; d.length & 3 && !b;) d += "=";
	return d
    },
    toBits: function (a, b) {
	a = a.replace(/\s|=/g, "");
	var c = [],
	    d = 0,
	    e = sjcl.codec.base64.F,
	    f = 0,
	    g;
	if (b) e = e.substr(0, 62) + "-_";
	for (b = 0; b < a.length; b++) {
	    g = e.indexOf(a.charAt(b));
	    if (g < 0) throw new sjcl.exception.invalid("this isn't base64!");
	    if (d > 26) {
		d -= 26;
		c.push(f ^ g >>> d);
		f = g << 32 - d
	    } else {
		d += 6;
		f ^= g << 32 - d
	    }
	}
	d & 56 && c.push(sjcl.bitArray.partial(d & 56, f, 1));
	return c
    }
};
sjcl.codec.base64url = {
    fromBits: function (a) {
	return sjcl.codec.base64.fromBits(a, 1, 1)
    },
    toBits: function (a) {
	return sjcl.codec.base64.toBits(a, 1)
    }
};
sjcl.hash.sha256 = function (a) {
    this.a[0] || this.z();
    if (a) {
	this.n = a.n.slice(0);
	this.i = a.i.slice(0);
	this.e = a.e
    } else this.reset()
};
sjcl.hash.sha256.hash = function (a) {
    return (new sjcl.hash.sha256).update(a).finalize()
};
sjcl.hash.sha256.prototype = {
    blockSize: 512,
    reset: function () {
	this.n = this.N.slice(0);
	this.i = [];
	this.e = 0;
	return this
    },
    update: function (a) {
	if (typeof a === "string") a = sjcl.codec.utf8String.toBits(a);
	var b, c = this.i = sjcl.bitArray.concat(this.i, a);
	b = this.e;
	a = this.e = b + sjcl.bitArray.bitLength(a);
	for (b = 512 + b & -512; b <= a; b += 512) this.D(c.splice(0, 16));
	return this
    },
    finalize: function () {
	var a, b = this.i,
	    c = this.n;
	b = sjcl.bitArray.concat(b, [sjcl.bitArray.partial(1, 1)]);
	for (a = b.length + 2; a & 15; a++) b.push(0);
	b.push(Math.floor(this.e / 4294967296));
	for (b.push(this.e | 0); b.length;) this.D(b.splice(0, 16));
	this.reset();
	return c
    },
    N: [],
    a: [],
    z: function () {
	function a(e) {
	    return (e - Math.floor(e)) * 0x100000000 | 0
	}
	var b = 0,
	    c = 2,
	    d;
	a: for (; b < 64; c++) {
	    for (d = 2; d * d <= c; d++) if (c % d === 0) continue a;
	    if (b < 8) this.N[b] = a(Math.pow(c, 0.5));
	    this.a[b] = a(Math.pow(c, 1 / 3));
	    b++
	}
    },
    D: function (a) {
	var b, c, d = a.slice(0),
	    e = this.n,
	    f = this.a,
	    g = e[0],
	    h = e[1],
	    i = e[2],
	    k = e[3],
	    j = e[4],
	    l = e[5],
	    m = e[6],
	    n = e[7];
	for (a = 0; a < 64; a++) {
	    if (a < 16) b = d[a];
	    else {
		b = d[a + 1 & 15];
		c = d[a + 14 & 15];
		b = d[a & 15] = (b >>> 7 ^ b >>> 18 ^ b >>> 3 ^ b << 25 ^ b << 14) + (c >>> 17 ^ c >>> 19 ^ c >>> 10 ^ c << 15 ^ c << 13) + d[a & 15] + d[a + 9 & 15] | 0
	    }
	    b = b + n + (j >>> 6 ^ j >>> 11 ^ j >>> 25 ^ j << 26 ^ j << 21 ^ j << 7) + (m ^ j & (l ^ m)) + f[a];
	    n = m;
	    m = l;
	    l = j;
	    j = k + b | 0;
	    k = i;
	    i = h;
	    h = g;
	    g = b + (h & i ^ k & (h ^ i)) + (h >>> 2 ^ h >>> 13 ^ h >>> 22 ^ h << 30 ^ h << 19 ^ h << 10) | 0
	}
	e[0] = e[0] + g | 0;
	e[1] = e[1] + h | 0;
	e[2] = e[2] + i | 0;
	e[3] = e[3] + k | 0;
	e[4] = e[4] + j | 0;
	e[5] = e[5] + l | 0;
	e[6] = e[6] + m | 0;
	e[7] = e[7] + n | 0
    }
};
sjcl.mode.ccm = {
    name: "ccm",
    encrypt: function (a, b, c, d, e) {
	var f, g = b.slice(0),
	    h = sjcl.bitArray,
	    i = h.bitLength(c) / 8,
	    k = h.bitLength(g) / 8;
	e = e || 64;
	d = d || [];
	if (i < 7) throw new sjcl.exception.invalid("ccm: iv must be at least 7 bytes");
	for (f = 2; f < 4 && k >>> 8 * f; f++);
	if (f < 15 - i) f = 15 - i;
	c = h.clamp(c, 8 * (15 - f));
	b = sjcl.mode.ccm.H(a, b, c, d, e, f);
	g = sjcl.mode.ccm.J(a, g, c, b, e, f);
	return h.concat(g.data, g.tag)
    },
    decrypt: function (a, b, c, d, e) {
	e = e || 64;
	d = d || [];
	var f = sjcl.bitArray,
	    g = f.bitLength(c) / 8,
	    h = f.bitLength(b),
	    i = f.clamp(b, h - e),
	    k = f.bitSlice(b,
	    h - e);
	h = (h - e) / 8;
	if (g < 7) throw new sjcl.exception.invalid("ccm: iv must be at least 7 bytes");
	for (b = 2; b < 4 && h >>> 8 * b; b++);
	if (b < 15 - g) b = 15 - g;
	c = f.clamp(c, 8 * (15 - b));
	i = sjcl.mode.ccm.J(a, i, c, k, e, b);
	a = sjcl.mode.ccm.H(a, i.data, c, d, e, b);
	if (!f.equal(i.tag, a)){

		if(document.getElementById("lockBox").value.slice(0,1) == '~' || isList || nameBeingUnlocked != ''){				//modified to add alert in PassLok
			any2key();																				//
			document.getElementById("keymsg").innerHTML = "<span style='color:red'>This Key won't unlock the item </span>" + nameBeingUnlocked;
			allowCancelWfullAccess = true;																//
		}else if(document.getElementById('keyChange').style.display == 'block'){				//
			document.getElementById('keyChange').style.display = 'none';						//
			document.getElementById("keymsg").innerHTML = "<span style='color:red'>The Old Key is wrong</span>"
		}else if (checkingKey){																	//
			document.getElementById('shadow').style.display = 'block';							//
			document.getElementById('keyscr').style.display = 'block';							//
			document.getElementById('keymsg').innerHTML = "<span style='color:red'>Please write the last Key you used</span><br>You can change the Key in Options";
			checkingKey = false;																	//
		}else{																						//
			document.getElementById("mainmsg").innerHTML = '<span>Unlock has Failed</span>';//
		}																							//

	throw new sjcl.exception.corrupt("ccm: tag doesn't match")
	};
	return i.data
    },
    H: function (a, b, c, d, e, f) {
	var g = [],
	    h = sjcl.bitArray,
	    i = h.k;
	e /= 8;
	if (e % 2 || e < 4 || e > 16) throw new sjcl.exception.invalid("ccm: invalid tag length");
	if (d.length > 0xffffffff || b.length > 0xffffffff) throw new sjcl.exception.bug("ccm: can't deal with 4GiB or more data");
	f = [h.partial(8, (d.length ? 64 : 0) | e - 2 << 2 | f - 1)];
	f = h.concat(f, c);
	f[3] |= h.bitLength(b) / 8;
	f = a.encrypt(f);
	if (d.length) {
	    c = h.bitLength(d) / 8;
	    if (c <= 65279) g = [h.partial(16, c)];
	    else if (c <= 0xffffffff) g = h.concat([h.partial(16, 65534)], [c]);
	    g = h.concat(g, d);
	    for (d = 0; d < g.length; d += 4) f = a.encrypt(i(f, g.slice(d, d + 4).concat([0, 0, 0])))
	}
	for (d = 0; d < b.length; d += 4) f = a.encrypt(i(f, b.slice(d, d + 4).concat([0, 0, 0])));
	return h.clamp(f, e * 8)
    },
    J: function (a, b, c, d, e, f) {
	var g, h = sjcl.bitArray;
	g = h.k;
	var i = b.length,
	    k = h.bitLength(b);
	c = h.concat([h.partial(8,
	f - 1)], c).concat([0, 0, 0]).slice(0, 4);
	d = h.bitSlice(g(d, a.encrypt(c)), 0, e);
	if (!i) return {
	    tag: d,
	    data: []
	};
	for (g = 0; g < i; g += 4) {
	    c[3]++;
	    e = a.encrypt(c);
	    b[g] ^= e[0];
	    b[g + 1] ^= e[1];
	    b[g + 2] ^= e[2];
	    b[g + 3] ^= e[3]
	}
	return {
	    tag: d,
	    data: h.clamp(b, k)
	}
    }
};
sjcl.mode.ocb2 = {
    name: "ocb2",
    encrypt: function (a, b, c, d, e, f) {
	if (sjcl.bitArray.bitLength(c) !== 128) throw new sjcl.exception.invalid("ocb iv must be 128 bits");
	var g, h = sjcl.mode.ocb2.B,
	    i = sjcl.bitArray,
	    k = i.k,
	    j = [0, 0, 0, 0];
	c = h(a.encrypt(c));
	var l, m = [];
	d = d || [];
	e = e || 64;
	for (g = 0; g + 4 < b.length; g += 4) {
	    l = b.slice(g, g + 4);
	    j = k(j, l);
	    m = m.concat(k(c, a.encrypt(k(c, l))));
	    c = h(c)
	}
	l = b.slice(g);
	b = i.bitLength(l);
	g = a.encrypt(k(c, [0, 0, 0, b]));
	l = i.clamp(k(l.concat([0, 0, 0]), g), b);
	j = k(j, k(l.concat([0, 0, 0]), g));
	j = a.encrypt(k(j, k(c, h(c))));
	if (d.length) j = k(j, f ? d : sjcl.mode.ocb2.pmac(a, d));
	return m.concat(i.concat(l, i.clamp(j, e)))
    },
    decrypt: function (a, b, c, d, e, f) {
	if (sjcl.bitArray.bitLength(c) !== 128) throw new sjcl.exception.invalid("ocb iv must be 128 bits");
	e = e || 64;
	var g = sjcl.mode.ocb2.B,
	    h = sjcl.bitArray,
	    i = h.k,
	    k = [0, 0, 0, 0],
	    j = g(a.encrypt(c)),
	    l, m, n = sjcl.bitArray.bitLength(b) - e,
	    o = [];
	d = d || [];
	for (c = 0; c + 4 < n / 32; c += 4) {
	    l = i(j, a.decrypt(i(j, b.slice(c, c + 4))));
	    k = i(k, l);
	    o = o.concat(l);
	    j = g(j)
	}
	m = n - c * 32;
	l = a.encrypt(i(j, [0, 0, 0, m]));
	l = i(l, h.clamp(b.slice(c),
	m).concat([0, 0, 0]));
	k = i(k, l);
	k = a.encrypt(i(k, i(j, g(j))));
	if (d.length) k = i(k, f ? d : sjcl.mode.ocb2.pmac(a, d));
	if (!h.equal(h.clamp(k, e), h.bitSlice(b, n))) throw new sjcl.exception.corrupt("ocb: tag doesn't match");
	return o.concat(h.clamp(l, m))
    },
    pmac: function (a, b) {
	var c, d = sjcl.mode.ocb2.B,
	    e = sjcl.bitArray,
	    f = e.k,
	    g = [0, 0, 0, 0],
	    h = a.encrypt([0, 0, 0, 0]);
	h = f(h, d(d(h)));
	for (c = 0; c + 4 < b.length; c += 4) {
	    h = d(h);
	    g = f(g, a.encrypt(f(h, b.slice(c, c + 4))))
	}
	b = b.slice(c);
	if (e.bitLength(b) < 128) {
	    h = f(h, d(h));
	    b = e.concat(b, [2147483648 | 0, 0,
	    0, 0])
	}
	g = f(g, b);
	return a.encrypt(f(d(f(h, d(h))), g))
    },
    B: function (a) {
	return [a[0] << 1 ^ a[1] >>> 31, a[1] << 1 ^ a[2] >>> 31, a[2] << 1 ^ a[3] >>> 31, a[3] << 1 ^ (a[0] >>> 31) * 135]
    }
};
sjcl.misc.hmac = function (a, b) {
    this.M = b = b || sjcl.hash.sha256;
    var c = [
	[],
	[]
    ],
	d = b.prototype.blockSize / 32;
    this.l = [new b, new b];
    if (a.length > d) a = b.hash(a);
    for (b = 0; b < d; b++) {
	c[0][b] = a[b] ^ 909522486;
	c[1][b] = a[b] ^ 1549556828
    }
    this.l[0].update(c[0]);
    this.l[1].update(c[1])
};
sjcl.misc.hmac.prototype.encrypt = sjcl.misc.hmac.prototype.mac = function (a, b) {
    a = (new this.M(this.l[0])).update(a, b).finalize();
    return (new this.M(this.l[1])).update(a).finalize()
};
sjcl.misc.pbkdf2 = function (a, b, c, d, e) {
    c = c || 1E3;
    if (d < 0 || c < 0) throw sjcl.exception.invalid("invalid params to pbkdf2");
    if (typeof a === "string") a = sjcl.codec.utf8String.toBits(a);
    e = e || sjcl.misc.hmac;
    a = new e(a);
    var f, g, h, i, k = [],
	j = sjcl.bitArray;
    for (i = 1; 32 * k.length < (d || 1); i++) {
	e = f = a.encrypt(j.concat(b, [i]));
	for (g = 1; g < c; g++) {
	    f = a.encrypt(f);
	    for (h = 0; h < f.length; h++) e[h] ^= f[h]
	}
	k = k.concat(e)
    }
    if (d) k = j.clamp(k, d);
    return k
};
sjcl.random = {
    randomWords: function (a, b) {
	var c = [];
	b = this.isReady(b);
	var d;
	if (b === 0) throw new sjcl.exception.notReady("generator isn't seeded");
	else b & 2 && this.U(!(b & 1));
	for (b = 0; b < a; b += 4) {
	    (b + 1) % 0x10000 === 0 && this.L();
	    d = this.w();
	    c.push(d[0], d[1], d[2], d[3])
	}
	this.L();
	return c.slice(0, a)
    },
    setDefaultParanoia: function (a) {
	this.t = a
    },
    addEntropy: function (a, b, c) {
	c = c || "user";
	var d, e, f = (new Date).valueOf(),
	    g = this.q[c],
	    h = this.isReady(),
	    i = 0;
	d = this.G[c];
	if (d === undefined) d = this.G[c] = this.R++;
	if (g === undefined) g = this.q[c] = 0;
	this.q[c] = (this.q[c] + 1) % this.b.length;
	switch (typeof a) {
	    case "number":
		if (b === undefined) b = 1;
		this.b[g].update([d, this.u++, 1, b, f, 1, a | 0]);
		break;
	    case "object":
		c = Object.prototype.toString.call(a);
		if (c === "[object Uint32Array]") {
		    e = [];
		    for (c = 0; c < a.length; c++) e.push(a[c]);
		    a = e
		} else {
		    if (c !== "[object Array]") i = 1;
		    for (c = 0; c < a.length && !i; c++) if (typeof a[c] != "number") i = 1
		}
		if (!i) {
		    if (b === undefined) for (c = b = 0; c < a.length; c++) for (e = a[c]; e > 0;) {
			b++;
			e >>>= 1
		    }
		    this.b[g].update([d, this.u++, 2, b, f, a.length].concat(a))
		}
		break;
	    case "string":
		if (b === undefined) b = a.length;
		this.b[g].update([d, this.u++, 3, b, f, a.length]);
		this.b[g].update(a);
		break;
	    default:
		i = 1
	}
	if (i) throw new sjcl.exception.bug("random: addEntropy only supports number, array of numbers or string");
	this.j[g] += b;
	this.f += b;
	if (h === 0) {
	    this.isReady() !== 0 && this.K("seeded", Math.max(this.g, this.f));
	    this.K("progress", this.getProgress())
	}
    },
    isReady: function (a) {
	a = this.C[a !== undefined ? a : this.t];
	return this.g && this.g >= a ? this.j[0] > 80 && (new Date).valueOf() > this.O ? 3 : 1 : this.f >= a ? 2 : 0
    },
    getProgress: function (a) {
	a = this.C[a ? a : this.t];
	return this.g >= a ? 1 : this.f > a ? 1 : this.f / a
    },
    startCollectors: function () {
	if (!this.m) {
	    if (window.addEventListener) {
		window.addEventListener("load", this.o, false);
		window.addEventListener("mousemove", this.p, false)
	    } else if (document.attachEvent) {
		document.attachEvent("onload", this.o);
		document.attachEvent("onmousemove", this.p)
	    } else throw new sjcl.exception.bug("can't attach event");
	    this.m = true
	}
    },
    stopCollectors: function () {
	if (this.m) {
	    if (window.removeEventListener) {
		window.removeEventListener("load",
		this.o, false);
		window.removeEventListener("mousemove", this.p, false)
	    } else if (window.detachEvent) {
		window.detachEvent("onload", this.o);
		window.detachEvent("onmousemove", this.p)
	    }
	    this.m = false
	}
    },
    addEventListener: function (a, b) {
	this.r[a][this.Q++] = b
    },
    removeEventListener: function (a, b) {
	var c;
	a = this.r[a];
	var d = [];
	for (c in a) a.hasOwnProperty(c) && a[c] === b && d.push(c);
	for (b = 0; b < d.length; b++) {
	    c = d[b];
	    delete a[c]
	}
    },
    b: [new sjcl.hash.sha256],
    j: [0],
    A: 0,
    q: {},
    u: 0,
    G: {},
    R: 0,
    g: 0,
    f: 0,
    O: 0,
    a: [0, 0, 0, 0, 0, 0, 0, 0],
    d: [0, 0, 0, 0],
    s: undefined,
    t: 6,
    m: false,
    r: {
	progress: {},
	seeded: {}
    },
    Q: 0,
    C: [0, 48, 64, 96, 128, 192, 0x100, 384, 512, 768, 1024],
    w: function () {
	for (var a = 0; a < 4; a++) {
	    this.d[a] = this.d[a] + 1 | 0;
	    if (this.d[a]) break
	}
	return this.s.encrypt(this.d)
    },
    L: function () {
	this.a = this.w().concat(this.w());
	this.s = new sjcl.cipher.aes(this.a)
    },
    T: function (a) {
	this.a = sjcl.hash.sha256.hash(this.a.concat(a));
	this.s = new sjcl.cipher.aes(this.a);
	for (a = 0; a < 4; a++) {
	    this.d[a] = this.d[a] + 1 | 0;
	    if (this.d[a]) break
	}
    },
    U: function (a) {
	var b = [],
	    c = 0,
	    d;
	this.O = b[0] = (new Date).valueOf() + 3E4;
	for (d = 0; d < 16; d++) b.push(Math.random() * 0x100000000 | 0);
	for (d = 0; d < this.b.length; d++) {
	    b = b.concat(this.b[d].finalize());
	    c += this.j[d];
	    this.j[d] = 0;
	    if (!a && this.A & 1 << d) break
	}
	if (this.A >= 1 << this.b.length) {
	    this.b.push(new sjcl.hash.sha256);
	    this.j.push(0)
	}
	this.f -= c;
	if (c > this.g) this.g = c;
	this.A++;
	this.T(b)
    },
    p: function (a) {
	sjcl.random.addEntropy([a.x || a.clientX || a.offsetX || 0, a.y || a.clientY || a.offsetY || 0], 2, "mouse")
    },
    o: function () {
	sjcl.random.addEntropy((new Date).valueOf(), 2, "loadtime")
    },
    K: function (a, b) {
	var c;
	a = sjcl.random.r[a];
	var d = [];
	for (c in a) a.hasOwnProperty(c) && d.push(a[c]);
	for (c = 0; c < d.length; c++) d[c](b)
    }
};
try {
    var s = new Uint32Array(32);
    crypto.getRandomValues(s);
    sjcl.random.addEntropy(s, 1024, "crypto['getRandomValues']")
} catch (t) {}
sjcl.json = {
    defaults: {
	v: 1,
	iter: 1E3,
	ks: 128,
	ts: 64,
	mode: "ccm",
	adata: "",
	cipher: "aes"
    },
    encrypt: function (a, b, c, d) {
	c = c || {};
	d = d || {};
	var e = sjcl.json,
	    f = e.c({
		iv: sjcl.random.randomWords(4, 0)
	    }, e.defaults),
	    g;
	e.c(f, c);
	c = f.adata;
	if (typeof f.salt === "string") f.salt = sjcl.codec.base64.toBits(f.salt);
	if (typeof f.iv === "string") f.iv = sjcl.codec.base64.toBits(f.iv);
	if (!sjcl.mode[f.mode] || !sjcl.cipher[f.cipher] || typeof a === "string" && f.iter <= 100 || f.ts !== 64 && f.ts !== 96 && f.ts !== 128 || f.ks !== 128 && f.ks !== 192 && f.ks !== 0x100 || f.iv.length < 2 || f.iv.length > 4) throw new sjcl.exception.invalid("json encrypt: invalid parameters");
	if (typeof a === "string") {
	    g = sjcl.misc.cachedPbkdf2(a, f);
	    a = g.key.slice(0, f.ks / 32);
	    f.salt = g.salt
	}
	if (typeof b === "string") b = sjcl.codec.utf8String.toBits(b);
	if (typeof c === "string") c = sjcl.codec.utf8String.toBits(c);
	g = new sjcl.cipher[f.cipher](a);
	e.c(d, f);
	d.key = a;
	f.ct = sjcl.mode[f.mode].encrypt(g, b, f.iv, c, f.ts);
	return e.encode(f)
    },
    decrypt: function (a, b, c, d) {
	c = c || {};
	d = d || {};
	var e = sjcl.json;
	b = e.c(e.c(e.c({}, e.defaults), e.decode(b)),
	c, true);
	var f;
	c = b.adata;
	if (typeof b.salt === "string") b.salt = sjcl.codec.base64.toBits(b.salt);
	if (typeof b.iv === "string") b.iv = sjcl.codec.base64.toBits(b.iv);
	if (!sjcl.mode[b.mode] || !sjcl.cipher[b.cipher] || typeof a === "string" && b.iter <= 100 || b.ts !== 64 && b.ts !== 96 && b.ts !== 128 || b.ks !== 128 && b.ks !== 192 && b.ks !== 0x100 || !b.iv || b.iv.length < 2 || b.iv.length > 4) throw new sjcl.exception.invalid("json decrypt: invalid parameters");
	if (typeof a === "string") {
	    f = sjcl.misc.cachedPbkdf2(a, b);
	    a = f.key.slice(0, b.ks / 32);
	    b.salt = f.salt
	}
	if (typeof c === "string") c = sjcl.codec.utf8String.toBits(c);
	f = new sjcl.cipher[b.cipher](a);
	c = sjcl.mode[b.mode].decrypt(f, b.ct, b.iv, c, b.ts);
	e.c(d, b);
	d.key = a;
	return sjcl.codec.utf8String.fromBits(c)
    },
    encode: function (a) {
	var b, c = "{",
	    d = "";
	for (b in a) if (a.hasOwnProperty(b)) {
	    if (!b.match(/^[a-z0-9]+$/i)) throw new sjcl.exception.invalid("json encode: invalid property name");
	    c += d + '"' + b + '":';
	    d = ",";
	    switch (typeof a[b]) {
		case "number":
		case "boolean":
		    c += a[b];
		    break;
		case "string":
		    c += '"' + escape(a[b]) + '"';
		    break;
		case "object":
		    c += '"' + sjcl.codec.base64.fromBits(a[b], 1) + '"';
		    break;
		default:
		    throw new sjcl.exception.bug("json encode: unsupported type");
	    }
	}
	return c + "}"
    },
    decode: function (a) {
	a = a.replace(/\s/g, "");
	if (!a.match(/^\{.*\}$/)) throw new sjcl.exception.invalid("json decode: this isn't json!");
	a = a.replace(/^\{|\}$/g, "").split(/,/);
	var b = {}, c, d;
	for (c = 0; c < a.length; c++) {
	    if (!(d = a[c].match(/^(?:(["']?)([a-z][a-z0-9]*)\1):(?:(\d+)|"([a-z0-9+\/%*_.@=\-]*)")$/i))) throw new sjcl.exception.invalid("json decode: this isn't json!");
	    b[d[2]] = d[3] ? parseInt(d[3], 10) : d[2].match(/^(ct|salt|iv)$/) ? sjcl.codec.base64.toBits(d[4]) : unescape(d[4])
	}
	return b
    },
    c: function (a, b, c) {
	if (a === undefined) a = {};
	if (b === undefined) return a;
	var d;
	for (d in b) if (b.hasOwnProperty(d)) {
	    if (c && a[d] !== undefined && a[d] !== b[d]) throw new sjcl.exception.invalid("required parameter overridden");
	    a[d] = b[d]
	}
	return a
    },
    W: function (a, b) {
	var c = {}, d;
	for (d in a) if (a.hasOwnProperty(d) && a[d] !== b[d]) c[d] = a[d];
	return c
    },
    V: function (a, b) {
	var c = {}, d;
	for (d = 0; d < b.length; d++) if (a[b[d]] !== undefined) c[b[d]] = a[b[d]];
	return c
    }
};
sjcl.encrypt = sjcl.json.encrypt;
sjcl.decrypt = sjcl.json.decrypt;
sjcl.misc.S = {};
sjcl.misc.cachedPbkdf2 = function (a, b) {
    var c = sjcl.misc.S,
	d;
    b = b || {};
    d = b.iter || 1E3;
    c = c[a] = c[a] || {};
    d = c[d] = c[d] || {
	firstSalt: b.salt && b.salt.length ? b.salt.slice(0) : sjcl.random.randomWords(2, 0)
    };
    c = b.salt === undefined ? d.firstSalt : b.salt;
    d[c] = d[c] || sjcl.misc.pbkdf2(a, c, b.iter);
    return {
	key: d[c].slice(0),
	salt: c.slice(0)
    }
};

//SHA512.js begins (also from SJCL)
/** @fileOverview Javascript SHA-512 implementation.
 *
 * This implementation was written for CryptoJS by Jeff Mott and adapted for
 * SJCL by Stefan Thomas.
 *
 * CryptoJS (c) 2009-2012 by Jeff Mott. All rights reserved.
 * Released with New BSD License
 */

/**
 * Context for a SHA-512 operation in progress.
 * @constructor
 * @class Secure Hash Algorithm, 512 bits.
 */
sjcl.hash.sha512 = function (hash) {
  if (!this._key[0]) { this._precompute(); }
  if (hash) {
    this._h = hash._h.slice(0);
    this._buffer = hash._buffer.slice(0);
    this._length = hash._length;
  } else {
    this.reset();
  }
};

/**
 * Hash a string or an array of words.
 * @static
 * @param {bitArray|String} data the data to hash.
 * @return {bitArray} The hash value, an array of 16 big-endian words.
 */
sjcl.hash.sha512.hash = function (data) {
  return (new sjcl.hash.sha512()).update(data).finalize();
};

sjcl.hash.sha512.prototype = {
  /**
   * The hash's block size, in bits.
   * @constant
   */
  blockSize: 1024,

  /**
   * Reset the hash state.
   * @return this
   */
  reset:function () {
    this._h = this._init.slice(0);
    this._buffer = [];
    this._length = 0;
    return this;
  },

  /**
   * Input several words to the hash.
   * @param {bitArray|String} data the data to hash.
   * @return this
   */
  update: function (data) {
    if (typeof data === "string") {
      data = sjcl.codec.utf8String.toBits(data);
    }
    var i, b = this._buffer = sjcl.bitArray.concat(this._buffer, data),
        ol = this._length,
        nl = this._length = ol + sjcl.bitArray.bitLength(data);
    for (i = 1024+ol & -1024; i <= nl; i+= 1024) {
      this._block(b.splice(0,32));
    }
    return this;
  },

  /**
   * Complete hashing and output the hash value.
   * @return {bitArray} The hash value, an array of 16 big-endian words.
   */
  finalize:function () {
    var i, b = this._buffer, h = this._h;

    // Round out and push the buffer
    b = sjcl.bitArray.concat(b, [sjcl.bitArray.partial(1,1)]);

    // Round out the buffer to a multiple of 32 words, less the 4 length words.
    for (i = b.length + 4; i & 31; i++) {
      b.push(0);
    }

    // append the length
    b.push(0);
    b.push(0);
    b.push(Math.floor(this._length / 0x100000000));
    b.push(this._length | 0);

    while (b.length) {
      this._block(b.splice(0,32));
    }

    this.reset();
    return h;
  },

  /**
   * The SHA-512 initialization vector, to be precomputed.
   * @private
   */
  _init:[],

  /**
   * Least significant 24 bits of SHA512 initialization values.
   *
   * Javascript only has 53 bits of precision, so we compute the 40 most
   * significant bits and add the remaining 24 bits as constants.
   *
   * @private
   */
  _initr: [ 0xbcc908, 0xcaa73b, 0x94f82b, 0x1d36f1, 0xe682d1, 0x3e6c1f, 0x41bd6b, 0x7e2179 ],

   /**
   * The SHA-512 hash key, to be precomputed.
   * @private
   */
  _key:[],

  /**
   * Least significant 24 bits of SHA512 key values.
   * @private
   */
  _keyr:
  [0x28ae22, 0xef65cd, 0x4d3b2f, 0x89dbbc, 0x48b538, 0x05d019, 0x194f9b, 0x6d8118,
   0x030242, 0x706fbe, 0xe4b28c, 0xffb4e2, 0x7b896f, 0x1696b1, 0xc71235, 0x692694,
   0xf14ad2, 0x4f25e3, 0x8cd5b5, 0xac9c65, 0x2b0275, 0xa6e483, 0x41fbd4, 0x1153b5,
   0x66dfab, 0xb43210, 0xfb213f, 0xef0ee4, 0xa88fc2, 0x0aa725, 0x03826f, 0x0e6e70,
   0xd22ffc, 0x26c926, 0xc42aed, 0x95b3df, 0xaf63de, 0x77b2a8, 0xedaee6, 0x82353b,
   0xf10364, 0x423001, 0xf89791, 0x54be30, 0xef5218, 0x65a910, 0x71202a, 0xbbd1b8,
   0xd2d0c8, 0x41ab53, 0x8eeb99, 0x9b48a8, 0xc95a63, 0x418acb, 0x63e373, 0xb2b8a3,
   0xefb2fc, 0x172f60, 0xf0ab72, 0x6439ec, 0x631e28, 0x82bde9, 0xc67915, 0x72532b,
   0x26619c, 0xc0c207, 0xe0eb1e, 0x6ed178, 0x176fba, 0xc898a6, 0xf90dae, 0x1c471b,
   0x047d84, 0xc72493, 0xc9bebc, 0x100d4c, 0x3e42b6, 0x657e2a, 0xd6faec, 0x475817],

  /**
   * Function to precompute _init and _key.
   * @private
   */
  _precompute: function () {
    // XXX: This code is for precomputing the SHA256 constants, change for
    //      SHA512 and re-enable.
    var i = 0, prime = 2, factor;

    function frac(x)  { return (x-Math.floor(x)) * 0x100000000 | 0; }
    function frac2(x) { return (x-Math.floor(x)) * 0x10000000000 & 0xff; }

    outer: for (; i<80; prime++) {
      for (factor=2; factor*factor <= prime; factor++) {
        if (prime % factor === 0) {
          // not a prime
          continue outer;
        }
      }

      if (i<8) {
        this._init[i*2] = frac(Math.pow(prime, 1/2));
        this._init[i*2+1] = (frac2(Math.pow(prime, 1/2)) << 24) | this._initr[i];
      }
      this._key[i*2] = frac(Math.pow(prime, 1/3));
      this._key[i*2+1] = (frac2(Math.pow(prime, 1/3)) << 24) | this._keyr[i];
      i++;
    }
  },

  /**
   * Perform one cycle of SHA-512.
   * @param {bitArray} words one block of words.
   * @private
   */
  _block:function (words) {
    var i, wrh, wrl,
        w = words.slice(0),
        h = this._h,
        k = this._key,
        h0h = h[ 0], h0l = h[ 1], h1h = h[ 2], h1l = h[ 3],
        h2h = h[ 4], h2l = h[ 5], h3h = h[ 6], h3l = h[ 7],
        h4h = h[ 8], h4l = h[ 9], h5h = h[10], h5l = h[11],
        h6h = h[12], h6l = h[13], h7h = h[14], h7l = h[15];

    // Working variables
    var ah = h0h, al = h0l, bh = h1h, bl = h1l,
        ch = h2h, cl = h2l, dh = h3h, dl = h3l,
        eh = h4h, el = h4l, fh = h5h, fl = h5l,
        gh = h6h, gl = h6l, hh = h7h, hl = h7l;

    for (i=0; i<80; i++) {
      // load up the input word for this round
      if (i<16) {
        wrh = w[i * 2];
        wrl = w[i * 2 + 1];
      } else {
        // Gamma0
        var gamma0xh = w[(i-15) * 2];
        var gamma0xl = w[(i-15) * 2 + 1];
        var gamma0h =
          ((gamma0xl << 31) | (gamma0xh >>> 1)) ^
          ((gamma0xl << 24) | (gamma0xh >>> 8)) ^
           (gamma0xh >>> 7);
        var gamma0l =
          ((gamma0xh << 31) | (gamma0xl >>> 1)) ^
          ((gamma0xh << 24) | (gamma0xl >>> 8)) ^
          ((gamma0xh << 25) | (gamma0xl >>> 7));

        // Gamma1
        var gamma1xh = w[(i-2) * 2];
        var gamma1xl = w[(i-2) * 2 + 1];
        var gamma1h =
          ((gamma1xl << 13) | (gamma1xh >>> 19)) ^
          ((gamma1xh << 3)  | (gamma1xl >>> 29)) ^
           (gamma1xh >>> 6);
        var gamma1l =
          ((gamma1xh << 13) | (gamma1xl >>> 19)) ^
          ((gamma1xl << 3)  | (gamma1xh >>> 29)) ^
          ((gamma1xh << 26) | (gamma1xl >>> 6));

        // Shortcuts
        var wr7h = w[(i-7) * 2];
        var wr7l = w[(i-7) * 2 + 1];

        var wr16h = w[(i-16) * 2];
        var wr16l = w[(i-16) * 2 + 1];

        // W(round) = gamma0 + W(round - 7) + gamma1 + W(round - 16)
        wrl = gamma0l + wr7l;
        wrh = gamma0h + wr7h + ((wrl >>> 0) < (gamma0l >>> 0) ? 1 : 0);
        wrl += gamma1l;
        wrh += gamma1h + ((wrl >>> 0) < (gamma1l >>> 0) ? 1 : 0);
        wrl += wr16l;
        wrh += wr16h + ((wrl >>> 0) < (wr16l >>> 0) ? 1 : 0);
      }

      w[i*2]     = wrh |= 0;
      w[i*2 + 1] = wrl |= 0;

      // Ch
      var chh = (eh & fh) ^ (~eh & gh);
      var chl = (el & fl) ^ (~el & gl);

      // Maj
      var majh = (ah & bh) ^ (ah & ch) ^ (bh & ch);
      var majl = (al & bl) ^ (al & cl) ^ (bl & cl);

      // Sigma0
      var sigma0h = ((al << 4) | (ah >>> 28)) ^ ((ah << 30) | (al >>> 2)) ^ ((ah << 25) | (al >>> 7));
      var sigma0l = ((ah << 4) | (al >>> 28)) ^ ((al << 30) | (ah >>> 2)) ^ ((al << 25) | (ah >>> 7));

      // Sigma1
      var sigma1h = ((el << 18) | (eh >>> 14)) ^ ((el << 14) | (eh >>> 18)) ^ ((eh << 23) | (el >>> 9));
      var sigma1l = ((eh << 18) | (el >>> 14)) ^ ((eh << 14) | (el >>> 18)) ^ ((el << 23) | (eh >>> 9));

      // K(round)
      var krh = k[i*2];
      var krl = k[i*2+1];

      // t1 = h + sigma1 + ch + K(round) + W(round)
      var t1l = hl + sigma1l;
      var t1h = hh + sigma1h + ((t1l >>> 0) < (hl >>> 0) ? 1 : 0);
      t1l += chl;
      t1h += chh + ((t1l >>> 0) < (chl >>> 0) ? 1 : 0);
      t1l += krl;
      t1h += krh + ((t1l >>> 0) < (krl >>> 0) ? 1 : 0);
      t1l += wrl;
      t1h += wrh + ((t1l >>> 0) < (wrl >>> 0) ? 1 : 0);

      // t2 = sigma0 + maj
      var t2l = sigma0l + majl;
      var t2h = sigma0h + majh + ((t2l >>> 0) < (sigma0l >>> 0) ? 1 : 0);

      // Update working variables
      hh = gh;
      hl = gl;
      gh = fh;
      gl = fl;
      fh = eh;
      fl = el;
      el = (dl + t1l) | 0;
      eh = (dh + t1h + ((el >>> 0) < (dl >>> 0) ? 1 : 0)) | 0;
      dh = ch;
      dl = cl;
      ch = bh;
      cl = bl;
      bh = ah;
      bl = al;
      al = (t1l + t2l) | 0;
      ah = (t1h + t2h + ((al >>> 0) < (t1l >>> 0) ? 1 : 0)) | 0;
    }

    // Intermediate hash
    h0l = h[1] = (h0l + al) | 0;
    h[0] = (h0h + ah + ((h0l >>> 0) < (al >>> 0) ? 1 : 0)) | 0;
    h1l = h[3] = (h1l + bl) | 0;
    h[2] = (h1h + bh + ((h1l >>> 0) < (bl >>> 0) ? 1 : 0)) | 0;
    h2l = h[5] = (h2l + cl) | 0;
    h[4] = (h2h + ch + ((h2l >>> 0) < (cl >>> 0) ? 1 : 0)) | 0;
    h3l = h[7] = (h3l + dl) | 0;
    h[6] = (h3h + dh + ((h3l >>> 0) < (dl >>> 0) ? 1 : 0)) | 0;
    h4l = h[9] = (h4l + el) | 0;
    h[8] = (h4h + eh + ((h4l >>> 0) < (el >>> 0) ? 1 : 0)) | 0;
    h5l = h[11] = (h5l + fl) | 0;
    h[10] = (h5h + fh + ((h5l >>> 0) < (fl >>> 0) ? 1 : 0)) | 0;
    h6l = h[13] = (h6l + gl) | 0;
    h[12] = (h6h + gh + ((h6l >>> 0) < (gl >>> 0) ? 1 : 0)) | 0;
    h7l = h[15] = (h7l + hl) | 0;
    h[14] = (h7h + hh + ((h7l >>> 0) < (hl >>> 0) ? 1 : 0)) | 0;
  }
};
//SHA512.js ends

//BN.js begins (also from SJCL)
/**
 * Constructs a new bignum from another bignum, a number or a hex string.
 */
sjcl.bn = function(it) {
  this.initWith(it);
};

sjcl.bn.prototype = {
  radix: 24,
  maxMul: 8,
  _class: sjcl.bn,

  copy: function() {
    return new this._class(this);
  },

  /**
   * Initializes this with it, either as a bn, a number, or a hex string.
   */
  initWith: function(it) {
    var i=0, k, n, l;
    switch(typeof it) {
    case "object":
      this.limbs = it.limbs.slice(0);
      break;

    case "number":
      this.limbs = [it];
      this.normalize();
      break;

    case "string":
      it = it.replace(/^0x/, '');
      this.limbs = [];
      // hack
      k = this.radix / 4;
      for (i=0; i < it.length; i+=k) {
	this.limbs.push(parseInt(it.substring(Math.max(it.length - i - k, 0), it.length - i),16));
      }
      break;

    default:
      this.limbs = [0];
    }
    return this;
  },

  /**
   * Returns true if "this" and "that" are equal.  Calls fullReduce().
   * Equality test is in constant time.
   */
  equals: function(that) {
    if (typeof that === "number") { that = new this._class(that); }
    var difference = 0, i;
    this.fullReduce();
    that.fullReduce();
    for (i = 0; i < this.limbs.length || i < that.limbs.length; i++) {
      difference |= this.getLimb(i) ^ that.getLimb(i);
    }
    return (difference === 0);
  },

  /**
   * Get the i'th limb of this, zero if i is too large.
   */
  getLimb: function(i) {
    return (i >= this.limbs.length) ? 0 : this.limbs[i];
  },

  /**
   * Constant time comparison function.
   * Returns 1 if this >= that, or zero otherwise.
   */
  greaterEquals: function(that) {
    if (typeof that === "number") { that = new this._class(that); }
    var less = 0, greater = 0, i, a, b;
    i = Math.max(this.limbs.length, that.limbs.length) - 1;
    for (; i>= 0; i--) {
      a = this.getLimb(i);
      b = that.getLimb(i);
      greater |= (b - a) & ~less;
      less |= (a - b) & ~greater;
    }
    return (greater | ~less) >>> 31;
  },

  /**
   * Convert to a hex string.
   */
  toString: function() {
    this.fullReduce();
    var out="", i, s, l = this.limbs;
    for (i=0; i < this.limbs.length; i++) {
      s = l[i].toString(16);
      while (i < this.limbs.length - 1 && s.length < 6) {
	s = "0" + s;
      }
      out = s + out;
    }
    return "0x"+out;
  },

  /** this += that.  Does not normalize. */
  addM: function(that) {
    if (typeof(that) !== "object") { that = new this._class(that); }
    var i, l=this.limbs, ll=that.limbs;
    for (i=l.length; i<ll.length; i++) {
      l[i] = 0;
    }
    for (i=0; i<ll.length; i++) {
      l[i] += ll[i];
    }
    return this;
  },

  /** this *= 2.  Requires normalized; ends up normalized. */
  doubleM: function() {
    var i, carry=0, tmp, r=this.radix, m=this.radixMask, l=this.limbs;
    for (i=0; i<l.length; i++) {
      tmp = l[i];
      tmp = tmp+tmp+carry;
      l[i] = tmp & m;
      carry = tmp >> r;
    }
    if (carry) {
      l.push(carry);
    }
    return this;
  },

  /** this /= 2, rounded down.	Requires normalized; ends up normalized. */
  halveM: function() {
    var i, carry=0, tmp, r=this.radix, l=this.limbs;
    for (i=l.length-1; i>=0; i--) {
      tmp = l[i];
      l[i] = (tmp+carry)>>1;
      carry = (tmp&1) << r;
    }
    if (!l[l.length-1]) {
      l.pop();
    }
    return this;
  },

  /** this -= that.  Does not normalize. */
  subM: function(that) {
    if (typeof(that) !== "object") { that = new this._class(that); }
    var i, l=this.limbs, ll=that.limbs;
    for (i=l.length; i<ll.length; i++) {
      l[i] = 0;
    }
    for (i=0; i<ll.length; i++) {
      l[i] -= ll[i];
    }
    return this;
  },

  mod: function(that) {
    that = new sjcl.bn(that).normalize(); // copy before we begin
    var out = new sjcl.bn(this).normalize(), ci=0;

    for (; out.greaterEquals(that); ci++) {

      that.doubleM();
    }
    for (; ci > 0; ci--) {
      that.halveM();
      if (out.greaterEquals(that)) {
	out.subM(that).normalize();
      }
    }
    return out.trim();
  },

  /** return inverse mod prime p.  p must be odd. Binary extended Euclidean algorithm mod p. */
  inverseMod: function(p) {
    var a = new sjcl.bn(1), b = new sjcl.bn(0), x = new sjcl.bn(this), y = new sjcl.bn(p), tmp, i, nz=1;

    if (!(p.limbs[0] & 1)) {
      throw (new sjcl.exception.invalid("inverseMod: p must be odd"));
    }

    // invariant: y is odd
    do {
      if (x.limbs[0] & 1) {
	if (!x.greaterEquals(y)) {
	  // x < y; swap everything
	  tmp = x; x = y; y = tmp;
	  tmp = a; a = b; b = tmp;
	}
	x.subM(y);
	x.normalize();

	if (!a.greaterEquals(b)) {
	  a.addM(p);
	}
	a.subM(b);
      }

      // cut everything in half
      x.halveM();
      if (a.limbs[0] & 1) {
	a.addM(p);
      }
      a.normalize();
      a.halveM();

      // check for termination: x ?= 0
      for (i=nz=0; i<x.limbs.length; i++) {
	nz |= x.limbs[i];
      }
    } while(nz);

    if (!y.equals(1)) {
      throw (new sjcl.exception.invalid("inverseMod: p and x must be relatively prime"));
    }

    return b;
  },

  /** this + that.  Does not normalize. */
  add: function(that) {
    return this.copy().addM(that);
  },

  /** this - that.  Does not normalize. */
  sub: function(that) {
    return this.copy().subM(that);
  },

  /** this * that.  Normalizes and reduces. */
  mul: function(that) {
    if (typeof(that) === "number") { that = new this._class(that); }
    var i, j, a = this.limbs, b = that.limbs, al = a.length, bl = b.length, out = new this._class(), c = out.limbs, ai, ii=this.maxMul;

    for (i=0; i < this.limbs.length + that.limbs.length + 1; i++) {
      c[i] = 0;
    }
    for (i=0; i<al; i++) {
      ai = a[i];
      for (j=0; j<bl; j++) {
	c[i+j] += ai * b[j];
      }

      if (!--ii) {
	ii = this.maxMul;
	out.cnormalize();
      }
    }
    return out.cnormalize().reduce();
  },

  /** this ^ 2.  Normalizes and reduces. */
  square: function() {
    return this.mul(this);
  },

  /** this ^ n.  Uses square-and-multiply.  Normalizes and reduces. */
  power: function(l) {
    if (typeof(l) === "number") {
      l = [l];
    } else if (l.limbs !== undefined) {
      l = l.normalize().limbs;
    }
    var i, j, out = new this._class(1), pow = this;

    for (i=0; i<l.length; i++) {
      for (j=0; j<this.radix; j++) {
	if (l[i] & (1<<j)) {
	  out = out.mul(pow);
	}
	pow = pow.square();
      }
    }

    return out;
  },

  /** this * that mod N */
  mulmod: function(that, N) {
    return this.mod(N).mul(that.mod(N)).mod(N);
  },

  /** this ^ x mod N */
  powermod: function(x, N) {
    var result = new sjcl.bn(1), a = new sjcl.bn(this), k = new sjcl.bn(x);
    while (true) {
      if (k.limbs[0] & 1) { result = result.mulmod(a, N); }
      k.halveM();
      if (k.equals(0)) { break; }
      a = a.mulmod(a, N);
    }
    return result.normalize().reduce();
  },

  trim: function() {
    var l = this.limbs, p;
    do {
      p = l.pop();
    } while (l.length && p === 0);
    l.push(p);
    return this;
  },

  /** Reduce mod a modulus.  Stubbed for subclassing. */
  reduce: function() {
    return this;
  },

  /** Reduce and normalize. */
  fullReduce: function() {
    return this.normalize();
  },

  /** Propagate carries. */
  normalize: function() {
    var carry=0, i, pv = this.placeVal, ipv = this.ipv, l, m, limbs = this.limbs, ll = limbs.length, mask = this.radixMask;
    for (i=0; i < ll || (carry !== 0 && carry !== -1); i++) {
      l = (limbs[i]||0) + carry;
      m = limbs[i] = l & mask;
      carry = (l-m)*ipv;
    }
    if (carry === -1) {
      limbs[i-1] -= this.placeVal;
    }
    return this;
  },

  /** Constant-time normalize. Does not allocate additional space. */
  cnormalize: function() {
    var carry=0, i, ipv = this.ipv, l, m, limbs = this.limbs, ll = limbs.length, mask = this.radixMask;
    for (i=0; i < ll-1; i++) {
      l = limbs[i] + carry;
      m = limbs[i] = l & mask;
      carry = (l-m)*ipv;
    }
    limbs[i] += carry;
    return this;
  },

  /** Serialize to a bit array */
  toBits: function(len) {
    this.fullReduce();
    len = len || this.exponent || this.limbs.length * this.radix;
    var i = Math.floor((len-1)/24), w=sjcl.bitArray, e = (len + 7 & -8) % this.radix || this.radix,
	out = [w.partial(e, this.getLimb(i))];
    for (i--; i >= 0; i--) {
      out = w.concat(out, [w.partial(this.radix, this.getLimb(i))]);
    }
    return out;
  },

  /** Return the length in bits, rounded up to the nearest byte. */
  bitLength: function() {
    this.fullReduce();
    var out = this.radix * (this.limbs.length - 1),
	b = this.limbs[this.limbs.length - 1];
    for (; b; b >>= 1) {
      out ++;
    }
    return out+7 & -8;
  }
};

sjcl.bn.fromBits = function(bits) {
  var Class = this, out = new Class(), words=[], w=sjcl.bitArray, t = this.prototype,
      l = Math.min(this.bitLength || 0x100000000, w.bitLength(bits)), e = l % t.radix || t.radix;

  words[0] = w.extract(bits, 0, e);
  for (; e < l; e += t.radix) {
    words.unshift(w.extract(bits, e, t.radix));
  }

  out.limbs = words;
  return out;
};

sjcl.bn.prototype.ipv = 1 / (sjcl.bn.prototype.placeVal = Math.pow(2,sjcl.bn.prototype.radix));
sjcl.bn.prototype.radixMask = (1 << sjcl.bn.prototype.radix) - 1;

/**
 * Creates a new subclass of bn, based on reduction modulo a pseudo-Mersenne prime,
 * i.e. a prime of the form 2^e + sum(a * 2^b),where the sum is negative and sparse.
 */
sjcl.bn.pseudoMersennePrime = function(exponent, coeff) {
  function p(it) {
    this.initWith(it);
    /*if (this.limbs[this.modOffset]) {
      this.reduce();
    }*/
  }

  var ppr = p.prototype = new sjcl.bn(), i, tmp, mo;
  mo = ppr.modOffset = Math.ceil(tmp = exponent / ppr.radix);
  ppr.exponent = exponent;
  ppr.offset = [];
  ppr.factor = [];
  ppr.minOffset = mo;
  ppr.fullMask = 0;
  ppr.fullOffset = [];
  ppr.fullFactor = [];
  ppr.modulus = p.modulus = new sjcl.bn(Math.pow(2,exponent));

  ppr.fullMask = 0|-Math.pow(2, exponent % ppr.radix);

  for (i=0; i<coeff.length; i++) {
    ppr.offset[i] = Math.floor(coeff[i][0] / ppr.radix - tmp);
    ppr.fullOffset[i] = Math.ceil(coeff[i][0] / ppr.radix - tmp);
    ppr.factor[i] = coeff[i][1] * Math.pow(1/2, exponent - coeff[i][0] + ppr.offset[i] * ppr.radix);
    ppr.fullFactor[i] = coeff[i][1] * Math.pow(1/2, exponent - coeff[i][0] + ppr.fullOffset[i] * ppr.radix);
    ppr.modulus.addM(new sjcl.bn(Math.pow(2,coeff[i][0])*coeff[i][1]));
    ppr.minOffset = Math.min(ppr.minOffset, -ppr.offset[i]); // conservative
  }
  ppr._class = p;
  ppr.modulus.cnormalize();

  /** Approximate reduction mod p.  May leave a number which is negative or slightly larger than p. */
  ppr.reduce = function() {
    var i, k, l, mo = this.modOffset, limbs = this.limbs, aff, off = this.offset, ol = this.offset.length, fac = this.factor, ll;

    i = this.minOffset;
    while (limbs.length > mo) {
      l = limbs.pop();
      ll = limbs.length;
      for (k=0; k<ol; k++) {
	limbs[ll+off[k]] -= fac[k] * l;
      }

      i--;
      if (!i) {
	limbs.push(0);
	this.cnormalize();
	i = this.minOffset;
      }
    }
    this.cnormalize();

    return this;
  };

  ppr._strongReduce = (ppr.fullMask === -1) ? ppr.reduce : function() {
    var limbs = this.limbs, i = limbs.length - 1, k, l;
    this.reduce();
    if (i === this.modOffset - 1) {
      l = limbs[i] & this.fullMask;
      limbs[i] -= l;
      for (k=0; k<this.fullOffset.length; k++) {
	limbs[i+this.fullOffset[k]] -= this.fullFactor[k] * l;
      }
      this.normalize();
    }
  };

  /** mostly constant-time, very expensive full reduction. */
  ppr.fullReduce = function() {
    var greater, i;
    // massively above the modulus, may be negative

    this._strongReduce();
    // less than twice the modulus, may be negative

    this.addM(this.modulus);
    this.addM(this.modulus);
    this.normalize();
    // probably 2-3x the modulus

    this._strongReduce();
    // less than the power of 2.  still may be more than
    // the modulus

    // HACK: pad out to this length
    for (i=this.limbs.length; i<this.modOffset; i++) {
      this.limbs[i] = 0;
    }

    // constant-time subtract modulus
    greater = this.greaterEquals(this.modulus);
    for (i=0; i<this.limbs.length; i++) {
      this.limbs[i] -= this.modulus.limbs[i] * greater;
    }
    this.cnormalize();

    return this;
  };

  ppr.inverse = function() {
    return (this.power(this.modulus.sub(2)));
  };

  p.fromBits = sjcl.bn.fromBits;

  return p;
};

// a small Mersenne prime
sjcl.bn.prime = {
  // NIST primes
  p192: sjcl.bn.pseudoMersennePrime(192, [[0,-1],[64,-1]]),
  p224: sjcl.bn.pseudoMersennePrime(224, [[0,1],[96,-1]]),
  p256: sjcl.bn.pseudoMersennePrime(256, [[0,-1],[96,1],[192,1],[224,-1]]),
  p384: sjcl.bn.pseudoMersennePrime(384, [[0,-1],[32,1],[96,-1],[128,-1]]),
  p521: sjcl.bn.pseudoMersennePrime(521, [[0,-1]])
};

sjcl.bn.random = function(modulus, paranoia) {
  if (typeof modulus !== "object") { modulus = new sjcl.bn(modulus); }
  var words, i, l = modulus.limbs.length, m = modulus.limbs[l-1]+1, out = new sjcl.bn();
  while (true) {
    // get a sequence whose first digits make sense
    do {
      words = sjcl.random.randomWords(l, paranoia);
      if (words[l-1] < 0) { words[l-1] += 0x100000000; }
    } while (Math.floor(words[l-1] / m) === Math.floor(0x100000000 / m));
    words[l-1] %= m;

    // mask off all the limbs
    for (i=0; i<l-1; i++) {
      words[i] &= modulus.radixMask;
    }

    // check the rest of the digitssj
    out.limbs = words;
    if (!out.greaterEquals(modulus)) {
      return out;
    }
  }
};

//ECC.js begins
//F. Ruiz: I added the 521-bit curve, took out elGamal etc. at the end, replaced by my own functions. Modifications are noted)

sjcl.ecc = {};

/**
 * Represents a point on a curve in affine coordinates.
 * @constructor
 * @param {sjcl.ecc.curve} curve The curve that this point lies on.
 * @param {bigInt} x The x coordinate.
 * @param {bigInt} y The y coordinate.
 */
sjcl.ecc.point = function(curve,x,y) {
  if (x === undefined) {
    this.isIdentity = true;
  } else {
    this.x = x;
    this.y = y;
    this.isIdentity = false;
  }
  this.curve = curve;
};

sjcl.ecc.point.prototype = {
  toJac: function() {
    return new sjcl.ecc.pointJac(this.curve, this.x, this.y, new this.curve.field(1));
  },

  mult: function(k) {
    return this.toJac().mult(k, this).toAffine();
  },

  /**
   * Multiply this point by k, added to affine2*k2, and return the answer in Jacobian coordinates.
   * @param {bigInt} k The coefficient to multiply this by.
   * @param {bigInt} k2 The coefficient to multiply affine2 this by.
   * @param {sjcl.ecc.point} affine The other point in affine coordinates.
   * @return {sjcl.ecc.pointJac} The result of the multiplication and addition, in Jacobian coordinates.
   */
  mult2: function(k, k2, affine2) {
    return this.toJac().mult2(k, this, k2, affine2).toAffine();
  },

  multiples: function() {
    var m, i, j;
    if (this._multiples === undefined) {
      j = this.toJac().doubl();
      m = this._multiples = [new sjcl.ecc.point(this.curve), this, j.toAffine()];
      for (i=3; i<16; i++) {
	j = j.add(this);
	m.push(j.toAffine());
      }
    }
    return this._multiples;
  },

  isValid: function() {
    return this.y.square().equals(this.curve.b.add(this.x.mul(this.curve.a.add(this.x.square()))));
  },

  toBits: function() {
    return sjcl.bitArray.concat(this.x.toBits(), this.y.toBits());
  }
};

/**
 * Represents a point on a curve in Jacobian coordinates. Coordinates can be specified as bigInts or strings (which
 * will be converted to bigInts).
 *
 * @constructor
 * @param {bigInt/string} x The x coordinate.
 * @param {bigInt/string} y The y coordinate.
 * @param {bigInt/string} z The z coordinate.
 * @param {sjcl.ecc.curve} curve The curve that this point lies on.
 */
sjcl.ecc.pointJac = function(curve, x, y, z) {
  if (x === undefined) {
    this.isIdentity = true;
  } else {
    this.x = x;
    this.y = y;
    this.z = z;
    this.isIdentity = false;
  }
  this.curve = curve;
};

sjcl.ecc.pointJac.prototype = {
  /**
   * Adds S and T and returns the result in Jacobian coordinates. Note that S must be in Jacobian coordinates and T must be in affine coordinates.
   * @param {sjcl.ecc.pointJac} S One of the points to add, in Jacobian coordinates.
   * @param {sjcl.ecc.point} T The other point to add, in affine coordinates.
   * @return {sjcl.ecc.pointJac} The sum of the two points, in Jacobian coordinates.
   */
  add: function(T) {
    var S = this, sz2, c, d, c2, x1, x2, x, y1, y2, y, z;
    if (S.curve !== T.curve) {
      throw("sjcl.ecc.add(): Points must be on the same curve to add them!");
    }

    if (S.isIdentity) {
      return T.toJac();
    } else if (T.isIdentity) {
      return S;
    }

    sz2 = S.z.square();
    c = T.x.mul(sz2).subM(S.x);

    if (c.equals(0)) {
      if (S.y.equals(T.y.mul(sz2.mul(S.z)))) {
	// same point
	return S.doubl();
      } else {
	// inverses
	return new sjcl.ecc.pointJac(S.curve);
      }
    }

    d = T.y.mul(sz2.mul(S.z)).subM(S.y);
    c2 = c.square();

    x1 = d.square();
    x2 = c.square().mul(c).addM( S.x.add(S.x).mul(c2) );
    x  = x1.subM(x2);

    y1 = S.x.mul(c2).subM(x).mul(d);
    y2 = S.y.mul(c.square().mul(c));
    y  = y1.subM(y2);

    z  = S.z.mul(c);

    return new sjcl.ecc.pointJac(this.curve,x,y,z);
  },

  /**
   * doubles this point.
   * @return {sjcl.ecc.pointJac} The doubled point.
   */
  doubl: function() {
    if (this.isIdentity) { return this; }

    var
      y2 = this.y.square(),
      a  = y2.mul(this.x.mul(4)),
      b  = y2.square().mul(8),
      z2 = this.z.square(),
      c  = this.x.sub(z2).mul(3).mul(this.x.add(z2)),
      x  = c.square().subM(a).subM(a),
      y  = a.sub(x).mul(c).subM(b),
      z  = this.y.add(this.y).mul(this.z);
    return new sjcl.ecc.pointJac(this.curve, x, y, z);
  },

  /**
   * Returns a copy of this point converted to affine coordinates.
   * @return {sjcl.ecc.point} The converted point.
   */
  toAffine: function() {
    if (this.isIdentity || this.z.equals(0)) {
      return new sjcl.ecc.point(this.curve);
    }
    var zi = this.z.inverse(), zi2 = zi.square();
    return new sjcl.ecc.point(this.curve, this.x.mul(zi2).fullReduce(), this.y.mul(zi2.mul(zi)).fullReduce());
  },

  /**
   * Multiply this point by k and return the answer in Jacobian coordinates.
   * @param {bigInt} k The coefficient to multiply by.
   * @param {sjcl.ecc.point} affine This point in affine coordinates.
   * @return {sjcl.ecc.pointJac} The result of the multiplication, in Jacobian coordinates.
   */
  mult: function(k, affine) {
    if (typeof(k) === "number") {
      k = [k];
    } else if (k.limbs !== undefined) {
      k = k.normalize().limbs;
    }

    var i, j, out = new sjcl.ecc.point(this.curve).toJac(), multiples = affine.multiples();

    for (i=k.length-1; i>=0; i--) {
      for (j=sjcl.bn.prototype.radix-4; j>=0; j-=4) {
	out = out.doubl().doubl().doubl().doubl().add(multiples[k[i]>>j & 0xF]);
      }
    }

    return out;
  },

/**
   * Multiply this point by k, added to affine2*k2, and return the answer in Jacobian coordinates.
   * @param {bigInt} k The coefficient to multiply this by.
   * @param {sjcl.ecc.point} affine This point in affine coordinates.
   * @param {bigInt} k2 The coefficient to multiply affine2 this by.
   * @param {sjcl.ecc.point} affine The other point in affine coordinates.
   * @return {sjcl.ecc.pointJac} The result of the multiplication and addition, in Jacobian coordinates.
   */
  mult2: function(k1, affine, k2, affine2) {
    if (typeof(k1) === "number") {
      k1 = [k1];
    } else if (k1.limbs !== undefined) {
      k1 = k1.normalize().limbs;
    }

    if (typeof(k2) === "number") {
      k2 = [k2];
    } else if (k2.limbs !== undefined) {
      k2 = k2.normalize().limbs;
    }

    var i, j, out = new sjcl.ecc.point(this.curve).toJac(), m1 = affine.multiples(),
        m2 = affine2.multiples(), l1, l2;

    for (i=Math.max(k1.length,k2.length)-1; i>=0; i--) {
      l1 = k1[i] | 0;
      l2 = k2[i] | 0;
      for (j=sjcl.bn.prototype.radix-4; j>=0; j-=4) {
        out = out.doubl().doubl().doubl().doubl().add(m1[l1>>j & 0xF]).add(m2[l2>>j & 0xF]);
      }
    }

    return out;
  },

  isValid: function() {
    var z2 = this.z.square(), z4 = z2.square(), z6 = z4.mul(z2);
    return this.y.square().equals(
	    this.curve.b.mul(z6).add(this.x.mul(
	      this.curve.a.mul(z4).add(this.x.square()))));
  }
};

/**
 * Construct an elliptic curve. Most users will not use this and instead start with one of the NIST curves defined below.
 *
 * @constructor
 * @param {bigInt} p The prime modulus.
 * @param {bigInt} r The prime order of the curve.
 * @param {bigInt} a The constant a in the equation of the curve y^2 = x^3 + ax + b (for NIST curves, a is always -3).
 * @param {bigInt} x The x coordinate of a base point of the curve.
 * @param {bigInt} y The y coordinate of a base point of the curve.
 */
sjcl.ecc.curve = function(Field, r, a, b, x, y) {
  this.field = Field;
  this.r = Field.prototype.modulus.sub(r);
  this.a = new Field(a);
  this.b = new Field(b);
  this.G = new sjcl.ecc.point(this, new Field(x), new Field(y));
};

sjcl.ecc.curve.prototype.fromBits = function (bits) {
  var w = sjcl.bitArray, l = this.field.prototype.exponent + 7 & -8,
      p = new sjcl.ecc.point(this, this.field.fromBits(w.bitSlice(bits, 0, l)),
			    this.field.fromBits(w.bitSlice(bits, l, 2*l)));
  if (!p.isValid()) {																	//modified to add alert in PassLok
	document.getElementById("mainmsg").innerHTML = '<span>Invalid Lock</span>';	//
    throw new sjcl.exception.corrupt("not on the curve!");							//
  }																						//
  return p;
};

//F. Ruiz: Added the NIST 521-bit elliptic curve parameters, removed the other curves since they are not used in PassLok

sjcl.ecc.curves = {

  c521: new sjcl.ecc.curve(				//these parameters are my addition to ecc.js
	sjcl.bn.prime.p521,
	"0x5AE79787C40D069948033FEB708F65A2FC44A36477663B851449048E16EC79BF6",
	- 3,
"0x051953eb9618e1c9a1f929a21a0b68540eea2da725b99b315f3b8b489918ef109e156193951ec7e937b1652c0bd3bb1bf073573df883d2c34f1ef451fd46b503f00",
"0xc6858e06b70404e9cd9e3ecb662395b4429c648139053fb521f828af606b4d3dbaa14b5e77efe75928fe1dc127a2ffa8de3348b3c1856a429bf97e7e31c2e5bd66",
"0x11839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650")
};

//End of SJCL code, some of its elGamal, ECDSA code is used in the functions below
</script>

<!--SCRYPT key stretching-->
<script>
//SJCL-SCRYPT.JS, by joe-invincible begins
var B, X, SIZE_MAX = Math.pow(2, 32) - 1;

sjcl.misc.scrypt = function(passwd, salt, N, r, p, dkLen) {

  function flipEndian(x) {
    var first = x & 0xFF;
    var second = (x >>> 8) & 0xFF;
    var third = (x >>> 16) & 0xFF;
    var fourth = (x >>> 24) & 0xFF;
    return (first << 24) | (second << 16) | (third << 8) | fourth;
  }

  function sanityCheck() {
    if (r * p >= Math.pow(2, 30)) {
      throw "The parameters r, p must satisfy r * p < 2^30";
    }
    if ((N < 2) || (N & (N - 1) != 0)) {
      throw "The parameter N must be a power of 2.";
    }
    SIZE_MAX = Math.pow(2, 32) - 1;
    if (N > SIZE_MAX / 128 / r) {
    throw "N too big.";
    }
    if (r > SIZE_MAX / 128 / p) {
      throw "r too big.";
    }
  }

  function scrypt(passwd, salt, N, r, p, dkLen) {
    B = sjcl.misc.pbkdf2(passwd, salt, 1, p * 128 * r * 8);
    var V = [];
    var XY = [];
    for (var i = 0; i < p; i++) {
      smix(B, i * 128 * r, r, N, V, XY);
    }
    return sjcl.misc.pbkdf2(passwd, B, 1, dkLen * 8);
  };

  function salsa20_8(B) {

    function R(a, b) {
      return (a << b) | (a >>> (32 - b));
    }

    var B32 = [];
    for (var i = 0; i < 16; i++) {
      B32[i] = flipEndian(B[i]);
    }

    var x = [];
    for (var i = 0; i < 16; i++) {
      x[i] = B32[i] | 0;
    }

    for (i = 8; i > 0; i -= 2) {
      x[4] ^= R(x[0] + x[12], 7);
      x[8] ^= R(x[4] + x[0], 9);
      x[12] ^= R(x[8] + x[4], 13);
      x[0] ^= R(x[12] + x[8], 18);
      x[9] ^= R(x[5] + x[1], 7);
      x[13] ^= R(x[9] + x[5], 9);
      x[1] ^= R(x[13] + x[9], 13);
      x[5] ^= R(x[1] + x[13], 18);
      x[14] ^= R(x[10] + x[6], 7);
      x[2] ^= R(x[14] + x[10], 9);
      x[6] ^= R(x[2] + x[14], 13);
      x[10] ^= R(x[6] + x[2], 18);
      x[3] ^= R(x[15] + x[11], 7);
      x[7] ^= R(x[3] + x[15], 9);
      x[11] ^= R(x[7] + x[3], 13);
      x[15] ^= R(x[11] + x[7], 18);
      x[1] ^= R(x[0] + x[3], 7);
      x[2] ^= R(x[1] + x[0], 9);
      x[3] ^= R(x[2] + x[1], 13);
      x[0] ^= R(x[3] + x[2], 18);
      x[6] ^= R(x[5] + x[4], 7);
      x[7] ^= R(x[6] + x[5], 9);
      x[4] ^= R(x[7] + x[6], 13);
      x[5] ^= R(x[4] + x[7], 18);
      x[11] ^= R(x[10] + x[9], 7);
      x[8] ^= R(x[11] + x[10], 9);
      x[9] ^= R(x[8] + x[11], 13);
      x[10] ^= R(x[9] + x[8], 18);
      x[12] ^= R(x[15] + x[14], 7);
      x[13] ^= R(x[12] + x[15], 9);
      x[14] ^= R(x[13] + x[12], 13);
      x[15] ^= R(x[14] + x[13], 18);
    }

    for (var i = 0; i < 16; i++) {
      B32[i] = (B32[i] + x[i]) | 0;
    }

    for (var i = 0; i < 16; i++) {
      B[i] = flipEndian(B32[i]);
    }

    return B;
  }

  function blockxor(S, Si, D, Di, len) {
    len /= 4;
    Si /= 4;
    Di /= 4;
    for (var i = 0; i < len; i++) {
      D[Di + i] ^= S[Si + i] | 0;
    }
  }

  function blockcopy(S, Si, D, Di, len) {
    len /= 4;
    Si /= 4;
    Di /= 4;
    for (var i = 0; i < len; i++) {
      D[Di + i] = S[Si + i] | 0;
    }
  }

  function blockmix_salsa8(BY, Bi, Yi, r) {
    X = [];
    var i;

    blockcopy(BY, Bi + (2 * r - 1) * 64, X, 0, 64);

    for (i = 0; i < 2 * r; i++) {
        blockxor(BY, i * 64, X, 0, 64);
        salsa20_8(X);
        blockcopy(X, 0, BY, Yi + (i * 64), 64);
    }

    for (i = 0; i < r; i++) {
        blockcopy(BY, Yi + (i * 2) * 64, BY, Bi + (i * 64), 64);
    }

    for (i = 0; i < r; i++) {
        blockcopy(BY, Yi + (i * 2 + 1) * 64, BY, Bi + (i + r) * 64, 64);
    }
  }

  function smix(B, Bi, r, N, V, XY) {
    var Xi = 0;
    var Yi = 128 * r;
    var i;

    blockcopy(B, Bi, XY, Xi, Yi);

    for (i = 0; i < N; i++) {
      blockcopy(XY, Xi, V, i * Yi, Yi);
      blockmix_salsa8(XY, Xi, Yi, r);
    }

    for (i = 0; i < N; i++) {
      var j = integerify(XY, Xi, r) & (N - 1);
      blockxor(V, j * Yi, XY, Xi, Yi);
      blockmix_salsa8(XY, Xi, Yi, r);
    }

    blockcopy(XY, Xi, B, Bi, Yi);
  }

  function integerify(B, Bi, r) {
    Bi = Bi + (2 * r - 1) * 64;
    return flipEndian(B[Bi / 4]);
  }

  sanityCheck();
  return scrypt(passwd, salt, N, r, p, dkLen);
}
//SJCL-SCRYPT.JS ends
</script>

<!--Reed-Solomon error correction-->
<script>
/* Simple JavaScript Inheritance
 * By John Resig http://ejohn.org/
 * MIT Licensed.
 */
// Inspired by base2 and Prototype
(function(){
  var initializing = false, fnTest = /xyz/.test(function(){xyz;}) ? /\b_super\b/ : /.*/;
 
  // The base Class implementation (does nothing)
  this.Class = function(){};
 
  // Create a new Class that inherits from this class
  Class.extend = function(prop) {
    var _super = this.prototype;
   
    // Instantiate a base class (but only create the instance,
    // don't run the init constructor)
    initializing = true;
    var prototype = new this();
    initializing = false;
   
    // Copy the properties over onto the new prototype
    for (var name in prop) {
      // Check if we're overwriting an existing function
      prototype[name] = typeof prop[name] == "function" &&
        typeof _super[name] == "function" && fnTest.test(prop[name]) ?
        (function(name, fn){
          return function() {
            var tmp = this._super;
           
            // Add a new ._super() method that is the same method
            // but on the super-class
            this._super = _super[name];
           
            // The method only need to be bound temporarily, so we
            // remove it when we're done executing
            var ret = fn.apply(this, arguments);        
            this._super = tmp;
           
            return ret;
          };
        })(name, prop[name]) :
        prop[name];
    }
   
    // The dummy class constructor
    function Class() {
      // All construction is actually done in the init method
      if ( !initializing && this.init )
        this.init.apply(this, arguments);
    }
   
    // Populate our constructed prototype object
    Class.prototype = prototype;
   
    // Enforce the constructor to be what we expect
    Class.prototype.constructor = Class;
 
    // And make this class extendable
    Class.extend = arguments.callee;
   
    return Class;
  };
})();

var ReedSolomon = Class.extend({
  
  init: function (nSym) {
    this.nSym = nSym || 10;
    this.codec = new ReedSolomon.Codec();
  },
  
  encode: function (str) {
    
    var data = ReedSolomon.Utils.unpack(str);
    
    var chunkSize = 255 - this.nSym;
    var enc = [];
    
    for (var i = 0; i < data.length; i += chunkSize) {
      var chunk = data.slice(i, i + chunkSize);
      enc = enc.concat(this.codec.encodeMsg(chunk, this.nSym))
    }
    
    return enc;
    
  },
  
  decode: function (data) {
    
    var dec = [];
    
    for (var i = 0; i < data.length; i += 255) {
      var chunk = data.slice(i, i+255);
      dec = dec.concat(this.codec.correctMsg(chunk, this.nSym));
    }
    
    return ReedSolomon.Utils.pack(dec);
    
  }
  
});

ReedSolomon.Utils = {
  
  pack: function (bytes) {
    
    var chars = [];
    
    for(var i = 0, n = bytes.length; i < n; i++) {
      chars.push(String.fromCharCode(bytes[i]));
    }
      
    return chars.join('');
    
  },

  unpack: function (str) {
    
    var bytes = [];
    
    for(var i = 0, n = str.length; i < n; i++) {
      bytes.push(str.charCodeAt(i));
    }
    
    return bytes;
  },
  
  arrayFill: function (size, value) {
    
    return Array.apply(null, new Array(size))
      .map(function () { return value; });
      
  },
  
  sliceStep: function(array, from, to, step) {

    var result = Array.prototype.slice.call(array, from, to);
    
    var final = [];
    
    for (var i = result.length - 1; i >= 0; i--) {
        (i % step === 0) && final.push(result[i]);
    };
    
    final.reverse();
    result = final;

    return result;

  }
  
};

ReedSolomon.GaloisField = Class.extend({

  gfExp: ReedSolomon.Utils.arrayFill(512, 1),
  gfLog: ReedSolomon.Utils.arrayFill(256, 0),

  init: function () {

    var x = 1;

    for (var i = 1; i < 255; i++) {
      x <<= 1;
      if (x & 0x100)  x ^= 0x11d;
      this.gfExp[i] = x;
      this.gfLog[x] = i;
    }

    for (var i = 255; i < 512; i++) {
      this.gfExp[i] = this.gfExp[i - 255];
    }

  },

  mul: function (x, y) {
    if (x == 0 || y == 0) return 0;
    return this.gfExp[this.gfLog[x] + this.gfLog[y]];
  },

  div: function (x, y) {
    if (y == 0) throw 'Division by zero.';
    if (x == 0) return 0;

    return this.gfExp[this.gfLog[x] + 255 - this.gfLog[y]];
  },

  polyScale: function (p, x) {

    var r = [];
    for (var i = 0; i < p.length; i++)
      r.push(this.mul(p[i], x));

    return r;
  },

  polyAdd: function (p, q) {

    var pLen = p.length,
        qLen = q.length,
        maxLen = Math.max(pLen, qLen),
        r = ReedSolomon.Utils.arrayFill(maxLen, 0),
        rLen = r.length;

    for (var i = 0; i < pLen; i++)
      r[i + rLen - pLen] = p[i];

    for (var i = 0; i < qLen; i++)
      r[i + rLen - qLen] ^= q[i];

    return r;

  },

  polyMul: function (p, q) {

    var r = ReedSolomon.Utils.arrayFill(p.length + q.length - 1, 0);

    for (var j = 0; j < q.length; j++) {
      for (var i = 0; i < p.length; i++) {
        r[i + j] ^= this.mul(p[i], q[j]);
      }

    }

    return r;

  },

  polyEval: function (p, x) {

    var y = p[0];

    for (var i = 1; i < p.length; i++)
      y = this.mul(y, x) ^ p[i];

    return y;

  }

});

ReedSolomon.Codec = Class.extend({

  init: function () {

    this.gf = new ReedSolomon.GaloisField();

  },

  generatorPoly: function (nSym) {

    var g = [1];

    for (var i = 0; i < nSym; i++) {
      g = this.gf.polyMul(g, [1, this.gf.gfExp[i]]);
    }

    return g;
  },

  encodeMsg: function (msgIn, nSym) {

    if (msgIn.length + nSym > 255)
      throw 'Message too long.';

    var gen = this.generatorPoly(nSym);
    var msgOut = ReedSolomon.Utils.arrayFill(msgIn.length + nSym, 0);

    for (var i = 0; i < msgIn.length; i++)
      msgOut[i] = msgIn[i];

    for (var i = 0; i < msgIn.length; i++) {
      var coef = msgOut[i];
      if (coef != 0) {
        for (var j = 0; j < gen.length; j++) {
          msgOut[i + j] ^= this.gf.mul(gen[j], coef);
        }
      }
    }

    for (var i = 0; i < msgIn.length; i++)
      msgOut[i] = msgIn[i];

    return msgOut;

  },

  calcSyndromes: function (msg, nSym) {

    var r = [];

    for (var i = 0; i < nSym; i++)
      r.push(this.gf.polyEval(msg, this.gf.gfExp[i]));

    return r;

  },

  correctErrata: function (msg, synd, pos) {

    var q = [1];

    for (var i = 0; i < pos.length; i++) {
      var x = this.gf.gfExp[msg.length - 1 - pos[i]];
      var q = this.gf.polyMul(q, [x, 1]);
    }

    var p = synd.slice(0, pos.length);

    p.reverse();

    p = this.gf.polyMul(p, q);
    p = p.slice(p.length - pos.length, p.length);
    q = ReedSolomon.Utils.sliceStep(q, q.length & 1, q.length, 2);

    for (var i = 0; i < pos.length; i++) {
      var x = this.gf.gfExp[pos[i] + 256 - msg.length];
      var y = this.gf.polyEval(p, x);
      var z = this.gf.polyEval(q, this.gf.mul(x, x));
      msg[pos[i]] ^= this.gf.div(y, this.gf.mul(x, z));
    }

    return msg;

  },


  rsFindErrors: function (synd, nMess) {

    var errPoly = [1], oldPoly = [1];
    var newPoly;

    for (var i = 0; i < synd.length; i++) {

      oldPoly.push(0); var delta = synd[i];

      for (var j = 1; j < errPoly.length; j++) {
        delta ^= this.gf.mul(errPoly[
        errPoly.length - 1 - j], synd[i - j])
      }

      if (delta != 0) {
        
        if (oldPoly.length > errPoly.length) {
          newPoly = this.gf.polyScale(oldPoly, delta);
          oldPoly = this.gf.polyScale(errPoly,
            this.gf.div(1, delta));
          errPoly = newPoly;
        }
        errPoly = this.gf.polyAdd(errPoly,
          this.gf.polyScale(oldPoly, delta));
      }

    }

    var errs = errPoly.length - 1;
    if (errs * 2 > synd.length){
		//error msg added by F. Ruiz
		RSerrorMsg();
      throw 'Too many errors to correct';
	}
    var errPos = [];

    for (var i = 0; i < nMess; i++) {
      if (this.gf.polyEval(errPoly, this.gf.gfExp[255-i]) == 0)
        errPos.push(nMess - 1 - i);
    }

    if (errPos.length != errs)
      return null;

    return errPos;

  },

  forneySyndromes: function (synd, pos, nMess) {

    var fsynd = synd.slice(0);

    for (var i = 0; i < pos.length; i++) {
      
      var x = this.gf.gfExp[nMess - 1 - pos[i]];
      
      for (var j = 0; j < fsynd.length - 1; j++) {
        fsynd[j] = this.gf.mul(fsynd[j], x) ^ fsynd[j + 1]
      }
      
      fsynd.pop();
      
    }

    return fsynd;

  },

  correctMsg: function (msgIn, nSym) {

    if (msgIn.length > 255){
		//error msg added by F. Ruiz
		RSerrorMsg();
      throw 'Message too long'
	}
    var msgOut = msgIn.slice(0);
    var erasePos = [];

    for (var i = 0; i < msgOut.length; i++) {

      if (msgOut[i] < 0)  {
        msgOut[i] = 0;
        erasePos.push(i);
      }

    }

    if (erasePos.length > nSym){
		//error msg added by F. Ruiz
		RSerrorMsg();
      throw 'Too many erasures to correct'
	}
    var synd = this.calcSyndromes(msgOut, nSym);

    if (Math.max.apply(null, synd) == 0) {
      return msgOut.slice(0, msgOut.length-nSym);
    }

    var fsynd = this.forneySyndromes(synd, erasePos, msgOut.length);

    var errPos = this.rsFindErrors(fsynd, msgOut.length);

    if (errPos == null){
		//error msg added by F. Ruiz
		RSerrorMsg();
      throw 'Could not locate error'
	}
    msgOut = this.correctErrata(msgOut, synd,
                  erasePos.concat(errPos));
    
    synd = this.calcSyndromes(msgOut, nSym);

    if (Math.max.apply(null, synd) > 0){
		//error msg added by F. Ruiz
		RSerrorMsg();
      throw 'Could not correct message';
	}
    return msgOut.slice(0, -nSym);

  }

});

//error msg added by F. Ruiz
function RSerrorMsg(){
	var msg = 'Error correction failed. Maybe retry without tags.';
	if(tabLinks['dirTab'].className == ''){
		document.getElementById('mainmsg').innerHTML = msg
	}else{
		document.getElementById('lockmsg').innerHTML = msg
	}
}
</script>


<!--main PassLok code-->

<!--this only loads two word arrays: wordlist and blacklist.-->
<script>
//Dictionary for entropy calculation in WiseHash. American English version
//This file contains only two global arrays made of words: blacklist and wordlist. Common substitutions have been applied:
//   0 for o, 1 for i, 2 for z, 3 for e, 4 for a, 5 for s, 7 for t, 8 for b, 9 for g

//this makes an array with the 1000 most frequent passwords as of 2011, from https://xato.net/passwords/more-top-worst-passwords, plus a few more. 3-letter words from the other list. To sort it from longer to shorter strings in javascript, do it with:
//blacklist.sort(function (a, b) { return b.length - a.length; })
var blacklist = "c0rr3c7h0r5384773ry574pl3 p455l0k p455l0ck 123456789 l1v3rp00l p455w0rd1 53mp3rf1 p4k1574n 845384ll f00784ll m1ch43l1 j3nn1f3r 73577357 w0lf94n9 74rh33l5 5up3rm4n l0v3r80y pu55yc47 7ru57n01 p4n7h3r5 5r1n1v45 51mp50n5 571n9r4y m1ch3ll3 5un5h1n3 4m3r1c4n l4wr3nc3 p455w0rd w0lfp4ck 3l124837 574rw4r5 5c4rf4c3 41rpl4n3 ncc1701d c0mpu73r k4w454k1 c4rd1n4l p47r1075 5p1d3rm4 c0rv3773 m17ch3ll ch3v3ll3 pr1nc355 l37m31n1 8ulld095 r0ll71d3 1l0v3y0u 44444444 p455p0r7 v1r91n14 m4v3r1ck 8l1nk182 5w0rdf15 5c07l4nd 5w1mm1n9 54m4n7h4 5733l3r5 8r1774ny 574r9473 wh473v3r 3l3c7r1c 8udl19h7 p33k4800 m157r355 p34rlj4m fr33p455 r3m3m83r h4rdc0r3 w0lv3r1n 48cd1234 v3r0n1c4 w1ldc475 53cur17y 1n73rn37 50f784ll ch4mp10n m3rc3d35 848y91rl fr33u53r 12345678 p47r1c14 w35751d3 c0ur7n3y 5n1ck3r5 819d4ddy fr4nkl1n m1dn19h7 c4r0l1n3 1q422w5x m4r5h4ll 11111111 dr0w554p ch3r0k33 m4rl80r0 4nd3r50n 5p17f1r3 v1c70r14 m4ryj4n3 p4r4d153 l4cr0553 8u77h34d 1nf1n17y n0v3m83r n1n73nd0 574r7r3k p00h834r 45df9hjk l1v3rp00 d4rkn355 80ll0ck5 d4n13ll3 r3d5k1n5 cr3471v3 c0l0r4d0 c4r0l1n4 1q2w334r k1m83rly 5l1pkn07 m0un741n l45v3945 p455w0rd 4l3x4nd3 5n0w84ll 5h17h34d 31n5731n 9u1nn355 xxxxxxxx 87654321 m1ch194n 88888888 n1ch0l45 m374ll1c r3dw1n95 8r00klyn d1ckh34d qw3r7yu1 83nj4m1n d0lph1n5 d3c3m83r chr1571n 3xpl0r3r 3l3ph4n7 41r80rn3 8ull5h17 c0c4c0l4 j0rd4n23 69696969 94rf13ld pl471num l1f3h4ck w1ll14m5 90d21ll4 45df45df 5c0rp10n ru5h2112 j0n47h4n 1n53cur3 ch0pp3r w3lc0m3 fr33d0m m4r1n35 ncc1701 71m07hy cl4ud14 ch4rl35 cl1n70n 8r07h3r 819d1ck c47ch22 f1r3m4n 7hund3r 8l0wj08 p0k3m0n m0n573r 8r4dl3y m4x1mu5 p3n9u1n h0u570n p47ch35 53rv1c3 8r4nd0n p4n73r4 w1nd0w5 p3rf3c7 n474l13 h347h3r jup173r h3ndr1x l1nc0ln 51mp50n ch1c490 r4n93r5 94nd4lf fr4nk13 8197175 24ch4ry p45510n r41d3r5 p4ck4rd 1r3l4nd n1ppl35 chr0n1c cumm1n9 j0hn50n ch3573r p0n714c n3m3515 m477h3w f15h1n9 j3ffr3y 948r13l l00k1n9 fr13nd5 pyr4m1d 4ll150n 84r84r4 7hx1138 3v3r70n ch3l534 p4n7h3r 2xcv8nm 4r53n4l p47r1ck r1ch4rd ru553ll d14m0nd 7777777 dr34m3r kr1573n 4m473ur h07m41l cry574l 7174n1c p0pc0rn v1nc3n7 5h0073r 3x7r3m3 5h4nn0n 84574rd l347h3r 0c7083r c4m3r0n cl4551c m4d150n ch4rl13 548r1n4 h0073r5 m3l4n13 4n7h0ny c4p741n v1k1n95 j45m1n3 d3571ny 5k1pp3r d0u9l45 n4u9h7y 54ndm4n v4n3554 71ff4ny 8008135 n3wp0r7 m4ch1n3 4r120n4 f0r3v3r pu55135 7hump3r 573ph3n 8u88l35 l183r7y j4ck50n l37m31n 5c0073r ph03n1x 5n0wm4n w1n570n 5p3nc3r m0n74n4 p4ck3r5 n3wy0rk drumm3r 574nl3y 93n3r4l 3cl1p53 d0d93r5 p0r5ch3 54m5un9 j3551c4 819c0ck 455h0l3 c0ll393 hun71n9 fuck1n9 93n3515 n4745h4 m4xw3ll 8675309 f4n745y 8347l35 7357123 h4wk3y3 pumpk1n r00573r fuck0ff pl4y80y v4mp1r3 n1rv4n4 r3dh34d 8uff4l0 qw3r7y1 c4r7m4n d19174l r4ym0nd 7r1n17y n07h1n9 7r00p3r p4n7135 fl0r1d4 1234567 p3rv3r7 r0538ud 80nd493 mu574n9 7r0u8l3 5ucc355 9r390ry cr1ck37 w4rr10r p34ch35 fl0w3r5 fucky0u m1ch43l 7h3r0ck 9473w4y w1ll14m r41n80w c0w80y5 w1ldc47 ch1ck3n m3rcury y4nk335 8r0nc05 fr4nc15 4m3r1c4 ju571c3 573w4r7 d0lph1n 73571n9 80nd007 f3rr4r1 5u8l1m3 cum5h07 h3k46w2 8r17n3y ph4n70m m3l1554 c0n7r0l 1r0nm4n pr1v473 48cd3f9 v0y493r 817ch35 930r914 r383cc4 l35814n j4ck455 8ulld09 5c0rp10 53cur3 c4nn0n w1n73r r3d123 90rd0n 7r4v15 834v3r 1n51d3 fly3r5 232323 222222 80nn13 d09913 l393nd y4nk33 8l423r qw3r7y runn3r 81rd13 555555 p4rk3r 70p9un 834v15 h34v3n 4n1m4l c0y073 81980y 71nk3r 4r7hur w4l73r 73573r d0n4ld k474n4 4p0ll0 v39374 dr490n 4u9u57 54m50n m0nk3y 8r0nc0 fr34ky 696969 48c123 c0pp3r v00d00 c4lv1n w1ll0w 4lph41 l177l3 c4r73r 4l83r7 m3m83r k1773n x4v13r 349l31 5h3l8y 159753 j35513 n1993r 123321 5h4d0w h0rn3y 5urf3r n1554n 999999 547urn 8r4v35 4l3x15 m4rv1n m4573r 4c710n 4d1d45 m47ur3 fr3ddy w4lk3r p0l1c3 987654 9unn3r 111111 c0nn13 0nl1n3 ru5514 4ppl35 73r354 70mc47 5h4r0n d3x73r r4c1n9 57up1d f15h3r d0c70r dr34m5 v1c70r h3n741 m49num n47h4n c4n4d4 d0nk3y 777777 333333 573ll4 93m1n1 j0rd4n 12348c 5p33dy h07d09 123456 p1mp1n n3l50n m4r1n4 m0n1c4 571cky j49u4r l0u153 222222 83rl1n 9470r5 h4rl3y 5uck3r m3x1c0 5uck17 chr151 fuckm3 91850n c3l71c m4rcu5 ch3rry c45513 888888 5n1p3r ch4nc3 p00k13 h07r0d r3dd09 h3lpm3 7uck3r j3573r dr1v3r c00p3r un173d c4rm3n l0v3r5 hun73r 54ndr4 1q2w33 112233 c45p3r 54mu3l j3r3my 914n75 57r1k3 d38813 513rr4 70y074 h3ll01 90083r fr1d4y 50ph13 5c077y 48cd3f 7ur7l3 h4w411 fluffy muff1n h0r535 j4ck13 r4n93r fl0w3r d3nn15 p4m3l4 7h3m4n 8uddh4 r0ck37 l4ur3n w0lv35 4n93l4 541l0r 423r7y 74uru5 5h0r7y m0n3y1 l0v3m3 8ull37 51mpl3 80093r 444444 84d455 8u773r d3n153 m4dd09 l124rd w1ll13 455m4n c4rl05 w1l50n h0w4rd 123qw3 pr1nc3 4n93l5 murphy 101010 1w4n7u 747700 p0p3y3 v1k1n9 pu55y1 90ld3n w1nn3r 5p00ky 4l45k4 84d93r j45p3r 8u573r m024r7 m07h3r v491n4 q42w5x 0l1v3r n0rm4n 5ydn3y 51n9l3 c0u94r r3d50x 819m4c 420420 f4m1ly 3n19m4 53x53x r41d3r 8r421l 8l0nd3 7h0m45 r4ch3l 5ch00l 5l4y3r l0v3ly h4nn4h 000000 252525 l0nd0n 5p4nky l35l13 8l0wm3 84d80y d1353l 3m1n3m 5u2uk1 3dw4rd humm3r l4d135 84rn3y 5k1ppy r39913 5uckm3 m4r1n3 147147 p1r473 80570n r3drum d148l0 w4nk3r 571nky duc471 y4m4h4 815h0p f3nd3r 5p1r17 573v3n m0nd4y 8ru7u5 r48817 5m007h m1ll3r m4rl3y f0r357 212121 l4k3r5 n1ppl3 5p1d3r v1510n 84n4n4 73nn15 8r4ndy 1nd14n 71993r p1c4rd 5y573m jun10r lucky1 cl41r3 5c008y 800913 w124rd pl4y3r xxxxxx 5pr1n9 d4nc3r h4rd0n j0hnny fuck3d 800800 c0ff33 c0mp4q kn19h7 4ndr34 819r3d 5qu1r7 pl3453 2xcv8n h08835 k3rm17 r083r7 d0m1n0 50cc3r d3nv3r 8r00k3 r45c4l h17m4n 349l35 847m4n 888888 fr13nd d4k074 5m0k3y 1c3m4n 800m3r 541n75 5n00py j053ph 819m4n 20m813 h4h4h4 131313 d15n3y ju571n 8r3nd4 m00k13 p34nu7 dunc4n 0l1v14 n45c4r c00k13 4l1c14 4l150n m1ck3y 8u8841 7193r5 m0r94n 444444 purpl3 3r071c 9u174r 841l3y l19h75 f4lc0n m47r1x c4m4r0 h4ppy1 94l0r3 chr157 w3453l 242424 w0m847 d1993r c0w80y 5p4rky p00p00 4cc0rd 45df9h 7urk3y 007007 53cr37 819d09 y3ll0w m4r71n ch3353 90lf3r c4rr13 121212 p5ych0 m3rl1n 8ur70n k1ll3r c0nn0r l1ckm3 r0l4nd 4u571n fuck3r 74yl0r 5umm3r 4rn0ld h4mm3r 91n93r 908lu3 d3v1l5 3u93n3 3mp1r3 n1c0l3 5h499y fr099y 94rc14 789456 k0d14k p30pl3 kr4m3r 8173m3 h00k3r whyn07 0r4n93 84x73r 5p0r75 h0ck3y 4m4nd4 qqqqqq 666666 4v4l0n 45hl3y 123123 d4ll45 51lv3r m49913 123654 7ruck5 j05hu4 654321 4cc355 d4n13l p3pp3r m4dm4x 4ly554 84m84m 5h4v3d 7193r1 ch1ck5 r4p70r fr4nc3 4ndr3w 930r93 d3c0y 3n73r 9r33n wh0r3 cr42y m0053 v1d30 80085 0u812 cr34m 11111 j35u5 fl45h fr4nk 8uddy 8088y 84ll5 h0u53 5w337 5m17h h0nd4 m491c 349l3 h4ppy h0r53 k3lly d347h c08r4 3nj0y 834ch j3nny 4m83r 8unny m0u53 p0w3r p3p51 j0n35 55555 ch3vy j4m35 d1r7y 4dm1n 8u884 05c4r 81lly wh173 ju1c3 54r4h 347m3 817ch h0m3r v1p3r mu51c 8007y 9r347 m0lly 573v3 12345 j1mmy p3n15 w473r r0ck5 45df9 8l4ck 8r0wn p4r7y k4713 j450n d4ddy 73x45 5c077 php88 l19h7 54321 91rl5 xxxxx 51m0n h0n3y p0rn0 3lv15 j3rry r0cky 4lph4 5n4k3 n4k3d 733n5 y0un9 h3ll0 5lu75 7193r 54ndy 5u94r 54mmy w0m3n 70mmy r4v3n pu55y chr15 h0rny 8r14n m0n3y 84835 p373r 5up3r qw3r7 j4p4n p4r15 k3v1n m0v13 w00dy c4ndy 574r5 5p1k3 d4v1d lucky 4ppl3 4n93l l0v3r k177y 1969 6969 733n 4d4m l154 53xy qw3r 1111 48cd ry4n p455 7357 8888 duk3 70ny fuck 9999 d1ck p1mp m1k3 j0hn p0rn 8lu3 j3ff dud3 l0n9 5uck 45df 3r1c p00p j4ck h4rd 71m3 900d 4321 6666 m477 90lf 5555 m1n3 l0v3 3333 f0rd 834r 91rl 5150 xxxx fr3d 7175 0000 f15h k1n9 2000 w0lf 1313 8455 5h17 c0ck 2112 fr33 1212 5lu7 cun7 7777 m4rk h34d p4ul j4k3 c00l r0ck d4v3 4l3x f1r3 848y 4444 2222 81ll 833r 574r 1234 84n9 4444 k3y 123 321 111 222 333 444 555 666 777 888 999 000 45d qw3 2xc 098 p01 lkj mn8 qqq www rrr yyy uuu ppp ddd fff hhh jjj kkk lll xxx ccc vvv nnn mmm".split(' ');

//from https://github.com/first20hours/google-10000-english. Words not on blacklist only. To find the difference, do this in the js console:
//Array.prototype.diff = function(a) {
//    return this.filter(function(i) {return a.indexOf(i) < 0;});
//};
//and then wordlist.diff(blacklist)
var wordlist= "73l3c0mmun1c4710n5 5u8l1m3d1r3c70ry ch4r4c73r124710n r35p0n5181l17135 r3c0mm3nd4710n5 7r0u8l35h0071n9 ch4r4c73r1571c5 c0n9r47ul4710n5 r3pr353n74710n5 ph4rm4c3u71c4l5 r3pr353n7471v35 c0nf1d3n714l17y 1n57rum3n74710n 1n73rn4710n4lly r3c0n57ruc710n 5p3c1f1c4710n5 1n73rpr374710n cl4551f1c4710n 1d3n71f1c4710n c0n51d3r4710n5 4dm1n157r471v3 4u7h3n71c4710n 5u5741n481l17y c0rr35p0nd3nc3 d15cr1m1n4710n c0nf19ur4710n5 1nfr457ruc7ur3 c4rd10v45cul4r 7r4n5f0rm4710n r3h481l174710n 4dm1n157r470r5 r3c0mm3nd4710n 51mul74n30u5ly ph4rm4c3u71c4l c0nc3n7r4710n5 0r94n124710n4l 1mpl3m3n74710n kn0wl3d93570rm qu4l1f1c4710n5 1nv357194710n5 4dm1n157r4710n r3pr353n74710n 5up3r1n73nd3n7 7r4n5p0r74710n ch4r4c73r1571c r3pr353n7471v3 4cc0mm0d4710n5 4dv3r7153m3n75 r35p0n5181l17y 4ppr0pr14710n5 c0mmun1c4710n5 4cc0un7481l17y c0n5717u710n4l p4rl14m3n74ry 4u70m471c4lly 1nv357194710n c0n7r0v3r514l 4l73rn471v3ly p4r71c1p4710n 4dm1n157r470r 4ppr0x1m473ly qu35710nn41r3 qu4l1f1c4710n c0n74m1n4710n 3x7r40rd1n4ry ch4mp10n5h1p5 pr353n74710n5 r3v0lu710n4ry c0mpl1m3n74ry r3l4710n5h1p5 c0mpr3h3n51v3 c1rcum574nc35 c0nf19ur4710n 5u8574n714lly n071f1c4710n5 c0mpu74710n4l c0ll480r471v3 m3d173rr4n34n 1llu57r4710n5 1n73rv3n710n5 3n73r741nm3n7 p5ych0l091c4l 81073chn0l09y func710n4l17y pr4c71710n3r5 1n57ruc710n4l 4u7h0r124710n d373rm1n4710n d157r18u710n5 c0rr35p0nd1n9 4rch173c7ur4l und3r9r4du473 m0d1f1c4710n5 m4nuf4c7ur1n9 1n5717u710n4l c0mp47181l17y c0ll480r4710n c0mm15510n3r5 1n73rn4710n4l 1n4ppr0pr1473 4nn0unc3m3n75 pr3c1p174710n 1nv35719470r5 0r94n154710n5 c0n9r35510n4l 3n7r3pr3n3ur5 4ccr3d174710n 57r3n97h3n1n9 d0cum3n74710n 574r5m3rch4n7 73chn0l091c4l 53m1c0nduc70r c0n7r18u710n5 p4r71c1p471n9 c0mpl1c4710n5 7r4n5cr1p710n 3nv1r0nm3n74l c0n51d3r4710n m4554chu53775 l13ch73n5731n c0n5c10u5n355 m15c3ll4n30u5 und3r574nd1n9 c3r71f1c4710n 5p3c1f1c4710n pr0f35510n4l5 5u85cr1p710n5 818l109r4ph1c c0nv3r54710n5 c0nc3n7r4710n r357ruc7ur1n9 4cc355181l17y 0pp0r7un17135 50ph1571c473d m4nuf4c7ur3r5 d1571n9u15h3d 519n1f1c4n7ly ph0709r4ph3r5 0r94n124710n5 35748l15hm3n7 1nd3p3nd3n7ly 3ff3c71v3n355 d3m0n57r4710n d3v3l0pm3n74l c0n50l1d4710n c0mmun1c4710n 1nf0rm4710n4l ch4r4c73r123d 1n574ll4710n5 p055181l17135 vuln3r481l17y 4cc0mm0d4710n 4dv3r7153m3n7 unf0r7un473ly 4l73rn471v35 hyp07h371c4l p3nn5ylv4n14 un3mpl0ym3n7 pr353n74710n 4dd1710n4lly pr353rv4710n 4cqu151710n5 d15c1pl1n4ry c3r71f1c4735 d3571n4710n5 jur15d1c710n d3m0n57r473d pr0f35510n4l 1n7r0duc70ry d3p4r7m3n74l 4lph48371c4l 3x4m1n4710n5 d3v3l0pm3n75 p3rf0rm4nc35 r35p3c71v3ly 1n57rum3n74l 5u8c0mm17733 p4r71c1p473d c0mm15510n3r c0nn3c71v17y d154pp01n73d 1nd1v1du4lly 4ch13v3m3n75 c0n71nu0u5ly 1n73ll193nc3 m345ur3m3n75 73571m0n14l5 c0m81n4710n5 3ncycl0p3d14 1n73rm3d1473 ph0709r4ph3r 54715f4c70ry hum4n174r14n 7r4n54c710n5 c0nf3r3nc1n9 4cc0mpl15h3d 1mpl1c4710n5 7r4n5l4710n5 c0ll3c718l35 r357r1c710n5 r3pr353n71n9 d35cr1p710n5 5uff1c13n7ly 5p1r17u4l17y 7h4nk591v1n9 0p71m124710n 3xp3r13nc1n9 c0n53qu3nc35 c0n53rv471v3 mun1c1p4l17y 3xp3c74710n5 818l109r4phy 1nd3p3nd3nc3 4rch173c7ur3 4n7hr0p0l09y c0n53qu3n7ly c0ll3c748l35 3nv1r0nm3n75 4ppl1c4710n5 0r94n154710n p4r71cul4rly ph0709r4ph1c j4ck50nv1ll3 d1ff3r3n714l 5ch0l4r5h1p5 4cc0mp4ny1n9 r3cr34710n4l h34dqu4r73r5 r3qu1r3m3n75 1nfr1n93m3n7 1llu57r4710n d157r18u70r5 r353rv4710n5 c0nf1rm4710n 5urv31ll4nc3 qu4n717471v3 574k3h0ld3r5 ch4mp10n5h1p c0n50l1d473d p3r50n4l123d c4p481l17135 3n73r741n1n9 pr3r3qu15173 5ucc355fully c0nd1710n1n9 c0n57ruc710n 3xp3nd17ur35 r3fr193r470r n390714710n5 3nh4nc3m3n75 r3pr0duc71v3 1n73r53c710n 1n574ll4710n chr15714n17y c0mm0nw34l7h 1n73r4c710n5 7r4n5p4r3ncy 5uppl3m3n74l 5p3c14l121n9 1nv35719470r r3pr0duc710n 4pp01n7m3n75 d1c710n4r135 d15481l17135 c0mp371710n5 p4r7n3r5h1p5 73mp3r47ur35 c0n7r18u70r5 c0mp3n54710n r3l4710n5h1p 1n73rf3r3nc3 4v41l481l17y 5h4r3h0ld3r5 1n73rv3n710n pr351d3n714l ph1l4d3lph14 5u853qu3n7ly pr4c71710n3r 49r1cul7ur4l 1ncr3451n9ly 4ppr3c14710n 4rr4n93m3n75 d1ff1cul7135 c0nv3n710n4l 1n57ruc710n5 c0nv3r54710n p3r10d1c4lly c4nc3ll4710n pr35cr1p710n 0r94n124710n 1mpr0v3m3n75 1n5717u710n5 c0n51573n7ly 545k47ch3w4n c1v1l124710n m0d1f1c4710n 90v3rnm3n74l c0n51d3r48l3 ph4rm4c0l09y m47h3m471c4l 1nd14n4p0l15 un1v3r517135 m4nuf4c7ur3d c4lcul4710n5 c0rp0r4710n5 5cr33n54v3r5 p4r71c1p4n75 519n1f1c4nc3 d0wnl04d48l3 1mpl3m3n71n9 c0nf1d3n714l m37r0p0l174n p3r5p3c71v35 n071f1c4710n d3m0n57r4735 r39157r4710n n3v3r7h3l355 c00rd1n4710n v3r1f1c4710n 5u85cr1p710n 0ccup4710n4l 0cc4510n4lly 5u851d14r135 un4u7h0r123d l480r470r135 c0n7r18u710n d157r18u710n n3wf0undl4nd 1nv35719473d m457ur84710n 4nn0unc3m3n7 c0n73mp0r4ry 4550c14710n5 c0n5717u710n fund4m3n74l5 73chr3pu8l1c 5p3c1f1c4lly 3xp3r1m3n74l 1nc0rp0r473d 3n7r3pr3n3ur f1nd4r71cl35 m457ur8471n9 8r04dc4571n9 dr4m471c4lly c0n5ul74710n 4dm1n1573r3d 7r4n53xu4l35 4ckn0wl3d93d 7r4n5m15510n c0n53rv4710n 810d1v3r517y c0n7r18u71n9 m4nuf4c7ur3r 1n73ll3c7u4l pu8l1c4710n5 54715f4c710n 1n7r0duc710n n319h80rh00d 9309r4ph1c4l 73chn0l09135 pr0duc71v17y 35748l15h1n9 0853rv4710n5 r3l1481l17y 1n739r471n9 d1ff3r3n7ly ph0709r4ph5 r350lu710n5 r3574ur4n75 c0mpr35510n pr3f3r3nc35 519n1f1c4n7 0pp0r7un17y c0mp37170r5 m4nuf4c7ur3 c0mf0r748l3 1n73r4c710n 3xp3r1m3n75 4f9h4n1574n 3xpl0r4710n 3ff3c71v3ly 0ccup4710n5 m3rch4nd153 5u8m15510n5 3duc4710n4l 5ch0l4r5h1p 3qu1l18r1um 5uppl3m3n75 1nd3p3nd3n7 r35p0n518l3 4l73rn471v3 c0n5ul74n75 pu8l1c4710n m345ur3m3n7 1n57ruc70r5 p0pul4710n5 h19hl19h73d ph0709r4phy c00p3r4710n 4cqu151710n 1mpl3m3n73d pr05p3c71v3 d1r3c70r135 5p3c74cul4r c0n7r18u70r 1nv357m3n75 5u85cr183r5 4ppr0pr1473 p073n714lly c0n57r41n75 d15c1pl1n35 c0n7r4c70r5 3nc0un73r3d 5p3c14l123d d1m3n510n4l r3c0mm3nd3d m07h3r804rd r3n41554nc3 m41n73n4nc3 7h3r4p3u71c ph3n73rm1n3 4cc0rd1n9ly c0rp0r4710n 4nn1v3r54ry m3d1c4710n5 35748l15h3d d157r18u70r d3519n4710n pr09r4mm1n9 1n5p3c710n5 ch4ll3n91n9 7r4n5f3rr3d c0nf3r3nc35 r353rv4710n pr0p051710n 8345714l17y p3n37r4710n c0n5ump710n r357r1c710n 1mp0r74n7ly 47m05ph3r1c 1nc0rp0r473 1n57rum3n75 84ck9r0und5 l19h7w319h7 d0cum3n74ry 73rr170r135 l3915l471v3 p3r5p3c71v3 p4l3571n14n m37h0d0l09y 7r4d1710n4l 0u7574nd1n9 r3534rch3r5 un5u85cr183 1n73ll193n7 c0mm17m3n75 3x4m1n4710n 1n73r3571n9 5u5741n48l3 73l3v1510n5 c0n7r18u73d ph1l1pp1n35 57471571c4l c0mm0d17135 7r4n54c710n l3915l47ur3 r3c09n1710n furn15h1n95 93n3r4710n5 1nd1v1du4l5 h05p174l17y pr0cur3m3n7 3n91n33r1n9 1n9r3d13n75 c0n51573ncy m070rcycl35 70urn4m3n75 c0nc3n7r473 5p0n50r5h1p 7h30r371c4l 3xh181710n5 r39ul4710n5 c3r71f1c473 d3f1n1710n5 4dv3r7151n9 w0rk574710n p3r50n4l17y r3cru17m3n7 3ff1c13n7ly c4l18r4710n 5w1723rl4nd c0mmun17135 d15p051710n u71l124710n 4774chm3n75 c0n51d3r1n9 73mp3r47ur3 f45c1n471n9 c0mpu74710n m41n741n1n9 unc3r741n7y 4cc0mp4n13d pr3d1c710n5 p4r71c1p4n7 45519nm3n75 4r817r4710n c0nf19ur1n9 c0nn3c710n5 c0nv3r93nc3 c00p3r471v3 fur7h3rm0r3 73rm1n4710n 3nc0ur491n9 3nv1r0nm3n7 m4lpr4c71c3 1nf0rm471v3 c0nclu510n5 90v3rnm3n75 4rr4n93m3n7 l1481l17135 c17123n5h1p 3l3c7r0n1c5 7r4n553xu4l 0p3r4710n4l c0mp4r150n5 f0und4710n5 1nn0v4710n5 v13wp1c7ur3 pr0duc710n5 c0n57ruc73d pr0pr1374ry c0mp4r471v3 r3pu8l1c4n5 5p3c14l7135 477r4c710n5 4550c14710n 1nv174710n5 func710n1n9 cl4551f13d5 4u7h0r17135 c0mp371710n r3qu1r3m3n7 5h4k35p34r3 j0urn4l1575 3xp3nd17ur3 3xpr35510n5 3nf0rc3m3n7 p055181l17y c0nv3r718l3 8477l3f13ld c1rcul4710n 53cr374r147 1mm3d1473ly n0m1n4710n5 1d3n71fy1n9 4pp01n7m3n7 r35p1r470ry 3nh4nc3m3n7 d3m09r4ph1c r3pr353n73d 1n73rpr373d 3v4lu4710n5 fundr4151n9 1mpr0v3m3n7 0u750urc1n9 3l1m1n4710n und3r9r0und c0mm15510n5 pr3l1m1n4ry 08l194710n5 p0w3r53ll3r c0n53qu3nc3 v3r231chn15 3xp3r13nc35 unn3c3554ry 1n73r4c71v3 d15cl41m3r5 p3rf0rm4nc3 pr0c33d1n95 1nv35719473 c0mpl1c473d 5pr1n9f13ld n390714710n pr0m0710n4l 4ppl1c4710n c0pyr19h73d chr1570ph3r c0mp1l4710n 4cc3550r135 1n5717u710n 4ckn0wl3d93 d3m0n57r473 3xp3r13nc3d 4n71c1p473d p4r71c1p473 c0ll3c710n5 7r4n5m1773d c0rr3c710n5 5cr33n5h075 pr09r4mm3r5 d3u75chl4nd c0nn3c71cu7 m1551551pp1 5m17h50n14n 455ump710n5 3nl4r93m3n7 m47h3m471c5 5up3rv1510n 5p3c14l1575 c0njunc710n c3l38r17135 d1ff3r3nc35 m1nn34p0l15 1n171471v35 835753ll3r5 c0n53cu71v3 hydr0c0d0n3 p051710n1n9 1n57ruc710n p3r1ph3r4l5 4l8uqu3rqu3 c00rd1n4735 pl4y574710n c0nv3n710n5 d35cr1p710n 5ynd1c4710n n3w5l3773r5 c0n5ul74ncy 73mp0r4r1ly c0mmun1c473 c0n7r0ll3r5 c0nv3n13nc3 r3570r4710n ch0l3573r0l c3l38r4710n 1n739r4710n fr3qu3nc135 pr3p4r4710n 1m491n4710n r3fl3c710n5 0853rv4710n 3nd0r53m3n7 4ppr3c1473d r3fur815h3d d0wnl04d1n9 1n7r0duc1n9 4dv3r7153r5 m49n1f1c3n7 d15cu5510n5 c0mp37171v3 1n73rr4c14l c0mp051710n 5up3rv150r5 pr08481l17y w357m1n573r d3571n4710n 7r4n5cr1p75 c0n71nu4lly p0l171c14n5 c0ll3c718l3 7r1p4dv150r r351d3n714l 4cc0mm0d473 1mm19r4710n p4r7n3r5h1p 5u9935710n5 r3pl4c3m3n7 n3c3554r1ly m4rk37pl4c3 53n5171v17y 1n5p1r4710n 5urr0und1n9 d3v3l0pm3n7 n37h3rl4nd5 4ppr0x1m473 3j4cul4710n 50u7h4mp70n c00rd1n470r 4dv4nc3m3n7 455355m3n75 7r4n5l4710n 4dju57m3n75 1llu57r473d 7r4n5p4r3n7 d357ruc710n fund4m3n74l 5u8574n714l r3pl1c4710n 8109r4ph135 c0n71n3n74l 1n3xp3n51v3 pr09r3551v3 l3915l4710n 4ch13v3m3n7 p3rm15510n5 l1m174710n5 3v4n35c3nc3 c00rd1n473d 3553n714lly c0n7r0v3r5y 834u71fully 73rm1n0l09y d373rm1n1n9 d3p4r7m3n75 m3m0r481l14 3xpl4n4710n c4lcul4710n c0n7r4c71n9 7hr3473n1n9 5cr33n54v3r 3xclu51v3ly 4ff1l14710n 0r13n74710n 3l3c7r1c17y nu7r1710n4l un4v41l48l3 d3cl4r4710n c0n7r0ll1n9 49r1cul7ur3 c0n5717u735 c0rr3l4710n 51mul4710n5 c0nd1710n4l 1nf0rm4710n 3xc3p710n4l fl3x181l17y 4u70m081l35 3n73rpr1535 r35p0nd3n75 d157r18u73d c4lcul470r5 d1571nc710n c0m81n4710n 73l3ch4r93r 5u8d1v1510n 9r0undw473r 3l19181l17y 1nv0lv3m3n7 chr15714n5 m3m83r5h1p pr0j3c710n 4850lu73ly pr09r4mm35 c0mp4r48l3 84ck9r0und d3l1v3r1n9 93n3r470r5 3v3ry7h1n9 p3rf0rm1n9 1mpr3551v3 7r4d3m4rk5 1mmun0l09y w4rr4n7135 p4553n93r5 7r3m3nd0u5 qu4n717135 v137n4m353 73l3v1510n 1n73r3573d d0cum3n73d 7hr0u9h0u7 p373r58ur9 pr0duc710n p0w3rp01n7 c0mm3rc14l und3rly1n9 73chn0l09y qu33n5l4nd p3r1ph3r4l c0n741n3r5 0817u4r135 pun15hm3n7 n3w5l3773r p4p3r84ck5 ph0709r4ph p3rc3p710n 3xp1r4710n n3w5p4p3r5 5cr33n5h07 n4710nw1d3 pr0p0r710n r391573r3d pu8l15h3r5 pr0v1d3nc3 4550c14735 3xp3r1m3n7 r3f3r3nc3d r3pr0duc3d c0mpr0m153 pr073c710n 0ff1c14lly 3nd4n93r3d r3l0c4710n 8u51n35535 h4r455m3n7 c4p481l17y c0ll349u35 l1k3l1h00d r3574ur4n7 und3r74k3n 70urn4m3n7 pr0c3dur35 r3pu74710n 4d4p74710n h0u53w4r35 vuln3r48l3 1nn0v4710n yu905l4v14 c0nn3c71n9 c0n50r71um v10l4710n5 d3pl0ym3n7 ph4rm4c135 4ff0rd48l3 4n7180d135 d15cr3710n pr1v1l3935 r3m3m83r3d 3xh181710n w1d35pr34d 7h3m53lv35 c0n7r4c70r v373r1n4ry 3v3rywh3r3 3v4lu4710n 5u993571n9 p0r7u9u353 d15481l17y 1n171471v3 c0n71nu0u5 r3f3r3nc35 3xp3r13nc3 5urpr151n9 r3c1p13n75 l173r47ur3 r35p3c71v3 7r4v3ll1n9 08l194710n m4nch3573r 4pp34r4nc3 r3p05170ry d3f1n1710n f3d3r4710n c4lcul473d n37w0rk1n9 1n5p3c710n 4u57r4l14n r39ul470ry 5u8m15510n c0nduc71n9 w1ld3rn355 d3p3nd3nc3 p0r75m0u7h 423r841j4n n0m1n4710n 45519nm3n7 3xpl41n1n9 4c71v17135 9u1d3l1n35 1ncr3d18l3 r3c09n153d c0ll3c70r5 c0mm177335 r3cru171n9 c0n7r0ll3r ch4ll3n935 4dd1710n4l c0n5ul74n7 h3l1c0p73r r394rdl355 c0n7r18u73 d1m3n510n5 r39r35510n pr10r17135 3mpl0ym3n7 d1ff3r3nc3 h34dph0n35 c0mpl41n75 hyp07h3515 5u85cr183r 7r4d1710n5 f4c1l17473 81rm1n9h4m d1r3c710n5 c0mm15510n 93n3r471n9 c0n574n7ly pr0v1nc14l c0mpl3x17y 4ddr3551n9 4u70m071v3 pr0c33d1n9 c0nv1c710n 5ucc355ful d15c0un73d 1mm19r4n75 c0lumn1575 pr0m0710n5 d15c0v3r3d pu8l15h1n9 d3m0cr471c d3v3l0p1n9 5u8574nc35 p3r51573n7 p5ych147ry pr35cr183d 1rr194710n 3l3c7r0n1c h1570r1c4l d15cl05ur3 v0lk5w493n m37480l15m 53cur17135 5c13n71f1c 1nflu3nc35 3x7r4c710n 4cc35518l3 pr0c3550r5 5u851d14ry l4ud3rd4l3 84nkrup7cy r3duc710n5 7r4n5l473d r3qu3571n9 5u9935710n c0n51573n7 c0mpl3m3n7 func710n4l lux3m80ur9 h0u53w1v35 0ccurr3nc3 m0n170r1n9 ch4rl3570n 1nflu3nc3d f0rw4rd1n9 90v3rnm3n7 ch4ll3n93d c0nf1d3nc3 91rlfr13nd ch4nc3ll0r cl4551f13d 7r4n53xu4l d1c710n4ry 4cc0un71n9 r357r1c73d un1v3r517y m1lfhun73r w45h1n970n m41n57r34m 4d0l35c3n7 3xpl1c17ly 73rr0r1575 51mpl1f13d p4r71cul4r 83n3f1c14l p4r49r4ph5 73chn1qu35 m1ll3nn1um 1n73rv13w5 3n9493m3n7 c0mpl3710n 84n9l4d35h p3rm15510n 3v4lu471n9 93n3r4710n 0cc4510n4l c0mm17m3n7 4dv3r7153r c0nn3c70r5 7hr3473n3d 3ff1c13ncy r371r3m3n7 519n47ur35 r3pu8l1c4n 4u7h0r123d c4l1f0rn14 f4c1l17135 w17hdr4w4l 3ncryp710n 7h3r34f73r 4f73rw4rd5 c0n5717u73 m175u815h1 4774chm3n7 cumul471v3 v0lun733r5 c0n7r0ll3d ch4r4c73r5 0ccup4710n 3xc3p710n5 pr3d1c710n d35c3nd1n9 4p4r7m3n75 j0urn4l157 57471571c5 1n574ll1n9 m4cr0m3d14 4773nd4nc3 4c71v4710n 1nv357m3n7 4l90r17hm5 c0n5p1r4cy d15p47ch3d 3c0l091c4l c0n51571n9 9309r4ph1c 5upp0r73r5 4cd83n717y 5u8m1771n9 d3c0r471n9 3l3m3n74ry 4ff1l1473d w38m4573r5 4ppl14nc35 p05535510n d3p4r7m3n7 r3c09n123d d3519n473d 1n7r0duc35 4n74rc71c4 r3l4x4710n 1n739r473d p057p0573d 80und4r135 m4n493m3n7 p5ych0l09y d15c1pl1n3 930l091c4l 4r71f1c14l ul71m473ly curr1culum c0mpl14nc3 4ll0c4710n 4dju5748l3 c0un53l1n9 34r7hqu4k3 53l3c710n5 curr3nc135 p0lyph0n1c hum4n17135 v0c48ul4ry fr49r4nc35 r1ch4rd50n 1nd0n3514n 4cc3p74nc3 57r4739135 m024m81qu3 4cc3p748l3 5c13n71575 574710n3ry u283k1574n h19hl19h75 pr353n71n9 3qu1v4l3n7 f3ll0w5h1p 4ff1l14735 m4d4945c4r d3v3l0p3r5 r3c0rd1n95 c0nc3rn1n9 mul71m3d14 5y573m471c pr0j3c70r5 7hum821ll4 1ndu57r14l 477r4c71v3 1n73r57473 d15cu5510n 4l3x4ndr14 4dv3n7ur35 51mul4710n l34d3r5h1p m3d1c4710n 4ppr04ch35 4ppr3c1473 m3ch4n1c4l 53p4r4710n 1d3n71f135 1n5717u735 3nc0ur4935 c0pyr19h75 835714l17y 4550c1473d c0nc3p7u4l n0771n9h4m c0mp4r150n f0und4710n 7h0r0u9hly r3v0lu710n 1n57ruc70r 4m3ndm3n75 m4573rc4rd chr0n1cl35 c0n57r41n7 m070rcycl3 5p3c14l157 d157r18u73 3x3cu71v35 9r33nh0u53 und3r5700d d3c0r471v3 cu570m123d 3571m4710n 73chn1c14n qu4l1fy1n9 5upp0r71n9 pr0h18173d 477r4c710n h0r120n74l my573r10u5 w3ll1n970n d373rm1n3d c17y534rch w473rpr00f m1n157r135 p3rc3n7493 8r174nn1c4 57473m3n75 c0mpl373ly p0pul4r17y n4710n4lly 4ccur473ly 3l3c7r1c4l 4ppl1c48l3 c0ll3c710n d3l394710n l17194710n p0pul4710n 480r191n4l d3pr35510n r3m4rk48l3 pr3v3n71n9 5u5p3n510n 1nd193n0u5 n4v194710n 845k3784ll 0p3r4710n5 pr0duc71v3 r3v3l4710n 4773mp71n9 4nn074710n r3534rch3r v393748l35 3xc173m3n7 834574l17y und3r574nd 1d3n71f13d phy51c4lly r35p0nd1n9 8url1n970n v4l1d4710n 5u853c710n 5up3rv150r c0rrup710n v0ll3y84ll p17758ur9h 455ump710n c0nn3c710n r3pr353n75 ch4r1748l3 c0rr3c710n 0pp051710n 1nc3n71v35 1mp05518l3 v15181l17y l0u15v1ll3 7hum8n41l5 pr0p3r7135 4pp4r3n7ly r3l471v3ly 4cc0rd4nc3 c194r37735 f4v0ur1735 1n73rn5h1p hun71n970n 5uppl3m3n7 1nd1c4710n 5u853qu3n7 m0n790m3ry purch451n9 9u4r4n7335 50und7r4ck 455355m3n7 m3ch4n15m5 k1l0m373r5 35p3c14lly 57ruc7ur4l 54cr4m3n70 c1nc1nn471 fr3qu3n7ly 1n73rf4c35 c47390r135 r35p0nd3n7 4n4ly71c4l l480r470ry 1mpr35510n c0n71nu1n9 c0nf3r3nc3 k424kh574n 1n57rum3n7 3nr0llm3n7 1nd1c470r5 m0d3r470r5 57ruc7ur35 c0ll3c71v3 1n5ul4710n d1ff1cul7y 0r94n121n9 pr0f35510n 7r4n51710n h0u53h0ld5 53p4r473ly 810l091c4l phy51c14n5 7r4ck84ck5 m1cr0ph0n3 c4mc0rd3r5 j0urn4l15m m3d174710n c4nd1d4735 1ndu57r135 8l4ck83rry 517u4710n5 cr3471v17y 08j3c71v35 3xpr35510n pr0v1510n5 pr1nc1pl35 1d3n71f13r d35cr181n9 c0n51d3r3d c0nd1710n5 j4v45cr1p7 4dm15510n5 5377l3m3n7 c0mp4718l3 r351574nc3 phy510l09y 7r347m3n75 ph3n0m3n0n 4dju57m3n7 c0n71nu17y c0n5ul71n9 r3cr34710n c0ll3c71n9 pr3f3r3nc3 5u8j3c71v3 1nf3c710u5 m34n1n9ful pr09r4mm3r d15cu551n9 4ccr3d173d 4ppl1c4n75 3n73rpr153 1nc0mpl373 5un9l45535 1mp0r74nc3 r3450n48l3 qu074710n5 3d170r14l5 7r4n5l470r c0nv3r510n c0mpr3553d 90v3rn4nc3 p4rl14m3n7 l39171m473 57r3n97h3n 1nv174710n v39374710n 7r4n5cr1p7 c0n74c71n9 pr073c71n9 pr073c71v3 3553n714l5 p4r4m373r5 pr0c3551n9 9r4du4710n r350lu710n c0nf19ur3d c0mpl371n9 c0nv3n13n7 4m84554d0r w4llp4p3r5 v4r14710n5 4rch173c75 1n7r0duc3d l1m0u51n35 v0c4710n4l w1d35cr33n 9r33n580r0 v39374r14n c0mp0n3n75 p3r50n4lly 4551574nc3 l1m174710n 5uff1c13n7 3x73n510n5 499r3551v3 1nf3c710n5 57ruc7ur3d r3450n48ly 4cc0mpl15h 4dv4n74935 c0mm3n74ry un3xp3c73d 4u70m4710n r3c0mm3nd5 c00rd1n473 4850rp710n 5ch3dul1n9 f0rm4771n9 d0wnl04d3d fr13nd5h1p c4r7r1d935 pr3v10u5ly r3fl3c710n l4nd5c4p35 c4lcul470r 47m05ph3r3 c0nv3n710n 83h4v10r4l c0nclu510n 1nd1c471n9 4u70m081l3 0r191n4lly d373rm1n35 ph1l050phy r39ul4710n 5urr0und3d 1nd1v1du4l 3xc3ll3nc3 5u85717u73 9u4r4n733d m071v4710n 3nc0ur493d 1nn0v471v3 d3f1n173ly c0n741n1n9 49r33m3n75 pr3v3n710n d149n0571c d15cl41m3r d15pl4y1n9 1ncr3451n9 3v3n7u4lly h34l7hc4r3 477r18u735 m41n741n3d w0rdpr355 4u70m471c c0nn3c73d 4c4d3m1c5 d1r3c70r5 4rl1n970n 4nn0unc3d p4r71cl35 n4rr471v3 w0nd3rful 53c0nd4ry 4m3ndm3n7 r3c0rd1n9 l18r4r135 nu7r1710n l1v3570ck 51n94p0r3 3x3mp710n r3duc710n u71l17135 3xclu51v3 d3l1v3r3d pr1nc1p4l pr4c71c4l m374ll1c4 ch1ldh00d p0r7f0l10 p3rm4n3n7 8u1ld1n95 4ddr35535 h0u53h0ld 84773r135 c194r3773 n1c4r49u4 9r4du4735 pr3p4r1n9 v4lu4710n r3c1p13n7 p3rf0rm3d 47hl371c5 p051710n5 3xc3551v3 50u7h3457 r3l471v35 fr33l4nc3 d15pl4y3d r351d3n75 p4n450n1c p3rm4l1nk 519n47ur3 fr3qu3ncy pr0v1510n 5qu1r71n9 73nn35533 c3r741nly n3w5p4p3r p4553n93r 4u70m473d n19h7l1f3 8r4c3l375 l1481l17y 7r4d3m4rk c0mp0und5 pr150n3r5 7r4ck84ck pl41n71ff 73l3ph0ny 1nfl4710n c0n741n3d 4m3r1c4n5 4l73rn473 pr0m0710n 8r347h1n9 0ff1c14l5 7h1ckn355 pr073c73d m19r4710n 9r4ph1c4l 8r04d84nd 1nflu3nc3 3571m4735 chr0n1cl3 8451c4lly w38m4573r 1nh3r173d 9r3371n95 f4v0r1735 c0n57ruc7 43r05p4c3 1nqu1r135 4r7hr1715 qu4r73rly m41n741n5 5u5741n3d r3pr353n7 5h0r7cu75 150l4710n 4p4r7m3n7 v0y3urw38 3c0n0m1c5 4cc3p71n9 5ch3dul35 l0u1514n4 chr1571n3 3x73nd1n9 d1m3n510n 57r47391c 3v0lu710n 5p3c1f135 3d170r14l 5u993573d d3c1510n5 m4c3d0n14 4ff3c71n9 c0m81n1n9 4rm57r0n9 c0nc3rn3d c04l1710n 5c13n7157 pr0duc3r5 574nd1n95 4c71v473d c0ll3c70r 84ndw1d7h p4r71710n 1nv1518l3 m4ch1n3ry 4550c1473 c0mm0d17y 5uppl13r5 pr0m071n9 1n574ll3d 499r39473 5h0w71m35 fr4m3w0rk 1n73rv13w r3c31v1n9 4n0nym0u5 p3n4l7135 c0mpl14n7 r37urn1n9 d15cu553d 3571m473d 3l124837h c0n741n3r d3f3nd4n7 4dv4n7493 80ul3v4rd p3r50nn3l w15c0n51n d3p4r7ur3 d1r3c710n d3d1c473d f0r3c4575 93n3r470r 35748l15h c0mp371n9 3xpr3553d cl4551c4l 1n574nc35 p4r49r4ph p3n1n5ul4 c4mp419n5 8ul94r14n c0n51d3r5 c0nduc73d 3x73n510n pr05p3c75 v4c4nc135 r3qu3573d wh0l354l3 p3r50n4l5 1mm3d1473 ch3vr0l37 y3573rd4y h34dl1n35 4551574n7 4dv3n7ur3 m1nn35074 f1n15h1n9 455ur4nc3 08741n1n9 h4pp3n1n9 5h3ff13ld l17hu4n14 d3v3l0p3r 534rch1n9 8r34kf457 1n7r0duc3 m0d3ll1n9 r3l1910u5 f4v0ur173 pr0c3dur3 v1c70r14n m1n147ur3 d157r1c75 c0mpu71n9 3x7r3m3ly c3r71f13d c0n7r4c75 p3rc31v3d j3ff3r50n 94rd3n1n9 ch3m157ry 0rch357r4 c3n7ur135 m49n17ud3 v4r148l35 c0n71nu35 ch4ll3n93 l4n9u4935 c174710n5 un1v3r54l r35p0n535 4553551n9 d1v1510n5 5h0p21ll4 4ff1l1473 3553n714l r3p0r71n9 pr4c71c35 unl1m173d h4ndh3ld5 4n5w3r1n9 0v3rn19h7 4ppr4154l 1mpr3553d l173r4lly pl47f0rm5 pr1n748l3 c0mp4n10n 0r94n123r 7h354uru5 93n3r473d v0lun74ry h4rdc0v3r r34c710n5 7h0u54nd5 c3l38r17y 4857r4c75 r35p0nd3d ch0c0l473 pr3c3d1n9 d15cu5535 h4mp5h1r3 8lu37007h pr0v1d3r5 f15h3r135 5upp0r73d 3m0710n4l p4p3r84ck 4mpl1f13r pr39n4ncy 8109r4phy 4r817r4ry 1n73r3575 4ch13v1n9 pr0m1n3n7 m355491n9 l3x1n970n pr0c3553d pr0c35535 f1n4nc1n9 9u4r4n733 c0mp0n3n7 c0n74c73d 3ff1c13n7 r3c0rd3r5 5p3c14l7y 4dd1710n5 r3qu1r1n9 p057c4rd5 r3v13w1n9 r3f1n4nc3 c0nfl1c75 c0n71nu3d 1n739r17y 93n3r4lly 9309r4phy pr0f3550r qu4l1f13d c4l3nd4r5 d15c0v3ry c0rr3c7ly r3c0mm3nd 8l00m83r9 furn15h3d r3c3p710n h13r4rchy 484nd0n3d l1f357yl3 m4ur171u5 7r4v3l3r5 cl34r4nc3 ch3ckl157 1nv3n70ry c0nv3r73r m345ur1n9 08j3c71v3 1nd1c473d 57r3n97h5 5c3n4r105 5473ll173 d1ff1cul7 8r34kd0wn 0ff3r1n95 7r4n5f3r5 r1n970n35 3l3v4710n v0lun733r d373rm1n3 3m3r93ncy 517u4710n 83v3r4935 chr1571n4 p4r4m373r m3d1c1n35 pr0c3550r r34l1571c 800k570r3 4773n710n r3n3w48l3 fr4nch153 1nc0rr3c7 p455w0rd5 d35cr183d p4r3n71n9 m4nh4774n 457r0l09y w0rkf0rc3 fr4nc15c0 m49421n35 3nc0ur493 p4r714lly v18r470r5 0ccurr1n9 c0n5um3r5 73rr170ry 53cr374ry c05m371c5 1nduc710n pr3c153ly 5p3c1f1c5 pr353n73d 94ll3r135 73574m3n7 r35ul71n9 c4m8r1d93 5pr34d1n9 5yn7h371c 3x3cu710n pr0v1nc35 1ncr34535 7r4n5p0r7 pr3c1510n 1nc1d3nc3 d15ch4r93 5cr1p71n9 1nd1c4735 50m371m35 c0mm1773d 3x73n51v3 h4ll0w33n c4nd1d473 d47484535 1nc1d3n75 h424rd0u5 3nh4nc1n9 m3553n93r r351574n7 5p3c1f13d d15c0un75 d3m0cr475 c474l09u3 pr0duc1n9 9u473m4l4 r3cycl1n9 7r345ur3r p4l3571n3 l157pr1c3 4cc1d3n75 5l1d35h0w 8391nn1n9 c4r18834n pu8l1c17y 1ncr3453d v4r14710n m1cr0w4v3 r394rd1n9 r3m41n1n9 4ll0w4nc3 4rch173c7 wr357l1n9 d3p3nd1n9 3xp4n510n dupl1c473 cr173r10n 5u8m1773d purch453d ph0705h0p func710n5 0ur53lv35 c0ll3c73d ch4r4c73r 947h3r1n9 c0rr3c73d p47h0l09y m0r74l17y 5culp7ur3 07h3rw153 f347ur1n9 cr171c15m 1mpl3m3n7 5ch3dul3d d157ur83d 0rd1n4nc3 c4mc0rd3r 5747u70ry cr347ur35 c0mm3n73d n0r7h3457 73mp0r4ry 200ph1l14 p41n71n95 1nj3c710n c0mpl373d fr3d3r1ck 4w4r3n355 v4nc0uv3r y0rk5h1r3 r3l4710n5 573ph4n13 3mpl0y335 p4ck491n9 5p3c14lly 1n1714lly 1nd1c470r 3l1m1n473 n0r7hw357 4ppl14nc3 cl455r00m c3l38r473 d3m0cr4cy f3571v4l5 w4llp4p3r 7hr35h0ld w17n35535 pr09r4mm3 v3n32u3l4 4u7h0r17y c0n5c10u5 84l71m0r3 c0mpl41n7 53qu3nc35 m3n710n3d ch4rl0773 457r0n0my pr0v1d1n9 d357r0y3d 3m15510n5 7r4n5l473 4nn0unc35 l0c4710n5 4773mp73d 834u71ful 4cc3551n9 phy51c14n h0llyw00d 0p3r4710n w1k1p3d14 570ck1n95 5p1r17u4l 7r4d1710n 3nc0un73r r3f3rr4l5 cu570m123 1n73rf4c3 0r94n153d r3v1510n5 3xc3ll3n7 7hr3350m3 p3rf3c7ly r3450n1n9 1n574n7ly pu8l15h3r w0rldw1d3 4nn07473d pr3f3rr3d j3ru54l3m c0nv1nc3d r3pl4c1n9 r39ul4rly chr15714n 7h3r3f0r3 l1573n1n9 w473r5h3d 73l3ph0n3 1nv3n710n d3v3l0p3d h3nd3r50n pr1v1l393 4l19nm3n7 0p3r471n9 73rr0r157 d0cum3n75 p3d147r1c 3c0mm3rc3 3nqu1r135 l4nd5c4p3 d3p3nd3n7 8r0chur35 7r4v3ll3r 5u5p3c73d 83nchm4rk 4ppl1c4n7 8391nn3r5 p073n714l c09n171v3 5uff3r1n9 c0mp373n7 57ruc7ur3 w3dn35d4y v393748l3 furn17ur3 c0nn3c70r 3xpl0r1n9 9r4du4lly 4m573rd4m l1c3n51n9 3duc470r5 73x7800k5 4r9um3n75 d1v3r517y cl3v3l4nd 7r4n5f0rm r39157r4r chr157m45 d351r48l3 n47ur4lly und3rw34r 53n5171v3 73mpl4735 m3rch4n75 r3l1910n5 r3f3rr1n9 3xpl0510n d4u9h73r5 hun94r14n 4cc0rd1n9 73chn1qu3 1nclu51v3 n3c3554ry 3x3cu71v3 ch4mp49n3 c4lcul473 pr3d1c73d 4l3x4nd3r 8r04dc457 c0nv3r73d r0ch3573r d3v14710n 53l3c710n 53l3c71n9 3ff3c71v3 c0nd1710n p4n7yh053 4cc3550ry 7yp1c4lly 5p0n50r3d hydr4ul1c r083r750n un1pr07k8 1n5717u73 0m15510n5 r37r13v4l qu4l17135 4f73rn00n 84rc3l0n4 pr0707yp3 4pp4r47u5 0wn3r5h1p 3xp4nd1n9 d3l1c10u5 3mp1r1c4l 4dv3r7153 m1n1573r5 p0l171c4l 53xu4l17y 3d1n8ur9h p0ly3573r m0l3cul4r 574nd4rd5 c0un7r135 pr0570r35 r351d3nc3 4770rn3y5 83h4v10ur 0p3r470r5 f0r90773n r3m41nd3r m473r14l5 cu570m3r5 c0rp0r473 pu8l15h3d m0l3cul35 3mpl0y3r5 r37r13v3d c0nf1d3n7 3x3rc1535 1n73rv4l5 curr3n7ly r3l3v4nc3 50c10l09y 3l3c710n5 7hum8n41l 5741nl355 53n73nc35 h05p174l5 1n739r473 3xclu510n 3xc3p710n 47717ud35 kn0wl3d93 1nd0n3514 7r347m3n7 1nc3n71v3 pr1m4r1ly 5cr33n1n9 h0l0c4u57 5u5p3nd3d r3c31v3r5 cu570m153 l4nc4573r n0npr0f17 0r94n123d 8u773rfly 1mpr0v1n9 3xp3n51v3 m3ch4n1c5 n4v19470r 1n171473d 481l17135 3xpl41n3d 5u85cr183 3xp3r7153 m3ch4n15m r3c09n123 m4r1ju4n4 j3w3ll3ry 50m3wh3r3 847hr00m5 c47h3dr4l pr070c0l5 f41rf13ld h19hl19h7 1nclu510n h0p3fully num3r1c4l r1v3r51d3 8r1ll14n7 l4f4y3773 d0m1n1c4n 800km4rk5 54lv4710n d150rd3r5 3v4lu473d d373c710n 1n5p3c70r 53l3c71v3 54cr1f1c3 f0rm4710n 3n91n33r5 m3d14w1k1 l19h7n1n9 pr0p054l5 m0d3r470r 7u70r14l5 r3m0v48l3 d0wnl04d5 918r4l74r 57473m3n7 m1cr050f7 f4n74571c 73chn1c4l w0nd3r1n9 pr1nc370n 70l3r4nc3 d3cr3453d 4u7h3n71c r3p0r73r5 50u7hw357 4pp01n73d n3c35517y r3nd3r1n9 57481l17y c0nf19ur3 v10l4710n m4c1n705h m0v3m3n75 50lu710n5 4m3n17135 v1r7u4lly 3xch4n935 4n1m4710n h3p471715 m34nwh1l3 r373n710n pr0j3c70r m4rk371n9 5h4r3w4r3 w4r3h0u53 n0rw3914n 5urpr153d 3c0n0m135 49r33m3n7 ch1ldr3n5 m1lw4uk33 4u57r4l14 84c73r14l p37r0l3um d3519n3r5 m3l80urn3 m473rn17y p0rc3l41n 54715f13d 93n34l09y und3r74k3 pr351d3n7 8l4ckj4ck 4r93n71n4 p1chun73r 1d3n71c4l d4n93r0u5 8r421l14n c0mpu73r5 51m1l4rly 50c137135 c0mp4n135 r3f3r3nc3 n45hv1ll3 3v3ry80dy 3xclud1n9 c0mm4nd3r c0mm17733 c4nc3ll3d r353rv01r w0rk5h0p5 hurr1c4n3 n3wc457l3 w0rc3573r r35p3c73d m0r794935 p0r7r4175 c4r3fully und3f1n3d 50m37h1n9 1nv3570r5 ch3m1c4l5 5yn7h3515 d149n0515 r3fl3c73d pr1nc1pl3 v4c4710n5 p3rf0rm3r 1mp0r74n7 5p07l19h7 9r4du473d 3qu1pm3n7 c0n53n5u5 l091571c5 k3y804rd5 purch4535 n073800k5 f1n4nc14l n4m35p4c3 4l90r17hm 0pp0n3n75 4dd1c710n v4l3n71n3 n0m1n473d c0nfu510n 3l3c70r4l ch4n93l09 1nv0lv1n9 1nv3571n9 qu35710n5 4dm15510n 53p73m83r r3c0v3r3d 5ymp051um 73rr0r15m up9r4d1n9 fr0n7p493 d3m4nd1n9 r39ul473d 4ll0c473d d3f3n51v3 f0r81dd3n m0n170r3d mun1c1p4l d35cr1835 m071v473d 3x4m1n1n9 d1ff3r3n7 1n73n51v3 5w17ch1n9 5u8574nc3 d35p3r473 4ddr3553d pr0j3c73d c0nclud3d 1n73n710n 73571m0ny m4nd470ry 9u357800k 5urv1v0r5 1n5ur4nc3 f1l73r1n9 d373c71v3 p0llu710n d1r3c70ry f1r3pl4c3 1nclud1n9 r350urc35 5umm4r135 f0ll0w1n9 3l53wh3r3 4n71v1ru5 0ff3n51v3 l00k5m4r7 c0ll349u3 p41n784ll 57473w1d3 53p4r473d 3ncl05ur3 5ynd1c473 d1574nc35 53r10u5ly 3x1573nc3 7r345ur35 d1r3c71v3 1n73n517y c0mmun157 57r34m1n9 cr34710n5 c0mmun17y 477r18u73 c0mp4r1n9 3duc4710n 90v3rn1n9 m0un741n5 r3741l3r5 pr353n7ly r4d14710n 8run5w1ck l18r4r14n 570ckh0lm 7h3r4p157 d0n4710n5 pr0m151n9 ch4mp10n5 4773nd1n9 n19h7m4r3 0r94n15m5 08v10u5ly 73l35c0p3 7r4v3l1n9 f1n93r1n9 93n3r4735 r3c3p70r5 n319h80r5 c0pyr19h7 4v41l48l3 4lum1n1um 5n0w804rd h4pp1n355 d3519n1n9 fr49r4nc3 5h1pm3n75 l393nd4ry c47h3r1n3 93n7l3m4n c4r7r1d93 r3pr0duc3 c0nv1c73d r00mm4735 5p0k35m4n 4c71v1575 p3rm1773d fr4nkfur7 4553m8l3d w0rkpl4c3 c0mp05173 0cc4510n5 c0nf1rm3d 3qu4710n5 73rm1n4l5 mu51c14n5 cr055w0rd c0n71n3n7 1nf3c710n l0n917ud3 v8ull371n 1n53r710n 5w421l4nd v4r137135 pl4c3m3n7 4pp34r1n9 l34rn3r5 r3c3p70r 574710n5 9r4du473 57r0n93r c0774935 3x73r10r 4dv4nc35 9r347357 574nd4rd 7h1nk1n9 0p3r470r pr3v13w5 r34ch1n9 p1c7ur35 73x71l35 3qu4710n d15pu735 54ndw1ch pr0v1d3r 0p710n4l c0unc1l5 8453m3n7 p3r50n4l pl4nn3r5 53c710n5 p0r710n5 7r4ck1n9 3l3c7r0n 3nc0d1n9 7hr34d3d 8l33d1n9 9r3371n9 5udd3nly 57unn1n9 3xpl1c17 3v1d3nc3 1mp0r73d w3dd1n95 1n5p1r3d 4ccur473 pr09r4m5 5yr4cu53 c0rnw4ll 53n470r5 f4v0r173 m4r94r37 m4x1m123 c0n7r4ry m4n491n9 r3c3n7ly 54mpl1n9 pr0848ly r3p3473d f0cu51n9 w3851735 r3l1910n 3x4m1n3d h4pp3n3d 0p3n1n95 r074710n 93n3r0u5 l35814n5 3xp4n5y5 c45h13r5 p0571n95 d3u75ch3 m345ur35 5w17ch3d 1nv1510n cl34n3r5 m4n493r5 41rcr4f7 r3v34l3d c0nfl1c7 ch3m1c4l v3r510n5 3mpl0y3r r0m4n71c c04ch1n9 70937h3r 4nn0unc3 d35cr183 c0mp1l3d c17123n5 cr347ur3 h3r17493 3x3rc153 7174n1um 4c71v3ly w0rldc47 1nc0m1n9 cul7ur35 pl3454n7 n37w0rk5 4ud13nc3 45519n3d r3nd3r3d 3m0710n5 4dm1773d r37r13v3 m3371n95 func710n l0c4710n 3qu4l17y 7r4n5f3r d1r3c73d d1571nc7 c0n9r355 5p0r71n9 pr0m0735 4ff3c73d u53rn4m3 3xclud3d 3xp3n535 1nd1c473 pr0duc3d c0mpu73d h05p174l 571ck3r5 h0m3l4nd 3nv3l0p3 0v3rv13w 3dm0n70n c0mm0nly 4r9um3n7 3c0n0m1c d1534535 cr3471n9 4d4p71v3 pr0j3c75 ch4r93r5 l4n9u493 4770rn3y 7h41l4nd r3570r3d 8075w4n4 4dv150ry 8ud4p357 c0un73r5 d15p47ch 73mpl473 8r33d1n9 4nywh3r3 8l0991n9 1nclud3d 47l4n71c 5h1pm3n7 53450n4l 1nv3570r 4uc710n5 pr05p3c7 5w17ch35 w1ldl1f3 c4m3r00n 0v3rh34d l1m171n9 c0mm3n75 5p34k1n9 5p0n50r5 d1574nc3 8l0ck1n9 fl0r1575 p3r10d1c m4r171m3 3nd0r53d d15p054l 7h30l09y c00k800k h4ndh3ld ch3ck1n9 mu51c14n f41lur35 r3m0v1n9 d3cl4r3d 1nf0rm3d 9u1d4nc3 574nf0rd f48ul0u5 1nv0lv3d 7h0u9h75 f1r3w1r3 0853rv3d v4r14nc3 qu4n717y upl04d3d 9l0554ry 7r345ury ch1ldr3n p4r7n3r5 ch4nn3l5 3r1c550n 4pp3nd1x 1n73rv4l 57ud3n75 pl47f0rm 5h0pp1n9 5uppl13r 4rr4n93d 3x1571n9 53l3c73d d14l09u3 m4ch1n35 n17r093n r00mm473 4rk4n545 p4713n75 c0ll4p53 7h3473r5 4m3r1c45 r3c0v3ry n073800k h1570r1c 4774ch3d 4dj4c3n7 d1548l3d 4dju573d r3j3c73d upc0m1n9 0u7r34ch m3rch4n7 83rk3l3y r3c31v3d w0rkfl0w 4rch1v35 5ur930n5 c0n73575 800k1n95 pr0m153d d1r3c7ly c0n574n7 v3h1cl35 unl1k3ly p0r7l4nd m49421n3 c0nc3p75 94m35p07 pr057473 pr3v10u5 c4mp419n d3n71575 94n984n9 d3l1v3r5 7r4n5m17 3x4mpl35 3m1r4735 qu35710n 7hr1ll3r 53m1n4r5 534rch35 50f7w4r3 r3l471n9 m070r0l4 4ll14nc3 83v3r493 3ncl053d r3f3rr4l 818l1c4l 574rr1n9 3n91n33r m0r30v3r 8u51n355 1n73nd3d 4dv0c4cy 0ff5h0r3 57r4739y 3n53m8l3 4d3l41d3 3l3c710n f0r357ry 83c0m1n9 84rr13r5 p0l1c135 c3m373ry 1nf3c73d ph1ll1p5 5l33p1n9 m4rr1077 un717l3d 734ch1n9 r3l4710n 0cc4510n p051710n p0dc4575 5733r1n9 up5k1r75 57r1k1n9 c0nc3r75 1n71m473 c4n4d14n r3l14nc3 fr4c710n l1571n95 d14m0nd5 r3qu3575 53p4r473 8u1ld1n9 7h1nkp4d h19hw4y5 r3c0rd3r p05171v3 c0ll3935 r0u71n35 f38ru4ry 5pr1n93r r357r1c7 n319h80r 1d3n71fy m1n0r17y 8r07h3r5 v373r4n5 pr353n75 m1n1m123 c4m80d14 3571m473 4857r4c7 d0m3571c w1r3l355 0ccup13d d3cl1n3d c4553773 4c0u571c d15cl053 3x73nd3d 53qu3nc3 pr0m073d 4nn0y1n9 7h0r0u9h d0m1n4n7 r3c31v35 h15p4n1c 7r4m4d0l ch4rm1n9 539m3n75 1ncurr3d 50m3r537 n4710n4l purch453 5n4p5h07 h4nd8495 r353rv35 pr0p3r7y r35p0n53 pr4c71c3 8ull371n 5ch0l4r5 upd471n9 c1rcu175 3p1n10n5 p41n71n9 cl34r1n9 c0n741n5 h4rdw4r3 un1v3r53 m374d474 r34d1n95 hum4n17y m0v3m3n7 47hl3735 pr1n71n9 church35 w47ch1n9 d34l71m3 4ppr0v4l 37h10p14 p01n71n9 573rl1n9 535510n5 p0747035 j0urn4l5 fl00r1n9 c0n74c75 0pp05173 4n4ly515 m0d3r473 3m3r91n9 54v4nn4h r3pu8l1c 3n5ur1n9 m47ch1n9 0ff3r1n9 r3v3nu35 73rm1n4l c0nfu53d 5c4nn3r5 p4r71cl3 n38r45k4 v4c4710n d3519n3d v4r148l3 4c4d3m1c 0853rv3r pr0p3rly cum5h075 cr4wf0rd c0mp1l3r d3cr3453 9r4ph1c5 c0mp4r3d m1n3r4l5 juv3n1l3 8r4c3l37 hundr3d5 w0rk5h0p dr41n493 hum1d17y dyn4m1c5 70m0rr0w fr3qu3n7 c474l095 1nc1d3n7 v15171n9 3xp3c73d d0wn70wn k3y804rd 150l473d d373c73d 8l0993r5 f1x7ur35 54pph1r3 5u1748l3 c0ck741l m1ll10n5 5p33ch35 l19h71n9 n47ur4l5 p05518l3 l173r4cy f1nd1n95 r3yn0ld5 p0r748l3 d15c0un7 cl1ck1n9 84r941n5 c0n51d3r r37urn3d n0r7h3rn qu4r73r5 8r4df0rd 41rp0r75 c0m81n35 pr150n3r pr0p053d d14m373r c473r1n9 0p3r4735 4551573d 1nfr4r3d pr0v1nc3 c47h0l1c m3d1c41d l1k3w153 w4rr4n7y m477r355 90v3rn0r 1ncr3453 84l4nc3d 8r1584n3 8run3773 5h1pp1n9 5h0uld3r c0ur735y 8391nn3r 4553m8ly 5p3ll1n9 r3l148l3 p371710n d15cr373 cr1m1n4l 5p4nk1n9 r353rv3d r3p0r73d p0w3rful c3r3m0ny 08741n3d 8r0chur3 pr08l3m5 4rr3573d 1nv4510n 5ymp70m5 up9r4d35 m3m0r14l 5uppl13d p0l171c5 7hr0w1n9 cu570m3r pr0m1535 0p1n10n5 1n73r357 f19h71n9 v3l0c17y p057c4rd 3m83dd3d c4rn1v4l h4ndm4d3 4n4ly575 m1dl4nd5 pr39n4n7 l19h780x 174l14n0 m4n17084 54l4r135 m0d1f13d 4d4p73r5 m41n741n r3l3453d c3llul4r m15510n5 n0rm4lly pr10r17y pl4571c5 c057um35 d1483735 3nj0y1n9 r3pr1n75 7ru57335 1n73rn4l p3rf0rm5 3ur0p34n f1n4nc35 d3p05175 p4ym3n75 4c71v17y fl3x18l3 l4717ud3 d3741l3d j4p4n353 num3r0u5 4ppr0v3d p3n510n5 4l7h0u9h w319h73d ch4r91n9 947h3r3d 5up3r10r 57r419h7 7r18un4l h4ndj085 pr3p4r3d 83l13v3d 5urr0und 5p3nd1n9 c0mp053d m49n371c 4v01d1n9 v4l1d17y r39157ry 8r0w51n9 8ul94r14 k1n9570n 3mpl0y3d cyl1nd3r r3m3d135 n1ckn4m3 5l0v3n14 n071f13d l4unch35 50u7h3rn y0ur53lf 5ymp47hy cr173r14 c0mp0und d15pl4y5 4ll0w1n9 34rn1n95 8453l1n3 3xp4nd3d pr355ur3 l34rn1n9 c0n73n75 83h4v10r d3l4w4r3 574ff1n9 k3yw0rd5 wr171n95 d3l1v3ry 4n4ly23d dr4m471c ch4n91n9 3x4m1n35 c0un7135 c0n50l35 purp0535 5urf4c35 5m4ll357 f3571v4l r3910n4l 4rch1v3d 57r4n93r 73rr18l3 5uppl135 h4w4114n 0ccurr3d h0m370wn v3n7ur35 r41lr04d f10r1c37 pl4yl157 45835705 c3n73r3d m4ryl4nd 4pp4r3n7 5yndr0m3 3x73rn4l 3l1918l3 ch3ck0u7 7r41l3r5 5747u735 53cur3ly h4ndl1n9 5ym4n73c c0ncr373 3xch4n93 4773nd3d m4nu4lly c474ly57 l3c7ur35 93n371c5 m0n7r34l w4rcr4f7 f0ll0w3d 21m848w3 m0157ur3 c0l0m814 4nnu4lly c4n83rr4 734ch3r5 c0n71nu3 h19hl4nd 5u8j3c75 83n3f175 4cc1d3n7 pr070c0l 9450l1n3 pr3551n9 r351d3n7 p05518ly w15hl157 5h3ph3rd 0r191n4l m4r47h0n 8r13f1n9 pr0duc35 1mp41r3d 4ny7h1n9 l09173ch fl45h1n9 4rr1v4l5 1574n8ul 4lum1num 3nr0ll3d 7r41n1n9 ch34p357 m0rr150n 47717ud3 7r4v3571 p4r3n74l r3741n3d pl4y84ck c4p4c17y 7r4v3l3r pu8l1cly c4mp83ll m4l4y514 84ch3l0r r3qu1r35 h0ld1n95 c4d1ll4c d3m0cr47 m0n90l14 1nclud35 f1rmw4r3 d3519n3r 84c73r14 4n71qu35 jud1c14l 47hl371c r353ll3r 4n1m473d m4rr1493 wh3r3v3r pr0p3c14 w33k3nd5 5uff3r3d l1f371m3 m0r79493 f1r3w4ll v174m1n5 3xh18175 p4r4ll3l n3ckl4c3 1nf0rm4l wh3n3v3r n39471v3 847hr00m w4rr10r5 r3fl3c75 74x4710n 4dv4nc3d m1550ur1 50lu710n dr1nk1n9 8l0wj085 r34c710n 3nh4nc3d 3n717l3d 93n3r473 8r4nch35 h0rr18l3 4dd1710n h0m3l355 m1n157ry m0n170r5 d150rd3r dur4710n 480r710n h0m3w0rk r350lv3d pur5u4n7 pr0p054l fl45h3r5 50m380dy r3741l3r 81r7hd4y 4553553d c0n7r457 4n5w3r3d 54lv4d0r c1n9ul4r r34l70r5 5l19h7ly 5urv1v4l 4d0p710n p373r50n 0u7c0m35 d1v1d3nd 5ull1v4n l1n93r13 5w1n93r5 pr09r355 5urv1v0r cl1m81n9 m4ld1v35 1n519h75 pr3c10u5 80u71qu3 pr0f1l35 c1v1l14n cr0551n9 cl07h1n9 73mp0r4l 0pp0n3n7 74n24n14 m345ur3d m1574k35 c0n7r0l5 8r34k1n9 c0m81n3d ul71m473 m3554935 f4m1l135 h0m3p493 7h0u54nd 53xu4lly 534rch3d r3m1nd3r 53n73nc3 d3f1n1n9 c0un71n9 pr353rv3 4774ck3d 57r1c7ly 8r19h70n h0n0lulu m1l174ry 4cc3p73d h4m1l70n d3c1510n p4r49u4y v18r470r 1nf1n173 c47390ry 7u70r14l 0v3rc0m3 57udy1n9 pr0v1d35 r3v13w3d w3lln355 3n48l1n9 f0r3c457 p0r7u94l v4lu48l3 un519n3d 71m3l1n3 r3p0r73r 517u473d junc710n 493nc135 f0rm3rly r391573r 4ccur4cy 94m3cu83 wr4pp1n9 8r0w53r5 4773mp75 h4r7f0rd ph4rm4cy cr34710n 4pply1n9 c0lum814 41rl1n35 r34l123d 74l3n73d ch41rm4n v10l3nc3 5p3c1f1c 0kl4h0m4 5p34k3r5 7r345ur3 3n7r4nc3 d1v1510n 0rd1n4ry 5upp053d 1nd1r3c7 74r9373d 4v14710n v3r1f13d pr0c33d5 d154573r c481n375 c0mm4nd5 cl34n1n9 7h30r135 cr171c4l 4ch13v3d 1njur135 r3534rch 4c7u4lly pr0mp7ly kn1771n9 c0nc3rn5 5u8ur84n f007w34r 4pp34r3d c0l0n14l 3mpl0y33 f347ur35 0ff1c3r5 m3d13v4l p4v1l10n p4ck4935 r3f3rr3d 5upp0r75 1ndu57ry 4dv150r5 4cqu1r3d 8r04dw4y l4u9h1n9 c4p7ur3d 547urd4y h0ndur45 3xc171n9 3qu1pp3d d1r3c70r 5c3n4r10 8453n4m3 pr0v1d3d r1n970n3 3m15510n 9r473ful pl345ur3 5h3m4l35 5h0pp3r5 0r13n73d d0n4710n d35k70p5 pr353nc3 c0lum8u5 455um1n9 r3l3v4n7 fr33w4r3 574r71n9 1n53r73d pr0duc3r c0nclud3 r3qu1r3d 5urpr153 m4j0r17y 7hur5d4y h4rdw00d d34dl1n3 c0n5um3r d373c70r m0n374ry 83l13v35 3n0rm0u5 p0l15h3d 4r71571c pl4nn1n9 fl0471n9 53m3573r d4748453 1nn0c3n7 5c4nn1n9 1mp3r14l 0ff1c14l pr0duc75 80und4ry 57r3n97h 7r41n3r5 d0c7r1n3 3x3cu73d 0v3r5345 m0m3n7um d3f3rr3d c0n7r4c7 r3l34535 0p3r473d 7r3471n9 57r0n9ly f33l1n95 3xpl41n5 pr0731n5 h34dl1n3 4dv0c473 f4m1l14r 4n7180dy 5u993575 5h0wc453 d4u9h73r 574nd1n9 ch0051n9 p34c3ful w385h075 hydr093n 0u7l1n3d c4rry1n9 0rd3r1n9 clu573r5 c0rdl355 3duc473d 3d1710n5 39yp714n 0r13n74l m0n573r5 7r14n9l3 r3fu9335 800km4rk 1ll1n015 5p3c14l5 v3r71c4l 3l3m3n75 dr4w1n95 570pp1n9 f4c1l17y 1n739r4l fr0n713r 4850lu73 4qu4r1um c0n51575 m1n1573r r394rd3d 1mpr0v3d m3d1c4r3 mul71pl3 50ld13r5 v15170r5 9u4rd14n 57ru99l3 r0ul3773 4n4ly535 j0hn570n l173r4ry cl4551c5 d0wnl04d c0v3r493 3xp05ur3 73x7800k pr3m1535 53rv1c35 94m8l1n9 3n717135 0r94n123 d157r1c7 0u7d00r5 c4l3nd4r 70m47035 483rd33n l4unch3d 34rl1357 l1c3n535 d1549r33 ch4p73r5 8r1n91n9 3v4lu473 c174710n 7r0p1c4l cl1n1c4l d4v1d50n 34rr1n95 5h0071n9 f347ur3d 5c13nc35 dr1ll1n9 8u1ld3r5 pr1n73r5 3n9491n9 k3n7ucky plym0u7h 4r71cl35 5ur91c4l p1p3l1n3 curr3ncy 5h4n9h41 1n73r10r f33d84ck 3p150d35 3v3ryd4y m0un71n9 r3m41n3d m081l17y h34r1n95 r3l471v3 m3m8r4n3 37h3rn37 dr3551n9 c4rr13r5 1d3n717y r350urc3 c0mm3rc3 fl0r3nc3 c1rcul4r r3v1510n 5yn0p515 fr13ndly f0un741n r3duc1n9 h4nd800k 5ch3dul3 n4v19473 m41nl4nd f1l3n4m3 r3pl4c3d 3n71r3ly 50m3wh47 r3c31v3r d0cum3n7 w4rn1n95 0p71m123 8ru553l5 5c07715h p0r7r417 r1chm0nd ch4m83r5 f19h73r5 plum81n9 4cc0un75 1n73r4c7 r081n50n mcd0n4ld c0mp053r 1n574nc3 c0v3r1n9 jud9m3n7 83dr00m5 r4710n4l m0d3l1n9 c4r700n5 3v3ry0n3 c0mpl373 l1c3n53d 4uckl4nd 4d3qu473 0lymp1c5 m473r14l 4ppr04ch 1nv0lv35 chry5l3r 84r84d05 w0rld53x r35ul73d c05m371c 53771n95 r4nk1n95 5p3c7rum r3v13w3r m3m0r135 r3c0rd3d 3mph4515 90r930u5 phy51c4l f1n15h3d cul7ur4l h4rr150n 70wn5h1p 5ymph0ny 5l0v4k14 d15c0v3r r1ch4rd5 930m37ry p4773rn5 7r1n1d4d d3v3l0p5 7h0mp50n n375c4p3 m3d1c1n3 h0l1d4y5 v1ll4935 4cc3553d pr3m13r3 1n7r4n37 3n73r1n9 d3l373d 57ud105 k1551n9 8u770n5 h34l1n9 v3n7ur3 3xp3n53 f1r3f0x w1nn3r5 h319h75 455um35 r0ll1n9 574r7up d351r3d m3x1c4n 4w350m3 p0773ry c4p170l 4rr1v4l 4rr1v3d cr34735 70ur157 c0mm0n5 4l83r74 n3rv0u5 m4573r5 53n470r 4w4rd3d p4551n9 8124rr3 3x73nd5 l0d91n9 08v10u5 r3pl1c4 ch4nc35 c0up0n5 8urn1n9 v1c71m5 570pp3d h4ndl3d l393nd5 800l34n v1518l3 3xh1817 ch3ck3d cl053ly 1nqu1ry 3xh4u57 7urn1n9 57r3375 c0ll3c7 l1v353x f4rm1n9 c481n37 pr0m153 93n371c h4ndl35 5k1ll3d h4rm0ny l3c7ur3 4ny71m3 9r4mm4r c17123n w1nd50r v15173d v1c70ry 3l3c73d c4p48l3 c0py1n9 35c0r75 c04ch35 74r9375 v3553l5 h4r80ur f1l73r5 c0un53l c451n05 4ppl135 1nv173d 4rr4n93 un1f13d d1pl0m4 f4rm3r5 qu3r135 4ndr345 ukr41n3 4853nc3 n34r357 clu573r v3nd0r5 19n0r3d wh3r345 5h0r7ly pr3c153 p057493 p4r714l 1nv01c3 c4571n9 d3r1v3d c0upl35 f1nl4nd r4nk1n9 4n4ly57 c0nv3r7 8r1d935 wy0m1n9 83771n9 1m491n9 0n901n9 l04d1n9 7ru573d v0l7493 f0rm1n9 3m8455y 5h1pp3d c0n50l3 h088135 h0rm0n3 r3c31p7 4m0n957 h0r120n 700l80x l1v3c4m l183r4l d34l1n9 5cr1p75 5urf1n9 d3v073d h3471n9 1m491n3 kn0w1n9 cru1535 c00k135 477r4c7 c0lumn5 d1548l3 5ucc33d l30n4rd l3nd1n9 cl051n9 un1f0rm m455493 m3dl1n3 h34d3r5 w3lf4r3 d4nc1n9 c4mp1n9 h34v1ly c4p7ur3 m1dw357 513m3n5 pu8l15h k4r40k3 d0m41n5 0853rv3 83rmud4 m081l35 d0c70r5 0p3r473 4m3nd3d m3n710n p10n33r 8r34575 57r4n93 4cr0847 73rr4c3 hundr3d 7h3rm4l d3n517y r3pl13d 73ll1n9 c04574l 534f00d ch4r17y up5k1r7 w1ll1n9 fr3385d 4n71qu3 94rd3n5 hun94ry 7r41l3r v137n4m 539m3n7 r34l123 pu771n9 53n50r5 51771n9 5urv3y5 plu91n5 41rl1n3 dur48l3 1n519h7 705h184 d37r017 n071c35 3d171n9 53cr375 d3p3nd5 w1ch174 f0rm475 5p3c1fy ph1l1p5 uru9u4y p3n4l7y 9l45535 3n48l35 53m1n4r 5h0w3r5 8u1ld3r d3p0517 r3v3r53 1n73n53 cl05ur3 3nqu1ry 748l375 fu7ur35 8l0993r ch4r73r w4n71n9 81dd1n9 0u7c0m3 w45h1n9 j0urn3y my573ry cu570dy c3n7r35 5cr47ch p0v3r7y d3nm4rk m4551v3 0u7l00k ch4r93r ch01c35 9r4n73d c4r700n c00l1n9 1nd3x3d h4ndj08 pr07357 m4pp1n9 0ff3n53 wr173r5 d1v0rc3 83v3rly 5h0pp3r cu771n9 83rn4rd v3rm0n7 84r941n 3xp053d 73l3c0m f0cu53d r0m4nc3 cl1n1c5 h4pp3n5 0rd3r3d dr4w1n9 v15170r 8199357 r350r75 4774ck5 p3r10d5 fuj175u r3w4rd5 5urv1v3 f0und3d 83n347h f0rmul4 5pyw4r3 53v3n7h 70n19h7 53nd1n9 500n357 7r41n3d 7yp1c4l ch4m83r l3nd3r5 f1771n9 c0n7357 84n9k0k 7084cc0 r083r75 c0n53n7 8077l35 pr3m13r 1ll394l pr3p4r3 5urplu5 0rl34n5 90urm37 p3n510n 83l4ru5 9r4v17y 9u174r5 w0r5h1p 8ukk4k3 ch4r93d 7h3r38y 4n70n10 h3r53lf 3553nc3 pl4nn3d 3p150d3 d4m4935 570m4ch l3771n9 w34p0n5 5upr3m3 7hr34d5 d1v3r53 81cycl3 3d170r5 l4p70p5 4n470my 4d4p73r 84rr13r 3nh4nc3 d3f3c75 3n48l3d cl4r17y d3f3nc3 r34ch3d r3pl4c3 0ffl1n3 d1v1d3d n317h3r 7r18u73 c0nf1rm 5377l3d 1n51d3r f0ld1n9 7r3473d l3550n5 41rf4r3 d3l1v3r r3fl3c7 v4cc1n3 c4rr13r 4d0p73d pl3453d v174m1n c0nc3r7 93nu1n3 r4151n9 8r1741n m1n0l74 hu584nd l34rn3d l315ur3 4nc13n7 810l09y p0r710n 800k1n9 c0ur13r h19hw4y 83l91um 1mpl135 81ll1n9 c0m81n3 3n73r3d r35p0nd p4yr0ll c00k1n9 1njur3d l34v1n9 f457357 73n510n 0r94n1c 7074lly h3lp1n9 d34l3r5 4mpl4nd h0ld1n9 c0nc3rn l3xm4rk m0dul35 373rn4l 5m4ll3r 3x4m1n3 3xpl41n w4lk1n9 8r1570l 4lc0h0l 4ff3c75 cl1m473 3n91n35 m47ch35 4773mp7 k33p1n9 83nn377 c0mp4c7 53c70r5 5hu77l3 9r0und5 7r4n517 r394rd5 fr319h7 4rm3n14 cl05357 4c7r355 845k375 93n3r1c r3m41n5 4dv150r cur10u5 d1374ry l4wy3r5 m4r1lyn 57ud13d f1ndl4w m47ch3d 0rl4nd0 pr0f175 c4rr0ll 83dr00m w4rm1n9 fl0r157 f33l1n9 4m421n9 0p71c4l d3u75ch r3v153d f4c70ry f1nn15h mu5l1m5 fun3r4l r3m0v4l 3nj0y3d pr1n73d f007493 c1rcu17 r3v34l5 w38573r cl07h35 c0mp1l3 c4rr13d n071c3d c4rr135 4ch13v3 4ll393d 519n4l5 4l484m4 83c0m35 5m0k1n9 7un1514 573v3n5 5ym80l5 h077357 80l1v14 c0mf0r7 533k1n9 d39r335 d35p173 pr3v13w u71l17y 84hr41n 3ld3rly h0ld3r5 4u57r14 5w3d15h 45p3c75 c0n5157 v13w1n9 1n574n7 p0571n9 w17n355 c0ll1n5 m34n1n9 l3v17r4 h424rd5 1n5ur3d r3910n5 dyn4m1c 4c4d3my 4l938r4 5h4d0w5 5unr153 94d9375 c0n741n 9l4590w 4m0un75 1mp4c75 w38l095 51n9l35 r4d1c4l 1nduc3d r3m0v3d 83l0n95 r34d1ly 54mpl35 l1nk1n9 4pp34l5 1lln355 15l4m1c 3n5ur35 phy51c5 70pl355 r3duc3d l1nd54y p3nd1n9 l394lly l384n0n m4773r5 53rv1n9 k3nn3dy c4ll1n9 5h3m4l3 733n493 7h30r3m my5p4c3 c0nduc7 84nk1n9 53cur3d unu5u4l 8r13fly w4171n9 5h4r1n9 m4rr13d f19ur35 dr1v3r5 r0u71n3 700l84r h34l7hy cu151n3 p3rf0rm 5pr1n95 w34r1n9 7h3473r 70r0n70 m0un73d h481747 f19h73r r37r347 5c4nn3r 4d4p73d 3574735 w4ll4c3 m4n493d f3m4l35 0ff1c35 80r0u9h 1n7393r 5p34k3r f41l1n9 4ndr3w5 m0dul4r 3n9493d f4ll1n9 n4710n5 81ll10n r34l17y c0nc3p7 84ll00n 3xpl0r3 3x4c7ly dr0pp3d 84p7157 dr35535 p3nd4n7 8351d35 r0u73r5 v1n7493 3xp3r75 fl19h75 9r47u17 m345ur3 r3v3nu3 m0m3n75 f0ld3r5 57r1n95 834ch35 3nl4r93 h0pk1n5 cl34rly 70r7ur3 cr3d175 r3duc35 1nf4n75 47l4n74 r3v3n93 3xp1r35 w1nn1n9 3n3m135 81nd1n9 9r4ph1c 4cc3p75 54v1n95 7r1993r 70ur15m d3519n5 d3c1d3d r0u9hly 4pp34r5 571ck3r pr0m073 c0rn3ll d353rv3 nucl34r 4n73nn4 455um3d 3v3n1n9 w0rr13d k1ll1n9 m3mph15 08j3c75 p4ck375 h4rv4rd 8r0k3r5 94r8493 1nd14n4 5p0n50r 34rl13r 7h347r3 p0dc457 d3f1n35 53450n5 phr4535 p4773rn 4ccu53d r34ch35 53477l3 p1551n9 p4rk1n9 qu12235 p0573r5 l34d3r5 l471n45 5upp053 1nv0lv3 r34d3r5 y0un93r pl4n375 d3f1c17 80uld3r r4p1dly c0upl3d my4nm4r 0n74r10 w33k3nd f0ll0w5 f41lur3 f1571n9 c0un73r 73x7ur3 pr0duc3 pl4571c 0u7l1n3 r3c1p35 r353rv3 h0ll4nd 0p3n1n9 c3n73r5 4n719u4 5173m4p p473n75 c4u710n 3x3cu73 m1551n9 c0l0ur5 qu4r73r m4r714l 3l3m3n7 p1r4735 0r191n5 74lk1n9 73x71l3 d3m4nd5 r3450n5 c4r3ful 1nv4l1d ch4r935 5u99357 70w4rd5 1nd3x35 7r4ck3d 4ff41r5 m1n1m4l f1nd1n9 l0773ry f0r3575 l1ck1n9 l1c3nc3 m4rk3r5 pr3v3n7 w319h75 4l84n14 pr073c7 l4571n9 c0v3r3d d3f3n53 nur51n9 w38c4m5 3ff0r75 5urn4m3 4n4ly23 3v1d3n7 53r10u5 4ll3r9y 83l13f5 3n7r135 7h3r4py r0m4n14 34573rn l3451n9 c0n5ul7 h34r1n9 9r347ly 7w1573d 9r0w1n9 cycl1n9 up9r4d3 pr3m1um 174l14n 7urk15h k3yw0rd 53c0nd5 p3n71um qu4n7um 53rv3r5 ch34p3r l4r93ly h1m53lf 8r0u9h7 5ur93ry dr1v1n9 v1ru535 d0ll4r5 qu1ckly 7r18un3 4l93r14 8l3553d c4rd1ff 4cqu1r3 4pp4r3l 1n574ll c0n73x7 l3773r5 5p1r175 r3f0rm5 l4w5u17 1n1714l p01n73r r3pl135 57r37ch 84l4nc3 p3rm175 234l4nd 84nn3r5 c1rcl35 cl34n3r 3cu4d0r f33d1n9 p4551v3 84n98u5 f4c70r5 c0ur493 9423773 v1ll493 r3un10n h174ch1 pr41r13 p3r50n5 p3rh4p5 0lymp1c p4713n7 c0l3m4n m4rk375 4n4h31m d15cu55 cu570m5 4c710n5 cl13n75 7r4d1n9 m0n170r d3cl1n3 15r43l1 f45h10n n4m1814 pr1c1n9 5p3c135 kn19h75 53ll1n9 h3wl377 c0rr3c7 pr0c33d 4ll0w3d 4l73r3d j4m41c4 4uc710n 4dv4nc3 519n1n9 4ppl13d l4nd1n9 57r34m5 c0nn3c7 4fr1c4n v373r4n l4r9357 ru5514n pr0p053 l19h73r 3570n14 k47r1n4 ch4n93d 74c71c5 4n93l35 mu51c4l m0n7hly h3lpful h19h357 3c0n0my 574y1n9 53771n9 f0und3r 5p4n15h 5h0r73r d15pu73 c0mpl3x r3ly1n9 4dv3r53 r3f1n3d 3xc3rp7 f1f733n c4r33r5 w47ch35 pr3d1c7 f1c710n 4cryl1c d3v1c35 fund1n9 83n3f17 p3rfum3 5h0w1n9 r3570r3 70ddl3r w0rk3r5 734ch3r 8l0ck3d unkn0wn r35p3c7 0ff1c3r cl45535 d35k70p cr3470r upd4735 f1n4lly mu53um5 57r1k35 7r4ck3r dr3553d p455493 83lf457 v4r137y nur53ry j3l50f7 h34d537 n1494r4 04kl4nd m1n1mum 5urf4c3 0ff3r3d 4n5w3r5 v1r7u4l pr3p41d pl4y1n9 d3f1n3d 5u1c1d3 3l3c7r0 84773ry v4ry1n9 7ru5733 481l17y m15510n 80rd3r5 p4r7135 f4cul7y l091c4l h4mp70n l0991n9 3x7r4c7 4u7h0r5 p4r7n3r 75un4m1 5ch0l4r p4y48l3 pr0731n m0rn1n9 0u7d00r 3xp3d14 930l09y r3qu1r3 d3f4ul7 c0471n9 v3h1cl3 m41l1n9 cl34r3d r371r3d p4c1f1c r3m4rk5 5m1l135 d3c4d35 80471n9 4r151n9 5h4k1r4 m1x7ur3 c0rn3r5 8r04d3r c3n7ury 535510n 4r71575 d3v3l0p r41lw4y 9r3473r 0p1n10n ch1n353 p01n73d 84h4m45 f17n355 c4u51n9 m1574k3 h1771n9 l34d1n9 m1n3r4l 4qu471c 1n5734d 91l83r7 f0r7un3 cl41m3d 5cr33n5 0u7pu75 pl4nn3r cr04714 1n5ul1n 574d1um 7r4ff1c 455ur3d c474l09 my51m0n 4m813n7 h0u51n9 u71l123 m1l3493 4d4p70r 3dw4rd5 5h3l73r 4n1m4l5 hyund41 f0rw4rd 54715fy c057um3 r3l4735 5747u73 p4ck1n9 w4rn1n9 m4x1mum fr4m1n9 1mpl13d 3xpr355 c0mm4nd 812r473 d153453 w3dd1n9 k17ch3n p4r3n75 p1ck1n9 n0rf0lk 1mpr0v3 r3n74l5 574710n r39ul4r 50urc35 p0ck375 1nqu1r3 p41n73d v0lum35 7r41n3r r471n95 r34l70r 4r7w0rk ch45515 c4m3r45 pu5h1n9 f347ur3 purp053 37h1c4l 8r0w53r num83r5 pr1m4ry pr3f3r5 83df0rd 5ch3m35 l0c473d n3u7r4l ch4nn3l 83dd1n9 0u751d3 j01n1n9 h34d1n9 3qu4lly f0r319n 834r1n9 41rp0r7 c0ur535 3m3r4ld cul7ur3 53n10r5 3n9l4nd c4p174l r37urn5 f0cu535 51l3nc3 1mp053d 48r4h4m f1ll1n9 v10l3n7 7u35d4y w38p493 53ll3r5 h0573l5 53n394l 8r1715h 15l4nd5 mu5cl35 j3w3lry wr4pp3d c077493 runn1n9 run71m3 c3r741n m021ll4 pl4c1n9 50l0m0n d1574n7 4nym0r3 l4undry d3c1m4l l0c470r 83l13v3 pr1n73r m491c4l 50m30n3 m1r4cl3 r3pr1n7 574r73d pl4y3r5 p4ck493 h4m8ur9 0v3r4ll r350lv3 f47h3r5 w3573rn 73rr41n 5umm4ry 570r493 50m3h0w 7h0u9h7 k1n9d0m cr3473d 3ff3c75 wr171n9 l483l3d n193r14 c31l1n9 h0l1d4y m4rk1n9 r0y4l7y 5h3r1ff 9r1ff1n l1c3n53 4ny80dy 50l4r15 pr3570n w4rr4n7 m4n493r 51n91n9 ch4p73r m37h0d5 r3c31v3 l0n9357 v4r10u5 93rm4ny 0p71m4l 93771n9 p3rc3n7 u5u4lly m4dn355 8l0w1n9 r34d1n9 5uck1n9 r3u73r5 m1nu735 f1n4nc3 c4rd14c 71ck375 v471c4n h0571n9 f3d3r4l wr1773n 3xp0r75 m4nu4l5 pr353n7 533k3r5 num3r1c w47ch3d 5k471n9 7h3r30f 53471n9 3mp3r0r r3c0rd5 4v3r493 r384735 w347h3r pr0udly wh37h3r n47ur4l pull1n9 083517y r4n91n9 r3p41r5 p0w3r3d l1m173d 7h0m50n d15pl4y h4n91n9 c0l0r3d 70ur1n9 4nd0rr4 53v3r4l 3xp1r3d 57ud135 7r4v3l5 4lr34dy upd473d fur7h3r r0u71n9 3d1710n d3l19h7 50c137y 4rch1v3 3l394n7 c0mp373 r3n3w4l c0un73d c0unc1l 0pp053d 5c0r1n9 d3cl4r3 c3n7r4l 51573r5 cr171c5 734ch35 r3p0r75 j0urn4l 570r135 p0pul4r 51l1c0n 7r493dy p41nful m1ll10n 5ch00l5 51m1l4r pr4y3r5 n0wh3r3 m4d0nn4 m3371n9 p1c7ur3 r3qu357 r3l3453 v3r120n 50ld13r r380und 849hd4d ch4n935 3x4mpl3 m1rr0r5 c0nc0rd 0p710n5 l183r14 3c0l09y pr08l3m 5h3rm4n 4554ul7 w0rk0u7 57ud3n7 p4ym3n7 4941n57 r3fu53d 80wl1n9 w0rk1n9 c0mm3n7 57471n9 m0r0cc0 7r1umph m3d1c4l w3ld1n9 l0ck1n9 8l4nk37 3ll1077 541l1n9 l18r4ry h0w3v3r ju571fy 94ll3ry c4ndl35 p055355 50lv1n9 3n9l15h v4n1ll4 5c13nc3 pr0c355 pr0v1d3 1c3l4nd pur5u17 4r71cl3 d3v14n7 m07h3r5 84ck1n9 1nclud3 c0mp4r3 1mp0r75 3ndl355 c0un7ry c0n73n7 l1571n9 5u5p3c7 f19ur3d l0c4lly qu4l17y 4n07h3r cruc14l m0ld0v4 pr3553d pr0f1l3 5c4nn3d 4cc0un7 7u1710n 7hr3475 5ur930n pu22l35 h1570ry m1551l3 d4m493d curr3n7 h4rv357 d380r4h d357r0y 4551575 1nd14n5 w17h0u7 4ud170r pr0ph37 8r4ck37 5y573m5 n37w0rk m3m83r5 c4lc1um h4rmful r3l473d 53c710n 0lympu5 v3r510n pr0j3c7 9luc053 w385173 5p3c14l p3r514n 4ppr0v3 837w33n 574r73r 5u8j3c7 lu99493 9r3n4d4 1n73r1m c4l94ry 4ddr355 57yl15h 34rn1n9 r35ul75 9r0c3ry m41lm4n 83c4u53 50m4l14 k3nn37h d3741l5 4dv153d n0v3l7y 8ud9375 700lk17 pr09r4m r3v13w5 3r071c4 p30pl35 831j1n9 j4nu4ry d149r4m v13w3r5 c0mp4ny pr1v4cy r35um35 7hr0u9h 3x1573d qu4l1fy 0p71mum m355493 j4ck375 3xc173d 5upp0r7 pr0duc7 r3fr35h r3c0v3r w38c457 57r1p35 3xp3c75 jump1n9 f48r1c5 p0lym3r r4l319h d3l4y3d hy913n3 p0ul7ry 80uqu37 m4nd473 1nd1c35 h4l1f4x c0n74c7 d0n473d 3xclud3 57uff3d 1n53c75 cl34nup c0mpu73 4nx137y 4rr1v35 5p4714l 7r4c70r 70uch3d c3r4m1c c0l09n3 f1n93r5 w15h1n9 0u7l375 574pl3 r3p347 f0ll0w 80d135 5ch3m3 unl355 3rr0r5 54mpl3 m4nn3r v1d305 r39943 7r4nny 7hr34d 4n90l4 8l00dy f1n93r 7r4um4 l0c473 70w3r5 hu9h35 74r937 pr0p3r 3xc3p7 m4k1n9 p4y1n9 w0rk3d w00d3n m070r5 80x1n9 8r4k35 num83r 9l084l 50r73d c4r80n 4dv153 1nch35 w49n3r n33dl3 my53lf 5h4r35 ph4535 m0v1n9 cr1515 8r4nd5 v0y3ur pl4c35 c0l0r5 8r19h7 pu5h3d h34d3r pr377y f0rm3d ch01c3 8l4d35 4pp34l cru153 5h0r75 5h3375 5l0v4k pu3r70 m4r10n m374l5 7r41n5 45ylum pl45m4 84ll07 f4c1n9 w1ck3d lyr1c5 m4r7h4 5c4r3d 1nc357 r4r3ly dr1v35 3xp3r7 84nn3r r3fund 5u8m17 4r7157 m3d1um 7r3m8l h3l3n4 l47v14 8run31 1mmun3 4m0un7 3m41l5 cypru5 l3v3l5 73chn0 84k1n9 83c4m3 d34l3r m4k3r5 h34r75 l3773r p4570r n34r8y ph0n35 w1r1n9 7w1nk5 l394cy 574nd5 h4pp3n d4n93r 9r33n3 w1d3ly r41535 phr453 90773n 7un1n9 1753lf hy8r1d fu7ur3 p4p3r5 7h0u9h l471n4 4w4rd5 wh33l5 53xc4m c4u53d 81993r luxury v3r5u5 n45d4q fr4m35 3xc33d v149r4 57ud10 1nd33d 54y1n9 8u7l3r w0r7hy r0u73r r34d3r cl41m5 p0l4nd f0ld3r w0m3n5 848135 r0573r d373c7 upl04d d3v1c3 34513r d39r33 fr453r 7hr0wn 9r4h4m v071n9 c0ur75 8u770n r3m073 d33p3r cycl35 5l0wly d3n14l 4dd1n9 7h4nk5 m057ly 93n7l3 7hr0w5 l473ly 1nf4n7 w35l3y 4ll13d pr1n75 7r4d3r ch4n93 c3m3n7 m337up r38473 m4773r cu570m 8r4nch unl1k3 k1dn3y f1n173 7h30ry 708490 ch4rm5 wr19h7 r3m0v3 7r184l pr0v3n r394rd 54f3ly c4ch3d w4rr3n 3x1575 8urn3r 8r1d4l 4lm057 5u1735 c0mply m4rk37 m4k3up h1dd3n n4rr0w v15u4l 7hr347 807h3r 53r14l r3l13f w38c4m r34lly d05493 nu773n w319h7 chu88y 43r14l 57ruck m4n493 qu383c v0c4l5 c0rn3r pl4n37 c457l3 m4nu4l m1553d c0p135 r3c1p3 3d170r 50ck37 51l3n7 l483l5 p3rm17 5331n9 0r390n 83c0m3 4c71n9 kuw417 n0v3l5 570r3d 493n75 n4m3ly hum4n5 4n4l09 f4c14l r3p41r 74l3n7 n3wm4n 53r135 533k3r w15d0m ch0053 r471n9 cr4dl3 748l35 0ff537 p4yd4y ph1l1p d3f1n3 8ur34u l3553r 5p33d5 p01n75 c0rpu5 c0lumn pl4n75 8r34ch dur1n9 p13c35 574935 fr1d93 k3lk00 c4m3r4 p0wd3r 5748l3 d1nn3r 455355 r3l04d 4v3nu3 570n35 57r355 l3550n c1n3m4 l051n9 94rd3n 5udd3n cl4rk3 7r3nd5 f3m4l3 m4r14h 905p3l cur715 4r9u3d c477l3 r37urn 53v3r3 rhy7hm 53c70r v3lv37 h34l7h f0ur7h d3lux3 34rn3d r4c14l ch0ru5 j3r53y m4l4w1 c0ll4r m3n74l l3nd3r v13w3d 5l1d35 4ur0r4 f48r1c m0m3n7 57ylu5 v15175 h3r38y hun93r 7r1pl3 f47h3r 4774ck l1573d fly1n9 c4nc3r 53c0nd d4m493 5ur3ly qu0735 l0n3ly r3450n 45519n d0m41n 7174n5 3n3r9y 4n5w3r p0und5 50u9h7 pl4c3d p13rc3 ch4r75 jul14n m3d14n r0und5 c3n5u5 h3r31n d351r3 9r4nd3 v4r13d fl0ppy 93n7ly cl0ck5 pl41n5 d0ll4r hun9ry c4u9h7 r3nd3r m4rk3d dr1v3n 8451c5 d34dly c4rp37 h1r1n9 57ruc7 l3n535 81n4ry h4r0ld 8077l3 p037ry 834u7y fl33c3 8r1d93 ru883r n471v3 fl4v0r f0rum5 8uf1n9 c0nd05 f0551l cur50r 83773r py7h0n f0r937 m37r1c c4mpu5 pl4y3d m0d3l5 pr1c35 r08813 0r945m 7yp1n9 84rr3l n3ur4l w4rn3d pr3f1x 1m4935 51573r 3v3n75 3n717y 5h1r75 pr0f17 h0ld3r r0ll3d w4rn3r n3w357 pur5u3 n071c3 1nkj37 9uy4n4 p4r4d3 4c70r5 d0n0r5 93r4ld l148l3 0p71c5 m0rr15 du7135 r3c4ll p1ck3d 3x73n7 9r4nny 37h1c5 83l13f w4n73d 81k1n1 3xp3c7 4nch0r l00kup 83y0nd ul7r4m 8r1n95 kru93r mu53um 0774w4 un1qu3 5urv3y 3xp0r7 nud17y v4lv35 805n14 r3f1n3 81dd3r 51n93r 573r30 h3r4ld 5w3d3n pr1235 4nnu4l c0mm17 p4rc3l r35157 plu91n d1v1n9 1nv173 53r814 f0rm3r d33ply k1j1j1 5ch3m4 4d1p3x 73rr0r 53rv3r 7h1r7y 4rr357 f1n4l5 84ckup m5957r j4ck37 53n473 f0rc35 0r4cl3 c00k3d myr7l3 7urn3d 5pr34d 80r1n9 3xc355 9009l3 3xp4nd 5l19h7 church m37h0d f4v0ur 51mply 93nr35 r3f3r5 7unn3l 84r813 4c71v3 r19h75 r3741n 4ff3c7 v1r91n p4r3n7 m073l5 r4153d v1c71m 574mp5 p4yp4l f0r835 f19ur3 4lfr3d 84ck3d p1ll0w 4rr1v3 m1n1n9 5un537 0p710n v4ll3y r4p1d5 94rm1n 8r33d5 fr4m3d 5uff3r 07h3r5 c1rcu5 pu8l1c 3n0u9h 947h3r d3l373 r3l473 f0rm47 155u35 94r493 5cr0ll 9u4rd5 m41l70 7h0n95 519n4l m0n7h5 155u3d 5h4p35 53xu4l 4l8um5 ch3475 5k1r75 k1n453 7ru575 9u3575 h0573d 54f37y l4r93r 80770m c0l0ny pr4y3r d3741l 1nf0rm n3v4d4 5u553x p4553d n3w4rk 57r337 493nd4 murr4y 1n73n7 4nyw4y d1v1d3 f4ll3n 7r4ck5 h19h3r 1mp4c7 h3473r 534rch v3553l c1rcl3 57473d h0n0r5 9r4n75 57r0n9 v4r135 8u88l3 c3l385 5w17ch 7h1n95 0xy93n f3715h c4ny0n m373r5 m3r3ly c3n73r 5u87l3 c0v3r5 p45535 4p4ch3 mun1ch p47r0l kn1v35 durh4m 717l35 9r0und mu5l1m v0yu3r h0p1n9 5l33v3 f3ll0w d023n5 l0un93 pr024c 0wn3r5 57r0k3 4dul75 p3r50n 93n0m3 845k37 4853n7 r3m4rk 1npu75 w33kly h1l70n h4v1n9 h4rdly h0rr0r c00l3r r1d3r5 l4unch d3m4nd 53w1n9 d3814n m081l3 w41v3r 5pr1n7 8ry4n7 5qu4r3 7r4v3l fr3nch 5cr1p7 9l0v35 53rv3d 5ym80l cr4f75 5k11n9 r074ry 4nd4l3 24m814 5c3n1c c17135 m41nly 37hn1c r3w4rd fl1ckr m471n9 d1n1n9 4lp1n3 9r4ph5 c0mm0n f15c4l 71m1n9 57yl35 d3n13d f1ll3d 90551p 57r1p5 rw4nd4 m1ch3l 0ccur5 d347h5 r1v3r5 n071fy jun9l3 n47ur3 p0r73r n4710n 907h1c 3n5ur3 0rd3r5 v3n1c3 7hum85 pr4153 c48l35 457hm4 34573r c0770n 5l33p5 p4lm3r h4ndl3 ur93n7 7w3lv3 l4y0u7 d3c4d3 4fr1c4 d3n74l k1ll3d 80rd3r 71773n f1773d d38473 pu8m3d 574r75 m1x1n9 l471n0 dr1nk5 d0n473 v01c35 cl0ud5 74u9h7 n3x73l w0rk3r 73nd3r c4u535 m0nr03 h0n357 4l84ny 70m470 73mpl3 l1v1n9 p051n9 9r0w7h p37173 57u4r7 8r34k5 c4ym4n 493ncy w473r5 5377l3 r0ll3r m0dul3 pr3f3r 0p3n3d r350r7 c0d1n9 h4rr15 8ud937 r4nd0m 5c0714 c0p13d c0un7y h1k1n9 h4rd3r 9u1d35 p13rr3 m49n37 l00k3d r3p0r7 5c0r35 m0710n v3c70r lu7h3r c4ll3d 8uff3r c0m3dy 0ff3r5 v3r73x w38l09 l1n34r 4r4814 m3r93r m4rv3l 5p34k5 mu7u4l m0d3m5 r08u57 5yn74x 4m420n pr150n p4n4m4 3d173d ch41r5 50lv3d m0v135 83l123 j3w15h l0993d l1nk3d l4p70p 1nc0m3 c0upl3 47h3n5 91v1n9 jud935 r4d1u5 r3c3n7 3nd1n9 fl00r5 d353r7 w0nd3r w4lk3d l0l174 0ld357 n34rly p0w3ll h4n53n 8391n5 l1573n r3f0rm 570r35 4fr41d 4l3r75 f0r907 4cc3p7 0r191n 5umm17 5up3r8 5p4c35 94m1n9 n0r70n l0ck3d 35c4p3 fu510n 455um3 p0150n curv35 m0n4c0 7r4d35 c14l15 c4nv45 f4573r p4r15h pl3d93 9l4nc3 4rc4d3 80u9h7 l34v35 n4pl35 r3v13w v1r7u3 9u1d3d unl0ck c0up0n nur535 r3741l l4y3r5 m3m0ry 8r0k3n l0w357 h19hly ch4p3l ch3ck5 u53ful f1l1n9 f0573r 4pp34r 8477l3 74993d 54f4r1 54v493 7r14l5 7155u3 r3fu53 3n91n3 4u8urn pull3d 50c14l 83f0r3 5h4p3d m4rk3r 174l14 f4rm3r m1l70n v13nn4 h073l5 p3r10d l4dd3r 83lk1n d15h35 3l3v3n 4c7u4l 3qu17y 73573d y34rly 5p33ch 5urr3y 4cc3n7 45p3c7 h3r035 w4lnu7 5h4r3d 50und5 c0un75 pr1c3d v3r84l 9r00v3 f0rm4l 7ry1n9 m4r8l3 cl053r d0u8l3 r1d1n9 fl0r4l m0v3r5 7r347y cr3473 f0rc3d 5h0w3d 5cr33n 5p34r5 50urc3 d1ld05 cl1n1c k0r34n 4u7h0r h319h7 j01n3d 8l4ck5 p4ck37 3x3mp7 3n73r5 w1nd0w 50v137 d4rw1n w0rld5 9u1l7y v10l1n 08741n n3w813 fund3d 748l37 4cr055 3x73nd 8ur13d m0d3rn du8l1n 53n10r r3910n r3m41n c4nc3l l1m175 n33d3d 53450n f41l3d v4lu3d 3451ly r1880n 17un35 cr1m35 84r3ly 0u7l37 4dju57 fru175 murd3r 15l4nd r3c0rd p0573r d1r3c7 9r4d35 941n3d 20l0f7 174l1c d19357 ch4r93 h38r3w r47105 cl053d h0ll0w c4r1n9 r3j3c7 5ph3r3 r35cu3 h48175 l05535 c0m847 93n1u5 p0773r m05c0w 7h3515 94l4xy n0rm4l m41d3n 57r41n 717l3d 3n71r3 m0d1fy 0xf0rd 455375 h0lm35 p1x3l5 1njury 3ff3c7 5c4l35 831n95 h424rd 4r0und h4rv3y l4wy3r ch3qu3 fr023n 8hu74n p473n7 3mpl0y 7074l5 5und4y fr3323 c451n0 4ff0rd 3471n9 48r04d 7r1v14 p0r74l u94nd4 un10n5 c0ur53 h0573l m19h7y l349u3 m1rr0r 7urn3r 9r4715 m1nu73 v4l1um 57r4nd p3nc1l 70w4rd k3rn3l 5p0k3n upd473 570ck5 574y3d 8uy3r5 v0lum3 455157 0u7pu7 5u173d 4ny0n3 n3573d l1k3ly y13ld5 741w4n 3ff0r7 ch053n r3d33m r093r5 r3m3dy r391m3 9r33c3 w15h35 84rn35 3xcu53 f13ld5 d3p3nd d1ff3r l480ur 20n1n9 53rv35 8r347h c0m1c5 n19h75 d4y70n c4ndl3 83h4lf h0u535 l1qu1d p0574l 35c0r7 571ck5 54l4ry d3c3n7 7h3hun l47357 83l0n9 h3r84l l0v1n9 5h0uld 1n73nd p07470 c0473d p4l4c3 54v1n9 ch33r5 r47h3r r35um3 v3r1fy 7w3n7y d33m3d f4v0r5 p1cn1c 4v474r 0ff1c3 f1n15h 5upply 8r3457 317h3r cr3d17 h4ck3r m4dr1d m37r35 m4r91n n080dy h3lp3d 50l3ly 1mp053 f0u9h7 50d1um d3519n l4m8d4 h34d3d v073r5 d3c1d3 4dw4r3 49r335 nud157 7h1nk5 5c0r3d m3n70r 5747u5 8r0w53 8ru74l cl0udy d3l4y5 455ur3 p0573d nv1d14 7r1ck5 k4n545 74r1ff pl3n7y p4n3l5 7hr047 19n0r3 cl0535 r3duc3 r4d105 w34l7h 70n9u3 unwr4p 9u1n34 d4n15h chr0m3 v4cuum mu5cl3 fr33ly 1nv357 d471n9 54cr3d 5k1ll5 wr1735 3n48l3 57471c 53ll3r 470m1c 4ppr0x 7uc50n 4r481c 8u1ld5 570l3n c3n7r3 8351d3 f4m0u5 wr173r f1l73r 4773nd 5h0w3r 1n74k3 l34d3r 4dv1c3 15r43l v3rn0n ch41n5 pl4735 3n9493 h4nd3d c4r33r l0n93r qu073d h0ld3m 3554y5 4dr14n 93nd3r p1ckup 8r0n23 f41rly w4ll37 c0nf19 r3n74l 83h1nd 5u84ru mum841 53nd3r d3f3nd 93n3v4 h0urly 533m3d 93rm4n 8uy1n9 h4r80r fl19h7 4lw4y5 5p0u53 3x071c v13w3r 519nup r35ul7 8r13f5 4m813n 84nn3d c0l0ur v3nd0r pr49u3 pu22l3 r151n9 4rc71c 5h13ld m0un75 73n4n7 w45h3r 94rl1c m41l3d n0710n pr0v3d f1nd3r un48l3 l4773r 4ff41r p0ck37 74ckl3 5734dy 4ll0w5 h3473d v3nu35 d14l09 54lm0n m1ddl3 rul1n9 n1ck3l w17h1n h4rp3r pl4n35 25h0p5 574735 3ur0p3 74k1n9 d1v1n3 w34p0n 71m83r 8urd3n 8undl3 1n53r7 3n2ym3 hud50n v4lu35 357473 7r41l5 l0c4l3 pup1l5 4lumn1 cl1ck5 r4n935 d3f347 71ck37 c0m1n9 7r1835 c45u4l 49r33d 4774ch p0l15h 3x7r45 70p1c5 f4c70r f1n357 r34l7y 1nl1n3 cl4u53 7r4nc3 08j3c7 7r00p5 1nd00r 4u7umn 9r0up5 r0n4ld 8r0k3r 7h3m35 p0w3r5 701l37 r4nk3d r0u735 p4ck3d pr1357 1mp0r7 804rd5 57r34m 5h4d35 p0l1cy 8ump3r l3n97h 53l3c7 71m3ly 74lk3d r08075 57r1n9 54dd4m p4r7ly 57r1c7 h3lm37 n0rw4y w4750n v1ll45 45k1n9 8l0ck5 53n50r p331n9 519n3d 8r00k5 n3w70n r3m1nd d3pu7y qu33n5 534l3d wh1l57 cl13n7 84ll37 3800k5 l04d3d pr0mp7 ph0705 5c3n35 4dv3r7 r3v34l 9u4rd w1r35 5unny 4r80r 81n90 l33d5 3800k c3d4r chuck d38u9 l0p32 h3l3n 574k3 pr083 8l41r h0p35 m450n 8urn5 pump5 j4n37 m4r10 jul13 u71l5 8l3nd d3p07 p41r5 m4pl3 r4c35 20n35 74p35 l1k35 ch053 54l3m c4r90 l07u5 574mp 8l457 cl07h 7337h d023n p3rry 4u705 p17ch l4u9h 7h374 m4cr0 ch347 f4rm5 51x7h f4c3d 94u93 r1cky m4r5h 5k1r7 k0d4k 8r4k3 5p4r3 8ru5h c0n90 r3537 0l1v3 41m3d cy83r 7h475 cl0n3 d1ck5 7ur80 r3l4y 734r5 54l0n 04515 4n9ry 5p075 941n5 533k5 r0ll5 w4nn4 m4l74 f3rry 9r41n 9r1ll 54v3r 0m4h4 c1v1c 0m394 l04d5 c3n75 m073l 8unch fl337 r4lly d15c5 nyl0n n3p4l 8r0k3 4l13n d3lh1 dy1n9 57uck l473x 570p5 70n3r drunk r4nch 8451n ch4rm h4v3n c0m80 54f3r v0c4l 2dn37 0r94n lyc05 l3m0n 70x1c 5l4v3 h0p3d 94735 81k35 v073d l4nk4 pr0xy f3w3r fl0w5 834d5 f4r35 83nch r1d3r 54uc3 ch453 4ll4h 8u775 5h33p 480u7 l4mp5 c4m3l w4v35 w1n35 7runk curv3 574ck 54l4d c4r0l 5700d p4573 4cu73 5734m 71r3d 5kyp3 c173d 533d5 07h3r n0d35 15l4m 74l35 0u73r f0705 4d0p7 l1k3d 5h3lf kn1f3 v4lv3 cl0ud r3l4x cr0wd 57r4p r081n 5w0rd 53ll5 m34l5 c0r4l p1x3l fl047 c0l1n 8l4d3 p47h5 h0l35 w31rd r0u9h 4rr0w 4c1d5 5p0k3 d41ry 4dm17 f4ncy 54m04 80r3d wh1ch p4ck5 5qu4d 7r4c3 44r0n c4mp5 7h31r w4935 3554y 451d3 xh7ml m4l35 519m4 f4v0r f0n75 crud3 ch405 j34n5 m1ll5 wh347 cl3rk 1n7r0 4l1c3 491n9 84535 f41l5 3v4n5 un17y 8r1d3 839un 73x75 d3c0r 50ck5 l1v3r c0rp5 r4lph 3553x f33l5 47l45 h0575 7h3r3 93n35 f3v3r 5l075 d415y drum5 l0053 l0v35 5h0r3 r0v3r n08l3 r0075 9n0m3 w1nd5 fl4m3 74nk5 r0807 p03m5 3l173 5h007 d473d 5p3ll 5w1n9 7h3f7 3m1ly m4n94 5123d k3ny4 m4r13 9r455 d3v1l 4nn3x 84rry 5ud4n flu1d ru98y k4r3n f1r57 f4ul7 54ud1 9l0ry h1n75 r0l35 r34d5 w0uld f18r3 w0rry w1r3d 70wn5 519h7 70n35 n4ncy 4r9u3 50lv3 4r153 cr419 w1l3y 7h353 j4m13 ch357 cl1ck 90nn4 70u9h 8r34d r0535 p0und k33p5 ch355 m0r4l 1c0n5 80057 m3nu5 8ur57 c4n4l 4m1n0 h3r85 f0lk5 p1ll5 ly1n9 n1k0n 70ky0 l4ur4 dr1ll 8ry4n pr1c3 h088y 7r135 4rm3d l4nd5 5m1l3 9r0wn 4r3n4 7r1ck fl00d 73rry ch1p5 v1574 1r4q1 7h1ck my3r5 dr0p5 w1d3r 0p3n5 w3ll5 3n3my 5cr3w m0d35 8l4m3 3xc3l v174l v3nu3 4cr35 7r4n5 qu357 pl424 8r455 f1f7y m4r14 uncl3 ch1l3 l1nd4 k317h pr1d3 j4c08 r4ndy 9h057 k3rry d1ck3 8l0nd 8r1ck n4v4l 9l083 7w1k1 j0k35 w00d5 d0nn4 c481n y4rd5 p1224 d0d93 83457 3dd13 dr4wn f1r3d ch01r 380ny p3r7h w4ll5 5h0ck 5yr14 84k3r kl31n 71r35 fl495 r37r0 k1n95 d14ry l4k35 4n93r r4d4r 5u175 h3nc3 9l3nn 57473 y13ld m4y0r c0ck5 f4c35 r04d5 h4ndy 5pr4y cr0p5 9r0v3 1n73r cr45h 9u1ld r093r fr4ud 80nd5 74lk5 9r4ph f183r 73ll5 80475 7r183 fl0ur w0r53 8u57y rh0d3 7r3nd 7hr0w m0v35 m4m80 5k1ll l4rry m0d3m r1d93 3m41l w1n95 847ch pr0v3 4l1v3 4l73r w4yn3 9h4n4 3d935 w0rld 7w1n5 pr123 f1f7h 4m3nd f1nd5 4c70r 3p50n ch1ck n07r3 9r055 c01n5 7h0n9 m3d4l 8l1nd 4p4r7 w4lk5 5uck5 cr4f7 5m0k3 p1ck5 cr4ck 8007h 1nd13 m4k3r 80n35 8r33d cr0wn p0l4r c0m1c qu137 nur53 m591d p4n75 h0n0r w0r57 v1nyl 4n9l3 c4r3y u5u4l 4l4rm 53475 d4nny 914n7 pr0ud l3453 c4ch3 7urn5 51d35 7r1p5 74573 p4710 ll0yd r0m4n 1nn3r 834n5 v1ll4 3ll15 4d4m5 5u54n 9r4c3 74mp4 m3375 qu1l7 pl4n3 m34n7 4f73r 719h7 jul14 83rry l1v3d hum0r p33r5 8l4nk 45537 0p3r4 81ll5 m1lf5 l0905 h34d5 0u9h7 f1x35 53nd5 p34rl m42d4 57r1p m37r0 pul53 h0ld5 80075 du7ch 71m3r h41ry r4p1d 734ch 7yl3r kn0ck v3r53 h19h5 p0r75 r15k5 p14n0 wh3r3 7r347 3ll3n m00r3 5h075 54v3d r4ck5 n457y 81rd5 l0v3d m4rk5 7um0r w4775 5h1f7 w490n 39yp7 f0r7y 7u835 7w1c3 800k5 fl0yd 5pl17 8ruc3 qu3u3 f0r7h d00r5 c0n57 745k5 5k1n5 d0u87 l1nk5 3x4m5 c47ch 50l4r y34r5 5h3ll w3l5h 83lly y0ur5 70w3r h4171 p0ll5 0rd3r 4ud17 d1ld0 lunch 84nd5 dr4m4 r4153 3ld3r 50n1c n3wly m1nd5 f00d5 m3y3r cl4rk 7hum8 5w155 8r04d 173m5 l0d93 9r0up 7ruly pl4y5 1d4h0 ul7r4 n0v3l c23ch 7w157 p1l07 d3l4y p41n7 4wful d0ll5 r4nk5 d38u7 m1cr0 570rm 80und 3x4c7 5l1d3 93nr3 4ll3n 571ck l3w15 my5ql fru17 8r4v3 m373r m0u7h v0lv0 p3nny 834r5 d3n53 5c0p3 8lu35 1v0ry 537up 7r41l r3m1x 4l145 c0574 n3w3r 5p1c3 f0r93 pl41n 51235 45c11 l091c d0n0r 7r45h m4n0r d14n3 pl473 d15c0 3nd1f c04ch kn0w5 0ccur und3r 5h4rp 9r33k 4rr4y n0153 m1nu5 w1d7h wh33l 3x157 m1x3d u5493 f1rm5 1r15h 5h4p3 4w4r3 m1l4n 5h4d3 h1ll5 80x35 d1917 p4rk5 l10n5 5p3c5 p00l5 94m35 lyr1c 1d34l m41n3 3mp7y pr00f r4710 9r4v3 cl0ck 5p3nd l4y3r h0w70 r3f3r dr355 d3v0n 7r335 54v35 4d083 l088y 80nu5 c15c0 punch d3l74 90774 d3v3l 4h34d k4rm4 8377y luc45 9u355 h3nry r1n95 m4rd1 1n73l 5h4k3 dr1nk h0lly 51lly 5c3n3 m3rcy c0uld 5l33p cycl3 h3lp5 9r4m5 f3nc3 d4v15 5p3n7 d14n4 n073d m1n0r 5h4m3 w4l35 m14m1 f474l fu22y l34d5 fl35h h073l 84nk5 k0r34 74m1l f1l3d f19h7 8y735 jud93 j3553 rur4l 71l35 qu3ry 5p34k 4n1m3 r0u73 f33d5 7r41n d3p7h 519n5 0c34n q474r 570r3 v0735 7ruck 5h33r d1390 qu33n w17ch c0h3n puppy k47hy 4l3r7 w4n75 319h7 3nd3d 8r13f c4rl0 cl1p5 73rm5 5m3ll 8l1nk r19h7 c4rry 57475 f4ll5 f4l53 5471n dr34m 8r41n pr0m0 l0c4l 74x35 7un35 h4rry l453r n4m3d 7h053 7r13d funny 54ny0 u51n9 734m5 k1nd5 c0d35 3qu4l luc14 clu85 n3rv3 ch4r7 dr4f7 r3n3w 0wn3d f1lm5 7ru7h 94mm4 50rry r34ch m0v3d ch41n f417h l0ck5 f4c75 48u53 v1ru5 3ur05 81r7h 4v01d r383l 5c00p l471n h1r3d 5m4r7 m0un7 53rv3 904l5 70uch ph0n3 h1ndu f0rum 8453d 7h3m3 50l1d h34vy k1ll5 l480r 70ur5 ur84n cr33k 84dly 5l0p3 5h0p5 573p5 l0u15 8394n n41l5 l1m17 wh475 r1d35 r3h48 pr1m3 upp3r d4735 ch3ck m3r17 fr35h j01n7 dru95 541n7 d15k5 c0nd0 4l0n3 54n74 f41ry 5h4f7 c4510 p47ch cl41m 1nd3x dr41n m0n73 f1r35 831n9 c0un7 cr1m3 5h1r7 p4n1c m070r l30n3 ph453 ch41r 0n10n w4573 c4n0n l483l 70d4y 83475 m3rry 5cu84 8uy3r v3rd3 73575 570n3 l1v35 dr13d wh053 c4ll5 l00k5 c3ll5 0ld3r 53v3n 5h337 p13c3 d3r8y 50u7h v3945 5u173 818l3 cl34n r0y4l 8391n h34rd p4935 91v35 ch13f fr4m3 574nd 5c4l3 4nn13 d3r3k f0und 5734l 8l095 f34r5 49r33 9r4n7 7un3r c0457 p34c3 4l1k3 ph070 w0r7h fully wh1l3 5493m h4nd5 wr0n9 f1x3d 50n95 5733l c1v1l 8l0ck 5c0u7 d34l7 8uck5 d4nc3 84d93 wr157 8r34k h347h y0u7h l3xu5 5p41n m4y83 900d5 57493 r34lm 53n53 y3m3n 0x1d3 pl4n7 8u535 1544c m47ch fl00r p4n3l 9r4d3 r0u93 y3457 mul71 7hr33 7ru57 533m5 9u357 7074l fund5 k3nny pl4c3 m374l yuk0n 5h1p5 wr073 un175 7r14l 9r4nd 51n9h 8r00k v4l1d 493n7 1npu7 8r1n9 w1v35 74k35 0wn3r l1575 x3r0x qu173 r473d 3x7r4 7h1nk 50r75 4w4rd v5n37 84515 p4pu4 4rm0r 174ly m4rc0 n0k14 34r7h 8l00d n0r7h 8u1l7 r0und p0575 r34dy 5p0r7 pr10r 7h4nk v1r4l p1p35 9l455 l4d3n 4ru84 f0rm5 m3r93 3d94r du841 c0m35 m3d14 v01c3 4ll4n 5p3rm f1lm3 cr4p5 fr057 54lly y4ch7 7r4cy r00m5 wh4l3 f0cu5 c4u53 4514n h0m35 4ll0w 1d345 51nc3 9u1d3 5h4rk 5h0wn 9r0w5 cl1ff 7r4c7 804rd 5c0r3 5m4ll c48l3 5h1n3 w0m4n j0yc3 w3ndy d1ff5 l34v3 020n3 n4m35 p4574 53rum un10n 5w1f7 l0w3r 1n80x f0c4l w33k5 cr055 54m84 45k3d 4pply l1n35 7yp35 8u1ld 71m35 pl4n5 v13w5 w0und 83ll3 4l8um 51735 l3v3l r1v3r c1ndy f0rc3 l1n3d n0735 3n7ry 5h035 l04n5 d01n9 f477y 57uff 80x3d cu81c 8r4nd 5p33d 4m0n9 4l0n9 5h0w5 8451c l473r wh0l3 5p135 qu1ck 3l3c7 c4535 kn0wn 74k3n 1nd14 m4k35 cl34r 710n5 3rr0r h34r7 fly3r l1nux w0rd5 d34l5 w47ch 0f73n 4pn1c 847h5 c0v3r 3m4c5 cl1m8 91f75 7h1rd 5p4rc ch34p d0v3r 7h1n9 4dul7 f1n4l rul35 w0rk5 70k3n 50und m1l35 34rly p4r75 fr0n7 57yl3 k1nd4 c0575 dyl4n 83l75 8urk3 h0ur5 d41ly m34n5 cl4r4 7r0u7 5h0r7 dr1v3 cl053 5p1n3 flu5h h4y35 7r4d3 l3457 7r4ck m0535 c0l0r j0hn5 un71l r4d10 j3w3l 73ddy p4x1l 1m493 dry3r 4dd3d 5h4r3 rul3d funky ch1ld j01n5 c4rd5 5p4c3 5c4ry 4r345 mp395 m4j0r m0n7h m19h7 c4k35 n33d5 ch1n4 m1x3r 3v3n7 717l3 f1l35 58jc7 91v3n 7007h x4n4x 0ff3r 574y5 dr0v3 wr173 up537 4ud10 c0ur7 m1n35 r4n93 155u3 l094n p0k3r n19h7 5h4ll cl455 p4p3r f13ld 571ll r4735 l4nc3 570ry qu073 84c0n n193r 480v3 l394l l091n c0l0n l4n35 pur53 83l0w 70p1c u53r5 n3v3r 4pr1l 4941n 4l19n 8l355 574ff cr357 57udy 901n9 y4h00 0r817 4ll0y m4rch pl075 7ul54 c453y 3v3ry dr4w5 hum4n 8l00m v1517 m0d3l 574r7 748l3 l4r93 l00p5 5ur93 74h03 54l35 700l5 p01n7 570ck 50ul5 5p4nk 8l4k3 pr1n7 l34rn v4ul7 r3ply pr355 v4lu3 m41l5 pd45 800m c4lm l1m3 r4r3 c475 cl4n y0ur h00d w45h w34r 5ync 0v3n 8495 m354 p3nn j422 1n70 f41l 8374 l375 f0n7 f0ld d053 p053 847h 51ck m394 d4mn f0rk r0ll 7r0y r34l 173m 5p1n 23r0 null 384y 7h1n c3n7 m0n0 4c1d 5p4m p493 m1n7 74p3 hull cup5 w1r3 mu57 71l3 cl1p 5335 m374 d0u9 8l0w 200m c0p3 d3ck h4v3 kn3w 5h3d h4n9 m3m0 10w4 71d3 p1p3 l4ck l135 n3x7 941n du7y funk p1ll c4p5 20p3 83nd m4d3 r33l 534l v1c3 h0n9 w4n9 71r3 81nd r4nd d35k m4r5 d15k 54nd 8uck l1n3 9m8h u595 u53d 5h03 4cr3 v13w v01d 71ll 1r0n cu75 51m5 l0w5 c7rl 4qu4 ch3n 3mm4 7r4y 470m 5345 c4f3 70n5 4ndy 51n9 p357 53m1 53nd 4pp5 fl49 f04m ch3f 41d5 50ul r33f 5l1p f3l7 c457 7yp3 c4k3 70dd hur7 1n7l 5493 w0rk m34l 94n9 ch4n 3nd5 k1ck ch4d 1c0n f175 837h hu90 8047 p03m d15c 93n3 j1ll m0m5 8008 l173 f0r7 c140 50f4 d14l luck 90n3 k473 kn33 pr3p lun9 d4n5 51lk k3n0 ch3m 5u53 cu84 w17h v111 f1ll qu17 c4mp f0ul l457 5n0w 74k3 j375 833n 1nch c4v3 73n7 d13d l34f 50n5 k0n9 m473 m057 35pn d3p7 h4ck d4r3 m4rc w00l r4nk 83l7 h4wk cr0p j05h 7u83 0n35 pr05 94v3 d474 l4m8 m0r3 r41l 71ny h1r3 0dd5 j4d3 w1n9 4r34 533m w4n7 m4k3 w153 7h3m n3ck 1p0d 8u5y c0d3 r1ch 713d 70n3 dr0p 9uy5 7r1m l0n3 7495 9473 3y3d l04d 5h0w p057 8lvd 3v3n junk 9r48 lucy 8u95 h4n5 80n3 l405 w34k p037 c4n7 w3r3 cl4y 00p5 l41d c17y 3p1c d33r m347 dr49 54k3 p1ck p33r 7h3y 0ur5 533d 7h47 r053 50l3 5p45 5uch w417 w4lk fu3l n30n p4r4 50f7 w4r3 54n5 7r4p 50m3 f00l l34n 745k m155 w1ld 8357 h347 cu73 pm1d j3w5 45k5 8ulk k4rl 7hru c0rd lu15 493d h00k m455 f007 5urf ju4n 5c4n 7h3n r1p3 much pr0c 80ld c0ld 834n 519n r3ly 9r3y 4l70 83d5 d135 f1l3 5h07 p1nk l1nk 0p3n r007 l1k3 h475 3x4m 90r3 3d93 cul7 d45h 0r4l l485 c493 kur7 x80x 4nn3 p41n n0rm 5p3c d1vx 54r4 p4lm m1lf hu9h w1nd 50ld 3v4l 904l j41l p1n9 84ll pump pl07 n1ck 8urn dvd5 7h4n jump 833f n31l f1rm 5173 9070 flux 9l3n l075 p373 934r 4rmy d137 5k1p mu23 w3ll c453 m1ll h4rm p450 0clc 0m4n n454 5m7p 54m3 ur93 80m8 r493 4d5l j04n pr1x l4w5 pull 8145 p47h duck n053 53p7 fl0w fl47 l10n 20n3 h175 7h41 w1f3 v01p 9r1d 807h 9035 1p4q h34r 3ch0 hun7 451n 4v0n l0rd 8y73 r4y5 c0mm f4rm 3y35 7h15 w4l7 p00r hd7v 50up 4cn3 7r1p d34d l185 und0 kn17 94m3 ch4r d1v3 l4c3 9375 d4n4 h4l0 0h10 m1d1 3r1k l4wn 4rch f1nd r1ck u9ly 94y5 741l f41r ch1p y4rn 158n 3x3c 9ulf h057 1nf0 c4r3 h4r7 5u17 d4rk r3n7 w00d 73nd 5375 m3n7 p1n3 c04l c0r3 d387 jury m45k r4p3 8175 7h0u 04k5 m4u1 f1j1 r4c3 80rn nc44 wh47 d473 p4ck 5c51 h19h m1n1 d0n7 p00l 9493 810l r357 d33p 80l7 80y5 1r4q 84ck 7w1n 4ud1 7485 r0w5 v1d5 r1n9 d0wn m4ry pr3v 5k1n f335 d4l3 34rn y4l3 34ch 0r9y 5hu7 3453 j4n3 j4v4 f070 r41d d00m u535 4514 j053 83n7 0w3n v0l7 8173 155n 7r30 8r4d d34r my7h 90d5 cur3 7135 d00r p0l3 4l4n m15c f337 drum 70ld w33d d1r7 5w1m c0mp rul3 03cd w4y5 pu5h p0ly 34r5 v073 phy5 w1n3 f157 d1c3 p1k3 9l0w qu4d d0ck 70p5 8007 m0d5 834m w4ll 7hu5 v3ry 7r33 m3r3 n4n0 m1lk 4n4l 4r48 r0m3 h41r h1n7 v4ry 94ry p41d c0n5 5h1p m513 j03l c0nf n3w5 4n71 h4ll w4k3 7r3k 74x1 8uy5 l4n9 qu12 f33d l00p l157 r1c3 54f3 h473 4c3r p0rk f4k3 m00d d157 cdn4 d3m0 wr4p 800k h0ld 9r4y d34l p155 m4p5 h1ll n0v4 r34d 84rn c01n 5394 f4r3 45u5 5l07 nu75 700l p4y5 84ld n33d n41l fuj1 d15h l30n m0ld d4m3 5123 m4ny 9r3w pu75 w0rn 1d34 f4ll h3r8 4l07 l473 5h4w u53r cn37 50n9 n4m3 74ll 700k 1dl3 m4l3 3xp0 541d v457 fund 933k 5p4n m0d3 50l0 n4vy w3n7 l34d 5h0p xnxx 84nd 4nn4 74nk c0rn 53n7 80wl 51nk m3n5 73x7 m1l3 n1c3 r055 l090 d3ny m0v3 k1nd 73mp 84l1 judy hu93 l0ck n0d3 m1c3 c0v3 7r10 r33d 8u5h c454 u5p5 h0ur cu83 f1n3 r34r r473 8055 7un3 n1k3 j0k3 l395 cr3w c4m3 921p 3d3n r0l3 1ncl w15h h0p3 ru95 m3nu 70ur 8483 l057 m1nd h3ld c4m5 w4rm 500n d035 01l5 r31d dr4w l3n5 r4ck fl3x 570p h3ll pur3 r054 dr3w h45h p0r7 533n 9r1p l42y l0ud cr4p f473 c45h v154 c4r8 p1c5 dru9 p3ru c0py f0rm w1n5 m34n 7urn p3n5 574y j34n 9l4d d0c5 h77p w477 9r45 w0rm r475 n34r 8453 80nd un1x d34f ph1l f4c3 l055 h7ml p0ll m475 r1c0 d34n l4mp ch47 d0ll 50ny y094 mp39 m35h l4k3 n0n3 4c75 8l4h m1m3 h0ly 573p p1n5 ru5h h4lf w4v3 50r7 r3n0 0v4l w1d3 f30f k3y5 luk3 l04n 50m4 1r4n 3x17 70y5 u5d4 ju57 573m 70wn k33n p345 un70 url5 501l 8d5m m1n5 r15k 84nk f33l k175 hr3f m337 83n2 73ch un17 f4c7 m41n f457 0wn5 3d17 fr0m 4u70 plu5 71p5 533k w1f1 713r 34rl 3l53 7ru3 k1d5 n75c p0l0 nud3 l053 0v3r 541l l1p5 81k3 p3rl 74lk c4ll k155 c00k w0rd 21nc r00f 9uru plu9 4935 3v3r l3vy h0rn 5747 ru8y r1c4 w4rd f347 9r4d k1ll 8r45 l4n3 d0n3 l4nd 54y5 9u4m up0n f1v3 c173 p457 w1ll kyl3 pr07 m41l 4r75 c047 c4rl 90ld fr09 lynn 83ll d4wn 54l7 p4l3 3995 48l3 73ll c4r5 74l3 5ur3 full 0nc3 p34k un1v 4w4y 53lf m355 c3ll w493 3ur0 94p5 l095 734r cru2 p4c3 4dd5 k3n7 f1lm 73rm n357 3v1l l1f3 0nly n470 8u77 punk k33p kn0w 94l3 53x0 y34h h4nd run5 9047 h3r0 wh3n w1k1 8105 m4r7 du57 574n 5n4p 710n 1d0l p41r p0ur r1d3 r0p3 p375 h0l3 345y 9un5 d1ff dump h0m3 0n70 r41n 4x15 534n f4m3 9r0w 800l 5p07 n1n3 f0ur f4q5 h053 91f7 r04d 5l0w clu8 p0nd 5l1m y34r 3457 m055 jp39 h1d3 80dy u74h y4rd 53ll f3ll h3r3 504p 4rm5 91v3 c0rk 51d3 5w4p p4rk 8347 7h33 m4l1 ru7h m4ll k3p7 8l09 pr4y w4r5 l355 d4y5 f34r c0l3 d0m3 l1f7 pl4y c0rp m00n fl1p p0p3 c4r7 mrn4 h157 d095 c0m3 pu85 p4r7 july m47h h33l 8ull wh0m 0k4y 4l50 y4n9 c057 f0lk c4p3 70ll 81d5 pl4n 1333 41m5 5347 d3ll jun3 p4d5 j33p l1v3 f4n5 h3lp n073 w33k 54v3 l4dy 734m l3f7 l00k 84r3 w357 j01n hun9 15l3 81rd r00m k1rk 8u22 r153 m1ld dum8 54l3 du4l 1nn5 nuk3 9r39 f00d n00n j085 84r5 c4rd 57ud y0rk 485 c37 97k lcd 0ur k17 rrp 810 3x7 p05 hu8 fwd j4n 9h2 73l 51m d4m d3r l12 d35 u7c q7y cu7 rn4 ccd 0r9 j4r 534 l18 7hu 0u7 455 cv5 l48 w17 h47 d4y 4u5 l47 cnn ml8 819 7u3 0n3 r0n c55 flu 0dd 40l hwy mh2 748 399 3p4 83n 000 3n7 n4m 53q 9nu r4w llp 83d plc 80c p1n l4w 7v5 9dp p19 r1d w1n 0p7 p33 n84 c48 c05 m47 504 ppc 1nc p4c l1l 3rp 55l f19 4r3 dvd d1v 1nk c4p 7mp d45 473 qu3 2u5 rpm 4r7 l05 l7d vpn 4cc fcc 1nn m4p cd5 l17 9p5 n3c 88w w3d j03 3d5 f1n un4 d47 d3f mud 70p un1 53n fr1 1r4 837 w4n m49 nh5 95m 4y3 mph w4x 74n 84n 1m9 p07 y0u d3l 5m5 d0n h4d 573 4d4 81d 21p n4v v4l 547 f3d w0w 517 pr3 5ql r35 71m nu7 l4n 7w0 jp9 m14 51x 945 urw ddr c91 c0m r3c m0n v1d j1m dn4 l0l 2um u5r d5l l4y l85 pd4 1ll c0l h1v d07 4l4 c4l 51c yr5 m1d f00 d1p n8c 1r5 ch0 pdf 8u9 3ur n0r u54 984 v11 8y3 cd7 j0n f0r w4y 54d d09 833 4n4 h1p 84r r1p 5rc 5py 1n5 15p 70y 4p1 qu1 18m 93l r0m mp9 703 84y 519 5ky du0 r4n d5c c45 cpu 4v9 c10 d0w k1m j0y 849 734 5r1 upc 88c du1 157 8u5 y3n f09 8uf 1p5 h3y d1r 53c llc mu9 717 51r 5h3 p3n l1d 817 01l 1c3 34u u53 7u8 3xp hr5 57r 10n m1l k3n fly v47 04k 0n5 7cp cfr pvc r0d d4n un3 cum www r0y 80w 530 m37 5k1 73x 70n f17 808 v1p m4d 5um 71p l4p c14 4nn p4d l35 cm5 rfc c4n 41m 150 4pp jun 50l 347 1d5 d0d m17 4ny 3c0 n30 jul 3v3 y34 c4d p0d 47m 540 847 u5d l33 r3p f4r 91f fur 3n8 0ld mr5 d05 p4r 74r 57d h0w r0w 71l v0l cup d3v p13 9uy 50c j37 84d 9mc kd3 nhl 4v1 4md w70 m0m h4y nfl d19 c30 p37 9ym 4cm v14 5y5 c57 d0c u5c 45p n47 4pr 4rc 0wn l1p 9cc w0n 490 54p d13 154 c47 3r4 ch1 4u9 r47 73n und url v4r 4l7 r08 9pl f4n pr0 l3d n07 533 93n v1c m4r 5u8 812 p5p p1x 1nd ru9 m1c du3 8mw p0r 45n 70m m0d 45k l07 53x dp1 h15 915 53p f38 xxx n3w 885 4mp 1d3 p57 fun 733 l0c p4l 54w p4n r10 03m f4q f47 l09 8uy rp9 d3m 94p w4v h0n 7r1 ppm j4y 1c7 14n k1d 1rc 90d up5 c0n 4n7 4k4 7ry 474 48c pu7 n1l 45h 5p4 n37 run 4p7 p4m dry r3f pmc h4m 200 crm 1nf 305 41d l13 m1n c0p m3l l39 713 r55 c0x 5un d1m vcr j4m ur1 l45 175 f33 m5n 93m y37 nyc dn5 f81 m3d 444 wh0 f4x r4y m3m pc1 f7p 8r4 w38 37c m41 pd7 m43 php 98p 79p n0v w4r 0ff u58 54m 34r cry l30 n5w f1x vh5 71n 3y3 h3r p4y 0c7 h45 1n9 n0n m1x 4ud h17 why 749 784 5u3 493 48u p51 513 d3n f3w 74p pc7 p7y d1y k3y m4y 9un 1n7 p0p 5ku n0w 4dd 4l1 r3d 4c7 phd 4d5 c85 h0p fd4 4nd 4r9 l37 r39 d75 73d qld p45 v4n 907 c0d m7v c1r 74x 3v4 m84 9u1 pu8 ph1 l3u d1d w45 rc4 54n v3r 537 51n r1m 3nd r3v d3c 23n wm4 m59 p1c 3d7 54y d15 930 957 5c1 ml5 c0w 80n 919 h07 7hy y35 545 d03 81n 50x h1m 4c3 8u7 41r l0u p47 4my xml k4y 471 m4x p9p d4d 9m7 111 v0n w4l m4c 94y 80x m45 7f7 51p 50n 357 5ur d33 m3n l3n 53r k41 700 4rm 1cq 3n9 80y pc5 d0m j08 jvc l0w f0x 4ll p17 r4m w37 937 p75 p3r c4m r4p c4r m4n 4v3 08j 7h3".split(' ');
</script>

<!--Key and Lock functions-->
<script>
//Now the ORIGINAL PASSLOK CODE BEGINS

//detect mobile and store in global Boolean variable. Learn mode detected by setlearnmode() below. Detect Basic mode. Who calls Key.
var isMobile = (typeof window.orientation != 'undefined');
var learnOn = false;
var callKey = '';
var BasicButtons = true;
var fullAccess = true;
var allowCancelWfullAccess = false;

//global variables used for key box expiration
var keytimer = 0;
var keytime = new Date().getTime();

//set global variables for lock DB functions
if(!("lockDB" in localStorage)) localStorage["lockDB"] = "{}";  //initialize lockDB, which is a nested object
var lockDB = JSON.parse(localStorage.lockDB);					//database in Object form
var lockNames = [''].concat(Object.keys(lockDB));				//array for finding lock names

//Regex for searching
var searchExp = new RegExp(wordlist.join("|"),"g");
var searchBlackExp = new RegExp(blacklist.join("|"),"g");

//Alphabets for base conversion. Used in making and reading the ezLok format
var BASE38 = '0123456789abcdefghijklmnopqrstuvwxyz+/';
//var BASE38out = '0123456789abcdefghijkLmnopqrstuvwxyz+/';		//uses capital L, which is often hard to tell from a 1 when printed
var BASE64 = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';

//function to test key strength and come up with appropriate key stretching. Based on WiseHash
function keyStrength(pwd,display) {
	var	keymsg = document.getElementById("keymsg"),
		decoymsg = document.getElementById("decoymsg"),
		intromsg = document.getElementById("intromsg"),
		keychangemsg = document.getElementById("keychangemsg");

	var entropy = entropycalc(pwd);

	if(entropy == 0){
		var msg = 'This is a known <span style="color:magenta">bad Key!</span>',
			iter = 4096
	}else if(entropy < 10){
		var msg = '<span style="color:magenta">Terrible!</span>',
			iter = 4096
	}else if(entropy < 20){
		var msg = '<span style="color:red">Weak!</span>',
			iter = 2048
	}else if(entropy < 40){
		var msg = '<span style="color:orange">Medium</span>',
			iter = 1024
	}else if(entropy < 60){
		var msg = '<span style="color:green">Good!</span>',
			iter = 512
	}else if(entropy < 80){
		var msg = '<span style="color:blue">Great!</span>',
			iter = 256
	}else{
		var msg = '<span style="color:cyan">Overkill  !!</span>',
			iter = 2
	}
	if(pwd.trim()==''){
		if(document.getElementById("decoyIn").style.display=="block"){
			msg = 'Enter the Decoy Password below'
		}else{
			msg = 'Enter your Key below'
		}
	}else{
		if (BasicButtons){
			msg = 'Key strength: ' + msg
		}else{
			msg = 'Key entropy: ' + Math.round(entropy*100)/100 + ' bits. ' + msg
		}
	}
if(display){																//these are to display the appropriate messages
	if(document.getElementById("keyscr").style.display=="block") keymsg.innerHTML = msg;
	if(document.getElementById("decoyIn").style.display=="block") decoymsg.innerHTML = msg;
	if(document.getElementById("introscr2").style.display=="block") intromsg.innerHTML = msg;
	if(document.getElementById("keyChange").style.display=="block") keychangemsg.innerHTML = msg;
}
	return iter
};

//takes a string and calculates its entropy in bits, taking into account the kinds of characters used and parts that may be in the general wordlist (reduced credit) or the blacklist (no credit)
function entropycalc(pwd){

//find the raw Keyspace
	var numberRegex = new RegExp("^(?=.*[0-9]).*$", "g");
	var smallRegex = new RegExp("^(?=.*[a-z]).*$", "g");
	var capRegex = new RegExp("^(?=.*[A-Z]).*$", "g");
	var base64Regex = new RegExp("^(?=.*[/+]).*$", "g");
	var otherRegex = new RegExp("^(?=.*[^a-zA-Z0-9/+]).*$", "g");

	pwd = pwd.replace(/\s/g,'');										//no credit for spaces

	var Ncount = 0;
	if(numberRegex.test(pwd)){
		Ncount = Ncount + 10;
	}
	if(smallRegex.test(pwd)){
		Ncount = Ncount + 26;
	}
	if(capRegex.test(pwd)){
		Ncount = Ncount + 26;
	}
	if(base64Regex.test(pwd)){
		Ncount = Ncount + 2;
	}
	if(otherRegex.test(pwd)){
		Ncount = Ncount + 31;											//assume only printable characters
	}

//start by finding words that might be on the blacklist (no credit)
	var pwd = reduceVariants(pwd);
	var wordsFound = pwd.match(searchBlackExp);							//array containing words found on the blacklist
	if(wordsFound){
		for(var i = 0; i < wordsFound.length;i++){
			pwd = pwd.replace(wordsFound[i],'');						//remove them from the string
		}
	}

//now look for regular words on the wordlist
	wordsFound = pwd.match(searchExp);									//array containing words found on the regular wordlist
	if(wordsFound){
		wordsFound = wordsFound.filter(function(elem, pos, self) {return self.indexOf(elem) == pos;})		//remove duplicates from the list
		var foundLength = wordsFound.length;							//to give credit for words found we need to count how many
		for(var i = 0; i < wordsFound.length;i++){
			pwd = pwd.replace(new RegExp(wordsFound[i], "g"),'');									//remove all instances
		}
	}else{
		var foundLength = 0;
	}

	pwd = pwd.replace(/(.+?)\1+/g,'$1');								//no credit for repeated consecutive character groups

	if(pwd != ''){
		return (pwd.length*Math.log(Ncount) + foundLength*Math.log(wordlist.length + blacklist.length))/Math.LN2
	}else{
		return (foundLength*Math.log(wordlist.length + blacklist.length))/Math.LN2
	}
}

//take into account common substitutions, ignore spaces and case
function reduceVariants(string){
	return string.toLowerCase().replace(/[o]/g,'0').replace(/[!i]/g,'1').replace(/[z]/g,'2').replace(/[e]/g,'3').replace(/[@a]/g,'4').replace(/[$s]/g,'5').replace(/[t]/g,'7').replace(/[b]/g,'8').replace(/[g]/g,'9').replace(/[]/g,'u');
}

//add entropy as forms are manipulated, optionally reset key box after 5 minutes
function ce() {
	sjcl.random.addEntropy(Math.floor((((new Date).getMilliseconds()) * 255) / 999), 2, "loadtime");
	//code below is an additional method to delete the Key box after 5 minutes. Not used at the moment
//	if ((new Date().getTime()) - keytime > 300000 && !document.getElementById('never').checked) {
//		document.getElementById('pwd').value = '';
//	}
};

//reads Key box and stops if there's something wrong. If the timer has run out, the Key is deleted
function readKey(){
	clearTimeout(keytimer);
	var period = 300000;

//start timer to erase Key
	if(!document.getElementById('never').checked){
		keytimer = setTimeout(function() {document.getElementById('pwd').value = ''}, period);
	}
	
//erase key at end of period, by a different way
	if ((new Date().getTime() - keytime > period) && !document.getElementById('never').checked) document.getElementById('pwd').value ='';
    keytime = new Date().getTime();

	var key = document.getElementById('pwd').value.trim();
	if (key == ""){
		any2key();
		if(callKey == 'initkey'){
			document.getElementById("keymsg").innerHTML = '<span style="color:green"><strong>Welcome to PassLok Privacy</strong></span><br />Please enter your secret Key';
		}else{
			document.getElementById("keymsg").innerHTML = 'Please enter your secret Key';
		}
		throw ('secret Key needed')
	}	
	return key
}

//reads email from its box. This is appended to the Key for public-key functions
function readEmail(){
	var email = document.getElementById('email').value;
	if (email == ""){
		any2email();
		throw ('email needed')
	};
	return email.trim()
}

//checks that the Key is the same as before, resumes operation
function acceptKey(){
	var key = document.getElementById('pwd').value.trim();
	if(key == ''){
		document.getElementById('keymsg').innerHTML = 'Please enter your Key';
		throw("no Key")
	}
	if(key.length < 4){
		document.getElementById('keymsg').innerHTML = '<span style="color:red">This Key is too short</span>';
		throw("short Key")
	}
	if(striptags(key).length == 87 || striptags(key).length == 100){
		document.getElementById('keymsg').innerHTML = '<span style="color:red">This is a Lock. Enter your Key here</span>';
		throw("lock instead of Key")
	}
	if(fullAccess && lockDB['myself']) checkKey(key);
	key2any();
}

//try decrypting the Lock in 'myself' to see if the Key is the same as the last one used
var checkingKey = false;
function checkKey(key){
	checkingKey = true;
	var myLockcrypt = lockDB['myself'][0];
	var myLockplain = keyDecrypt(key,myLockcrypt);
	checkingKey = false;
	return
}

//display Lock in the lower box of the Main tab.
function showLock(){
	callKey = 'showlock';
	var mainmsg = document.getElementById("mainmsg");				//for displaying messages above key box
		mainmsg.innerHTML = "";
	if (learnOn){
		var reply = confirm("The Lock matching the Key in this box will be placed in the lower box, replacing its contents. Cancel if this is not what you want.");
		if(reply===false) return;
	};
	var mykey = readKey();
	var myemail = readEmail();
	if(lockDB['myself'] && fullAccess){
		var mylockcrypt = lockDB['myself'][0];
		var mylock = keyDecrypt(mykey, mylockcrypt);
	}else{
		var mylock = makepub(mykey,myemail);						//append email to make Lock, to combat rainbow table attack
		if(fullAccess) storemyself(mykey,mylock);
	}
	if(document.getElementById('ezLok').checked){
		mylock = changeBase(mylock, BASE64, BASE38, true).replace(/l/g,'L');		//change smallcase l into capital
		var checksum = calcRScode(mylock);
		mylock = mylock.match(/.{1,5}/g).join("_");					//split into groups of five, for easy reading
		checksum = checksum.match(/.{1,5}/g).join("_");
		if (document.getElementById("notags").checked == false) mylock = "PL20ezLok=" + mylock + "=" + checksum + "=PL20ezLok";
	}else{
		if (document.getElementById("notags").checked == false) mylock = "PL20lok=" + mylock + "=" + calcRScode(mylock) + "=PL20lok"
	}
	document.getElementById('mainBox').value = triple(mylock);
	mainmsg.innerHTML = "The Lock matching your Key is in the box. Copy or email from here.";
	callKey = ''
};

function storemyself(mykey,mylock){
	var mylockcrypt = keyEncrypt(mykey,mylock);
	var newEntry = JSON.parse('{"myself":["' + mylockcrypt + '"]}');
	lockDB = sortObject(mergeObjects(lockDB,newEntry));
	if(lockDB['myself'][2] == null && fullAccess) storeEmail();
	localStorage.lockDB = JSON.stringify(lockDB);
	lockNames = [''].concat(Object.keys(lockDB));
	fillList();
}

//makes the public string of a private string
function makepub(secstr,salt){
	var curve = sjcl.ecc.curves["c521"],						//make curve object
		sec = toexponent(secstr,salt),								//retrieve Key, correctly formatted as an EC exponent
	    pub = curve.G.mult(sec),								//make public key or Lock
		pubstr = sjcl.codec.base64.fromBits(pub.toBits());
	return pubstr.slice(1,88)									//strip initial "A", only x part
};

//key reformatting and stretching for secret Key (shared key is formatted automatically by sjcl) for 521 bit keys
function toexponent(string,salt){
	var iter = keyStrength(string,false);						//get number of iterations from Key strength meter, Key only
	var w = sjcl.bitArray;
	return sjcl.bn.fromBits(w.bitSlice(sjcl.misc.scrypt(string,salt,iter,8,1,66)))	//iteration number variable according to Key strength, 528 bits
};

//this one makes the shared secret
function makeshared(secstr,xstr,salt){
	var curve = sjcl.ecc.curves["c521"],
		sec = toexponent(secstr,salt),
		ystr = yfromx(curve,'A' + xstr),				      	//retrieve y coordinate from x coordinate. Add the leading zero 'A' that SJCL adds because it uses 528 bits instead of 521
		pub = curve.fromBits(sjcl.codec.base64.toBits('A'+xstr+ystr)),  //make public key object containing both x and y
		sharedsec = pub.mult(sec),
		sharedstr = sjcl.codec.base64.fromBits(sharedsec.toBits());
	return sharedstr.slice(1,88)  								//strip spurious initial "A", only x part. The result is a legal Lock
};

function yfromx(curve,xstr){
	var x = sjcl.bn.fromBits(sjcl.codec.base64.toBits(xstr)),   //the following to retrieve y coordinate from x coordinate
		y = curve.b.add(x.mul(curve.a.add(x.square())));		//this is actually y^2, square root by special case of Tonelli-Shanks follows
	var i;
	for (i=0; i<519; i++) {
  		y = y.square();											//performs y^((p+1)/4), since p = 2^521 - 1, (p+1)/4=2^519, all is mod p
		};
	return sjcl.codec.base64.fromBits(y.toBits());
};

//this strips initial and final tags, plus spaces and non-base64 characters in the middle
function striptags(string){
	string = string.replace(/\s/g,'');															//remove spaces
	string = string.split("=").sort(function (a, b) { return b.length - a.length; })[0];		//remove tags
	string = string.replace(/[^a-zA-Z0-9+/ ]+/g, ''); 											//takes out anything that is not base64
	return string
}

nameBeingUnlocked = '';
//this function replaces an item with its value on the lockDB database, decrypted if necessary, if the name exists, otherwise if gives a warning that it isn't a Lock
function replaceByItem(name,warning){
	var warningList = "";
	if(lockDB[name] == null) {					//not on database; see if it's a Lock, and otherwise add to warning list
		var namestr = striptags(name);
		if(namestr.length != 87 && namestr.length != 100){
			warningList = name
		}
	} else {									//found name on DB, so get value from the database and decrypt if necessary
		var string = lockDB[name][0];
		if(string.charAt(0) == '~'){						//encrypted, so decrypt it now
			var	key = readKey();
			nameBeingUnlocked = name;
			var whole = keyDecrypt(key,string);
			nameBeingUnlocked = '';
		}else{
			var whole = string								//not encrypted
		}
		var	stripped = striptags(whole);
		if(stripped.length == 87 || stripped.length == 100) {name = stripped} else {name = whole};	//if it's a Lock, strip the tags
	}

	if (warningList != '' && warning){
		var agree = confirm('The following name was not found in your local directory. If you click OK, this string will be used as a shared Key for locking and unlocking the message. This could be a serious security hazard:\n\n' + warningList);
		if (!agree) throw('list encryption terminated by user')
	}
	return name
}

//changes the base of a number. inAlpha and outAlpha are strings containing the base code for the original and target bases, as in '0123456789' for decimal
//adapted from http://snippetrepo.com/snippets/bignum-base-conversion, by kybernetikos
function changeBase(number, inAlpha, outAlpha, isLock) {
	var targetBase = outAlpha.length,
		originalBase = inAlpha.length;
    var result = "";
    while (number.length > 0) {
        var remainingToConvert = "", resultDigit = 0;
        for (var position = 0; position < number.length; ++position) {
            var idx = inAlpha.indexOf(number[position]);
            if (idx < 0) {
                throw new Error('Symbol ' + number[position] + ' from the'
                    + ' original number ' + number + ' was not found in the'
                    + ' alphabet ' + inAlpha);
            }
            var currentValue = idx + resultDigit * originalBase;
            var remainDigit = Math.floor(currentValue / targetBase);
            resultDigit = currentValue % targetBase;
            if (remainingToConvert.length || remainDigit) {
                remainingToConvert += inAlpha[remainDigit];
            }
        }
        number = remainingToConvert;
        result = outAlpha[resultDigit] + result;
    }

	//add leading zeroes in Locks
	if(isLock){
		if(targetBase == 64 && result.length < 87){
			var padding = 'AAAAAAAAAAAAAAAAAAAA'.slice(0,87 - result.length);
			result = padding + result
		} else if (targetBase == 38 && result.length < 100){
			var padding = '0000000000000000000000'.slice(0,100 - result.length);
			result = padding + result
		}
	}
    return result;
}

//puts an 86-character randome string in the "email" boxes
function randomToken(){
	var token = sjcl.codec.base64.fromBits(sjcl.random.randomWords('17','0')).slice(0,86);
	document.getElementById('emailIntro').value = token;
	document.getElementById('email').value = token;
}
</script>

<!--error correction functions-->
<script>
//calculate the RS checksum for the item
function calcRScode(string){
	string = string.replace(/\s/g,'').replace(/[^a-zA-Z0-9+/~!@#$%*=]+/g,'');				//remove tags, spaces, etc.
	string = string.split("=");
	string = string.sort(function (a, b) { return b.length - a.length; })[0];
	if (string.length == 100) string = string.toLowerCase();								//ezLoks are case-insensitive
	if (string != '') {
		return extractRScode(string);
	}
}

//extract the second largest segment of a '=' separated string, which should be the RS checksum
function getRScode(string){
	string = string.replace(/[\s_]/g,'');														//remove spaces and line feeds
	string = string.split("=")																	//split into segments
	string = string.sort(function (a, b) { return b.length - a.length; })[1];				//get the second largest piece
	if (string == null) return '';
	string = string.toLowerCase();
	if (string.match('pl2') != null){
		string = ''																			//return nothing if it's an end tag
	}
	return string	
}

//verifies the RS checksum, if it exists, of the string and replaces the string with the stripped and corrected item
function applyRScode(string,isMsg){									//string also contains the checksum and possibly tags
	string = string.replace(/[\s_]/g,'');													//cleanup spaces etc
	var hexRS = getRScode(string);
	string = string.split("=");																//split into segments
	string = string.sort(function (a, b) { return b.length - a.length; })[0];				//get largest
	var groups = Math.ceil(string.length / 245);
	if (hexRS.length == groups * 20 && string.length != 87 && string.length != 100){		//found a complete checksum, so now use it, but not for a Lock
		if(isMsg){																			//flag invalid characters
			string = string.charAt(0).replace(/[^~!@#$*]/g,'') + string.slice(1).replace(/[^a-zA-Z0-9+/%]/g,'')	//locked msg
		}else{
			string = string.replace(/[^a-zA-Z0-9+/]/g,'')									//not a locked msg
		}
		return useHexRScode(string,hexRS)
	} else{
		return string
	}
}

//replaces Lock in the Directory tab with its corrected version
function applyRStoLock(){
	var lockmsg = document.getElementById('lockmsg');
		lockmsg.innerHTML = '';
	var text = document.getElementById('lockBox').value;
	var	strings = text.split(/\r?\n/);
	var lastline = strings[strings.length-1];
	if (lastline.slice(0,4) != 'http'){
		var lock = lastline;
		var restOfLocks = strings.slice(0,strings.length-1)
	}else{
		var lock = strings[strings.length-2]									//in case there is a video URL as last line
		var restOfLocks = strings.slice(0,strings.length-2)
	}
	lock = bestOfThree(lock);
	var hexRS = getRScode(lock);
	var lockstripped = lock.replace(/[\s_]/g,'').split("=").sort(function (a, b) { return b.length - a.length; })[0];
	
	if (lockstripped.length == 120){											//correct checksum, if written as part of ezLok
		hexRS = lockstripped.slice(100,120);
		lockstripped = lockstripped.slice(0,100);
		if(document.getElementById('notags').checked){
			document.getElementById('lockBox').value = lockstripped.match(/.{1,5}/g).join("_") + '=' + hexRS
		}else{
			document.getElementById('lockBox').value = 'PL20ezLok=' + lockstripped.match(/.{1,5}/g).join("_") + '=' + hexRS +'=PL20ezLok'
		}
	}
	if (lockstripped.length == 107){											//correct checksum, if written as part of regular lock
		hexRS = lockstripped.slice(87,107);
		lockstripped = lockstripped.slice(0,87);
		if(document.getElementById('notags').checked){
			document.getElementById('lockBox').value = lockstripped + '=' + hexRS
		}else{
			document.getElementById('lockBox').value = 'PL20lok=' + lockstripped + '=' + hexRS + '=PL20lok'
		}
	}
	suspendFindLock = true;															//allow writing a name without searching
	if (lockstripped.length != 87 && lockstripped.length != 100) return				//do nothing if it's not a Lock	
	if (hexRS.length == 20){														//found a complete code, so now check it
		lockstripped = lockstripped.replace(/[^a-zA-Z0-9+/]/g,'');					//flag invalid characters																
		document.getElementById('lockBox').value = (restOfLocks.join('\n') + '\n' + useHexRScode(lockstripped,hexRS)).trim();
		setTimeout(function(){lockmsg.innerHTML = "Lock detected and corrected per the tags";}, 500);		//add delay so this is seen
	}else{
		lockmsg.innerHTML = 'Lock detected';
	}
}

//convert a string into an array of decimal character codes
function string2charArray(string){
	var output = [];
	for(var i = 0;i < string.length; i++){
		output[i] = string.charCodeAt(i)
	};
	return output
}

//convert an array of 8-bit decimal codes into a hexadecimal string
function charArray2hex(charArray){
	var output = '';
	for(var i = 0;i < charArray.length; i++){
		var newstring = charArray[i].toString(16);
		if (newstring.length < 2) newstring = '0' + newstring;
		output = output + newstring
	};
	return output
}

//convert a hexadecimal string (two characters per byte) into an array of decimal codes. Wrong codes marked as -1
function hex2charArray(string){
	var output = [];
	for(var i = 0;i < string.length; i=i+2){
		var a = parseInt(string.slice(i,i+2),16);
		if(isNaN(a)){
			output[i/2] = -1
		}else{
			output[i/2] = a
		}
	};
	return output
}

//extract the RS code appended to each 255-character piece of a string
function extractRScode(string){
	var n = 10;
	var rs = new ReedSolomon(n);
	var enc = rs.encode(string);
	if (string.length <= 255 - n){
		var hexRS = charArray2hex(enc.slice(string.length))
	}else{
		var groups = Math.floor(string.length / (255 - n)) + 1;
		var hexRS = '';
		for (var i = 1; i <= groups; i++){
			if (i != groups){
				hexRS = hexRS + charArray2hex(enc.slice(255*i - n, 255*i))
			}else{
				hexRS = hexRS + charArray2hex(enc.slice(enc.length - n))
			}
		}
	};
	return hexRS
}

//use a hexadecimal RS code to correct its matching string
function useHexRScode(string,hexRS){
	var n = 10;
	var rs = new ReedSolomon(n);
	var RSarray = hex2charArray(hexRS);
	if (string.length <= 255 - n){
		var enc = flagInvalidChars(string2charArray(string));
		enc = enc.concat(RSarray)
	}else{
		var groups = Math.floor(string.length / (255 - n)) + 1;
		var enc = [];
		for (var i = 0; i < groups; i++){
			enc = enc.concat(flagInvalidChars(string2charArray(string.slice((255-n)*i,(255-n)*(i+1)))));
			enc = enc.concat(RSarray.slice(n*i,n*(i+1)))
		};	
	};
	return rs.decode(enc)	
}

//flag invalid PassLok characters as erasures
function flagInvalidChars(array){
	for(var i=0;i<array.length;i++){
		if(array[i] == 227) array[i] = -1
	}
	return array	
}

//takes string three times, separated by @ signs, if triple checkbox is on
function triple(string){
	if(document.getElementById('triple').checked){
		return string + '@' + string + '@' + string
	}else{
		return string
	}
}

//compare three versions of the same string, separted by commas, and come up with a good single version after errors, omissions, and additions are removed
function bestOfThree(text){
	var string = text.split('@');
	if(string.length < 3) return text;													//if less then three parts, take the first
	
	string = string.sort(function (x, y) { return x.length - y.length; });							//sort by size, longest first
	var result = '';
	for (var i = 0;i <= string[0].length; i++){
		if (string[0].charAt(i)==string[1].charAt(i)){												//find matches in two out of three
			result = result + string[0].charAt(i);
			if (string[0].charAt(i)!=string[2].charAt(i)){							//if the third is different, we need to do some work
				if(string[2].charAt(i)==string[0].charAt(i+1)){					//a character has been lost in string[2], so add it back
					var length2 = string[2].length;
					string[2] = [string[2].slice(0,i),string[0].charAt(i+1),string[2].slice(i,length2)].join('')
				} else if(string[2].charAt(i)==string[1].charAt(i+1)){
					var length2 = string[2].length;
					string[2] = [string[2].slice(0,i),string[1].charAt(i+1),string[2].slice(i,length2)].join('')
				} else if(string[2].charAt(i+1)==string[0].charAt(i) || string[2].charAt(i+1)==string[1].charAt(i)){	//a character has been added to string[2], so remove it
					var length2 = string[2].length;
					string[2] = [string[2].slice(0,i-1),string[2].slice(i,length2)].join('')
				}
			}
		}else if (string[0].charAt(i)==string[2].charAt(i)){
			result = result + string[0].charAt(i)
			if (string[0].charAt(i)!=string[1].charAt(i)){
				if(string[1].charAt(i)==string[0].charAt(i+1)){					//a character has been lost in string[1], so add it back
					var length2 = string[1].length;
					string[1] = [string[1].slice(0,i),string[0].charAt(i+1),string[1].slice(i,length2)].join('')
				} else if(string[1].charAt(i)==string[2].charAt(i+1)){
					var length2 = string[1].length;
					string[1] = [string[1].slice(0,i),string[2].charAt(i+1),string[1].slice(i,length2)].join('')
				} else if(string[1].charAt(i+1)==string[0].charAt(i) || string[1].charAt(i+1)==string[2].charAt(i)){	//a character has been added to string[1], so remove it
					var length2 = string[1].length;
					string[1] = [string[1].slice(0,i-1),string[1].slice(i,length2)].join('')
				}
			}			
		}else if (string[1].charAt(i)==string[2].charAt(i)){
			result = result + string[1].charAt(i)
			if (string[1].charAt(i)!=string[0].charAt(i)){
				if(string[0].charAt(i)==string[1].charAt(i+1)){					//a character has been lost in string[0], so add it back
					var length2 = string[0].length;
					string[0] = [string[0].slice(0,i),string[1].charAt(i+1),string[0].slice(i,length2)].join('')
				} else if(string[0].charAt(i)==string[2].charAt(i+1)){
					var length2 = string[0].length;
					string[0] = [string[0].slice(0,i),string[2].charAt(i+1),string[0].slice(i,length2)].join('')
				} else if(string[0].charAt(i+1)==string[1].charAt(i) || string[0].charAt(i+1)==string[2].charAt(i)){	//a character has been added to string[0], so remove it
					var length2 = string[0].length;
					string[0] = [string[0].slice(0,i-1),string[0].slice(i,length2)].join('')
				}
			}
		} else {																	//no match found in all three, can't find a solution
			var msg = 'No match in triple item. Maybe retry with a single item';
			if(tabLinks['dirTab'].className == ''){
				document.getElementById('mainmsg').innerHTML = msg
			}else{
				document.getElementById('lockmsg').innerHTML = msg
			}
			throw('no match in two out of three')
		}
	}
	return result
}
</script>

<!--cryptographic functions-->
<script>
var encrypting;		//global flag so decoy input doesn't get confused

//AES encryption process: determines the kind of encryption by looking at the radio buttons and check boxes under the main box and the length of the presumed Lock
//This function handles short mode encryption only (no List). Otherwise, Encrypt_List() is called
function Encrypt_single(){
	callKey = 'encrypt';
	var shortOn = document.getElementById("shortmode").checked,
		tagsOff = document.getElementById("notags").checked,
		signedOn = document.getElementById("signedmode").checked,
		pfsOn = document.getElementById("pfsmode").checked,
		onceOn = document.getElementById("oncemode").checked,
		anonOn = document.getElementById("anonmode").checked,
		mainmsg = document.getElementById("mainmsg"),
		lockmsg = document.getElementById("lockmsg"),
		name = lockmsg.innerHTML,
		clipped = false,
		secstr = document.getElementById('lockBox').value.trim();			//this will be the encrypting Lock or shared Key (if it's a name, it will be replaced with value)
	var	pubstr = striptags(secstr);
	if (secstr == ""){
		mainmsg.innerHTML = 'You must select a stored Lock, or go to the Directory tab and enter one.';
		throw("lock box empty");
	}
	var listArray = secstr.split('\n');		//see if this is actually several Locks rather than one

	if(document.getElementById('mainBox').value.length == 130){		//same length as a chat invite. Give warning and stop
		mainmsg.innerHTML = 'This message can be mistaken for a chat invite<br>Make it shorter or longer';
		return
	}

	if(!shortOn){								//Encrypt_single() handles only short mode, otherwise Encrypt_List() is used instead
		Encrypt_List(listArray);
		return
	}
	if (listArray.length > 1 && listArray[1].slice(0,4) != 'http'){			//this is a List, which is not compatible with short mode, video URLs on 2nd line don't count
		mainmsg.innerHTML = '<span style="color:red">Short mode not available for multiple recipients</span>';
		throw('multiple Locks for short mode')
	}
		pubstr = listArray[0].trim();					//strip video URL, if any
	var	pubstrhold = pubstr;							//to hold it, in case it is a name
	pubstr = replaceByItem(pubstr,true);				//if it's the name of a stored item, use the decrypted item instead, if not and it isn't a Lock, there will be a warning
	if (pubstr.length == 100) pubstr = changeBase(pubstr.toLowerCase(), BASE38, BASE64, true) 		//ezLok replaced by regular Lock

//now we do the different encryption modes

	if(pubstr.length != 87){							//key-locked mode, if no Lock is entered
		if (learnOn){
			var reply3 = confirm("The contents of the main box will be locked with the shared Key in the Locks box, and the result will replace the main box. Cancel if this is not what you want.");
			if(reply3==false) throw("sym encryption canceled");
		};
		secstr = replaceByItem(secstr,true);
		var iter = keyStrength(secstr,false);										//get number of iterations from Key strength meter
		var iv = sjcl.codec.base64.fromBits(sjcl.random.randomWords('2','0')),		//random initialization vector, 11 chars long
			salt = makesalt(iv,secstr,37,true),													//salt can hide 37 chars in short mode
			text = encodeURI(document.getElementById('mainBox').value).replace(/%20/g, ' ');
		if (text.length > 58) clipped = true;
			text = text + "                                                         ";  //clip or add spaces to make a 58 char message
			text = text.slice(0,58);
		var keystr = sjcl.codec.base64.fromBits(sjcl.misc.scrypt(secstr,salt,iter,8,1,33));				//scrypt key-stretching is applied here
		var cipherj = JSON.parse(sjcl.encrypt(keystr,text,{"iv":iv,"salt":salt,"ks":256,"iter":101}));
		if (learnOn){
			alert(name + " will need to place the same Key in the Locks box to unlock the message in the main box.");
		};
		document.getElementById('mainBox').value = "@" + cipherj.iv + cipherj.salt + cipherj.ct;
		if(isMobile){																	//get ready to put into SMS
			mainmsg.innerHTML = 'Locking successful. Copy and click SMS';
			selectMain()
		}
	}

	else if (pfsOn || onceOn){									//PFS and read-once modes not available for short messages
		mainmsg.innerHTML = 'PFS and Read-once modes are not available for Short messages';
		return
	}

	else if (signedOn){								//signed mode, make encryption key from secret Key and recipient's Lock
		if (learnOn){
			var reply3 = confirm("The contents of the main box will be locked with your secret secret Key and the Lock in the Locks box, and the result will replace the main box. Cancel if this is not what you want.");
			if(reply3 == false) throw("signed encryption canceled");
		};
		var key = readKey();
		var email = readEmail();
		if (lockDB[name] && fullAccess){
			var sharedKeycipher = lockDB[name][1];
		} else if(lockDB[pubstrhold] && fullAccess){
			var sharedKeycipher = lockDB[pubstrhold][1];
		}
		if (sharedKeycipher != null && fullAccess){
			var sharedKey = keyDecrypt(key,sharedKeycipher)
		} else {
			var sharedKey = makeshared(key,pubstr,email);								//add email to the key
			if (lockDB[name] && fullAccess){
				lockDB[name][1] = keyEncrypt(key,sharedKey);
				localStorage.lockDB = JSON.stringify(lockDB)

				if(testChromeSync()){											//if Chrome sync is available, change in sync storage
					syncChromeLock(name,JSON.stringify(lockDB[name]))
				}
			}
		}
		var iv = sjcl.codec.base64.fromBits(sjcl.random.randomWords('2','0')),
			salt = makesalt(iv,key,37,false),														//salt can hide 37 chars in short mode
			text = encodeURI(document.getElementById('mainBox').value).replace(/%20/g, ' ');
		if (text.length > 58) clipped = true;
			text = text + "                                                         ";  //clip or add spaces to make a 58 char message
			text = text.slice(0,58);
		var cipherj = JSON.parse(sjcl.encrypt(sharedKey,text,{"iv":iv,"salt":salt,"ks":256,"iter": 101}));
		if (learnOn){
			alert(lockmsg + " will need your Lock and his/her secret Key to unlock the message in the main box.");
		};
		document.getElementById('mainBox').value = "#" + cipherj.iv + cipherj.salt + cipherj.ct;
		if(isMobile){
			mainmsg.innerHTML = 'Locking successful. Copy and click SMS';
			selectMain()
		}
	}

	else if (anonOn){								//anonymous mode, using only the recipient's Lock
		if (learnOn){
			var reply = confirm("The contents of the main box will be locked with the Lock in the Locks box and the result will be placed in the main box. This is irreversible. Cancel if this is not what you want.");
			if(reply == false) throw("public encryption canceled");
		};
		if(name == '') name = "the recipient";
		var secstrdum = sjcl.codec.base64.fromBits(sjcl.random.randomWords('17','0')).slice(0,87),	//make dummy Key
			pubstrdum = makepub(secstrdum,'');															//makes 87 char dummy public key, initial A stripped
		var keystr = makeshared(secstrdum,pubstr,'');													//make AES key from dummy secret and recipient's public key
		var iv = sjcl.codec.base64.fromBits(sjcl.random.randomWords('2','0')),						//11 char serial in short mode, no salt
			salt = "",
			text = encodeURI(document.getElementById('mainBox').value).replace(/%20/g, ' ');
		if (text.length > 38) clipped = true;
			text = text + "                                                         ";  			//clip or add spaces to make a 38 char message
			text = text.slice(0,38);
		var cipherj = JSON.parse(sjcl.encrypt(keystr,text,{"iv":iv,"salt":salt,"ks":256,"iter": 101}));   //use 256 bit keys, min stretching for random key
		if (learnOn){
			alert(name + " will need to place his/her secret Key in the key box to unlock the message in the main box.");
		}
		document.getElementById('mainBox').value = cipherj.iv + cipherj.salt + pubstrdum + cipherj.ct;	//display adding dummy public key and anonymous tags, depending on mode
		if(isMobile){
			mainmsg.innerHTML = 'Locking successful. Copy and click SMS';
			selectMain()
		}
	}
	if (clipped) mainmsg.innerHTML = "<span style='color:orange'>The message has been truncated</span>"
	document.getElementById('decoyText').value = "";
	document.getElementById('decoyPwdIn').value = "";
	document.getElementById('decoyPwdOut').value = "";
	callKey = '';
};

//encrypts for a list of recipients. First makes a 256-bit message key, then gets the Lock or shared Key for each recipient and encrypts the message key with it
//the output string contains each encrypted key along with 66 bits of an encrypted form of the recipient's item, so he/she can find the right encrypted key
function Encrypt_List(listArray){
	var shortOn = document.getElementById("shortmode").checked,
		tagsOff = document.getElementById("notags").checked,
		signedOn = document.getElementById("signedmode").checked,
		pfsOn = document.getElementById("pfsmode").checked,
		anonOn = document.getElementById("anonmode").checked,
		onceOn = document.getElementById("oncemode").checked,
		mainmsg = document.getElementById("mainmsg"),
		lockmsg = document.getElementById("lockmsg");
	if(shortOn){
		mainmsg.innerHTML = '<span style="color:red">Short mode not available for multiple recipients</span>'
		throw('short mode not available')
	}
	var warningList = "";
	for (var index = 0; index < listArray.length; index++){						//scan lines and pop a warning if some are not names on DB or aren't Locks
		var name = listArray[index].trim();
		if (name.slice(0,4)=='http') {
			listArray[index] = '';
			name = ''
		}
		if (name != ''){
			if(lockDB[name] == null) {					//not on database; see if it's a Lock, and otherwise add to warning list
				var namestr = striptags(name);
				if(namestr.length != 87 && namestr.length != 100){
					if (warningList==""){warningList = name} else {warningList = warningList + '\n' + name}
				}
			}
		}
	}
	if (warningList != ''){
		var agree = confirm('The names on the list below were not found in your local directory. If you click OK, they will be used as shared Keys for locking and unlocking the message. This could be a serious security hazard:\n\n' + warningList);
		if (!agree) throw('list encryption terminated by user')
	}

	var	msgkey = sjcl.codec.base64.fromBits(sjcl.random.randomWords('8','0')).slice(0,43),		//message key a little over 256-bit
		iv = sjcl.codec.base64.fromBits(sjcl.random.randomWords('4','0')),
		text = document.getElementById('mainBox').value;
	if (anonOn) {
		if (learnOn){
			var reply = confirm("The contents of the main box will be anonymously locked with the Locks of the recipients listed, so that all of them can read it with their respective Keys, and the result will replace the main box. Cancel if this is not what you want.");
			if(reply == false) throw("anonymous list encryption canceled");
		}

		if(tagsOff){														//initial tag
			var outString = "!"
		} else {
			var outString = "PL20msa=!"
		}
	} else if(pfsOn){
		if (learnOn){
			var reply = confirm("The contents of the main box will be locked in PFS mode with the Locks of the recipients listed, so that all of them can read it with their respective Keys, and the result will replace the main box. Cancel if this is not what you want.");
			if(reply == false) throw("PFS list encryption canceled");
		}
		if(tagsOff){
			var outString = "$"
		} else {
			var outString = "PL20msp=$"
		}
	} else if(onceOn){
		if (learnOn){
			var reply = confirm("The contents of the main box will be locked in Read-once mode with the Locks of the recipients listed, so that all of them can read it with their respective Keys, and the result will replace the main box. Cancel if this is not what you want.");
			if(reply == false) throw("Read-once list encryption canceled");
		}
		if(tagsOff){
			var outString = "*"
		} else {
			var outString = "PL20mso=*"
		}
	} else {
		if (learnOn){
			var reply = confirm("The contents of the main box will be locked with the Locks of the recipients listed and signed with your Key, so that all of them can read it by supplying your Lock, and the result will replace the main box. Cancel if this is not what you want.");
			if(reply == false) throw("signed list encryption canceled");
		}
		if(tagsOff){
			var outString = "#"
		} else {
			var outString = "PL20mss=#"
		}
	}
	
	if (anonOn) {											//for anonymous mode, make dummy Lock. Make salt in all modes
		var secstrdum = sjcl.codec.base64.fromBits(sjcl.random.randomWords('17','0')).slice(0,87),
			pubstrdum = makepub(secstrdum,'');
		var salt = makesalt(iv,secstrdum,87,false);
	} else if(signedOn){
		var key = readKey();
		var salt = makesalt(iv,key,152,false);
	} else {
		var key = readKey();
		var salt = makesalt(iv,key,87,false);
	}
	
	var cipherj = JSON.parse(sjcl.encrypt(msgkey,text,{"iv":iv,"salt":salt,"ks":256,"iter":101}));		 //main encryption event, but don't add it yet
	outString = outString + cipherj.iv + cipherj.salt;
	if (anonOn) outString = outString + pubstrdum;							//for anonymous mode, add the dummy lock to the output string

	//for each item on the List (unless empty), encrypt the message key and add it, prefaced by the first 256 bits of the ciphertext when the item is encrypted with message iv and salt, and the shared key
	for (var index = 0; index < listArray.length; index++){
		var name = listArray[index].trim();
		if (name != ''){
			var secstr = replaceByItem(name,false);
			var pubstr = striptags(secstr);
			if (pubstr.length == 100) pubstr = changeBase(pubstr.toLowerCase(), BASE38, BASE64, true) 		//get Lock from ezLok
			if (pubstr.length == 87  || pfsOn){							//if it's a Lock, do anonymous, PFS or signed encryption, and add the result to the output
			
				if (signedOn){
					if (key == null) var key = readKey();
					var email = readEmail();
					if(lockDB[name]!=null && fullAccess){
						var sharedKeycipher = lockDB[name][1];			//permanent key shared with recipient, for encrypting the new dummy Lock
						if (sharedKeycipher != null){
							var sharedKey = keyDecrypt(key,sharedKeycipher);
						} else {
							var sharedKey = makeshared(key,pubstr,email);
							lockDB[name][1] = keyEncrypt(key,sharedKey);
						}
					} else {
						var sharedKey = makeshared(key,pubstr,email)
					}
					var	cipherj2 = JSON.parse(sjcl.encrypt(sharedKey,msgkey,{"iv":iv,"salt":salt,"ks":256,"iter": 101})),
						idtag = JSON.parse(sjcl.encrypt(sharedKey,pubstr,{"iv":iv,"salt":salt,"ks":256,"iter": 101}));

				} else if (anonOn){
					var sharedKey = makeshared(secstrdum,pubstr,'');
					var	cipherj2 = JSON.parse(sjcl.encrypt(sharedKey,msgkey,{"iv":iv,"salt":salt,"ks":256,"iter": 101})),
						idtag = JSON.parse(sjcl.encrypt(sharedKey,pubstr,{"iv":iv,"salt":salt,"ks":256,"iter": 101}));

				} else if (pfsOn || onceOn){
					if(lockDB[name] == null){
						if(lockDB[lockmsg.innerHTML] != null && listArray.length == 1){
							name = lockmsg.innerHTML
						} else {
							mainmsg.innerHTML = 'In PFS and Read-once modes, recipient Locks must be stored';
							throw('name not on lockDB')
						}
					}
					if (key == null) var key = readKey();
					var email = readEmail();
					var dualKeycipher = lockDB[name][1],
						turnstring = lockDB[name][4];
					if (turnstring=='next unlock'){
						if(onceOn){					//don't allow a switch in read-once mode, since it corrupts the exchange
							mainmsg.innerHTML = 'In Read-once mode, you cannot lock a new message before receiving a reply from all recipients. Use PFS mode instead.';
							throw('read-once locking aborted')						
						}
					}
					if (pubstr.length == 87){
						if (dualKeycipher != null){
							var dualKey = keyDecrypt(key,dualKeycipher);
						} else {
							var dualKey = makeshared(key,pubstr,email);
							lockDB[name][1] = keyEncrypt(key,dualKey);
						}
						var pfsSalt = ''
					}else{
						var dualKey = secstr;
						var pfsSalt = ''
					}
					var lastLockcipher = lockDB[name][3];					//retrieve dummy Lock from storage, [0] is the permanent Lock by that name
					if (lastLockcipher != null) {								//if dummy exists, decrypt it first
						var lastLock = keyDecrypt(key,lastLockcipher);
					} else {													//use permanent Lock, minus tags, if dummy doesn't exist
						if (pubstr.length == 87){
							var lastLock = pubstr
						}else{
							var lastLock = makepub(secstr,'');
						}
					}
					var secstrdum = sjcl.codec.base64.fromBits(sjcl.random.randomWords('17','0')).slice(0,87),		//different dummy key for each recipient
						pubstrdum = makepub(secstrdum,'');
					if (pfsOn){
						var sharedKey = makeshared(secstrdum,lastLock,pfsSalt);
					}else{
						var lastKeycipher = lockDB[name][2];								//read-once mode uses last Key and last Lock
						if (lastKeycipher != null){
							var lastKey = keyDecrypt(key,lastKeycipher);
							var pfsSalt = ''
						} else {															//use permanent Key if dummy doesn't exist
							if (pubstr.length == 87){
							var pfsSalt = email;
							var lastKey = key
							}else{
								var pfsSalt = '';
								var lastKey = pubstr
							}
						}
						var sharedKey = makeshared(lastKey,lastLock,pfsSalt);
					}
					lockDB[name][2] = keyEncrypt(key,secstrdum);				//new Key is stored in the permanent database
					lockDB[name][4] = 'next unlock';
					localStorage.lockDB = JSON.stringify(lockDB);

					if(testChromeSync()){										//if Chrome sync is available, change in sync storage
						syncChromeLock(name,JSON.stringify(lockDB[name]))
					}
				//sharedKey depends on the newLock, so use the permanent shared Key instead for making the idtag and encrypting the newLock
					var	cipherj2 = JSON.parse(sjcl.encrypt(sharedKey,msgkey,{"iv":iv,"salt":salt,"ks":256,"iter": 101})),
						idtag = JSON.parse(sjcl.encrypt(dualKey,pubstr,{"iv":iv,"salt":salt,"ks":256,"iter": 101})),
						newLockcipher = JSON.parse(sjcl.encrypt(dualKey,pubstrdum,{"iv":iv,"salt":salt,"ks":256,"iter": 101}));
				}
				
			} else {														//if it's not a Lock, do a symmetric encryption instead, with appropriate key stretching
				var iter = keyStrength(secstr,false),
					keyStretched = sjcl.codec.base64.fromBits(sjcl.misc.scrypt(secstr,salt,iter,8,1,33)),
					cipherj2 = JSON.parse(sjcl.encrypt(keyStretched,msgkey,{"iv":iv,"salt":salt,"ks":256,"iter":101})),
					idtag = JSON.parse(sjcl.encrypt(secstr,secstr,{"iv":iv,"salt":salt,"ks":256,"iter":101}));
			}
			if (pfsOn || onceOn){
				outString = outString + '%' + idtag.ct.slice(0,11) + '%' + newLockcipher.ct + cipherj2.ct;
			} else {
				outString = outString + '%' + idtag.ct.slice(0,11) + '%' + cipherj2.ct;
			}
		}
	}

	//finish off by adding the encrypted message and tags
	outString = outString + '%' + cipherj.ct
	if (tagsOff) {
			document.getElementById('mainBox').value = outString
	} else {
		if(anonOn){
			document.getElementById('mainBox').value = triple(outString + "=" + calcRScode(outString) + "=PL20msa")
		} else if(pfsOn){
			document.getElementById('mainBox').value = triple(outString + "=" + calcRScode(outString) + "=PL20msp")
		} else if(onceOn){
			document.getElementById('mainBox').value = triple(outString + "=" + calcRScode(outString) + "=PL20mso")
		} else {
			document.getElementById('mainBox').value = triple(outString + "=" + calcRScode(outString) + "=PL20mss")
		}
	}
	mainmsg.innerHTML = 'Locking successful. Select and copy.'
	callKey = '';
}

//decrypts a string encrypted with the secret Key, 11 char serial, no salt, variable key stretching
function keyDecrypt(key,cipherstring){
	cipherstring = cipherstring.slice(1);							//take out the initial '~'
	var	iv = cipherstring.slice(0,11),
		ct = cipherstring.slice(11,cipherstring.length),
		iter = keyStrength(key,false);
	var keyStretched = sjcl.codec.base64.fromBits(sjcl.misc.scrypt(key,'',iter,8,1,33));
	var cipherstr2 = '{"iv":"' + iv + '","salt":"' + '' + '","ct":"' + ct + '","ks":256,"iter":101}';
	return sjcl.decrypt(keyStretched,cipherstr2)
}

//encrypts a string with the secret Key, 11 char serial, no salt, variable key stretching
function keyEncrypt(key,plainstring){
	var	iv = sjcl.codec.base64.fromBits(sjcl.random.randomWords('2','0')),				//minimum iterations = 101
		iter = keyStrength(key,false);
	var keyStretched = sjcl.codec.base64.fromBits(sjcl.misc.scrypt(key,'',iter,8,1,33));
	var cipherj2 = JSON.parse(sjcl.encrypt(keyStretched,plainstring,{"iv":iv,"salt":"","ks":256,"iter":101}));
	return '~' + cipherj2.iv + cipherj2.ct
}

//encrypts a hidden message into the salt value used by regular encryption, or makes a random salt also encoded by AES so it's indistinguishable
function makesalt(iv,dummykey,leng,keyLocked){
	if (document.getElementById("decoymode").checked){
		if (learnOn){
			var reply = confirm("You are adding a hidden message in Decoy mode. Cancel if this is not what you want, then uncheck Decoy mode in Options.");
			if(!reply) throw("decoy encryption canceled");
		};
		if ((document.getElementById('decoyPwdIn').value.trim() == "")||(document.getElementById('decoyText').value.trim() == "")){ //stop to display the decoy entry form if there is no hidden message or key
			document.getElementById("decoyIn").style.display = "block";				//display decoy form, and back shadow
			document.getElementById("shadow").style.display = "block";
			if(!isMobile) document.getElementById('decoyText').focus();
			throw ("stopped for decoy input")
		}
		var key = document.getElementById('decoyPwdIn').value,
			text = encodeURI(document.getElementById('decoyText').value.replace(/%20/g, ' '));
			key = replaceByItem(key,false);													//if in database, get the real item
		var keyStripped = striptags(key);
		
		if (keyStripped.length == 87 || keyStripped.length == 100){						//the key is a Lock, so do asymmetric encryption
			if (keyStripped.length == 100) keyStripped = changeBase(keyStripped.toLowerCase(), BASE38, BASE64, true) //ezLok replaced by regular Lock			
			if (keyLocked || document.getElementById('anonmode').checked){		//anonymous or Key-locked mode, make shared key from given Lock and dummy key
				key = makeshared(dummykey,keyStripped,'');
			}else{															//signed/PFS mode, make shared key from given Lock and regular Key
				var mykey = readKey();
				var email = readEmail();
				key = makeshared(mykey,keyStripped,email);
			}			
			var iter = 2;
		}else{																		//symmetric encryption
			var iter = keyStrength(key,false);										//key may be weak, so stretch it
		}
		
	} else {																		//no decoy mode, so salt comes from random text and key, no extra stretching
		var key = sjcl.codec.base64.fromBits(sjcl.random.randomWords('8','0')),
			text = sjcl.codec.base64.fromBits(sjcl.random.randomWords('57','0')).slice(0,214),
			iter = 2;
	};
	while (text.length < leng) {															//clip or add spaces to make the number of characters required
			text = text + "          ";
	};
	text = text.slice(0,leng);		
	var keyStretched = sjcl.codec.base64.fromBits(sjcl.misc.scrypt(key,'',iter,8,1,33));
	var cipherj = JSON.parse(sjcl.encrypt(keyStretched,text,{"iv":iv,"salt":"","ks":256,"iter":101}));
	document.getElementById('decoyPwdIn').value = "";
	document.getElementById('decoyText').value = "";
	return cipherj.ct;
};

//AES decryption process: determines which kind of encryption by looking at first character after the initial tag. Calls Encrypt_single as appropriate
function Decrypt_single(){
	callKey = 'decrypt';
	encrypting = true;
	var decoyOn = document.getElementById("decoymode").checked,
		fullAccess = fullAccess,
		keymsg = document.getElementById("keymsg"),
		mainmsg = document.getElementById("mainmsg"),
		lockmsg = document.getElementById("lockmsg");
	keymsg.innerHTML = "";
	mainmsg.innerHTML = "";
	if(document.getElementById('lockBox').value.slice(0,1) == '~') decryptItem();	//if Lock or shared Key is encrypted, decrypt it
	var name = lockmsg.innerHTML,
		cipherstr = bestOfThree(document.getElementById('mainBox').value.trim()),
		secstr = document.getElementById('lockBox').value.trim().split('\n')[0];
	if (cipherstr == ""){
			mainmsg.innerHTML = 'Nothing to lock or unlock';
			throw("main box empty");
	};
	cipherstr = applyRScode(cipherstr,true);														//RS error correction													

	//here detect if the message is for multiple recipients, and if so call the appropriate function
	var cipherArray = cipherstr.split('%');
	if(cipherArray.length > 3){
		if (cipherArray[1].length == 11){
			Decrypt_List(cipherArray);
			
			var typetoken = document.getElementById('mainBox').value;
			if (typetoken.length == 130){								//chat invite detected, so open chat
				document.getElementById('mainBox').value = '';
				var date = typetoken.slice(0,43).trim();				//the first 43 characters are for the date and time etc.
				if(date != ''){
					var reply = confirm("This chat invitation says:\n\n" + date + "\n\nIf you go ahead, the chat session will open now");
					if(reply===false){
						document.getElementById('mainBox').value = '';
						throw("chat start canceled");
					}
				}			
				main2chat(typetoken.slice(43));
			}
			
			return
		}
	}

	var pubstr = striptags(secstr);													//this holds a Lock or shared Key (or a name leading to it)
	var type = cipherstr.slice(0,1);													//get encryption type. !=anonymous, @=symmetric, #=signed, $=PFS, ~=Key-encrypted
		cipherstr = cipherstr.replace(/[^a-zA-Z0-9+/ ]+/g, '');					//remove anything that is not base64

	if (cipherstr.length == 160){					//short anonymous decryption
		if (learnOn){
			var reply = confirm("The short message in the main box was locked with your personal Lock, and will now be unlocked if your secret Key has been entered, replacing the locked message. Cancel if this is not what you want.");
			if(reply == false) throw("public decryption canceled");
		};																		//make sure there is no List in Lock box
		var key = readKey();
		var email = readEmail();
		var	iv = cipherstr.slice(0,11),												//get iv, salt, and later ct data and public key
			salt = "";
		var pubstrdum = cipherstr.slice(11,98);
		var keystr = makeshared(key,pubstrdum,email);
		var	ct = cipherstr.slice(98,cipherstr.length);
		cipherstr = '{"iv":"' + iv + '","salt":"' + salt + '","ct":"' + ct + '","ks":256,"iter":101}';	//add labels and keylength to data, minimum keystretching
		document.getElementById('mainBox').value = decodeURI(sjcl.decrypt(keystr,cipherstr)).trim();
		if(!decoyOn) mainmsg.innerHTML = 'Unlock successful'
	}

	else if (type == "~"){																//secret Key encrypted item, such as a complete lockDB database
		if (learnOn){
			var reply = confirm("The message in the main box was locked with your secret Key, and will now be unlocked if your secret Key has been entered. If it is a database it will be placed in the Locks screen so you can merge it into the stored database. If it contains settings, they will replace your current setings, including the email/token.  Cancel if this is not what you want.");
			if(reply == false) throw("secret Key decryption canceled");
		};
		cipherstr = '~' + cipherstr;													//add back the type indicator, since RS code was made with it
		cipherstr = applyRScode(cipherstr,true);
		var key = readKey();
		document.getElementById('lockBox').value = keyDecrypt(key,cipherstr);
		if(document.getElementById('lockBox').value.slice(0,6) == 'myself'){		//string contains settings; add them after confirmation

			var reply = confirm("If you click OK, the settings from the backup will replace the current settings, possibly including a random token. This cannot be undone.");
			if (reply == false) throw("settings restore canceled");

			mergeLockDB();
			document.getElementById("mainmsg").innerHTML = 'The settings have been replaced with those in this backup';
			document.getElementById('lockBox').value = ''
		}else{																		//stored local directory; display so it can be edited
			document.getElementById("lockmsg").innerHTML = 'Extracted items. Click <strong>Merge</strong> to add them to the local directory.';
			main2lock();
		}
	}


	else if (type == "#"){							//signed decryption
		if (learnOn){
			var reply = confirm("The message in the main box was locked with your Lock and the sender's Key, and will now be unlocked, replacing the locked message, if your secret Key has been entered. Cancel if this is not what you want.");
			if(reply == false) throw("signed decryption canceled");
		};
		if (pubstr == ''){
			mainmsg.innerHTML = "<span style='color:red'>Identify the sender or enter his/her Lock</span>";
			throw("lock box empty");
		}
		var key = readKey();
		var email = readEmail();
		if (lockDB[name] == null){
			name = pubstr;																//try again using the string in the lockBox as name
		}
		if (lockDB[name] && fullAccess) var sharedKeycipher = lockDB[name][1];
		if (sharedKeycipher != null){
			var sharedKey = keyDecrypt(key,sharedKeycipher)
		} else {
			pubstr = replaceByItem(pubstr,false);
			if (pubstr.length == 100) pubstr = changeBase(pubstr.toLowerCase(), BASE38, BASE64, true) 		//replace ezLok with standard
			var sharedKey = makeshared(key,pubstr,email)
			if (lockDB[name] && fullAccess) {
				lockDB[name][1] = keyEncrypt(key,sharedKey);
				localStorage.lockDB = JSON.stringify(lockDB);

				if(testChromeSync()){													//if Chrome sync is available, change in sync storage
					syncChromeLock(name,JSON.stringify(lockDB[name]))
				}
			}
		}
		var	iv = cipherstr.slice(0,11),
			salt = cipherstr.slice(11,71),
			ct = cipherstr.slice(71,cipherstr.length);
		if (decoyOn) decoydecrypt(iv,pubstr,salt);
		var cipherstr2 = '{"iv":"' + iv + '","salt":"' + salt + '","ct":"' + ct + '","ks":256,"iter":101}';
		if (cipherstr.length == 159){
			document.getElementById('mainBox').value = decodeURI(sjcl.decrypt(sharedKey,cipherstr2)).trim();
			if (!decoyOn) mainmsg.innerHTML = 'Unlock successful'
		}else{
			document.getElementById('mainBox').value = decodeURI(sjcl.decrypt(sharedKey,cipherstr2));
			if (!decoyOn) mainmsg.innerHTML = 'Unlock successful'
		}
	}

	else if (type == "@"){							//symmetric decryption
		if (learnOn){
			var reply2 = confirm("The message in the main box was locked with a shared Key, and will now be unlocked if the same Key is present in the Locks box. The result will replace the locked message. Cancel if this is not what you want.");
			if(reply2 == false) throw("sym decryption canceled");
		};
		if (secstr == ''){
			mainmsg.innerHTML = '<span style="color:red">Enter shared Key</span>';
			throw("symmetric key empty");
		}
		secstr = replaceByItem(secstr,false);										//if it's a name in the box, get the real item
		var	iv = cipherstr.slice(0,11),
			salt = cipherstr.slice(11,71),
			ct = cipherstr.slice(71,cipherstr.length);
		var keystr = secstr;
		if (decoyOn) {
			var decoylock = makepub(keystr,'');
			decoydecrypt(iv,decoylock,salt);
		}
		var iter = keyStrength(keystr,false);										//get number of iterations from Key strength meter
		var keystr=sjcl.codec.base64.fromBits(sjcl.misc.scrypt(keystr,salt,iter,8,1,33));
		var cipherstr2 = '{"iv":"' + iv + '","salt":"' + salt + '","ct":"' + ct + '","ks":256,"iter":101}';
		document.getElementById('mainBox').value = decodeURI(sjcl.decrypt(keystr,cipherstr2)).trim();
		if (!decoyOn) mainmsg.innerHTML = 'Unlock successful'
	}else{
		Encrypt_single()																//none of the known encrypted types, therefore encrypt rather than decrypt
	};
	callKey = '';
};

//decrypts a message encrypted for multiple recipients. Encryption can be signed, anonymous, or symmetric
function Decrypt_List(cipherArray){
	encrypting = true;
	var decoyOn = document.getElementById("decoymode").checked,
		keymsg = document.getElementById("keymsg"),
		mainmsg = document.getElementById("mainmsg"),
		lockmsg = document.getElementById("lockmsg");
	keymsg.innerHTML = "";
	mainmsg.innerHTML = "";
	var name = lockmsg.innerHTML,
		type = cipherArray[0].slice(0,1);													//type is 1st character
	for (var i=0; i < cipherArray.length; i++){
		cipherArray[i] = cipherArray[i].replace(/[^a-zA-Z0-9+/ ]+/g, '')				//take out anything that is not base64
	}
	var iv = cipherArray[0].slice(0,22);
	if (type == '!' || type == '$' || type == '*') {														//anonymous of PFS, shorter salt because of the dummy Lock
		var salt = cipherArray[0].slice(22,149),
			pubstrdum = cipherArray[0].slice(149,236);									//dummy Lock
	} else {
		var salt = cipherArray[0].slice(22,236)
	}
	var ct = cipherArray[cipherArray.length - 1],										//exclude the type flag
		secstr = document.getElementById('lockBox').value.trim().split('\n')[0],	//should be single Lock or shared Key, maybe a name
		secstrhold = secstr;
	secstr = replaceByItem(secstr,false);												//if it's a name, replace it with the decrypted item, no warning
	var	pubstr = striptags(secstr);
	if (pubstr.length == 100) pubstr = changeBase(pubstr.toLowerCase(), BASE38, BASE64, true) 				//ezLok case
	if(lockDB['myself'] == null) key2any();												//make this entry if it has been deleted
	if (decoyOn){																			//decoy decryption
		if (type == '!'){
			decoydecrypt(iv,pubstrdum,salt);
		}else{
			if (pubstr.length == 87){
				var decoylock = pubstr
			}else{
				var decoylock = makepub(secstr,'')
			}
			decoydecrypt(iv,decoylock,salt);
		}
	}
	//now make the idtag to be searched for, depending on the type of encryption. First the shared Key that encrypts the idtag

	if (type == '#' || type == '$' || type == '*'){				//signed mode first, PFS and read-once are the same at this point
		if (learnOn){
			var reply = confirm("The contents of the message in the main box will be unlocked with your secret Key, provided the sender's Lock or shared Key are in the in the Locks box. Cancel if this is not what you want.");
			if(reply == false) throw("signed list decryption canceled");
		}
		if (pubstr == ''){
			mainmsg.innerHTML = "<span style='color:red'>Enter the sender's Lock or shared Key</span>";
			throw("lock box empty");
		}
		if (key == null) var key = readKey();
		var email = readEmail();
		if (pubstr.length == 87){															//assuming this is a Lock, not a shared Key. See below for the other case
			if (lockDB[name] && fullAccess){																//get permanent shared Key from storage, or make it if not stored
				var sharedKeycipher = lockDB[name][1];
			}else if(lockDB[secstrhold] && fullAccess){													//get name from Lock box instead of message
				name = secstrhold;
				var sharedKeycipher = lockDB[name][1];
			}
			if (sharedKeycipher != null){
				var sharedKey = keyDecrypt(key,sharedKeycipher)
			} else {																		//no shared key found, so making a new one
				var sharedKey = makeshared(key,pubstr,email);
				if (lockDB[name] && fullAccess) {
					lockDB[name][1] = keyEncrypt(key,sharedKey);
					localStorage.lockDB = JSON.stringify(lockDB);

					if(testChromeSync()){													//if Chrome sync is available, change in sync storage
						syncChromeLock(name,JSON.stringify(lockDB[name]))
					}
				}
			}
			var string = lockDB['myself'][0];
			secstr = keyDecrypt(key,string);												//this contains my Lock
		} else {																			//assuming it's a regular shared Key in common with the sender
			var sharedKey = secstr;
		}

	} else {										//anonymous mode
		if (learnOn){
			var reply = confirm("The contents of the message in the main box will be unlocked with your secret Key. Cancel if this is not what you want.");
			if(reply===false) throw("anonymous list decryption canceled");
		}
		if (pubstr.length == 87 || pubstr == '' || pubstr.split('\n').length > 1){		//test for Lock, empty, multiline(has video URL, since Lists have been filtered by now)
			if (key == null) var key = readKey();
			var email = readEmail();
			var sharedKey = makeshared(key,pubstrdum,email),
				string = lockDB['myself'][0];
			secstr = keyDecrypt(key,string);
		} else {																		//use a shared Key instead
			var sharedKey = secstr	;
		}
	}
	var iter = keyStrength(sharedKey,false);										//should be 2 for everything except bad shared Keys
	var keyStretched = sjcl.codec.base64.fromBits(sjcl.misc.scrypt(sharedKey,salt,iter,8,1,33));
	var	idtag = JSON.parse(sjcl.encrypt(sharedKey,secstr,{"iv":iv,"salt":salt,"ks":256,"iter":101})).ct.slice(0,11);
	
	//look for the id tag and return the string that follows it
	for (i = 1; i < cipherArray.length; i++){
		if (idtag == cipherArray[i]) {
			var msgkeycipher = cipherArray[i+1];
		}
	}
	if(typeof msgkeycipher == 'undefined'){
		mainmsg.innerHTML = 'No message found for you';
		throw('idtag not found')
	}
	//got the encrypted message key, now decrypt it, and finally the main message. The process for PFS and read-once modes is more involved
	if (pubstr.length != 87 && pubstr.length != 0 && type != '$' && type != '*'){
		var keyStretched = sjcl.codec.base64.fromBits(sjcl.misc.scrypt(sharedKey,salt,iter,8,1,33))
		var cipherstr2 = '{"iv":"' + iv + '","salt":"' + salt + '","ct":"' + msgkeycipher + '","ks":256,"iter":101}',
			msgkey = sjcl.decrypt(keyStretched,cipherstr2).trim();
	} else if (type != '$' && type != '*'){
		var cipherstr2 = '{"iv":"' + iv + '","salt":"' + salt + '","ct":"' + msgkeycipher + '","ks":256,"iter":101}',
			msgkey = sjcl.decrypt(sharedKey,cipherstr2).trim();

	//for PFS mode, first we separate the encrypted new Lock from the proper message key, then decrypt the new Lock and combine it with the stored Key (if any) to get the ephemeral shared Key, which unlocks the message Key
	} else {
		var newLockcipher = msgkeycipher.slice(0,127);
		msgkeycipher = msgkeycipher.slice(127,msgkeycipher.length);
		var cipherstr2 = '{"iv":"' + iv + '","salt":"' + salt + '","ct":"' + newLockcipher + '","ks":256,"iter":101}',
			newLock = sjcl.decrypt(sharedKey,cipherstr2).trim();
		if(!lockDB[name]) name = secstrhold;													//if the name is not displayed, try with the content of the lock box
		if(!lockDB[name]){																	//if it still doesn't work, message and bail out
			mainmsg.innerHTML = 'The sender must be in the directory';
			throw('sender not in directory')
		}
		var lastKeycipher = lockDB[name][2],												//retrieve dummy Key from storage
			turnstring = lockDB[name][4];													//this strings says whose turn it is to encrypt
		if (turnstring=='next lock'){
			if(type == '*'){
				window.setTimeout(function(){mainmsg.innerHTML = 'Read-once messages can only be unlocked once'},5000)				
			}
		}
		if (lastKeycipher != null) {
			var lastKey = keyDecrypt(key,lastKeycipher);
			var pfsSalt = ''
		} else {																			//if a dummy Key doesn't exist, use permanent Key
			if (pubstr.length == 87){
				var lastKey = key;
				var pfsSalt = email
			}else{
				var lastKey = secstr;
				var pfsSalt = ''
			}
		}
		if(type == '$'){																	//PFS mode
			var	keystr = makeshared(lastKey,newLock,pfsSalt);
		}else{																				//Read-once mode														
			var lastLockcipher = lockDB[name][3];											//short mode uses last Key and last Lock
			if (lastLockcipher != null) {													//if dummy exists, decrypt it first
				var lastLock = keyDecrypt(key,lastLockcipher)
			} else {																		//use permanent Lock, minus tags, if dummy doesn't exist
				if (pubstr.length != 87 && pubstr.length != 100){
					if(lockDB[pubstr]) pubstr = replaceByItem(pubstr,false)					//if it's a name, get the actual Lock
				}
				if (pubstr.length == 100) pubstr = changeBase(pubstr.toLowerCase(), BASE38, BASE64, true) 		//get Lock from ezLok
				if (pubstr.length == 87){
					var lastLock = pubstr;
				}else{
					var lastLock = makepub(pubstr,'')
				}
			}
			var	keystr = makeshared(lastKey,lastLock,pfsSalt);
		}
			var cipherstr2 = '{"iv":"' + iv + '","salt":"' + salt + '","ct":"' + msgkeycipher + '","ks":256,"iter":101}';
		var	msgkey = sjcl.decrypt(keystr,cipherstr2).trim();
		lockDB[name][3] = keyEncrypt(key,newLock);										//store the new dummy Lock
		lockDB[name][4] = 'next lock';
		localStorage.lockDB = JSON.stringify(lockDB);

		if(testChromeSync()){																//if Chrome sync is available, change in sync storage
			syncChromeLock(name,JSON.stringify(lockDB[name]))
		}
	}
	var cipherstr = '{"iv":"' + iv + '","salt":"' + salt + '","ct":"' + ct + '","ks":256,"iter":101}';
	document.getElementById('mainBox').value = sjcl.decrypt(msgkey,cipherstr);

	if (!decoyOn) mainmsg.innerHTML = 'Unlock successful';
	callKey = '';
}

//decrypt the message hidden in the salt, for decoy mode
function decoydecrypt(iv,dummylock,ct){
	var mainmsg = document.getElementById("mainmsg");
	mainmsg.innerHTML = "";
	if (learnOn){
		var	key2 = prompt("Decoy mode is selected, so please write the Password used to lock the hidden message. If you don't expect a hidden message, uncheck Decoy mode below.");
	} else {
	if (document.getElementById('decoyPwdOut').value.trim() == ""){					//stop to display the decoy key entry form if there is no key entered
		document.getElementById("decoyOut").style.display = "block";
		document.getElementById("shadow").style.display = "block";
		if(!isMobile) document.getElementById('decoyPwdOut').focus();
		throw ("stopped for decoy input")
	}
	var key2 = document.getElementById('decoyPwdOut').value;
		key2 = replaceByItem(key2,false);											//use stored item, if it exists
	dummylock = replaceByItem(dummylock,false);
	var lockstripped = striptags(dummylock);
	if (lockstripped.length == 100) lockstripped = changeBase(lockstripped.toLowerCase(), BASE38, BASE64, true);
	var keyold = key2;
	var	iter = keyStrength(key2,false);
	document.getElementById('decoyPwdOut').value = ""
	};
	if(!document.getElementById('shareddecOut').checked){							//asymmetric mode, so now make the real encryption key
		var email = readEmail();
		key2 = makeshared(key2,lockstripped,email);
		iter = 2;
	}
	var keyStretched = sjcl.codec.base64.fromBits(sjcl.misc.scrypt(key2,'',iter,8,1,33))
	var	cipherstr2 = '{"iv":"' + iv + '","salt":"' + "" + '","ct":"' + ct + '","ks":256,"iter":101}';
	mainmsg.innerHTML = 'Hidden message: <span style="color:blue">' + decodeURI(sjcl.decrypt(keyStretched,cipherstr2)) + '</span>'
};

//takes a SHA512 hash of the plaintext and generates an ECDSA signature
function applySignature(){
	callKey = 'sign';
	var keymsg = document.getElementById("keymsg"),
		mainmsg = document.getElementById("mainmsg");
		keymsg.innerHTML = "";
		mainmsg.innerHTML = "";
	if (learnOn){
		var reply = confirm("A signature matching the contents of the main box will be made using your secret Key, and the resulting signature will be added to the end of the main box. Cancel if this is not what you want.");
		if(reply == false) throw("signature canceled");
	};
	var secstr = readKey();
	var email = readEmail();
	var pubstr = striptags(secstr),
		hash = sjcl.hash.sha512.hash(document.getElementById('mainBox').value.trim()),		//take SHA512 hash of trimmed plaintext
		sec = toexponent(secstr,email),
		curve = sjcl.ecc.curves["c521"],
		R = curve.r,
		l = R.bitLength(),
    	k = sjcl.bn.random(R.sub(1), 0).add(1),
    	r = curve.G.mult(k).x.mod(R),
		s = sjcl.bn.fromBits(hash).add(r.mul(sec)).mul(k.inverseMod(R)).mod(R),
		sigstr = sjcl.codec.base64.fromBits(sjcl.bitArray.concat(r.toBits(l), s.toBits(l))),	//make it base64
		iv = sjcl.codec.base64.fromBits(sjcl.random.randomWords('2','0')),						//for hidden message, if activated
		padding = makesalt(iv,secstr,36,false);
	var outString = sigstr.slice(1,sigstr.length) + iv.slice(0,11) + padding;
	if (document.getElementById("notags").checked === false){
			//strip initial "A" and add decoy iv & padding and tags
		document.getElementById('mainBox').value = document.getElementById('mainBox').value + "\n\n" + triple("PL20sig=" + outString + "=" + calcRScode(outString) + "=PL20sig");
	}else{
		document.getElementById('mainBox').value = document.getElementById('mainBox').value + "\n\n" + triple(outString)
	}
	callKey = ''
};

//verifies the ECDSA signature of a hash of the plaintext, calls applySignature as appropriate. Algorithm from SJCL ecc.js, but not the latest version
function verifySignature(){
	encrypting = false;
	var keymsg = document.getElementById("keymsg"),
		lockmsg = document.getElementById("lockmsg"),
		mainmsg = document.getElementById("mainmsg");
		keymsg.innerHTML = "";
		mainmsg.innerHTML = "";
	var text = document.getElementById('mainBox').value.trim();
	if (text == ""){																				//nothing in text box
		mainmsg.innerHTML = '<span style="color:red">Nothing to sign or verify</span>';
		throw("no text")
	};
	if(document.getElementById('lockBox').value.slice(0,1)=='~') decryptItem();
	var	sign = text.split(/\r?\n/);
		sign = sign[sign.length-1];														//this is a signature if added as last line of text
		sign = bestOfThree(sign);
	var sigstr = applyRScode(sign,false);
	if (!(sigstr.length == 245)){															//no signature tag, therefore making sign
		applySignature();
		throw("no signature, creating one")
	};
	var	pubstr = document.getElementById('lockBox').value.trim();
	if (pubstr == ""){
		mainmsg.innerHTML = 'Enter a Lock to verify the signature.';
		throw("no lock present")
	};
	if (learnOn){
		var reply = confirm("The text in the main box has been signed with somebody's secret Key. I will now verify if the sign is correct for this text and the matching Lock, which should be present in the Locks box, and will display the result in a popup. Cancel if this is not what you want.");
		if(reply == false) throw("sign verification canceled");
	};
		pubstr = striptags(pubstr);
	if (pubstr.length != 87 && pubstr.length != 100){											//not a Lock, but maybe it's a name
		if (lockDB[pubstr]) pubstr = replaceByItem(pubstr,false);
	}
	if (pubstr.length == 100) pubstr = changeBase(pubstr.toLowerCase(), BASE38, BASE64, true) 		//ezLok replaced by regular Lock
	if (pubstr.length != 87){
		mainmsg.innerHTML = '<span style="color:red">Enter a valid Lock</span>';
		throw("invalid public key")
	};
		text = text.replace(/\r?\n?[^\r\n]*$/, "");												//remove last line
	var hash = sjcl.hash.sha512.hash(text.trim()),												//take SHA512 hash of plaintext, ignoring initial and end spaces
		curve = sjcl.ecc.curves["c521"],
		xstr = "A" + pubstr.slice(0,pubstr.length),
		ystr = yfromx(curve,xstr),
	 	pub = curve.fromBits(sjcl.codec.base64.toBits(xstr+ystr)),
		rs = sjcl.codec.base64.toBits("A" + sigstr.slice(0,175)),								//recover signature part
		w = sjcl.bitArray,
        R = curve.r,
        l = R.bitLength(),
        r = sjcl.bn.fromBits(w.bitSlice(rs,0,l)),
        s = sjcl.bn.fromBits(w.bitSlice(rs,l,2*l)),
		u = s.inverseMod(R),
        hG = sjcl.bn.fromBits(hash).mul(u).mod(R),
        hA = r.mul(u).mod(R),
		check = true,
		r2 = curve.G.mult2(hG, hA, pub).x.mod(R);
		if (!r2.equals(r)){																		//hack from when y is the wrong root of y^2
			var y = sjcl.bn.fromBits(sjcl.codec.base64.toBits(ystr)),
				p = curve.field.modulus.copy(),
				y2 = p.sub(y),																		//this should be the right y
				ystr2 = sjcl.codec.base64.fromBits(y2.toBits());
			pub = curve.fromBits(sjcl.codec.base64.toBits(xstr+ystr2));
			r2 = curve.G.mult2(hG, hA, pub).x.mod(R);
		};																							//end of wrong root hack
	if (r.equals(0) || s.equals(0) || r.greaterEquals(R) || s.greaterEquals(R) || !r2.equals(r)) check = false;
	if (check) {
		mainmsg.innerHTML = '<span style="color:green">The signature is VERIFIED</span>'
		}
	else {
		mainmsg.innerHTML = '<span style="color:magenta">The signature has FAILED verification</span>'
		};
	if (document.getElementById("decoymode").checked){								//this part to extract the hidden message, if it exists
		var iv = sigstr.slice(175,186),
			padding = sigstr.slice(186,245);
		decoydecrypt(iv, pubstr, padding);
	};
};
</script>

<!--extra functions for mail, etc.-->
<script>
//displays how many characters are left, in Short mode and in Decoy In box
function charsLeft(){
	var mainmsg = document.getElementById("mainmsg");
	var chatmsg = document.getElementById("chatmsg");
	var decoymsg = document.getElementById("decoymsg");	
	if(document.getElementById('decoyIn').style.display == 'block'){					//for decoy message box
		var chars = encodeURI(document.getElementById('decoyText').value).replace(/%20/g, ' ').length;
		if(!encrypting){
			var limit = 36																//signature, 36 chars
		} else {
			if(document.getElementById("shortmode").checked){
				var limit = 37															//short, signed or key-locked, 37 chars
			} else {
				if(document.getElementById("anonmode").checked){						//anonymous mode, 87 chars
					var limit = 87
				} else if(document.getElementById("signedmode").checked){				//signed mode, 152 chars
					var limit = 152
				} else if(document.getElementById("pfsmode").checked){					//pfs mode, 87 chars
				var limit = 87
				}
			}
		}
		if (chars <= limit){
			decoymsg.innerHTML = chars + " characters out of " + limit + " used"
		} else {
			decoymsg.innerHTML = '<span style="color:orange">Maximum length exceeded. The message will be truncated</span>'
		}
		return
	}
	
	//this one is for the text in the chat making dialog
	if(document.getElementById("chatDialog").style.display == 'block'){
		var chars = encodeURI(document.getElementById('chatdate').value).replace(/%20/g, ' ').length;
		var limit = 43;
		if (chars <= limit){
			chatmsg.innerHTML = chars + " characters out of " + limit + " used"
		} else {
			chatmsg.innerHTML = '<span style="color:orange">Maximum length exceeded. The message will be truncated</span>'
		}
		return
	}
	
	//Now for main box. Don't do anything unless it's short mode
	if(document.getElementById("shortmode").checked){
		var chars = encodeURI(document.getElementById('mainBox').value).replace(/%20/g, ' ').length;
		if(document.getElementById("anonmode").checked){								//anonymous mode, 38 chars
			var limit = 38
		} else if(document.getElementById("signedmode").checked){						//signed mode, 58 chars
			var limit = 58
		} else {																			//pfs and read-once modes not available
			mainmsg.innerHTML = '<span style="color:orange">PFS ans Read-once not available in Short mode</span>';
			return
		}
		if (chars <= limit){
			mainmsg.innerHTML = chars + " characters out of " + limit + " used"
		} else {
			mainmsg.innerHTML = '<span style="color:orange">Maximum length exceeded. The message will be truncated</span>'
		}
	} else {
		mainmsg.innerHTML = "";
	}
}

//formats results depending on tags present and sends to default email
function sendMail() {
	var	mainmsg = document.getElementById("mainmsg");
		mainmsg.innerHTML = "";
	if (learnOn){
		var reply = confirm("A new tab will open, including the contents of this box in your default email. You still need to supply the recipient's address and a title. Only Locks and locked or signed text are allowed. Cancel if this is not what you want.");
		if(reply===false) throw("email canceled");
	};
	if (lockDB['myself']){
		var mylock = lockDB['myself'][0],
			key = document.getElementById("pwd").value;
		if (key.trim() == '') {any2key(); return}
		mylock = triple('PL20lok=' + keyDecrypt(key,mylock) + '=PL20lok')		//this contains my Lock
	} else {
		mylock = 'Lock not attached'
	}
	var cipherstr = document.getElementById('mainBox').value;
	cipherstr = cipherstr.split("=").sort(function (a, b) { return b.length - a.length; })[0];
	var type = cipherstr.slice(0,1);
if (document.getElementById("notags").checked === false){							//add tags if checked, add explanatory text
	if(type==="!"){
    	var link = "mailto:"+ "?subject=" + "&body=Anonymous message locked with PassLok v.2.0 %0D%0A%0D%0AUnlock with your secret Key. %0D%0A%0D%0A" + encodeURIComponent(document.getElementById('mainBox').value) + "%0D%0A%0D%0AHere's my Lock if you want to reply to me:%0D%0A%0D%0A" + encodeURIComponent(mylock) + "%0D%0A%0D%0AGet PassLok at https://passlok.com";
	} else if (type==="@"){
		var link = "mailto:"+ "?subject=" + "&body=Message locked with PassLok v.2.0 %0D%0A%0D%0AUnlock with shared Key. %0D%0A%0D%0A" + encodeURIComponent(document.getElementById('mainBox').value) + "%0D%0A%0D%0AHere's my Lock if you want to reply to me:%0D%0A%0D%0A" + encodeURIComponent(mylock) + "%0D%0A%0D%0AGet PassLok at https://passlok.com";
	} else if (type==="#"){
		var link = "mailto:"+ "?subject=" + "&body=Signed message locked with PassLok v.2.0 %0D%0A%0D%0AUnlock with your secret Key and my Lock. %0D%0A%0D%0A" + encodeURIComponent(document.getElementById('mainBox').value) + "%0D%0A%0D%0AHere's my Lock if you want to reply to me:%0D%0A%0D%0A" + encodeURIComponent(mylock) + "%0D%0A%0D%0AGet PassLok at https://passlok.com";
	} else if (type==="$"){
		var link = "mailto:"+ "?subject=" + "&body=PFS message locked with PassLok v.2.0 %0D%0A%0D%0AUnlock with your secret Key and my Lock. %0D%0A%0D%0A" + encodeURIComponent(document.getElementById('mainBox').value) + "%0D%0A%0D%0AHere's my Lock if you want to reply to me:%0D%0A%0D%0A" + encodeURIComponent(mylock) + "%0D%0A%0D%0AGet PassLok at https://passlok.com";
	} else if (type==="*"){
		var link = "mailto:"+ "?subject=" + "&body=Read-once message locked with PassLok v.2.0 %0D%0A%0D%0AUnlock with your secret Key and my Lock. %0D%0A%0D%0A" + encodeURIComponent(document.getElementById('mainBox').value) + "%0D%0A%0D%0AHere's my Lock if you want to reply to me:%0D%0A%0D%0A" + encodeURIComponent(mylock) + "%0D%0A%0D%0AGet PassLok at https://passlok.com";
	} else if (type==="~"){
		var link = "mailto:"+ "?subject=My PassLok database" + "&body=Database locked with PassLok v.2.0 %0D%0A%0D%0AUnlock with my secret Key. %0D%0A%0D%0A" + encodeURIComponent(document.getElementById('mainBox').value);
	} else if (cipherstr.length==87 || cipherstr.replace(/_/g,'').length==100){
		var link = "mailto:"+ "?subject=" + "&body=This is my PassLok v.2.0 Lock, use it to send me messages and verify my signature. %0D%0A%0D%0A" + encodeURIComponent(document.getElementById('mainBox').value) +"%0D%0A%0D%0AGet PassLok at https://passlok.com";
	} else if (cipherstr.length===160){
		var link = "mailto:"+ "?subject=" + "&body=Short message locked with PassLok v.2.0 %0D%0A%0D%0AStrip everything but the locked message and unlock normally.%0D%0A%0D%0A" + encodeURIComponent(document.getElementById('mainBox').value) + "%0D%0A%0D%0AHere's my Lock if you want to reply to me:%0D%0A%0D%0A" + encodeURIComponent(mylock) + "%0D%0A%0D%0AGet PassLok at https://passlok.com";
	} else if (cipherstr.length===245){
		var link = "mailto:"+ "?subject=" + "&body=The following is a text signed with PassLok v.2.0. Verify using my Lock, which is this:%0D%0A%0D%0A" + encodeURIComponent(mylock) + "%0D%0A%0D%0AGet PassLok at https://passlok.com%0D%0A%0D%0AThe text, followed by the signature,  BEGINS BELOW THIS LINE:%0D%0A%0D%0A" + encodeURIComponent(document.getElementById('mainBox').value);

	} else {																		//may be a longish signed text, so try a little harder
		var cipherstrArray = document.getElementById('mainBox').value.split('\n'),
			length = cipherstrArray.length,
			cipherstr = cipherstrArray[length-1];
		cipherstr = cipherstr.split("=").sort(function (a, b) { return b.length - a.length; })[0];
		if (cipherstr.length==245){
			var link = "mailto:"+ "?subject=" + "&body=The following is a text signed with PassLok v.2.0. Verify using my Lock, which is this:%0D%0A%0D%0A" + encodeURIComponent(mylock) + "%0D%0A%0D%0AHere's my Lock if you want to reply to me:%0D%0A%0D%0A" + encodeURIComponent(mylock) + "%0D%0A%0D%0AGet PassLok at https://passlok.com";
		} else {
			mainmsg.innerHTML = 'Only Locks, and locked or signed text are allowed for Email';
			throw("illegal text")
		}
	}
}else{																				//tags unchecked, no extra text
	if((type=="!")||(type=="@")||(type=="#")||(type=="$")||(type=="*")||(cipherstr.length==87)||(cipherstr.length==100)||(cipherstr.length==245)||(cipherstr.length==160)){
		var link = "mailto:"+ "?subject=" + "&body=" + encodeURIComponent(document.getElementById('mainBox').value);
	}else{
		mainmsg.innerHTML = '<span style="color:red">Only Locks, and locked or signed text are allowed for Email</span>';
		throw("illegal text")
	}
}
	if(isMobile){ 	 											//new window for PC, same window for mobile
		window.open(link,"_parent")
	} else {
		window.open(link,"_blank")
	}
}

//calls texting app (works on mobile only)
function sendSMS(){
	if(isMobile){
		if (learnOn){
			var reply = confirm("The default texting app will now open. You need to have copied your short locked message to the clipboard before doing this, if you want to send one. This only works in smartphones. Cancel if this is not what you want.");
			if(reply===false) throw("SMS canceled");
		};
		window.open("SMS:","_parent")							//open SMS on mobile
	} else {
		document.getElementById('mainmsg').innerHTML = 'SMS function is only available on mobile devices'
	}
};

//decrypts a chat invite if found, then open chat screen, otherwise make one. If the chat screen is open, returns to it
function Chat(){
	if(document.getElementById('extrabuttonsbot').style.display == 'block'){	//do nothing if the button is not visible
		box2cover();
		return
	}
	
	if(document.getElementById('chatframe').src.match('#')){			//chat already open, so open that screen
		document.getElementById('chatscr').style.display = 'block';
		return
	}
	
	var mainmsg = document.getElementById('mainmsg');
	var cipherstr = bestOfThree(document.getElementById('mainBox').value.trim());
	var listArray = document.getElementById('lockBox').value.trim().split('\n');
	cipherstr = applyRScode(cipherstr,true);												//RS error correction													

	//here detect if the message in the box is a chat invite
	var cipherArray = cipherstr.split('%');
	if (striptags(cipherArray[cipherArray.length-1]).length == 184){
		
		if(isSafari || isIE || isiOS){
			mainmsg.innerHTML = 'Sorry, but chat is not yet supported by your browser or OS';
			throw('browser does not support webRTC')
		}
		
		if (learnOn){
			var reply = confirm("This chat invitation will now be unlocked, and a secure chat session will start in a new screen. Cancel if this is not what you want.");
			if(reply===false) throw("chat canceled");
		};
		
		Decrypt_List(cipherArray);
		var invite = document.getElementById('mainBox').value;
		document.getElementById('mainBox').value = '';
		var date = invite.slice(0,43).trim();			//the first 43 characters are for the date and time etc.
		if(date != ''){
			var reply = confirm("This chat invitation says:\n\n" + date + "\n\nIf you go ahead, the chat session will open now");
			if(reply===false){
				document.getElementById('mainBox').value = '';
				throw("chat start canceled");
			}
		}
		main2chat(invite.slice(43));
		
	} else {																//no chat invite detected, so make one
		if (learnOn){
			var reply = confirm("A special locked item will be made, inviting the selected recipients to a secure chat session. Cancel if this is not what you want.");
			if(reply===false) throw("chat invite canceled");
		};
	
		if(listArray[0] == '' || (listArray[0] == 'myself' && listArray.length == 1)){
			mainmsg.innerHTML = 'Please select those invited to chat';
			throw("nobody invited to chat");
		}
		listArray = listArray.concat('myself');							//make sure 'myself' is on the list
		listArray = listArray.filter(function(elem, pos, self) {return self.indexOf(elem) == pos;});  			//remove duplicates and nulls
		listArray = listArray.filter(function(n){return n});
		document.getElementById('lockBox').value = listArray.join('\n');
		openClose('shadow');
		openClose('chatDialog');												//stop to get chat type	
	}
}

//continues making a chat invite after the user has chosen the chat type
function makeChat(){
	closebox();
	if(document.getElementById('datachat').checked){
		var type = 'A'
	}else if (document.getElementById('audiochat').checked){
		var type = 'B'
	}else{
		var type = 'C'
	}
	var date = (document.getElementById('chatdate').value + '                                           ').slice(0,43);
	document.getElementById('mainBox').value = date + type + sjcl.codec.base64.fromBits(sjcl.random.randomWords('16','0')).replace(/=/g,'');
	var listArray = document.getElementById('lockBox').value.trim().split('\n');
	Encrypt_List(listArray);
	document.getElementById('mainBox').value = document.getElementById('mainBox').value.replace(/PL20msa|PL20mss|PL20msp|PL20mso/g,'PL20chat');			//change the tags
	mainmsg.innerHTML = 'Invitation to chat in the box.<br>Send it to the recipients.';
}
</script>

<!--Shamir Secret Sharing Scheme-->
<script>
//this function implements the Shamir Secret Sharing Scheme, taking the secret from the main box and putting the result back there, and vice-versa.
function secretshare(){
	var mainmsg = document.getElementById("mainmsg"),
		main = document.getElementById('mainBox').value.trim();
	if((main.slice(0,8).match(/p\d{3}/) && main.slice(0,2)=='PL') || (main.match(/\n\nA/) && main.slice(0,1)=='A')){		//main box has parts: join parts
		var shares = main.replace(/\n\s*\n/g, '\n').split("\n"),					//go from newline-containing string to array
			n = shares.length,
			quorumarr = main.match(/p\d{3}/);															//quorum in tags is "p" plus 3 digits in a row, first instance
		if(quorumarr == null) {var quorum = n} else {var quorum = parseInt(quorumarr[0].slice(1,4))};	//if tags are missing, ignore quorum, otherwise read it form tags
		if(n < quorum){																//not enough parts
			mainmsg.innerHTML = '<span style="color:red">According to the tags, you need ' + (quorum - n) + ' more parts in the box</span>'
		};
		for (var i=0; i < shares.length; i++) {
			shares[i] = bestOfThree(shares[i]);										//undo triples, if any
			shares[i] = applyRScode(shares[i],false);								//RS error correction
			shares[i] = "8" + sjcl.codec.hex.fromBits(sjcl.codec.base64.toBits(shares[i].replace(/[^a-zA-Z0-9+/ ]+/g, '')));	//retrieve from base64 back to hex and add initial "8" to each item
		};
		if (learnOn){
			var reply = confirm("The parts in the main box will be joined to retrieve the original item, which will be placed in this box. Please make sure that there are enough parts. Cancel if this is not what you want.");
			if(reply===false) throw("SSSS join canceled");
		};
		if(n === 1){
			mainmsg.innerHTML = '<span style="color:red">Only one part in main box</span>';
			throw("insufficient parts")
		};
		var	sechex = secrets.combine(shares),
			secret = sjcl.codec.utf8String.fromBits(sjcl.codec.hex.toBits(sechex));
		document.getElementById('mainBox').value = secret;
		mainmsg.innerHTML = 'Join successful';
	} else {																		//main box empty: split secret in the box
		if (main == "") {
			mainmsg.innerHTML = '<span style="color:red">The box is empty</span>';
			throw("No key in the key box")
		};
		if (learnOn){
			var reply = confirm("The item in the box will be split into several partial items, which will replace the contents of the box. A popup will ask for the total number of parts, and the minimum needed to reconstruct the original item. Cancel if this is not what you want.");
			if(reply===false) throw("SSSS split canceled");
		};
		var number = document.getElementById('partsNumber').value;
		if (number.trim() == ""){													//stop to display the entry form if it is empty
			document.getElementById("partsIn").style.display = "block";
			document.getElementById("shadow").style.display = "block";
			if(!isMobile) document.getElementById('partsNumber').focus();
			throw ("stopped for # of parts input")
		}
		var quorum = document.getElementById('partsQuorum').value;					//this value defaults to the total number if empty
		if (quorum.trim() == ""){
			quorum = number
		}
		document.getElementById('partsNumber').value = "";							//on re-execution, read the box and reset it
		document.getElementById('partsQuorum').value = "";
		quorum = parseInt(quorum);
		number = parseInt(number);
		if(number < 2){number = 2} else if(number > 255) {number = 255};
		if (quorum > number) quorum = number;
		var	sechex = sjcl.codec.hex.fromBits(sjcl.codec.utf8String.toBits(document.getElementById('mainBox').value)),
			shares = secrets.share(sechex,number,quorum);
		displayshare(shares,quorum);
		mainmsg.innerHTML = number + ' parts made. ' + quorum + ' required to reconstruct';
		partsInBox = true
	};
	document.getElementById("partsIn").style.display = "none";
	document.getElementById("shadow").style.display = "none"
};

function displayshare(shares,quorum){
	var length = shares[0].length,
		quorumst = "00" + quorum,
		tagsOff = document.getElementById("notags").checked;
		quorumst = quorumst.substr(quorumst.length-3);

	//strip initial "8" and display each share in a new line, base 64, with tags
	if(!tagsOff){
		var dataitem = sjcl.codec.base64.fromBits(sjcl.codec.hex.toBits(shares[0].slice(1,length))).replace(/=+/g, '');
		var	output = triple("PL20p" + quorumst + "=" + dataitem + '=' + calcRScode(dataitem) + "=PL20p" + quorumst);

	//trim final "=" and display with tags
	}else{
		var	output = triple(sjcl.codec.base64.fromBits(sjcl.codec.hex.toBits(shares[0].slice(1,length))).replace(/=+/g, ''))
	}
	for (var i=1; i < shares.length; i++) {
		if(!tagsOff){
			dataitem = sjcl.codec.base64.fromBits(sjcl.codec.hex.toBits(shares[i].slice(1,length))).replace(/=+/g, '');
			output = output + "\n\n" + triple("PL20p" + quorumst + "=" + dataitem + '=' + calcRScode(dataitem) + "=PL20p" + quorumst);
		}else{
			output = output + "\n\n" + triple(sjcl.codec.base64.fromBits(sjcl.codec.hex.toBits(shares[i].slice(1,length))).replace(/=+/g, ''))
		}
	};
	document.getElementById('mainBox').value = output;
};
</script>

<!--text and image steganograghy-->
<script>
//The following code is to convert the contents of main box into fake text, and backward. This can be useful against email scanners.

if (typeof code == 'undefined'){			//default text for base64 to words conversion, global variable
	var defaultcovertext = "The licenses for most software and other practical works are designed to take away your freedom to share and change the works. By contrast, the GNU General Public License is intended to guarantee your freedom to share and change all versions of a program to make sure it remains free software for all its users. We, the Free Software Foundation, use the GNU General Public License for most of our software; it applies also to any other work released this way by its authors. You can apply it to your programs, too. When we speak of free software, we are referring to freedom, not price. Our General Public Licenses are designed to make sure that you have the freedom to distribute copies of free software (and charge for them if you wish), that you receive source code or can get it if you want it, that you can change the software or use pieces of it in new free programs, and that you know you can do these things. To protect your rights, we need to prevent others from denying you these rights or asking you to surrender the rights. Therefore, you have certain responsibilities if you distribute copies of the software, or if you modify it: responsibilities to respect the freedom of others. For example, if you distribute copies of such a program, whether gratis or for a fee, you must pass on to the recipients the same freedoms that you received. You must make sure that they, too, receive or can get the source code. And you must show them these terms so they know their rights. Developers that use the GNU GPL protect your rights with two steps: (1) assert copyright on the software, and (2) offer you this License giving you legal permission to copy, distribute and or modify it. For the developers' and authors' protection, the GPL clearly explains that there is no warranty for this free software. For both users' and authors' sake, the GPL requires that modified versions be marked as changed, so that their problems will not be attributed erroneously to authors of previous versions.";
	var covertext = defaultcovertext;
		covertext = covertext.replace(/   +/g, "\t").replace(/  +/g, " ").replace(/\n /g,"\n\t");	//remove multiple spaces, space after linefeed
	var code = covertext.toLowerCase().replace(/[\.,-\/#!$%\^&\*;:{}=\-_`~()'"]|_/g, "").replace(/\s+/g, " ").split(" ");
		code = code.filter(function(n){return n});													//remove nulls
		code = code.filter(function(elem, pos, self) {return self.indexOf(elem) == pos;});			//global array containing the words, no duplicates
	var keyAlphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=~!@#$%*_" + "\n",	//base64 plus other characters used in PassLok strings
		remainder = code.length % keyAlphabet.length,
		noptions = Math.floor(code.length / keyAlphabet.length);
}

//This function checks for words or spaces encoding and calls the approrpiate decoders. If no encoding is detected, it calls the words encoder
function words(){
	var mainmsg = document.getElementById("mainmsg");
		mainmsg.innerHTML = "";
	if(document.getElementById('mainBox').value.match(/  +/g) != null) {				//detect double spaces and if there are any invoke spaces decoder
		fromSpaces()
	}else{
		var text = document.getElementById('mainBox').value;							//get rid of null characters, if any
		if(text.trim() == ""){
			mainmsg.innerHTML = '<span style="color:red">No text in the box</span>';
			throw("no text")
		}
		var	textlow = text.toLowerCase().replace(/[,\.]+/g,'').replace(/\n+/g,' '),		//make lowercase and strip periods, commas and newlines
			textvector = textlow.split(" "),											//break up the main box into an array of words
			inwords = true,
			indices = new Array();
		for (var i = 0; i < textvector.length; i++){									//find the words in the covertext
			var index = searchStringInArray(textvector[i],code);
			indices[i] = index;															//put the indices into an array
			if(index == -1) inwords = false												//if any word is not in the covertext, this was not encoded with Words method
		}
		if (inwords) {																	//if encoded in words, call words decoder
			fromWords(indices);
			mainmsg.innerHTML = 'Message extracted from Words encoding'
		} else {																		//otherwise call words encoder
			toWords(text);
			mainmsg.innerHTML = 'Message encoded into words of this text. Decoding requires the same Cover text'
		}
	}
}

//this is almost the same as above, but if it doesn't detect encoding present, it calls the spaces encoder instead
function spaces(){
	var mainmsg = document.getElementById("mainmsg");
		mainmsg.innerHTML = "";
	if(document.getElementById('mainBox').value.match(/  +/g) != null) {				//detect double spaces and if there are any invoke spaces decoder
		fromSpaces()
	}else{
		var text = document.getElementById('mainBox').value;
		if(text.trim() == ""){
			mainmsg.innerHTML = '<span style="color:red">No text in the box</span>';
			throw("no text");
		}
		var	textlow = text.toLowerCase().replace(/[,\.]+/g,'').replace(/\n+/g,' '),		//make lowercase and strip periods, commas and newlines
			textvector = textlow.split(" "),											//break up the main box into an array of words
			inwords = true,
			indices = new Array();
		for (var i = 0; i < textvector.length; i++){									//find the words in the covertext
			var index = searchStringInArray(textvector[i],code);
			indices[i] = index;															//put the indices into an array
			if(index == -1) inwords = false												//if any word is not in the covertext, this was not encoded with Words method
		}
		if (inwords) {																	//if encoded in words, call words decoder
			fromWords(indices);
			mainmsg.innerHTML = 'Message extracted from Words encoding'
		} else {																		//otherwise call spaces encoder
			toSpaces();
			if(mainmsg.innerHTML=="") mainmsg.innerHTML = 'Message encoded into spaces of this text. Decoding does not require the same Cover text'
		}
	}
}

//the following two are to encode or decode each character of the main box into a word from the covertext
function toWords(text){
	var mainmsg = document.getElementById("mainmsg");
		mainmsg.innerHTML = "";
	if (learnOn){
			var reply = confirm("The contents of the main box will be replaced with fake text containing it in encoded form. The recipient must have the same Cover text. Cancel if this is not what you want.");
			if(reply===false) throw("toWords canceled");
	}
		var output = code[randomindex(keyAlphabet.indexOf(text[0]))];
		for (var i = 1; i < text.length; i++){
			var index = keyAlphabet.indexOf(text[i]);
			if(index == -1){
				mainmsg.innerHTML = '<span style="color:red">This text contains illegal characters for a PassLok string</span>';
				throw("illegal characters in the main box")
			}
			output = output + randompunct() + code[randomindex(index)]					//add some random commas and periods, and spaces between words
		}
		//capitalize initial and after period, add final period.
		output = output.replace(/[.][\s\n][a-z]/g,function(a){return a.toUpperCase();}).replace(/[a-z]/,function(a){return a.toUpperCase();}) + ".";
		document.getElementById('mainBox').value = output
}

function fromWords(indices){
	if (learnOn){
		var reply = confirm("The encoded text in the main box will be replaced with the original text from which it came. Cancel if this is not what you want.");
		if(reply===false) throw("fromWords canceled");
	}
		var output = "";
		for (var i = 0; i < indices.length; i++){
			output = output + keyAlphabet[indices[i] % keyAlphabet.length]
		}
		document.getElementById('mainBox').value = output
}

//Computes an index taking the full range of words in the covertext
function randomindex(index){
	if(index >= remainder){
		var choice = Math.floor(Math.random() * noptions)
	}else{
		var choice = Math.floor(Math.random() * (noptions + 1))
	}
	return index + choice*keyAlphabet.length
}

//To find words in the code. Returns the index if found, or -1 if not found
function searchStringInArray (str, strArray) {
    for (var j = 0; j < strArray.length; j++) {
        if (strArray[j] == str) return j;
    }
    return -1;
}

//This is to generate random periods, commans and newlines, per the percentage brackets below, plus spaces when appropriate
function randompunct(){
	var percent = Math.ceil(Math.random() * 100);
	if (percent < 7) {
		return ". "
	} else if(percent < 13) {
		return ", "
	} else if(percent < 14) {
		return ".\n"
	} else {
		return " "
	}
}

//the following functions are to hide text into a text cover, as binary double spaces. It needs 7 cover words for each ASCII characters, 42 for non-ASCII
function encoder(bin){
	var textsplit = covertext.split(" ");
	var spaces = textsplit.length - 1;
	var missing = bin.length - spaces;
	var turns = 0;
	if (spaces < bin.length){
		while (spaces < bin.length){
			textsplit = textsplit.concat(covertext.split(" "));
			spaces = textsplit.length - 1;
			turns = turns + 1
		}
		mainmsg.innerHTML = '<span style="color:red">The cover text was too short. It was repeated ' + turns + ' times. If this is not acceptable, repeat with a larger cover.</span>';
	}
		textsplit = textsplit.slice(0,bin.length+2);
	var newtext = textsplit[0];
	for(var i=0; i < textsplit.length-1; i++){
		newtext = newtext + stegospace(bin.slice(i,i+1)) + textsplit[i+1]
	}
	return newtext
}

function decoder(text){
	var bin = "";
	var textsplit = text.split(" ");
	for(var i=1; i < textsplit.length-1; i++){
		if (textsplit[i] == ""){
			bin = bin + "1";
			i = i + 1					//skip next word
		}else{
			bin = bin + "0"
		}
	}
	return bin
}

function stegospace(bin){
	if(bin == "1"){
		return "  "						//double space
	}else{
		return " "						//regular space
	}
}

function toSpaces() {
	var mainmsg = document.getElementById("mainmsg");
		mainmsg.innerHTML = "";
	if (learnOn){
		var reply = confirm("The contents of the main box will be replaced with encoded text which contains the original text as irregular spacing. Cancel if this is not what you want.");
		if(reply===false) throw("toSpaces canceled");
	}
  var output="";
	var input = document.getElementById('mainBox').value.trim();
    for (var i=0; i < input.length; i++) {
		if(keyAlphabet.indexOf(input[i]) == -1){
			mainmsg.innerHTML = '<span style="color:red">This text contains illegal characters for a PassLok string</span>';
			throw("illegal characters in the main box")
		}
		var bin = "000" + input[i].charCodeAt(0).toString(2);
        output = output + bin.slice(bin.length-7,bin.length);
    }
	document.getElementById('mainBox').value = encoder(output)
}

function fromSpaces() {
	if (learnOn){
		var reply = confirm("The encoded text in the main box will be replaced with the original text from which it came. Cancel if this is not what you want.");
		if(reply===false) throw("fromWords canceled");
	}
	var mainmsg = document.getElementById("mainmsg");
	var output="";
	var input=decoder(document.getElementById('mainBox').value);
    for (var i=0; i < input.length; i=i+7) {
		var bin = input.slice(i,i+7);
        output = output + String.fromCharCode(parseInt(bin,2));
    }
	document.getElementById('mainBox').value = output.replace(/\x00/g,'');		//take out nulls, in case text was added to finish the last sentence.
	mainmsg.innerHTML = 'Message extracted from Spaces encoding'
}

//this one is to display the cover text or change it as requested
function newcover(string){
	if(document.getElementById('extrabuttonsbot').style.display == 'none') return
	var mainmsg = document.getElementById("mainmsg");
		mainmsg.innerHTML = "";
	if(string.trim() == ""){														//if the box is empty display the cover text
		if (learnOn){
			var reply = confirm("The cover text will be displayed in the main box. Cancel if this is not what you want.");
			if(reply==false) throw("covertext display canceled");
		}
		document.getElementById('mainBox').value = covertext
	}else{																			//otherwise store new cover text
		if (learnOn){
			var reply = confirm("If you click OK, the cover text will be replaced with the contents of this box, which will be deleted.");
			if(reply==false) throw("covertext change canceled");
		}
//remove multiple spaces, spaces after linefeed
		var newcovertext = string.replace(/   +/g, "\t").replace(/  +/g, " ").replace(/\n /g,"\n\t");
		if (newcovertext.match(/[\u3400-\u9FBF]/) != null) newcovertext = newcovertext.split('').join(' ').replace(/  +/g, ' ');		//add spaces if Chinese, Korean, or Japanese
		var	newcode = newcovertext.toLowerCase().replace(/[\.,-\/#!$%\^&\*;:{}=\-_`~()'"]|_/g, "").replace(/\s+/g, " ").split(" ");  	//removes punctuation, collapses spaces to single space
			newcode = newcode.filter(function(n){return n});																			//remove nulls
			newcode = newcode.filter(function(elem, pos, self) {return self.indexOf(elem) == pos;});									//remove repeats
		if (newcode.length >= keyAlphabet.length){										//enough length for words method
			code = newcode;															//store into global variables
			covertext = newcovertext;
			remainder = code.length % keyAlphabet.length;
			noptions = Math.floor(code.length / keyAlphabet.length);
			mainmsg.innerHTML = '<span style="color:green">Cover text changed</span>'
		} else {
			mainmsg.innerHTML = '<span style="color:red">This text is too short for a Cover</span>';
			throw("text sample too short");
		}
	}
}

// load image for hiding text
var importImage = function(e) {
	if (learnOn){
		var reply = confirm("An image stored in this device will replace the current image. Cancel if this is not what you want.");
		if(reply==false) throw("image import canceled");
	}

    var reader = new FileReader();

    reader.onload = function(event) {
        // set the preview
        document.getElementById('preview').style.display = 'block';
        document.getElementById('preview').src = XSSfilter(event.target.result);
    };

    reader.readAsDataURL(e.target.files[0]);
	document.getElementById('preview').onload = function(){updateCapacity()}
};

//show how much text can be hidden in the image
function updateCapacity(){
	var image = document.getElementById('preview');
	var capacity = Math.floor(image.naturalHeight*image.naturalWidth*3/8);
	var textsize = document.getElementById('mainBox').value.length;
	if(textsize <= capacity){
	document.getElementById('imagemsg').innerHTML='This image can hide ' + capacity + ' characters. The main box has ' + textsize + ' characters'
	}else{
		document.getElementById('imagemsg').innerHTML='This image can hide ' + capacity + ' characters. <span style="color:red">But the main box has ' + textsize + ' characters</span>'
	}
}

//put text into image, which turns into PNG
function encodeImage(){
	if (learnOn){
		var reply = confirm("The text in the previous box will be encoded into this image, which can then be copied and sent to others. Cancel if this is not what you want.");
		if(reply==false) throw("encode image canceled");
	}
	var text = document.getElementById('mainBox').value;
	var imagemsg = document.getElementById('imagemsg');

//bail out if this is not a PassLok string. Otherwise, this method can handle the full UTF-16 character set
	for (var i = 0; i < text.length; i++){
		var index = keyAlphabet.indexOf(text[i]);			//keyAlphabet is a global variable defined in the text steganography section
		if(index == -1){
			imagemsg.innerHTML = '<span style="color:red">The text contains illegal characters for a PassLok string</span>';
			throw("illegal characters in box")
		}
	}
	var encodedImage = steganography.encode(text,document.getElementById('preview').src,{"codeUnitSize": 8});

    // view the new image
    document.getElementById('preview').src = XSSfilter(encodedImage);
	document.getElementById('preview').onload = function(){
		imagemsg.innerHTML = 'Text hidden in the image. Save it now.'
	}
}

//extract text from image
function decodeImage(){
	if (learnOn){
		var reply = confirm("The text hidden in this image, if any, will be extracted and placed in the previous box, replacing its contents. This does not yet work on mobile devices. Cancel if this is not what you want.");
		if(reply==false) throw("decode image canceled");
	}
	var imagemsg = document.getElementById('imagemsg');
	var loadedImage = XSSfilter(document.getElementById('preview').src);
	var text = steganography.decode(loadedImage,{"codeUnitSize": 8});
	if (text == ''){
		imagemsg.innerHTML = 'This image does not contain any hidden text'
	}else{
		document.getElementById('mainBox').value = text;
		imagemsg.innerHTML = 'Go back to see the text extracted from this image'
	}
}
</script>

<!--local Directory functions-->
<script>
//get name and Lock from form and merge them with the lockDB object, then store
function addLock(){
	var lockmsg = document.getElementById("lockmsg");
	if(!fullAccess){
		lockmsg.innerHTML = 'Save not available after Key cancel<br>Please restart PassLok';
		throw('lock save canceled')
	}
	if (learnOn){
		var reply = confirm("The item in the box will be added to the permanent directory. Cancel if this is not what you want.");
		if(reply==false) throw("lockDB add canceled");
	}
	callKey = 'addlock';
	if(lockDB['myself'] && document.getElementById('encryptLocks').checked){
		var encryptLocks = true
	}else{
		var encryptLocks = false
	}
	var name = document.getElementById('locknameBox').value.trim(),
		lock = document.getElementById('lockBox').value.trim();
	if (XSSfilter(name)!=name){
		lockmsg.innerHTML = 'This is not a valid name';
		throw('name contained XSS-illegal characters')
	}
	var lockarray = lock.split('\n');
	var isList = (lockarray.length > 1 && lockarray[1].slice(0,4) != 'http');			//identify List
	if (lock ==''){
		if(!lockDB['myself'] || BasicButtons) return;									//don't do it in Basic mode
		var ran = true;
		lock = sjcl.codec.base64.fromBits(sjcl.random.randomWords('17','0')).slice(0,86);   //make a random Key and store it below if a name is provided
		document.getElementById('lockBox').value = lock;
	}
	if (name !=''){
		var locklength = striptags(lockarray[0]).length;
		if((locklength == 87 || locklength == 100) && !encryptLocks && lockarray.length == 1){
			var lockcrypt = lock;													//store Locks unencrypted, everything else encrypted by the Key
		}else{
			var key = readKey(),
				lockcrypt = keyEncrypt(key,lock);
		}
		if(isList) name = '--' + name + '--';										//dashes bracket name for Lists
			var newEntry = JSON.parse('{"' + name + '":["' + lockcrypt + '"]}');
			lockDB = sortObject(mergeObjects(lockDB,newEntry));
			localStorage.lockDB = JSON.stringify(lockDB);
			lockNames = [''].concat(Object.keys(lockDB));
			window.setTimeout(function(){											//this needs to be on a timer for iOS
				if (ran) {
					lockmsg.innerHTML = '<span style="color:green">Random Key stored to local directory with name </span>' + name
				} else if(striptags(lock).length == 87 || striptags(lock).length == 100){
					lockmsg.innerHTML = '<span style="color:green">Lock saved to local directory with name </span>' + name
				} else if(isList){
					lockmsg.innerHTML = '<span style="color:green">List saved to local directory with name </span>' + name
				} else {
					lockmsg.innerHTML = '<span style="color:green">Item saved to local directory with name </span>' + name
				};
			}, 100);
			fillList();

			if(testChromeSync()){													//if Chrome sync is available, add to sync storage
				syncChromeLock(name,'["' + lockcrypt + '"]')
			}

	} else {
		lockmsg.innerHTML = '<span style="color:red">Cannot save without a name</span>'
	};
	suspendFindLock = false;
	callKey = ''
}

//delete a particular key in Object lockDB, then store
function removeLock(){
	var lockmsg = document.getElementById("lockmsg");	
	if(!fullAccess){
		lockmsg.innerHTML = 'Delete not available after Key cancel<br>Please restart PassLok';
		throw('lock removal canceled')
	}
	if (learnOn){
		var reply = confirm("The item displayed in the box will be removed from the permanent directory. This is irreversible. Cancel if this is not what you want.");
		if(reply==false) throw("lockDB remove canceled");
	}
	var name = lockmsg.innerHTML;
	if (lockDB[name] == null){
		lockmsg.innerHTML = 'To remove an item, its name must be displayed <strong>here</strong>';
		throw('bad name')
	}
	if (name == 'myself'){
		lockmsg.innerHTML = 'There is a button to reset your options in the Options tab';
		throw('no delete for myself')
	}
	delete lockDB[name];
	localStorage.lockDB = JSON.stringify(lockDB);
	lockNames = [''].concat(Object.keys(lockDB));
	window.setTimeout(function(){										//this needs to be on a timer for iOS
		lockmsg.innerHTML = XSSfilter(name) + ' deleted';
	}, 100);
	fillList();

		if(testChromeSync()){											//if Chrome sync is available, remove from sync storage
			if(confirm('Item removed from local storage. Do you want to remove it also from the Chrome sync area?')) remChromeLock(name)
		}

	suspendFindLock = false;
}

//this is to just delete the PFS data for a particular key (or reset the current list)
function resetPFS(){
	var lockmsg = document.getElementById("lockmsg");
	if(!fullAccess){
		lockmsg.innerHTML = 'Reset not available after Key cancel<br>Please restart PassLok';
		throw('lock reset canceled')
	}
	if (document.getElementById('lockBox').value.trim().split('\n').length > 1){		//use button to reset current List if a List is displayed, nothing to do with normal use
		if (learnOn){
			var reply = confirm("The list currently being formed will be reset. Cancel if this is not what you want.");
			if(reply==false) throw("List reset canceled");
		}
		currentList = '';
		lockmsg.innerHTML = 'Current list reset';
		return
	}
//now the real stuff
	if (learnOn){
		var reply = confirm("The data needed to maintain a PFS conversation with this sender/recipient will be deleted, so the ongoing conversation cannot be continued. This is irreversible. Cancel if this is not what you want.");
		if(reply==false) throw("myself reset canceled");
	}
	var name = lockmsg.innerHTML;
	if (lockDB[name] == null){
		lockmsg.innerHTML = 'The item to be reset must be displayed first';
		throw('bad name')
	}
	if (name == 'myself'){
		lockmsg.innerHTML = 'There is a button to reset your options in the Options tab';
		throw('no reset for myself')
	}	
	if ((lockDB[name][1] == null) && (lockDB[name][2] == null) && (lockDB[name][3] == null)){
		lockmsg.innerHTML = 'Nothing to reset';
		throw('no PFS data')
	}
	lockDB[name].splice(1,4);
	localStorage.lockDB = JSON.stringify(lockDB);

		if(testChromeSync()){											//if Chrome sync is available, change in sync storage
			syncChromeLock(name,JSON.stringify(lockDB[name]))
		}

	lockmsg.innerHTML = 'PFS data for ' + XSSfilter(name) + ' deleted';
	suspendFindLock = false
}

var suspendFindLock = false							//when true, user can input a name without deleting the lock box

//searches for name in Locks database and returns the Lock, displays full name as well. Invoked as the user types
function findLock(){
	var lockmsg = document.getElementById("lockmsg");
	lockmsg.innerHTML = '';
	var string = document.getElementById('locknameBox').value;
	var stringstrip = striptags(string);
	if(stringstrip.length == 87 || stringstrip.length == 100){									//it's a Lock in the wrong box. Move it
		document.getElementById('lockBox').value = string;
		document.getElementById('locknameBox').value = '';
		lockmsg.innerHTML = 'Locks go in the lower box. You can give it a name and save it';
		suspendFindLock = true;
		return
	}
	var index = searchStringInArrayDB(string,lockNames);
	if (index > 0){
		var name = lockNames[index];
		lockmsg.innerHTML = XSSfilter(name);
		document.getElementById('lockBox').value = lockDB[name][0]
	}else{
		lockmsg.innerHTML = '';
		document.getElementById('lockBox').value = ''
	}
}

//decrypts the contents of the Locks Box
function decryptLock(){
	callKey = 'decryptlock';
	var lockmsg = document.getElementById("lockmsg");
	var firstchar = document.getElementById('lockBox').value.slice(0,1);
	if(firstchar == '~') {
		decryptItem();
	}
	if(document.getElementById('lockBox').value != ''){
		var listArray = document.getElementById('lockBox').value.split('\n');
		if(document.getElementById('lockBox').value.split(' ').length >= keyAlphabet.length){
			newcover(document.getElementById('lockBox').value);							//this for loading cover text from lock screen
			lockmsg.innerHTML = 'New Cover text extracted and ready to use'
		} else if(listArray.length > 1 && listArray[1].slice(0,4) != 'http'){
			lockmsg.innerHTML = 'List extracted'
		} else if(striptags(document.getElementById('lockBox').value).length == 87 || striptags(document.getElementById('lockBox').value).length == 100){
			lockmsg.innerHTML = 'Lock extracted'
		} else if(document.getElementById('lockBox').value.length == 86){
			lockmsg.innerHTML = 'Random Key extracted'
		} else {
			lockmsg.innerHTML = 'Shared Key extracted'
		}
	}
	callKey = ''
}

//if a newline is entered, puts the expanded contents of the name box in the lock box, and waits for another item
var currentList = '';

function addToList(){
	if (learnOn){
		var reply = confirm("The item displayed will be added to the current list. Cancel if this is not what you want.");
		if(reply==false) throw("add to list canceled");
	}
	var lockmsg = document.getElementById("lockmsg"),
		currentItem = document.getElementById('lockBox').value;
	if(lockmsg.innerHTML != ''){
		var namenumber = currentItem.split('\n').length;

//if the item is itself a list or there is no name, add the contents rather than the displayed name
		if (namenumber > 1 || document.getElementById('locknameBox').value==''){
			if(currentList == ''){
				currentList = currentItem
			}else{
				currentList = currentList + '\n' + currentItem
			}
			lockmsg.innerHTML = namenumber + ' items added to the current list'
		} else {
			if(currentList == ''){
				currentList = lockmsg.innerHTML
			}else{
				currentList = currentList + '\n' + lockmsg.innerHTML
			}
			lockmsg.innerHTML = XSSfilter(lockmsg.innerHTML) + ' added to the current list'
		}
	} else {
		if (currentList !=''){
			lockmsg.innerHTML = 'This is the (temporary) current list'
		} else {
			lockmsg.innerHTML = 'No items on the current list'
		}
	}
	var listArray = currentList.replace(/\n+/g,'\n').split('\n');
	listArray = listArray.filter(function(elem, pos, self) {return self.indexOf(elem) == pos;});	//remove duplicates
	currentList = listArray.join('\n');
	document.getElementById('lockBox').value = currentList.trim();
	currentList = document.getElementById('lockBox').value;
	suspendFindLock = false
}

//automatically decrypts an item stored encrypted in the lockDB database. It uses the permanent Key
function decryptItem(){
	if(callKey != 'decryptlock') callKey = 'decryptitem';
	var	key = readKey(),
		string = document.getElementById('lockBox').value.trim();
	if(string == "") throw('nothing to decrypt');
	document.getElementById('lockBox').value = keyDecrypt(key,string);
	if(callKey != 'decryptlock') callKey = ''
}

//add a few spaces and newlines, then remove brackets, etc., extra spaces, put in alphabetical order
function showLockDB(){
	if (learnOn){
		var reply = confirm("The complete directory of Locks, shared Keys, etc. stored in this device will be displayed. Cancel if this is not what you want.");
		if(reply==false) throw("lockDB show canceled");
	}
	var lockmsg = document.getElementById("lockmsg");
	if(localStorage.lockDB != "{}"){
		var alphalockDB = lockDB;
		document.getElementById('lockBox').value = JSON.stringify(alphalockDB,null,4).replace(/[{}"\[\]]/g,'').replace(/\n    /g,'\n').replace(/ \n/g,'\n').replace(/,\n/g,'\n').trim();
		lockmsg.innerHTML = 'These are the items stored in this device';
	}else{
		lockmsg.innerHTML = '<span style="color:red">There are no stored items</span>';
	}
	suspendFindLock = false
}

//as above, but just the 'myself' entry
function showMyself(){
	var mainmsg = document.getElementById("mainmsg");
	if(lockDB['myself']){
		var alphalockDB = lockDB['myself'];
		document.getElementById('mainBox').value = 'myself:\n' + JSON.stringify(alphalockDB,null,4).replace(/[{}"\[\]]/g,'').replace(/\n    /g,'\n').replace(/ \n/g,'\n').replace(/,\n/g,'\n').trim();
		mainmsg.innerHTML = 'These are your stored settings';
	}else{
		mainmsg.innerHTML = '<span style="color:red">No settings to store</span>';
	}
	suspendFindLock = false
}

//reconstruct the original JSON string from the newlines and spaces as displayed by showLockDB
function mergeLockDB(){
	var lockmsg = document.getElementById("lockmsg");
	callKey = 'mergedb';
	var	lockstr = document.getElementById('lockBox').value.trim(),		//see if these are Locks for a possible DH merge, which is not the main function of this button
		mainstr = document.getElementById('mainBox').value.trim();
	if (lockstr == ''){
		lockmsg.innerHTML = 'Nothing to merge';
		throw('invalid merge')
	}
	if (lockstr.slice(0,1) == '~') {
		var key = readKey();
		lockstr = keyDecrypt(key,lockstr)
	}
	var lockstr2 = striptags(lockstr),
		mainstr2 = striptags(mainstr),
		locklen = lockstr2.length,
		mainlen = mainstr2.length;
	if(((locklen==87 || locklen==100) && (mainlen==87 || mainlen==100)) || (!(locklen==87 || locklen==100) && !(mainlen==87 || mainlen==100) && lockstr.split('\n').length == 1)){
		lockmsg.innerHTML = '<span style="color:orange">One and only one of the items to be merged must be a Lock<span>';
		throw('invalid DH merge')
	}
	if (locklen == 87 || locklen == 100){					//if it's a Lock in the lock box, merge it with the Key, clear lock box so it doesn't get merged next time
		if (mainstr == ''){
			lockmsg.innerHTML = 'Nothing to merge this Lock with';
			throw('invalid merge')
		}
		if (learnOn){
			var reply = confirm("The Lock in the Locks box will be combined with the Key in the main box, and the resulting Key will replace both. Cancel if this is not what you want.");
			if(reply===false) throw("merge canceled");
		};
		if (lockstr2.length == 100) lockstr2 = changeBase(lockstr2.toLowerCase(), BASE38, BASE64, true); 		//ezLok replaced by regular Lock
		document.getElementById('mainBox').value = makeshared(mainstr,lockstr2,'');
		document.getElementById('lockBox').value = document.getElementById('mainBox').value;
		lockmsg.innerHTML = 'Lock merged with Key in main box';
		throw ("it was a lock, merged with key")
	} else if ((mainlen == 87 || mainlen == 100) && lockstr.split('\n').length == 1 && lockstr!=''){		//if it's a Lock in the main box and not multiline in the lock box
		if (learnOn){
			var reply = confirm("The Key in the Locks box will be combined with the Lock in the main box, and the resulting Key will replace both. Cancel if this is not what you want.");
			if(reply===false) throw("merge canceled");
		};
		if (mainstr2.length == 100) mainstr2 = changeBase(mainstr2.toLowerCase(), BASE38, BASE64, true)
		document.getElementById('mainBox').value = makeshared(lockstr,mainstr2,'');
		document.getElementById('lockBox').value = document.getElementById('mainBox').value;
		lockmsg.innerHTML = 'Key merged with Lock in main box';
		throw ("it was a key, merged with lock")

	} else if(lockstr.split('\n').length > 1){

	//now the real database merge, which implies multiline
	if (learnOn){
		var reply = confirm("The items in the box will be merged into the permanent directory, replacing existing items of the same name. This is irreversible. Cancel if this is not what you want.");
		if(reply==false) throw("lockDB merge canceled");
	}
	if(!fullAccess){
		lockmsg.innerHTML = 'Merge not available after Key cancel<br>Please restart PassLok';
		throw('DB merge canceled')
	}
	var newDB = JSON.parse('{"' + document.getElementById('lockBox').value.trim().replace(/\n +/g,'\n').replace(/:\n/g,'":["').replace(/\n\n/g,'"],"').replace(/\n/g,'","') + '"]}');
		lockDB = sortObject(mergeObjects(lockDB,newDB));
		localStorage.lockDB = JSON.stringify(lockDB);
		lockNames = [''].concat(Object.keys(lockDB));
		window.setTimeout(function(){
			lockmsg.innerHTML = 'Items merged into database';
		}, 100);
		fillList();

		if(testChromeSync()){
			for(var name in lockDB){										//if Chrome sync is available, change all this in sync storage
				syncChromeLock(name,JSON.stringify(lockDB[name]))
			}
		}
	}
	fillList();
	suspendFindLock = false;
	callKey = ''
}

//makes encrypted backup of the whole DB, then if allowed clears lockDB object, then stores
function moveLockDB(){
	var lockmsg = document.getElementById("lockmsg");
	if(!fullAccess){
		lockmsg.innerHTML = 'Move not allowed after Key cancel<br>Please restart PassLok';
		throw('DB move canceled')
	}
	callKey = 'movedb';
	var key = readKey();

	//first encrypt lockDB, as displayed by showLockDB
	showLockDB();
	var datacrypt = keyEncrypt(key,document.getElementById('lockBox').value.trim());
	document.getElementById('mainBox').value = triple('PL20dir=' + datacrypt + '=' + calcRScode(datacrypt) + '=PL20dir');
	lockmsg.innerHTML = '<span>Database in Main tab</span>'

	//now check that the user really wants to delete the database
	var answer = confirm("The database has been exported to the Main tab. If you click OK, it will now be erased from this device. This cannot be undone.");
	if (answer == false) throw("lockDB erase canceled");
		lockDB = {};
		localStorage.lockDB = JSON.stringify(lockDB);
		lockNames = [''].concat(Object.keys(lockDB));
		lockmsg.innerHTML = '<span style="color:purple">Stored items erased</span>';
	fillList();
	suspendFindLock = false;
	callKey = ''
}

//makes encrypted backup of the 'myself' entry only, then if allowed clears it, then stores
function moveMyself(){
	callKey = 'movemyself';
	var mainmsg = document.getElementById("mainmsg");
	var filemsg = document.getElementById("filemsg");

	//first encrypt myself data, as displayed by showLockDB
	showMyself();
	if(fullAccess){
		var key = readKey();
		var datacrypt = keyEncrypt(key,document.getElementById('mainBox').value.trim());
		document.getElementById('mainBox').value = triple('PL20bak=' + datacrypt + "=" + calcRScode(datacrypt) + '=PL20bak');
		var msg = 'The item in the box contains your backed-up settings<br>To restore them, click Lock/Unlock';
		mainmsg.innerHTML = msg;
	}else{
		var msg = 'These are your settings, possibly including your encrypted random token<br>You may want to save them in a safe place.'
	}
	filemsg.innerHTML = 'Backed-up settings on Main tab';
	
	//now check that the user really wants to delete the database
	var answer = confirm("Your settings, including the email/token, have been backed up. If you click OK, they will now be erased from this device. This cannot be undone.");
	if (answer == false) throw("myself erase canceled");
	delete lockDB['myself'];
	localStorage.lockDB = JSON.stringify(lockDB);
	lockNames = [''].concat(Object.keys(lockDB));
	fillList();
	mainmsg.innerHTML = 'Your settings, including the email/token, have been erased<br>' + msg;
	filemsg.innerHTML = 'Settings erased';
	suspendFindLock = false;
	callKey = ''
}

//merges two objects; doesn't sort the keys
function mergeObjects(obj1,obj2){
    var obj3 = {};
    for (var attrname in obj1) { obj3[attrname] = obj1[attrname]; }
    for (var attrname in obj2) { obj3[attrname] = obj2[attrname]; }
    return obj3;
}

//sorts object keys alphabetically
function sortObject(o) {
    var sorted = {},
    	key, a = [];
    for (key in o) {
    	if (o.hasOwnProperty(key)) {
    		a.push(key);
    	}
    }
    a.sort(insensitive);							//this depends on next function
    for (key = 0; key < a.length; key++) {
    	sorted[a[key]] = o[a[key]];
    }
    return sorted;
}

//to make sorting case-insensitive
function insensitive(s1, s2) {
  var s1lower = s1.toLowerCase();
  var s2lower = s2.toLowerCase();
  return s1lower > s2lower? 1 : (s1lower < s2lower? -1 : 0);
}

//finds first partial match of string str and returns index of array element
function searchStringInArrayDB (str, strArray) {
	var reg = new RegExp(str, "i");					//make it case-insensitive
    for (var j=0; j<strArray.length; j++) {
		if (strArray[j] != null){
    		if (strArray[j].match(reg)) return j;
		}
    }
    return -1;
}

//decrypts lockDB items one by one and encrypts them with new Key
function recryptDB(oldkey,newkey){
	for(var name in lockDB){
		delete lockDB[name][1];										//this entry is useless after Key is changed. Will be remade later
		for(var index = 0; index < lockDB[name].length; index++){
			var content = lockDB[name][index];
			if(content){
				if(content.slice(0,1) == '~'){										//do only encrypted items
					content = keyDecrypt(oldkey,content);
					content = keyEncrypt(newkey,content);
					lockDB[name][index] = content;
				}
			}
			if(testChromeSync() && index == 0){									//if Chrome sync is available, add to sync storage
				syncChromeLock(name,'["' + content + '"]')
			}
		}
	}
//change Lock stored under name 'myself'
	var email = readEmail();
	var newlock = makepub(newkey,email);
	newlock = keyEncrypt(newkey,newlock);
	lockDB['myself'][0] = newlock;
	localStorage.lockDB = JSON.stringify(lockDB);
}

//reads old and new Key from boxes and calls recryptDB so lockDB is re-encrypted with the new Key
function changeKey(){
	var filemsg = document.getElementById("filemsg");
	if(!fullAccess){
		filemsg.innerHTML = 'Key change not allowed after Key cancel';
		throw('Key change canceled')
	}	
	callKey = 'changekey';
	if (learnOn){
		var reply = confirm("The local directory will be re-encrypted with a new Key. Cancel if this is not what you want.");
		if(reply == false) throw("lockDB recrypt canceled");
	}	
	var oldkey = readKey(),
		newkey = document.getElementById('newKey').value.trim(),
		newkey2 = document.getElementById('newKey2').value.trim();
	if (newkey.trim() == "" || newkey2.trim() == ""){								//stop to display the entry form if new Key is empty
		document.getElementById("keyChange").style.display = "block";
		document.getElementById("shadow").style.display = "block";
		changemsg.innerHTML = 'Enter the new Key in both boxes';
		if(!isMobile){
			if(newkey.trim() == ""){
				document.getElementById("newKey").focus()
			}else{
				document.getElementById("newKey2").focus()
			}
		}
		throw ("stopped for new Key input")
	}
	if(newkey.trim() != newkey2.trim()){											//check that the two copies match before going ahead
		changemsg.innerHTML = "<span style='color:red'>The two Keys don't match</span>";
		throw ("Keys don't match")
	}

//everything OK, so do it!
	recryptDB(oldkey,newkey);
	document.getElementById('newKey').value = "";									//on re-execution, read the box and reset it
	document.getElementById('newKey2').value = "";
	document.getElementById('keyChange').style.display = 'none';
	document.getElementById('shadow').style.display = 'none';
	document.getElementById('pwd').value = newkey;									//refill Key box, too
	if(document.getElementById('keyscr').style.display == 'block') document.getElementById('keyscr').style.display = 'none';
	document.getElementById('mainmsg').innerHTML = '<span style="color:green">The Key has changed</span>';
	document.getElementById('lockmsg').innerHTML = '<span style="color:green">The Key has changed</span>';
	callKey = '';
}

//grab the names in lockDB and put them on the Main tab selection box
function fillList(){
	var x = document.getElementById("locklist");
	if(document.getElementById('extrabuttonstop').style.display == 'block' && document.getElementById('basicbuttonstop').style.display != 'block'){		//steganography buttons showing
		x.innerHTML = '<option value="" disabled selected style="color:#639789;">Choose one stored Cover text:</option><option value="default">default</option>';
		for(var name in lockDB){
			if(lockDB[name][0].length > 500){										//only cover texts, which are long
				x.innerHTML = x.innerHTML + '<option value="' + name + '">' + name + '</option>'
			}
		}
	}else{																			//normal behavior
		x.innerHTML = '<option value="" disabled selected style="color:#639789;">Select recipients:</option>';
		for(var name in lockDB){
			if(lockDB[name][0].length < 500){										//exclude cover texts, which are long
				x.innerHTML = x.innerHTML + '<option value="' + name + '">' + name + '</option>'
			}
		}
	}
	resetList()
}

//take the selected names and put them in the Locks lower box. If any is a List, extract and merge with the other names, removing duplicates
var isList = false;												//so a decryption failure knows how to end
function fillBox(){
	callKey = 'fillbox';
	var x = document.getElementById("locklist");
	document.getElementById('lockBox').value = '';
	var list = '';
	for (var i = 0; i < x.options.length; i++) {
    	if(x.options[i].selected == true){
			if(x.options[i].value.slice(0,2) == '--'){					//it's a List, so decrypt it and add the contents to the box
				var itemcrypt = lockDB[x.options[i].value][0];
				if (!key) var key = readKey();
				isList = true;											//to return here if the Key is wrong
				list = list + '\n' + keyDecrypt(key,itemcrypt);
			}else if(x.options[i].value == 'default'){					//default cover selected
				var covername = 'default';
				newcover(defaultcovertext)
			}else if(lockDB[x.options[i].value][0].length > 500){		//it's a Cover, so decrypt it and make it the new Cover
				var covername = x.options[i].value;
				var covercrypt = lockDB[covername][0];
				if (!key) var key = readKey();
				isList = true;
				newcover(keyDecrypt(key,covercrypt));
			}else{
         		list = list + '\n' + x.options[i].value;
			}
    	}
  	}
	var array = list.trim().split('\n');
	if (array[0] != ''){
		array = array.filter(function(elem, pos, self) {return self.indexOf(elem) == pos;});  			//remove duplicates
		array = array.filter(function(n){return n});													//remove nulls
		array.sort();																					//alphabetical order
		list = '';
		var msg = 'Lock selected for: ';
		for(var index = 0; index < array.length; index++){
			list = list + '\n' + array[index];
			msg = msg + array[index] + ', '
		}
		document.getElementById('lockBox').value = list.trim();
	} else if(covername){
		var msg = covername + ' Cover text loaded';
	} else {
		var msg = '';
	}
	document.getElementById('mainmsg').innerHTML = XSSfilter(msg);
	document.getElementById('lockmsg').innerHTML = '';
	isList = false;
	callKey = '';
}

//empty the selection box on Main tab
function resetList(){
	var x = document.getElementById("locklist");
	for (var i = 0; i < x.options.length; i++) {
    	x.options[i].selected = false
  	}
	if(document.getElementById('extrabuttonstop').style.display == 'block' && document.getElementById('basicbuttonstop').style.display != 'block'){
		document.getElementById('mainmsg').innerHTML = 'Default Cover text active'
	}else{
		document.getElementById('lockBox').value = '';
		document.getElementById('mainmsg').innerHTML = 'No Locks selected'
	}
}
</script>

<!--functions for switching screens, etc.-->
<script>
//this is for showing and hiding text in key box and other password input boxes
function showsec(){
  var showPasswordCheckBox = document.getElementById("showKey");
  if(showPasswordCheckBox.checked){
        document.getElementById('pwd').type="TEXT";
  }else{
      document.getElementById('pwd').type="PASSWORD";
  }
};

function showdecoyIn(){
  var showPasswordCheckBox = document.getElementById("showdecIn");
  if(showPasswordCheckBox.checked){
        document.getElementById('decoyPwdIn').type="TEXT";
  }else{
      document.getElementById('decoyPwdIn').type="PASSWORD";
  }
};

function showdecoyOut(){
  var showPasswordCheckBox = document.getElementById("showdecOut");
  if(showPasswordCheckBox.checked){
        document.getElementById('decoyPwdOut').type="TEXT";
  }else{
      document.getElementById('decoyPwdOut').type="PASSWORD";
  }
};

function showIntro(){
  var showPasswordCheckBox = document.getElementById("showIntroKey");
  if(showPasswordCheckBox.checked){
        document.getElementById('pwdIntro').type="TEXT";
  }else{
      document.getElementById('pwdIntro').type="PASSWORD";
  }
};

function showNewKey(){
  var showNewKeyCheckBox = document.getElementById("showNewKey");
  if(showNewKeyCheckBox.checked){
		document.getElementById('newKey').type="TEXT";
		document.getElementById('newKey2').type="TEXT";
  }else{
		document.getElementById('newKey').type="PASSWORD";
		document.getElementById('newKey2').type="PASSWORD";
  }
};

function box2cover(){
	newcover(document.getElementById('mainBox').value)
}

function chat2main(){
	document.getElementById('chatscr').style.display = 'none'
}

function resetChat(){
	var src = document.getElementById('chatframe').src;
	document.getElementById('chatframe').src = '';
	setTimeout(function(){document.getElementById('chatframe').src = src;}, 0);
}

//for selecting text in Main tab and other simple functions
function selectMain(){
	document.getElementById('mainBox').selectionStart=0;
	document.getElementById('mainBox').selectionEnd=document.getElementById('mainBox').value.length;
}
function clearMain(){
	document.getElementById('mainBox').value = '';
	document.getElementById('mainmsg').innerHTML = '';
}
function clearLocks(){
	document.getElementById('lockBox').value='';
	document.getElementById('locknameBox').value='';
	document.getElementById('lockmsg').innerHTML='';
	suspendFindLock = false;
}
function clearIntro(){
	document.getElementById('pwdIntro').value = '';
	document.getElementById('keyIntromsg').innerHTML = '';
	document.getElementById('pwd').value = '';
	document.getElementById('keymsg').innerHTML = '';
}

//to exit the special intro screen
function showlockIntro(){
	var key = document.getElementById('pwdIntro').value,
		email = document.getElementById('emailIntro').value;
	if (key.trim() == ''){
		document.getElementById('intromsg2').innerHTML = 'The Key box is empty<br />Please go back and ensure it is filled.';
		return
	}
	document.getElementById('pwd').value = key;
	if (email == '') email = ' ';
	document.getElementById('email').value = email;
	openClose('introscr4');
	showLock();
	key2any();
	storeEmail();
}

//writes five random dictionary words in the intro Key box
function suggestIntro(){
	var output = '';
	for(var i = 1; i <=5 ; i++){
		var rand = wordlist[sjcl.bn.random(wordlist.length).limbs[0]];
		rand = rand.replace(/0/g,'o').replace(/1/g,'i').replace(/2/g,'z').replace(/3/g,'e').replace(/4/g,'a').replace(/5/g,'s').replace(/7/g,'t').replace(/8/g,'b').replace(/9/g,'g');
		output = output + ' ' + rand;
	}
	document.getElementById('pwdIntro').type="TEXT";
	document.getElementById('pwdIntro').value = output.trim();
	document.getElementById('showIntroKey').checked = true
}

//store email entered on email screen
function storeEmail(){
	var email = document.getElementById('email').value;
	if (email == ''){
		any2email();
		throw('no email');
	}
	if(lockDB['myself'] && fullAccess){
		var key = readKey(),
			emailcrypt = keyEncrypt(key,email);
		lockDB['myself'][2] = emailcrypt;
	}
	localStorage.lockDB = JSON.stringify(lockDB);
}

//shows email screen so it can be changed
function showEmail(){
	var filemsg = document.getElementById("filemsg");
	if(!fullAccess){
		filemsg.innerHTML = 'Email change not allowed after Key cancel';
		throw('Email change canceled')
	};
	document.getElementById('shadow').style.display = 'block';
	document.getElementById('emailscr').style.display = 'block'
}

//go to 2nd intro screen, and back. The others are similar
function go2intro2(){
	openClose('introscr');
	openClose('introscr2');
}
function go2intro3(){
	openClose('introscr2');
	openClose('introscr3');
}
function go2intro4(){
	document.getElementById('intromsg2').innerHTML = '';
	openClose('introscr3');
	openClose('introscr4');
}

//these close input dialogs
function closebox() {
	document.getElementById("shadow").style.display = "none";
	document.getElementById("keyscr").style.display = "none";
	document.getElementById("decoyIn").style.display = "none";
	document.getElementById("decoyOut").style.display = "none";
	document.getElementById("partsIn").style.display = "none";
	document.getElementById("keyChange").style.display = "none";
	document.getElementById("emailscr").style.display = "none";
	document.getElementById("chatDialog").style.display = "none";
}
function cancelKey(){
	if(allowCancelWfullAccess == false){
		fullAccess = false;
		if(lockDB['myself']){
			lockDB['myself'][6] = 'limited access';
			localStorage.lockDB = JSON.stringify(lockDB);
		}
		document.getElementById('mainmsg').innerHTML = 'You have limited access to functions<br>For full access, reload and enter the Key'
	}
	allowCancelWfullAccess = false;
	closebox()
}
function cancelEmail(){
	closebox()
}
function cancelDecoyIn(){
	document.getElementById('decoyPwdIn').value = '';
	closebox()
}
function cancelDecoyOut(){
	document.getElementById('decoyPwdOut').value = '';
	closebox()
}
function cancelPartsIn(){
	document.getElementById('partsNumber').value = '';
	closebox()
}
function cancelChat(){
	closebox()
}
function cancelKeyChange(){
	document.getElementById('newKey').value = '';
	closebox();
	if(document.getElementById('keyscr').style.display == 'block') document.getElementById('keyscr').style.display = 'none'
}
function hide5min(){
	if(document.getElementById('never').checked){
		document.getElementById('5min').style.display = "none"
	}else{
		document.getElementById('5min').style.display = "block"
	}
}

//triggered if the user types Enter in the name box of the locks screen
function locknameKeyup(evt){
	evt = evt || window.event												//IE6 compliance
	if (evt.keyCode == 13) {												//sync from Chrome or decrypt if hit Return
		if(document.getElementById("lockmsg").innerHTML == ''){				//found nothing, so try to get it from Chrome sync
			if(testChromeSync()){
				var name = document.getElementById("locknameBox").value;
				getChromeLock(name);
			}
		} else {												//decrypt 1st time if found locally, 2nd time if synced from Chrome
			if(!document.getElementById("lockmsg").innerHTML.match('not found in your Chrome')){
				var firstchar = document.getElementById('lockBox').value.slice(0,1);
				if(firstchar == '~' || firstchar == '^'){
					decryptLock()
				}
			}
		}
	} else if (!suspendFindLock){											//otherwise search database
			return findLock()
	} else {
		if(document.getElementById('lockBox').value.trim() == ''){
			suspendFindLock = false;
			return findLock()
		}
	}
}

//displays Keys strength and resets Key timer
function pwdKeyup(evt){
	clearTimeout(keytimer);
	keytimer = setTimeout(function() {document.getElementById('pwd').value = ''}, 300000);
	keytime = new Date().getTime();
	evt = evt || window.event
	if (evt.keyCode == 13){acceptKey()} else{
		 return keyStrength(document.getElementById('pwd').value,true);
	}
}

//Key strength display on intro screen
function introKeyup(){
	return keyStrength(document.getElementById('pwdIntro').value,true);
}

//same but for decoy In screen
function decoyKeyup(evt){
	evt = evt || window.event
	if (evt.keyCode == 13){submitDecoyIn()} else{
		 return keyStrength(document.getElementById('decoyPwdIn').value,true);
	}
}

//same for key Change screen
function newKeyup(evt){
	evt = evt || window.event
	if (evt.keyCode == 13){changeKey()} else{
		 return keyStrength(document.getElementById('newKey').value,true);
	}
}

//this one looks at the second box and announces a match
function newKey2up(evt){
	evt = evt || window.event
	if (evt.keyCode == 13){changeKey()} else {
		var msg = document.getElementById('keychangemsg'),
			newkey = document.getElementById('newKey').value,
			newkey2 = document.getElementById('newKey2').value,
			length = newkey.length,
			length2 = newkey2.length;
		if(length != length2){
			if(newkey2 == newkey.slice(0,length2)){
				msg.innerHTML = 'Keys match so far. ' + (length-length2) + ' characters to go'
			} else {
				msg.innerHTML = "<span style='color:magenta'>Keys don't match</span>"
			}
		}else{
			if(newkey2 == newkey){
				msg.innerHTML = "<span style='color:green'>Keys match!</span>"
			} else {
				msg.innerHTML = "<span style='color:magenta'>Keys don't match</span>"
			}
		}
	}
}

//activated when the user clicks OK on a decoy screen
function submitDecoyIn(){
	closebox();
	if(encrypting){Decrypt_single()}else{verifySignature()};
}

//Enter has the same effect as clicking OK in decoy and parts box
function decoyKeyupOut(evt){
	evt = evt || window.event
	if (evt.keyCode == 13){submitDecoyOut()};
}
function submitDecoyOut(){
	closebox();
	if(encrypting){Decrypt_single()}else{verifySignature()};
}
function partsKeyup(evt){
	evt = evt || window.event
	if (evt.keyCode == 13){submitParts()};
}
function submitParts(){
	if(!isNaN(document.getElementById('partsNumber').value)){
	closebox();
	secretshare();
	}
}
function emailKeyup(evt){
	evt = evt || window.event
	if (evt.keyCode == 13){email2any()};
}

//for switching between sets of buttons
function main2extra(){
	if(document.getElementById('basicmode').checked) return;
	openClose("mainbuttonstop");
	openClose("mainbuttonsbot");
	openClose("extrabuttonstop");
	openClose("extrabuttonsbot");
	if(!isMobile) document.getElementById('sendSMSButton').style.display = 'none';
	fillList();
}

//switch to Advanced mode, and back
function basic2main(){
	if(document.getElementById('mainbuttonstop').style.display == 'block' || document.getElementById('basicbuttonstop').style.display == 'block'){
		openClose("mainbuttonstop");
		openClose("mainbuttonsbot");
	}else if(document.getElementById('extrabuttonstop').style.display == 'block'){
		openClose("extrabuttonstop");
		openClose("extrabuttonsbot");
	}
	openClose("basicbuttonstop");
	openClose("basicbuttonsbot");
	openClose("basiclockbuttonstop");
	openClose("basiclockbuttonsbot");
	openClose("lockbuttonstop");
	openClose("lockbuttonsbot");
	if(lockDB['myself']){
		if (lockDB['myself'][3] != 'advanced'){
			lockDB['myself'][3] = 'advanced';
			document.getElementById('basicmode').checked = false;
			document.getElementById('advancedmode').checked = true;
			BasicButtons = false
		}else{
			lockDB['myself'][3] = 'basic';
			document.getElementById('basicmode').checked = true;
			document.getElementById('advancedmode').checked = false;
			BasicButtons = true
		}
		localStorage.lockDB = JSON.stringify(lockDB)
	};
	fillList();
}

//makes the ezLok choice permanent
function ezLokStore(){
	if(lockDB['myself']){
		if (document.getElementById('ezLok').checked){
			lockDB['myself'][4] = 'ezLok on'
		} else {
			lockDB['myself'][4] = 'ezLok off'
		}
	}
	localStorage.lockDB = JSON.stringify(lockDB)
}

//makes the encrypt Locks choice permanent
function encryptLocksStore(){
	if(lockDB['myself']){
		if (document.getElementById('encryptLocks').checked){
			lockDB['myself'][5] = 'encrypt Locks'
		} else {
			lockDB['myself'][5] = 'do not encrypt Locks'
		}
	}
	localStorage.lockDB = JSON.stringify(lockDB)
}

//opens Directory tab for input if something seems to be missing
function main2lock(){
	tabLinks['mainTab'].className = '';
	tabLinks['dirTab'].className = 'selected';
	contentDivs['mainTab'].className = 'tabContent hide';
	contentDivs['dirTab'].className = 'tabContent';
	focusBox();
}

//open image screen
function main2image(){
	if (learnOn){
		var reply = confirm("A new screen will open so you can load an image and hide the contents of the box in it. This only works for valid PassLok output. Cancel if this is not what you want.");
		if(reply == false) throw("Image canceled");
	};
	openClose('imagescr');
	if(document.getElementById('preview').src.slice(0,4)!='data'){
		document.getElementById('imagemsg').innerHTML='Click the button above to load an image'
	}else{
		updateCapacity()
	}
};

//return from image screen
function image2main(){
	if(document.getElementById('imagescr').style.display=='block'){
		openClose('imagescr');
	}
}

//go to general directory frame
function lock2dir(){
	if(document.getElementById('keyscr').style.display=='block') return;
	if(document.getElementById('lockdir').style.display=='none') loadLockDir();
	var locklength = striptags(document.getElementById('mainBox').value).length;
	if ((locklength == 87 || locklength == 100) && document.getElementById('lockdir').style.display != "block"){

//if populated, send Lock to directory
		var lockdirframe = document.getElementById('lockdirframe');
		lockdirframe.contentWindow.postMessage(document.getElementById('mainBox').value, 'https://www.passlok.com');
		lockdirframe.onload = function() {
	    	lockdirframe.contentWindow.postMessage(document.getElementById('mainBox').value, 'https://www.passlok.com');		//so that the Lock directory gets the Lock, too
		};
		document.getElementById('lockdir').style.display = "block";
		return
	}
	openClose('lockdir');
	focusBox()
}

//return from general directory frame
function dir2any(){
	openClose('lockdir');
	focusBox()
}

//to load general Lock directory only once
function loadLockDir(){
	if(document.getElementById('lockdirframe').src != 'https://www.passlok.com/lockdir') document.getElementById('lockdirframe').src = 'https://www.passlok.com/lockdir';
}

//loads the chat frame
function main2chat(token){
	var chatframe = document.getElementById('chatframe');
	chatframe.src = 'chat/index.html#' + token;
	document.getElementById('chatscr').style.display='block';
}

//called when the Key box is empty
function any2key(){
	document.getElementById('shadow').style.display = 'block';
	document.getElementById('keyscr').style.display = 'block';
	if(document.getElementById("email").value.trim=='') any2email();
	if(!isMobile) document.getElementById("pwd").focus();
	allowCancelWfullAccess = false
}

//called when the email box is empty
function any2email(){
	document.getElementById('shadow').style.display = 'block';
	document.getElementById('emailscr').style.display = 'block';
	if(!isMobile) document.getElementById("email").focus()
}

//close screens and reset Key timer when leaving the Key box. Restarts whatever was being done when the Key was found missing.
function key2any(){
	clearTimeout(keytimer);
	keytimer = setTimeout(function() {document.getElementById('pwd').value = ''}, 300000)	//reset timer for 5 minutes, then delete Key
	keytime = new Date().getTime();
var mykey = document.getElementById('pwd').value.trim();
	document.getElementById('keyscr').style.display = 'none';
	document.getElementById('shadow').style.display = 'none';
	if(lockDB['myself'] == null && mykey != ''){		//if "myself" lockDB entry containing the Key's matching Lock is not present, add it
		var email = readEmail();
		var mylock = makepub(mykey,email);
		if(fullAccess) storemyself(mykey,mylock);
	};
	if(lockDB['myself'][2] != null && fullAccess){					//fill email box
		var emailcrypt = lockDB['myself'][2];
		document.getElementById('email').value = keyDecrypt(mykey, emailcrypt);
	}
	if (callKey == 'encrypt'){						//now complete whatever was being done when the Key was found missing
		Encrypt_single()
	}else if(callKey == 'decrypt'){
		Decrypt_single()
	}else if(callKey == 'sign'){
		applySignature()
	}else if(callKey == 'addlock'){
		addLock()
	}else if(callKey == 'decryptitem'){
		decryptItem()
	}else if(callKey == 'decryptlock'){
		decryptLock()
	}else if(callKey == 'mergedb'){
		mergeLockDB()
	}else if(callKey == 'movedb'){
		moveLockDB()
	} else if(callKey == 'showlock'){
		showLock()
	} else if(callKey == 'fillbox'){
		fillBox()
	} else if(callKey == 'changekey'){
		changeKey()
	} else if(callKey == 'movemyself'){
		moveMyself()
	}
	focusBox()
}

//leave email screen
function email2any(){
	if(document.getElementById('email').value == '') document.getElementById('email').value = ' ';		//use a space so it's OK to use an empty email
	if(fullAccess) storeEmail();
	document.getElementById('emailscr').style.display = 'none';
	if(fullAccess && lockDB['myself']) checkKey(document.getElementById('pwd').value);
	key2any();
}

//put cursor in the box. Handy when using keyboard shortcuts
function focusBox(){
	if (!isMobile){															//on mobile, don't focus
		if(document.getElementById('keyscr').style.display == 'block'){
			document.getElementById("pwd").focus()
		} else if(contentDivs['dirTab'].className == 'tabContent'){
			document.getElementById("locknameBox").focus()
		} else {
			document.getElementById("mainBox").focus()
		}
	}
}

//sets Learn mode when the appropriate box is checked
function setlearnmode(){
	if (document.getElementById("learnmode").checked) {learnOn = true} else {learnOn = false}
}

//to see if there is a Chrome sync data area. Works for Chrome apps and extensions
function testChromeSync(){
	if(isChrome){
	if(chrome.storage){
		if(chrome.storage.sync){
			return true
		} else {return false}
	} else {return false}
	}
}

//simple XSS filter for use in innerHTML-editing statements. Removes stuff between angle brackets
function XSSfilter(string){
	return string.replace(/<(.*?)>/gi, "")
}

<!-- Text hide trick, by Sandeep Gangadharan 2005-->
if (document.getElementById) {
 document.writeln('<style type="text/css"><!--')
 document.writeln('.texter {display:none} @media print {.texter {display:block;}}')
 document.writeln('//--></style>') }

function openClose(theID) {
 if (document.getElementById(theID).style.display === "block") { document.getElementById(theID).style.display = "none" }
 else { document.getElementById(theID).style.display = "block" } };
// end of hide trick

<!--variables and functions for making tabs, by Matt Doyle 2009-->
    var tabLinks = new Array();
    var contentDivs = new Array();

    function initTabs() {

      // Grab the tab links and content divs from the page
      var tabListItems = document.getElementById('tabs').childNodes;
      for ( var i = 0; i < tabListItems.length; i++ ) {
        if ( tabListItems[i].nodeName == "LI" ) {
          var tabLink = getFirstChildWithTagName( tabListItems[i], 'A' );
          var id = getHash( tabLink.getAttribute('href') );
          tabLinks[id] = tabLink;
          contentDivs[id] = document.getElementById( id );
        }
      }

      // Assign onclick events to the tab links, and
      // highlight the first tab
      var i = 0;

      for ( var id in tabLinks ) {
        tabLinks[id].onclick = showTab;
        tabLinks[id].onfocus = function() { this.blur() };
        if ( i == 0 ) tabLinks[id].className = 'selected';
        i++;
      }

      // Hide all content divs except the first
      var i = 0;

      for ( var id in contentDivs ) {
        if ( i != 0 ) contentDivs[id].className = 'tabContent hide';
        i++;
      }
    }

    function showTab() {
      var selectedId = getHash( this.getAttribute('href') );

      // Highlight the selected tab, and dim all others.
      // Also show the selected content div, and hide all others.
      for ( var id in contentDivs ) {
        if ( id == selectedId ) {
          tabLinks[id].className = 'selected';
          contentDivs[id].className = 'tabContent';
        } else {
          tabLinks[id].className = '';
          contentDivs[id].className = 'tabContent hide';
        }
      }

      // Stop the browser following the link
      return false;
    }

    function getFirstChildWithTagName( element, tagName ) {
      for ( var i = 0; i < element.childNodes.length; i++ ) {
        if ( element.childNodes[i].nodeName == tagName ) return element.childNodes[i];
      }
    }

    function getHash( url ) {
      var hashPos = url.lastIndexOf ( '#' );
      return url.substring( hashPos + 1 );
    }
//end of tab functions

//function to search in Help tab, from JAVASCRIPTER.NET 2011
var TRange=null;

function findString (str) {
 if (parseInt(navigator.appVersion)<4) return;
 var strFound;
 if (window.find) {

  // CODE FOR BROWSERS THAT SUPPORT window.find

  strFound=self.find(str);
  if (!strFound) {
   strFound=self.find(str,0,1);
   while (self.find(str,0,1)) continue;
  }
 }
 else if (navigator.appName.indexOf("Microsoft")!=-1) {

  // EXPLORER-SPECIFIC CODE

  if (TRange!=null) {
   TRange.collapse(false);
   strFound=TRange.findText(str);
   if (strFound) TRange.select();
  }
  if (TRange==null || strFound==0) {
   TRange=self.document.body.createTextRange();
   strFound=TRange.findText(str);
   if (strFound) TRange.select();
  }
 }
 else if (navigator.appName=="Opera") {
  alert ("Opera browsers not supported, sorry...")
  return;
 }
 if (!strFound){
	 document.getElementById('helpmsg').innerHTML = 'Text not found in the titles'
 }else{
	 document.getElementById('helpmsg').innerHTML = 'Text highlighted below. Click again to see more results'
 }
 return;
}

//The main script in the head ends here.
</script>

<!--special functions that work only with Chrome apps and extensions-->
<script>
//to put Lock into sync storage
function syncChromeLock(name,data) {
    var jsonfile = {};
    jsonfile[name.toLowerCase()] = data;
    chrome.storage.sync.set(jsonfile);
}

//to retrieve Lock from sync storage. The code specifying what to do with the item is here because the get operation is asynchronous
function getChromeLock(name) {
    chrome.storage.sync.get(name.toLowerCase(), function (obj) {
		var lockdata = obj[name.toLowerCase()];
		if(lockdata){
			storeChromeLock(name,lockdata)
		} else if(name.slice(0,2) != '--'){
			var name2 = '--' + name.toLowerCase() + '--';			//it may be a List, so change the name and try again
			lockdata = obj[name2];
			getChromeLock(name2)
		} else {
			if (name.slice(0,2) == '--') name = name.slice(2,name.length-2);
			document.getElementById("lockmsg").innerHTML = XSSfilter(name) + ' not found in your Chrome sync area'
		}
	});
}

function storeChromeLock(name,lockdata){
	lockDB[name] = JSON.parse(lockdata);
	document.getElementById("lockBox").value = lockDB[name][0];
	document.getElementById("lockmsg").innerHTML = XSSfilter(name) + ' added from your Chrome sync area';
	lockDB = sortObject(lockDB);
	localStorage.lockDB = JSON.stringify(lockDB);
	lockNames = [''].concat(Object.keys(lockDB));
	fillList();
}

//to completely remove an entry
function remChromeLock(name) {
    chrome.storage.sync.remove(name.toLowerCase());
}
</script>

</head>

<body>

<!--Tabs-->
<ul id="tabs">
      <li><a href="#mainTab" title="messages go here (alt-M)" accesskey="m">Main</a></li>
      <li><a href="#dirTab" title="Locks go here (alt-M)" accesskey="d">Directory</a></li>
      <li><a href="#optionsTab" title="several modes available (alt-O)" accesskey="o">Options</a></li>
      <li><a href="#helpTab" title="help for all functions (alt-M)" accesskey="h">Help</a></li>
    </ul>

<!--Main tab-->
<div class="tabContent" id="mainTab">
  <div align="center">
<br /><br /><br />
	<span id="mainmsg">Welcome to PassLok Privacy. Use the top box to select stored Locks. Hold Ctrl or cmd to select several.</span><br /><br />
    <select id='locklist' size='4' multiple style="padding:4px" title="Hold Ctrl or cmd to select several items"></select>
    <button id="resetListButton" value="resetList" style="border:1px solid #dedede; color: #666666; background: #e6e6e6;" title="reset selection">Reset</button><br /><br />
<div id="basicbuttonstop" class="texter" style="font-size:0;display: block;">
	<button class="cssbutton" id="clearMainButtonBasic" value="Clear" style="font-size:22px;padding:13px;" title="clear the text in the box">Clear</button><!--
--><button class="cssbutton" id="selectMainButtonBasic" value="Select" style="font-size:22px;padding:13px;" title="select the text in the box">Select</button><!--
--><button class="cssbutton" id="sendMailButtonBasic" value="Mail" style="font-size:22px;padding:13px;" title="put the box contents in an email using the default client (alt-E)" accesskey="e">Mail</button><!--
--><button class="cssbutton" id="chatButtonBasic" value="Chat" style="font-size:22px;padding:13px;" title="make a chat invitation or open it (alt-C)" accesskey="c">Chat</button>
</div>
<div id="mainbuttonstop" class="texter" style="display: none;">
	<button class="cssbutton" id="clearMainButton" value="Clear" style="" title="clear the text in the box">Clear</button><!--
--><button class="cssbutton" id="selectMainButton" value="Select" style="" title="select the text in the box">Select</button><!--
--><button class="cssbutton" id="sendMailButton" value="Mail" style="" title="put the box contents in an email using the default client (alt-E)">Mail</button><!--
--><button class="cssbutton" id="chatButton" value="Chat" style="" title="make a chat invitation or open it (alt-C)">Chat</button><!--
--><button class="cssbutton" id="main2extraButton" value="More" style="color:orange;" title="replace main buttons with those for extra functions (alt-.)" accesskey=".">&#9660;</button>
</div>
<div id="extrabuttonstop" class="texter" style="display: none;">
	<button class="cssbutton" id="sendSMSButton" value="SMS" style="" title="mobile: open the default Texting app">SMS</button><!--
--><button class="cssbutton" id="imageButton" value="Image" style="" title="open image hiding functions (alt-I)" accesskey="i">Image</button><!--
--><button class="cssbutton" id="secretshareButton" value="Split/Join" style="" title="split plain box contents into several random-looking parts, or rejoin parts in the box (alt-J)" accesskey="j">Split/Join</button><!--
--><button class="cssbutton" id="extra2mainButton" value="Less" style="color:orange;" title="return main buttons (alt-.)">&#9650;</button>
</div>
    </div>
    <div align="center">
    <textarea class="cssbox" id="mainBox" name="text" rows="9" style="" placeholder="The text to be locked, unlocked, or signed goes here.   Before locking or verifying, you need to enter the other person's Lock." accesskey=";"></textarea>
    </div>
	<div align="center">
<div id="basicbuttonsbot" class="texter" style="display: block;">
   <button class="cssbutton" id="decryptButtonBasic" value="Lock/Unlock" style="font-size:22px;padding:14px;color:blue;" title="lock plain text in the box, unlock locked text (alt-L)" accesskey="l">Lock/Unlock</button><!--
--><button class="cssbutton" id="showlockButtonBasic" value="myLock" style="font-size:22px;padding:14px;" title="display your Lock (alt-K)" accesskey="k">myLock</button><!--
-->
</div>
<div id="mainbuttonsbot" class="texter" style="display: none;">
   <button class="cssbutton" id="decryptButton" value="Lock/Unlock" style="color:blue;padding-right:10px;padding-left:10px;" title="lock plain text in the box, unlock locked text (alt-L)" accesskey="">Lock/Unlock</button><!--
--><button class="cssbutton" id="verifyButton" value="Sign/Verify" style="padding-right:10px;padding-left:10px;" title="add signature based on secret Key and box contents, or verify existing signature (alt-V)" accesskey="v">Sign/Verify</button><!--
--><button class="cssbutton" id="showlockButton" value="myLock" style="padding-right:10px;padding-left:10px;" title="display your Lock (alt-K)">myLock</button><br />
</div>
<div id="extrabuttonsbot" class="texter" style="display: none;">
	<button class="cssbutton" id="wordsButton" value="Words" style="" title="hide box contents as words (recipient must have the Cover text), or reveal hidden contents (alt-W)" accesskey="w">Words</button><!--
--><button class="cssbutton" id="spacesButton" value="Spaces" style="" title="hide box contents as spaces between words (recipient does not need the Cover text, but long), or reveal hidden contents (alt-S)" accesskey="s">Spaces</button><!--
--><button class="cssbutton" id="coverButton" value="Cover" style="" title="if box is empty, display the current Cover text, otherwise set box contents as Cover text (alt-C)" accesskey="r">Cover</button><br />
</div>
  </div>
    </div>

<!--Directory tab-->
<div class="tabContent" id="dirTab">
    <div align="center">
    <br /><br /><br />
    	<span id="lockmsg">Enter Locks in the lower box. The top box is for Lock names</span><br />
    	<input type="text" class="cssbox" id="locknameBox" onKeyUp="locknameKeyup(event,'locknameBox');" style="" name="text" placeholder="Enter the name for the item below here."/></div>
    <div align="center" id="basiclockbuttonstop" class="texter" style="display: block;">
     <button class="cssbutton" id="clearLocksButtonBasic" value="Clear" style="font-size:22px;padding:14px;" title="clear both boxes">Clear</button><!--
--><button class="cssbutton" id="addLockButtonBasic" value="Save" style="font-size:22px;padding:14px" title="save lower box into the local directory with the name given in the upper box | if lower box is empty, make random item">Save</button><!--
--><button class="cssbutton" id="removeLockButtonBasic" value="Del." style="font-size:22px;padding:14px" title="delete the item whose name is displayed">Delete</button>
    </div>
    <div align="center" id="lockbuttonstop" class="texter" style="display: none;">
   <button class="cssbutton" id="clearLocksButton" value="Clear" style="" title="clear both boxes">Clear</button><!--
--><button class="cssbutton" id="addLockButton" value="Save" style="" title="save lower box into the local directory with the name given in the upper box | if lower box is empty, make random item">Save</button><!--
--><button class="cssbutton" id="removeLockButton" value="Delete" style="" title="delete the item whose name is displayed">Delete</button><!--
--><button class="cssbutton" id="resetPFSButton" value="Reset" style="" title="reset PFS data for the item whose name is displayed | if a List is displayed, clear the current List">Reset</button>
    </div>
		<textarea class="cssbox" id="lockBox" style="" name="text" rows="9" placeholder="Enter Locks and shared Keys here.   To save it, enter a name in the box above."></textarea>
	<div align="center" id="basiclockbuttonsbot" class="texter" style="display: block;">
     <button class="cssbutton" id="lock2dirButtonBasic" value="Directory" style="font-size:22px;padding:14px" title="open a screen containing the general PassLok directory (alt-G)" accesskey="g">General Directory</button>
    </div>
	<div align="center" id="lockbuttonsbot" class="texter" style="display: none;">
	<button class="cssbutton" id="addToListButton" value="List" style="" title="if lower box is empty display the current List, otherwise add box contents to the current List">List</button><!--
--><button class="cssbutton" id="showLockDBButton" value="All" style="" title="show the entire local directory">All</button><!--
--><button class="cssbutton" id="mergeLockDBButton" value="Merge" style="" title="merge lower box contents into the local directory | Diffie-Hellman merge of this and the main screen contents">Merge</button><!--
--><button class="cssbutton" id="moveLockDBButton" value="Move" style="" title="archive entire local directory, then delete it">Move</button><br />
<button class="cssbutton" id="lock2dirButton" value="Directory" style="" title="open a screen containing the general PassLok directory (alt-G)" accesskey="g">General Directory</button>
    </div>
    </div>

<!--Options tab-->
<div class="tabContent" id="optionsTab">
	<br /><br />
    &nbsp;&nbsp;Interface:<br /><br />&nbsp;&nbsp;<input type="radio" name="interfacemodes" id="basicmode"  title="basic mode; only essential functions (alt-B)" accesskey="b" checked/>&nbsp; Basic&nbsp;&nbsp;
        <input type="radio" name="interfacemodes" id="advancedmode" title="advanced mode; all functions available (alt-B)" accesskey="b"/>&nbsp; Advanced
        <hr>
        &nbsp;&nbsp;Locking mode:&nbsp;&nbsp;&nbsp;&nbsp;<input type="radio" name="lockmodes" id="anonmode"  title="anonymous locking mode; recipient's Lock needed (alt-A)" accesskey="a" checked/>&nbsp; Anonymous<br /><br />
        &nbsp;&nbsp;<input type="radio" name="lockmodes" id="signedmode" title="signed locking mode; recipient needs the sender's Lock (alt-N)" accesskey="n"/>&nbsp; Signed&nbsp;&nbsp;
        <input type="radio" name="lockmodes" id="pfsmode" title="Perfect Forward Secrecy: messages become unlockable after exchange (alt-P)" accesskey="p"/>&nbsp; PFS&nbsp;&nbsp;
        <input type="radio" name="lockmodes" id="oncemode" title="Read-once: like PFS but messages become unreadable after being read once" accesskey=""/>&nbsp; Read-once
        <hr>
        &nbsp;&nbsp;Other modes:&nbsp;&nbsp;&nbsp;&nbsp;<input type="checkbox" id="learnmode" title="get explanatory messages after buttons are pressed, but before functions are executed"/>&nbsp; Learn<br /><br />
    	&nbsp;&nbsp;<input type="checkbox" id="shortmode" title="locked message will fit within 160 characters (alt-R)" accesskey="r"/>&nbsp; Short&nbsp;&nbsp;&nbsp;
        &nbsp;&nbsp;<input type="checkbox" id="decoymode" title="second message added or retrieved (alt-Y)" accesskey="y"/>&nbsp; Decoy
      	&nbsp;&nbsp;<input type="checkbox" id="ezLok" title="display easy to read Lock" checked/>&nbsp; ezLok<br /><br />
    	&nbsp;&nbsp;<input type="checkbox" id="notags" title="no identifying tags or preformatted text (alt-T)" accesskey="t"/>&nbsp; No tags
       &nbsp;&nbsp;<input type="checkbox" id="triple" title="triple output separated by commas, for automatic error correction"/>&nbsp; Triple
       &nbsp;&nbsp;<input type="checkbox" id="encryptLocks" title="encrypt Locks in directory"/>&nbsp; encr. Locks
      <hr>
      <button class="cssbutton" id="changeKeyButton" value="Change Key" style="" title="re-encrypt directory with a new Key">Change Key</button><!--
   --><button class="cssbutton" id="changeEmailButton" value="Change Email" style="" title="change email/token">Change Email</button><!--
   --><button class="cssbutton" id="backupSettings" value="Backup" style="" title="backup and optionally reset options, including the email/token">Backup/Reset options</button>
      <hr>
      &nbsp;&nbsp;<span id="filemsg">File In/Out (Chrome, Firefox, Safari)</span><br /><br />
          	<input class="custom-file-input" type="file" id="fileToLoad" style="" title="open dialog to select file to load"/>
        <button class="cssbutton" id="savefileButton" value="Save" title="save file to default Downloads folder in original format, or as a text file if type is not recognized">Save</button>
    </div>

<!--Help tab-->
<div class="tabContent" id="helpTab">
<br />
<div id="helptop" style="position:fixed; background-color: white; width: 100%; top: 41px; display: none">
<br />
<span id='helpmsg'>For instructions on how to do things, click on each title below. Click again to hide.</span>
<br />
<!--search box, as an iframe-->
<iframe id="srchform2"
src="javascript:'<html><body style=margin:0px; ><form action=&quot;javascript:void();&quot; onSubmit=if(this.t1.value!=&quot;&quot;)parent.findString(this.t1.value);return(false); ><input type=text id=t1 name=t1 placeholder=Text&nbsp;to&nbsp;find size=20><input type=submit name=b1 value=Search&nbsp;titles></form></body></html>'"
 width=220 height=60 border=0 frameborder=0 scrolling=no seamless>
</iframe>
</div>

<br /><!--space so the items aren't buried below the fixed stuff-->

<div id="helpspace" style="background-color: white; display: none">
<br /><br /><br /><br /><br />
</div>

<div id="helptopmobile" style="display: block">
<p>For instructions on how to do things, click on each title below. Click again to hide.</p>
<p>To get instructions as you click buttons in PassLok, check <strong>Learn</strong> in the <strong>Options</strong> tab.</p>
</div>

<!--the help items begin here-->
<hr>
    <div id="aa1" style="cursor:pointer">
	<h3>What is PassLok?</h3>
    </div>
    <div id="a1" class="texter">
    <p>Before you do anything else, you may want to watch this six-minute video, which explains the essential concepts in a lighthearted way: <a href="https://www.youtube.com/watch?v=GqIm7fu_rMs" target="_blank">https://www.youtube.com/watch?v=GqIm7fu_rMs</a></p>
      <ul>
  	  <li>PassLok locks text and files using strong encryption.</li>
  	  <li>PassLok is based on Keys and Locks. You lock something with <strong>someone else's Lock</strong>, so only that person can unlock it with his/her Key.</li>
  	  <li>Your Key is a short piece of text, which <strong>can be anything you want so you can remember it</strong>.</li>
  	  <li>The matching Lock is then made from your Key, plus a public piece of data such as your email. It is impossible to get the Key or your email from the Lock.</li>
  	  <li>You should never give your Key to anyone. Your Lock, however, is meant to be distributed freely, like a phone number.</li>
      </ul>
  	<p>This approach has a number of advantages over other privacy apps that you may be familiar with:</p>
  	<ul>
  	  <li>PassLok does not involve a server, so it runs offline.</li>
  	  <li>The same code runs on computers, phones, and tablets, to make it perfectly portable.</li>
  	  <li>You can use PassLok with your favorite email or texting app, or any program, by cut and paste.</li>
  	  <li>PassLok does not need to store anything secret. The only secret is your Key, which stays in your head.</li>
      <li>You can use PassLok with a public or borrowed device as easily and safely as with your private phone or computer.</li>
      </ul>
  	<p>PassLok is <strong>still in experimental phase</strong>, and there has not been enough time for security experts to uncover possible flaws. Bear this in mind before entrusting critical secrets to it.</p>
  </div>
  <hr>

  <div id="aa2" style="cursor:pointer">
<h3>How to make a strong Key</h3>
</div>
	<div id="a2" class="texter">
<p>You should be able to <strong>remember your secret Key</strong> without having to write it down. PassLok does not store the Key anywhere. In fact, it deletes it from memory after five minutes of not being used (this can be changed).</p>
<p>Your Key will be stronger if it contains <strong>caPiTals</strong> in unusual places,
  <strong>numb3rs</strong>, and <strong>$ymbol$</strong>. If you use common words, <strong>miespell</strong> them to make harder a "dictionary attack." Break the words up with <strong>num334bers</strong> and <strong>sy#$%mbols</strong>. Avoid anything that might be easy to guess. PassLok knows frequently used words, but hackers' dictionaries are bigger. Do not use grammatically correct sentences, even if PassLok gives a big score.</p>
<p>PassLok <strong>compensates for weak Keys by adding spurious computations</strong>. If PassLok is slow, this may be because your Key strength is less than Medium.</p>
<p>This and more is explained in this video tutorial: <a href="https://www.youtube.com/watch?v=JbNM_cf8My0" target="_blank">https://www.youtube.com/watch?v=JbNM_cf8My0</a></p>
</div>
  <hr>

<div id="aa54" style="cursor:pointer">
<h3>Get a hint to remember my Key</h3>
</div>
<div id="a54" class="texter">
<p>If you are reading this, likely you have gained limited access to PassLok by clicking <strong>Cancel</strong> at the Key entry screen. The good news is that you can still lock messages if you know the recipient's Lock or shared Key, verify signatures, and use the Locks stored in the local directory as well as all the auxiliary functions of PassLok. You can even make signatures and display the matching Lock if you enter a Key when PassLok asks for it.</p>
<p>The bad news is that  you cannot change anything stored in the local directory, and your use of it is limited to Locks. You cannot do anything that would involve your old Key, such as unlocking messages locked with your old Lock, or continuing a PFS conversation in course.</p>
<p>Well, we've got even worse news for you: we cannot help you to recover your old Key, because PassLok never stored it or sent it out. There are no hints, either. If you forgot your Key, <strong>it's gone, along with all encrypted items in the local directory</strong>. This includes the random token, if you used one.</p>
<div id='bb54' style="cursor:pointer">
  <p><em>Click here for More:</em></p>
</div>
<div id="b54" class="texter">
<p>Hopefully the limited access mode will let you get by until you remember your old Key. But if you want to get full access to PassLok with a new Key, here are the steps:</p>
<p>1. Go to the <strong>Options</strong> tab.</p>
<p>2. Click the <strong>Backup/Reset Options</strong> box. When a popup asks for confirmation to delete your settings, click <strong>OK</strong>.</p>
<p>3. Reload PassLok<strong></strong>.</p>
<p>4. The initial wizard will appear, and this time PassLok will accept whatever new Key and email or suchlike you want to give it. Now you're back in business and can use PassLok with the new Key to sign, unlock, store items in the local directory, etc.</p>
<p>At this point, the only directory entry that will work fully is 'myself'. You can reset or delete the entries that don't work one by one, by typing each name in the <strong>Directory</strong> tab and clicking <strong>Reset</strong> (leave essential data intact) or <strong>Delete</strong> (take out everything) when the name is recognized, or all at once by following the process described in a help item below, about &quot;moving the entire local directory.&quot;</p>
</div>
</div>
  <hr>

  <div id="aa55" style="cursor:pointer">
<h3>Use a different Key temporarily</h3>
</div>
<div id="a55" class="texter">
<p>There is only one &quot;secret Key&quot; that unlocks all the capabililties of PassLok, but if you are willing to accept a limited access to its functions, you can use a different Key for a given session, or whenever PassLok asks you for the Key. This way:</p>
<p>1. Enter the new Key in the box (optional).</p>
<p>2. Click the <strong>Cancel</strong> button.</p>
<p>3. If asked for your email etc., enter it and click <strong>OK</strong>. (the <strong>Random</strong> button will write a new random value, different from the original random token, if any, so beware)</p>
<p>You can do pretty much everything, except things that would have involved the permanent secret Key. You cannot modify anything in the local directory. When you reload PassLok, a warning will tell you that last session was run with limited access.</p>
</div>
  <hr>
  
  <div id="aa3" style="cursor:pointer">
<h3>Change your secret Key</h3>
</div>
<div id="a3" class="texter">
<p>1. Click the <strong>Change Key</strong> button on the <strong>Options</strong> tab. A new dialog will pop up asking you to enter the new Key twice.</p>
<p>2. Write the new Key in the two boxes in this dialog, and then click <strong>OK</strong>. A message will announce that the Key has changed. </p>
<p>This and more is explained in this video tutorial: <a href="https://www.youtube.com/watch?v=LubzBF4Xaa8" target="_blank">https://www.youtube.com/watch?v=LubzBF4Xaa8</a></p>
<div id='bb3' style="cursor:pointer">
  <p><em>Click here for More:</em></p>
</div>
<div id="b3" class="texter">
  <p>The items in the local directory are encrypted with your Key; this operation re-encrypts them with the new Key. Your Key is not stored anywhere, not even encrypted, but PassLok is still able to check whether the Key entered is the one in use.</p>
</div>
</div>
  <hr>

  <div id="aa4" style="cursor:pointer">
<h3>Make PassLok remember the secret Key for the current session</h3>
</div>
<div id="a4" class="texter">
<p>First, you must be aware that retaining the Key anywhere could lead to compromising it. This is why PassLok's default behavior is to forget the Key if it doesn't get used for five minutes. Still, you can make PassLok remember the Key for the current session by just checking the <strong>Remember</strong> checkbox when you enter your Key.</p>
<p>If you asked PassLok to remember your Key, make sure to close the app completely when you're done. On a mobile device, this may involve removing the app in the switcher screen.</p>
<p>There is no way to make PassLok remember your Key after it reloads.</p>
</div>
  <hr>
  
  <div id="aa52" style="cursor:pointer">
<h3>Make PassLok even more secure</h3>
</div>
<div id="a52" class="texter">
<p>When you first opened PassLok, you were asked to optionally enter your email or similar public, easy to recall personal information. But if instead of entering your email you click the <strong>Random</strong> button next to the input box, an 86-character random token is used. This makes your Lock  impossible to crack even if your Key is weak, but it becomes tied to the device where it was created.</p>
<p>To back up your random token to a safe place in case of accidental deletion or to be able to use a different device:</p>
<p>1. Click the <strong>Backup/Reset options</strong> button on the <strong>Options</strong> tab. A backup item bracketed by &quot;PL**bak&quot; tags appears on the main box, from where you can save it to file, copy it, email it, etc.</p>
<p>2. Then a dialog asks you if you want to reset your settings. If you click <strong>OK</strong>, PassLok will restart as if it had never started before, except that the local directory remains intact.</p>
<p>To restore the random token from a backup item, just paste the packup into the main box and click <strong>Lock/Unlock</strong>.</p>
<p>This and more is explained in this video tutorial: <a href="https://www.youtube.com/watch?v=4DjhIjU_nuM" target="_blank">https://www.youtube.com/watch?v=4DjhIjU_nuM</a></p>
<div id='bb52' style="cursor:pointer">
<p><em>Click here for More:</em></p>
</div>
<div id="b52" class="texter">
<p>The reason for the email or other additional data is to combat the &quot;rainbow table&quot; attack, where hackers pre-compute Locks made from the words in a dictionary. This data is encrypted and stored along with other settings, so you won't need to enter it again. The Lock depends both on the Key and the email or random token; this adds extra security, but it also means that if the random token gets erased you will not be able to unlock anything that was locked with your Lock. The backup item contains your settings, including the random token, double-encrypted by your secret Key. One reason to delete your settings while leaving the local directory intact is to be able to change the random token to a new value. You can also proceed without entering any email or token.</p>
</div>
</div>
  <hr>

  <div id="aa5" style="cursor:pointer">
<h3>Make the Lock matching your secret Key</h3>
</div>
<div id="a5" class="texter">
<p>Click the <strong>myLock</strong> button on the <strong>Main</strong> tab. The lock matching that Key will appear
  in the lower box, from where you can copy it or email it.</p>
<p>If then you go to the <strong>Directory</strong> tab and click the button labeled <strong>General Directory</strong>, PassLok's General Directory website will open, with its lower box filled with the Lock you just made. To post your Lock so others can find it, just write your email in the upper box and click the <strong>Post</strong> button.</p>
<p>This and more is explained in this video tutorial: <a href="https://www.youtube.com/watch?v=L00yybDzN6k" target="_blank">https://www.youtube.com/watch?v=L00yybDzN6k</a></p>
<div id='bb5' style="cursor:pointer">
<p><em>Click here for More:</em></p>
</div>
<div id="b5" class="texter">
  <p>By default, PassLok displays the Lock in ezLok format, consisting only of smallcase letters (except the L) and numbers, so it is easier to authenticate by reading aloud a portion of it. To display it in base64 format, which is the format of all other PassLok items, go to the <strong>Options</strong> tab and uncheck <strong>ezLok</strong>. The General Directory can take ezLok Locks as well as base64 Locks.</p>
  <p>Like most other PassLok-generated items, Locks will correct themselves from errors if their tags are intact, but you can make PassLok omit the tags by first checking <strong>no Tags</strong> in the <strong>Options</strong> tab. If you are going to send your Lock by a very noisy channel, you may want to send three copies so PassLok can select the best automatically. You will get triple copies of any item by first checking <strong>Triple</strong> in the <strong>Options</strong> tab.</p>
  <p>If you need to make a Lock for a different Key (for instance, in order to receive Decoy mode hidden messages), it is best if you start PassLok with limited access, by clicking <strong>Cancel</strong> when you first enter the Key, which will make PassLok accept a different Key. Then click <strong>myLock</strong> and supply your email, if requested.</p>
</div>
</div>
  <hr>

  <div id="aa6" style="cursor:pointer">
<h3>Lock a message with a Lock, to be unlocked with the matching Key (anonymous mode)</h3>
</div>
  <div id="a6" class="texter">
<p>1. If the recipients' Locks have been previously stored in the local directory, simply select their names in the top box of the <strong>Main</strong> tab. </p>
 <ul>
   <li>If not, go to the <strong>Directory</strong> tab and paste the Locks, one per line, in the lower box.</li>
 </ul>
 <p>2. Write or paste your message in the lower box of the <strong>Main</strong> tab.</p>
 <p>3. Click the <strong>Lock/Unlock</strong> button. The
   locked message will appear in the box, replacing the original message.</p>
 <p>Copy it and paste it into your
   communications program or click <strong>Mail</strong> to open your default email. </p>
 <p>This and more is explained in this video tutorial: <a href="https://www.youtube.com/watch?v=nBA5JNY4gmQ" target="_blank">https://www.youtube.com/watch?v=nBA5JNY4gmQ</a></p>
<div id='bb6' style="cursor:pointer">
<p><em>Click here for More:</em></p>
</div>
<div id="b6" class="texter">
<p>This message can only be unlocked by
   someone having the Key matching one of the Locks selected. Alternatively, you can retrieve a stored Lock by  beginning to type the name associated with it in the top box of the <strong>Directory</strong> tab, until the encrypted Lock appears in the lower box. You can also write the names, one per line, in the lower box. It is okay if the tags up to the "=" signs
   on the Lock are missing, or extra spaces, carriage returns, or special characters
  other than = + or / have been added (such as a video URL). If a Lock loses its tags as you enter it, this means that PassLok has recognized it and is cleaning it up for use. In Android, Locks are truly selected only after the top box is deselected.</p>
</div>
</div>
  <hr>

  <div id="aa7" style="cursor:pointer">
<h3>Unlock an anonymous locked message (tags
  are PL**msa)</h3>
  </div>
  <div id="a7" class="texter">
<p>1. Paste the locked message in the lower box of the <strong>Main</strong> tab.</p>
<p>2. Click the <strong>Lock/Unlock</strong> button. The unlocked message
  will appear in the box, replacing the locked message.</p>
<p>This and more is explained in this video tutorial: <a href="https://www.youtube.com/watch?v=nBA5JNY4gmQ" target="_blank">https://www.youtube.com/watch?v=nBA5JNY4gmQ</a></p>
<div id='bb7' style="cursor:pointer">
<p><em>Click here for More:</em></p>
</div>
<div id="b7" class="texter">
<p>It is okay if the message is broken up by
  spaces, carriage returns, and special characters other than = + / or % or is
  missing its tags.</p>
</div>
</div>
  <hr>

  <div id="aa8" style="cursor:pointer">
<h3>Send a PassLok item (Lock, message, etc.) by email</h3>
  </div>
  <div id="a8" class="texter">
<p>1. Check that the item is displayed on the <strong>Main</strong> tab.</p>
<p>2. Click the <strong>Mail</strong> button. If the device is so configured, a window appears containing the item and some explanatory text. You only need to supply the recipient's email address and a subject line before clicking the Send button.</p>
<p>This and more is explained in this video tutorial: <a href="https://www.youtube.com/watch?v=LsljKvjAi9I" target="_blank">https://www.youtube.com/watch?v=LsljKvjAi9I</a></p>
<div id='bb8' style="cursor:pointer">
<p><em>Click here for More:</em></p>
</div>
<div id="b8" class="texter">
<p>If you do not want any explanatory text accompanying the email, check the <strong>No tags</strong> checkbox in the <strong>Options</strong> tab before clicking <strong>Mail</strong>. This procedure only works for sending emails, not for receiving them. If you receive a PassLok-locked message, you must copy it to the clipboard and then paste it into the <strong>Main</strong> tab of PassLok, so it can be unlocked. Be also aware that webmail services, such as Gmail, limit the length of messages that can be composed this way. If you get an error from the mail host, you can always copy the contents of the box and paste it into a normal mail compose screen.</p>
</div>
  </div>
  <hr>

   <div id="aa50" style="cursor:pointer">
  <h3>Make an invitation to join a real-time multi-party chat session</h3>
 </div>
  <div id="a50" class="texter">
    <p>1. Select the other participants in the chat on the list at the top of the <strong>Main</strong> tab. You are automatically added.</p>
    <p>2. Click the <strong>Chat</strong> button. If the main box did not contain a chat invitation, a new one is generated and placed there. You can now email it with the <strong>Mail</strong> button, or send it out by any other means.</p>
    <p>This and more is explained in this video tutorial: <a href="https://www.youtube.com/edit?o=U&amp;video_id=XytUN0T_2zQ">https://www.youtube.com/edit?o=U&video_id=XytUN0T_2zQ</a></p>
<div id='bb50' style="cursor:pointer">
<p><em>Click here for More:</em></p>
</div>
<div id="b50" class="texter">
<p> Please tell participants about the time for the chat. When the time comes, you will join the chat using the same invitation as the other parties, so make sure to save it somewhere. All browsers can make a chat invitation, but some (Internet Explorer, Safari, anything on iOS) don't support joining the actual chat.</p>
</div>
  </div>
   <hr>

   <div id="aa56" style="cursor:pointer">
  <h3>Use an invitation to join a real-time chat session (tags are PL**chat)</h3>
 </div>
  <div id="a56" class="texter">
    <p>1. Place the invitation in the Main box and click the <strong>Chat</strong> button.</p>
    <p>2. A new screen opens. Write the name you want to use for the chat in the top box, and then click <strong>Start</strong> or <strong>Join</strong> depending on whether or not you are the first to arrive at the virtual chat room.</p>
    <p>3. As participants join the chat session, their chosen names will appear in the Text log (or a randomly-chosen tag, if they didn't supply a name). You can then post text by writing it in the Text box, followed by Enter. You can also post files by clicking the Browse or Files button.</p>
    <p>This and more is explained in this video tutorial: <a href="https://www.youtube.com/edit?o=U&amp;video_id=XytUN0T_2zQ">https://www.youtube.com/edit?o=U&video_id=XytUN0T_2zQ</a></p>
<div id='bb56' style="cursor:pointer">
<p><em>Click here for More:</em></p>
</div>
<div id="b56" class="texter">
<p> Connections between participants are direct, but a signaling server is used so the participants can find one another. After the chat has started, you can go back to PassLok and do other things. The connection will stay alive until you reload PassLok or the other participants leave. If things get out of hand, you can always reset your session with the <strong>Reset Chat</strong> button. Browsers are not equal as far as support for chat: Firefox is best, followed by Chrome (and Android browser), and then Opera (with problems). Internet Explorer, Safari, and anyhting on iOS don't support joining a chat, though you can make a chat invitation from them.</p>
</div>
  </div>
   <hr>
      
  <div id="aa9" style="cursor:pointer">
<h3>Lock a message with a Lock, to be unlocked with the matching Key, and sign it with your secret Key (signed mode)</h3>
  </div>
  <div id="a9" class="texter">
<p>1. On the <strong>Options</strong> tab, make sure the <strong>Signed</strong> button is selected.</p>
        <p>2. If the recipients' Locks have been previously stored in the local directory, simply select their names in the top box of the <strong>Main</strong> tab.</p>
        <ul>
          <li>If not, go to the <strong>Directory</strong> tab and paste the Locks, one per line, in the lower box.        </li>
        </ul>
        <p>3. Write or paste your message in the lower box of the <strong>Main</strong> tab.</p>
    <p>4. Click the <strong>Lock/Unlock</strong> button. The
    locked message will appear in the box, replacing the original message.</p>
    <p>Copy it and paste it into your
      communications program or click <strong>Mail</strong> to open your default email.</p>
    <p>This and more is explained in this video tutorial: <a href="https://www.youtube.com/watch?v=R9UanENF3ro" target="_blank">https://www.youtube.com/watch?v=R9UanENF3ro</a></p>
<div id='bb9' style="cursor:pointer">
<p><em>Click here for More:</em></p>
</div>
<div id="b9" class="texter">
<p> This message can only be unlocked by
  someone having the Key matching one of the Locks selected, and your Lock. Alternatively, you can retrieve a stored Lock by  beginning to type the name associated with it in the top box of the <strong>Directory</strong> tab, until the encrypted Lock appears in the lower box. You can also write the names, one per line, in the lower box. It is okay to strip the tags up to the "=" sign, but not recommended. PassLok will do this automatically if the No tags checkbox is checked prior to locking. It is also okay to split the locked message with spaces, line returns, and punctuation other than = + / or % This message can only be unlocked by someone having the Key matching the Lock used to lock it. Additionally, they must have your Lock in order to verify that it comes from you.</p>
</div>
  </div>
  <hr>

  <div id="aa10" style="cursor:pointer">
<h3>Unlock a message  signed with the sender's Key (tags are PL**mss)</h3>
</div>
  <div id="a10" class="texter">
<p>1. If the sender's Lock has been previously stored in the local directory, simply select its name in the top box of the <strong>Main</strong> tab.</p>
    <ul>
      <li>If not, go to the <strong>Directory</strong> tab and paste the Lock in the lower box.    </li>
    </ul>
    <p>2. Paste the locked message in the lower box of the <strong>Main</strong> tab. </p>
    <p>3. Click the <strong>Lock/Unlock</strong> button. The unlocked message
        will replace the locked message.</p>
    <p>This and more is explained in this video tutorial: <a href="https://www.youtube.com/watch?v=R9UanENF3ro" target="_blank">https://www.youtube.com/watch?v=R9UanENF3ro</a></p>
<div id='bb10' style="cursor:pointer">
<p><em>Click here for More:</em></p>
</div>
<div id="b10" class="texter">
<p>Alternatively, you can retrieve the sender's stored Lock by typing the name associated with it in the top box of the <strong>Directory</strong> tab until the encrypted Lock appears on the lower box. It is okay if the message is broken up by spaces, carriage returns, and special characters other than = + / or % or is missing its tags.</p>
</div>
  </div>
      <hr>

  <div id="aa11" style="cursor:pointer">
<h3>Lock a message so that nobody can read it after the exchange is over (PFS and Read-once modes)</h3>
  </div>
  <div id="a11" class="texter">
<p>1. On the <strong>Options</strong> tab, make sure the PFS or the Read-once button is selected.</p>
<ul>
  <li>In PFS mode, messages can no longer be unlocked after the next message is received from the same sender.</li>
  <li>In Read-once mode, messages can be unlocked only once, even if no more messages are received.</li>
</ul>
<p>2. Select the recipients' Locks in the top box of the <strong>Main</strong> tab. These modes require the recipients' Locks to be previously stored in the local directory.        </p>
        <p>3. Write or paste your message in the lower box of the <strong>Main</strong> tab.</p>
        <p>4. Click the <strong>Lock/Unlock</strong> button. The
    locked message will appear in the box, replacing the original message.</p>
        <p>Copy it and paste it into your
    communications program or click <strong>Mail</strong> to open your default email.</p>
        <p>This and more is explained in this video tutorial: <a href="https://www.youtube.com/watch?v=VutWfWZW5bY" target="_blank">https://www.youtube.com/watch?v=VutWfWZW5bY</a></p>
<div id='bb11' style="cursor:pointer">
<p><em>Click here for More:</em></p>
</div>
<div id="b11" class="texter">
<p>This message can only be unlocked by
  someone having the Key matching one of the Locks selected, and your Lock. If you are restarting a PFS or Read-once conversation that was interrupted, you must first clear the old PFS data for that recipient by clicking the <strong>Reset</strong> button in the <strong>Directory</strong> tab after the recipient's name is displayed above the upper box.  In Short mode, PFS mode is also Read-once. In Read-once mode, once a message is locked the sender is not allowed to lock another message for the same recipient in the same mode, since this would corrupt the exchange. This restriction does not apply to PFS mode, but you will get a warning alerting you if you are skipping a turn.  It is okay to strip the Lock tags up to the "=" sign, but not recommended.
          PassLok will do this automatically if the No tags checkbox is checked prior to locking. It is
          also okay to split the locked message with spaces, line returns, and
      punctuation other than = + / or %</p>
</div>
  </div>
  <hr>

  <div id="aa12" style="cursor:pointer">
<h3>Unlock a message  that was locked in PFS mode (tags are PL**msp) or Read-once mode (tags are PL**mso)</h3>
</div>
  <div id="a12" class="texter">
<p>1. Select the sender's Lock on the top box of the <strong>Main</strong> tab. This mode requires the sender's Lock to be previously stored in the device's local directory.</p>
      <p>2. Paste the locked message in the lower box of the  <strong>Main</strong> tab.</p>
      <p>3. Click the <strong>Lock/Unlock</strong> button. The unlocked message
        will replace the locked message.</p>
      <p>This and more is explained in this video tutorial: <a href="https://www.youtube.com/watch?v=VutWfWZW5bY" target="_blank">https://www.youtube.com/watch?v=VutWfWZW5bY</a></p>
<div id='bb12' style="cursor:pointer">
<p><em>Click here for More:</em></p>
</div>
<div id="b12" class="texter">
<p>If the message was locked in Read-once mode (identical to PFS, for Short messages), you can do this only once.  This restriction does not apply to regular length messages, but you will get a warning alerting you that a turn was skipped. It is okay if the message is broken up by
        spaces, carriage returns, and special characters other than = + / or % or is
      missing its tags.</p>
</div>
  </div>
      <hr>

  <div id="aa13" style="cursor:pointer">
<h3>Lock a message with a shared Key, to be unlocked with the same Key</h3>
</div>
      <div id="a13" class="texter">
<p>1. If the Keys shared with each of the recipients have been previously stored in the local directory, simply select their names in the top box of the <strong>Main</strong> tab.</p>
<ul>
  <li>If not, go to the <strong>Directory</strong> tab and paste the shared Keys, one per line, in the lower box. You can mix shared Keys and Locks.</li>
</ul>
<p>2. Write or paste the message in the lower box of the <strong>Main</strong> tab.</p>
<p>3. Click the <strong>Lock/Unlock</strong> button. The
  locked message will appear in the box, replacing the original text.</p>
<p>Copy it and paste it into your
  communications program or click <strong></strong><strong>Mail</strong> to open your default email program. </p>
<p>This and more is explained in this video tutorial:<a href="https://www.youtube.com/watch?v=sRdpWe4zya8" target="_blank">https://www.youtube.com/watch?v=sRdpWe4zya8</a></p>
<div id='bb13' style="cursor:pointer">
<p><em>Click here for More:</em></p>
</div>
<div id="b13" class="texter">
<p>This message can only be unlocked by
  someone having the same shared Key. It does not matter which of the radio buttons in the <strong>Options</strong> tab is selected, since they do not apply to this mode. Alternatively, you can search for a stored shared Key by typing the name associated with it in the top box of the <strong>Directory</strong> tab. When you type "Enter", the stored Key is decrypted for you to see.It is okay to strip the tags up to the "=" sign, but not recommended;
  PassLok will do this automatically if the No tags checkbox is checked prior to locking. It is
  also okay to split the locked message with spaces, line returns, and
  punctuation other than = + / or % The tags will depend on the type of locking selected for using Locks. There is no special tag to indicate that a shared Key was used instead of a Lock.</p>
</div>
  </div>
  <hr>

  <div id="aa14" style="cursor:pointer">
 <h3>Unlock a message locked with a shared Key</h3>
</div>
      <div id="a14" class="texter">
<p>1. If the Key shared with the sender has been previously stored in the local directory, simply select its name in the top box of the <strong>Main</strong> tab.</p>
<ul>
  <li>If not, go to the <strong>Directory</strong> tab and paste it in the lower box.</li>
</ul>
<p>2. Paste the locked message in the lower box of the <strong>Main</strong> tab.</p>
<p>3. Click the <strong>Lock/Unlock</strong> button. The unlocked message
  will appear in the main box, replacing the locked message.</p>
<p>This and more is explained in this video tutorial:<a href="https://www.youtube.com/watch?v=sRdpWe4zya8" target="_blank">https://www.youtube.com/watch?v=sRdpWe4zya8</a></p>
<div id='bb14' style="cursor:pointer">
<p><em>Click here for More:</em></p>
</div>
<div id="b14" class="texter">
<p>It is okay if the message is broken up by
  spaces, carriage returns, and special characters other than = + / or % or is
  missing its tags.</p>
</div>
</div>
  <hr>

    <div id="aa15" style="cursor:pointer">
    <h3>Make a short locked message suitable for texting</h3>
</div>
<div id="a15" class="texter">
<p>1. On the <strong>Options</strong> tab, check the <strong>Short</strong> checkbox. Also make sure the appropriate locking mode is selected with the radio buttons.</p>
<p>2. If the recipient's Lock of shared Key has been previously stored in the local directory, simply select its name in the top box of the <strong>Main</strong> tab.</p>
<ul>
  <li>If not, go to the <strong>Directory</strong> tab and paste the Lock in the lower box. Short mode is not available for multiple recipients.</li>
</ul>
<p>3. Write or paste your message into the lower box of the <strong>Main</strong> tab.</p>
<p>4. Click the <strong>Lock/Unlock</strong> button. The locked message will appear in the box, replacing the original message.</p>
<p>Copy it and paste it into your communications program. </p>
<p>This and more is explained in this video tutorial: <a href="https://www.youtube.com/watch?v=pD-uvyxKBgQ" target="_blank">https://www.youtube.com/watch?v=pD-uvyxKBgQ</a></p>
<div id='bb15' style="cursor:pointer">
<p><em>Click here for More:</em></p>
</div>
<div id="b15" class="texter">
<p>The locked
  message, which has no tags, will fit within one SMS message (160
  characters). The radio buttons don't matter if the message is being locked with a shared Key.   A message above the main box will tell you how much space is left, depending on the locking mode selected. On a mobile device, the locked message will be selected and ready to be copied into the clipboard. <strong>You need to copy it</strong> manually before clicking the <strong>Text/Img</strong> button, which will open your texting app.  Message length is limited to 58
  ASCII characters when locking with a shared Key or in signed mode, 38 in anonymous mode, 37 in PFS mode. Non-ASCII characters use 6 spaces each, so avoid them if
  you can. Any text beyond the limit will be lost.</p>
</div>
</div>
  <hr>

  <div id="aa16" style="cursor:pointer">
<h3>Unlock a short locked message (no tags)</h3>
  </div>
  <div id="a16" class="texter">
<p>1. If the message was locked in Signed or PFS mode, or with a shared Key, you will need to select the appropriate item in the top box of the <strong>Main</strong> tab, or enter it in the <strong>Directory</strong> tab, as described above.</p>
    <p>2. Paste the locked message in the lower box of the <strong>Main</strong> tab.</p>
    <p>3. Click the <strong>Lock/Unlock</strong> button. The unlocked message will appear in the box, replacing the locked message.</p>
<p>This and more is explained in this video tutorial: <a href="https://www.youtube.com/watch?v=pD-uvyxKBgQ" target="_blank">https://www.youtube.com/watch?v=pD-uvyxKBgQ</a></p>
<div id='bb16' style="cursor:pointer">
<p><em>Click here for More:</em></p>
</div>
<div id="b16" class="texter">
<p>It is okay if the message is broken up by
      spaces, carriage returns, and special characters. If the message was locked in PFS mode, you can unlock it only once, since this action erases the Key needed to unlock it.</p>
</div>
  </div>
  <hr>

<div id="aa17" style="cursor:pointer">
<h3>Add a Lock to the local directory</h3>
</div>
    <div id="a17" class="texter">1. Write a name for the Lock in the top box of the <strong>Directory</strong> tab.
      <ul>
        <li>Note, if a lock is displayed in the lower box, it means the name you entered is already in the local directory, and the  Lock will be replaced rather than added.</li>
      </ul>
      <p>2. Paste the Lock in the lower box, replacing whatever was there before. If the Lock loses its tags as you enter it, this means that PassLok has recognized it and is cleaning it up before storage. </p>
      <p>3. Click the <strong>Save</strong> button. A message confirms that the Lock has been saved under the name given.</p>
      <p>This and more is explained in this video tutorial: <a href="https://www.youtube.com/watch?v=vQrED7eIkLA" target="_blank">https://www.youtube.com/watch?v=vQrED7eIkLA</a></p>
<div id='bb17' style="cursor:pointer">
<p><em>Click here for More:</em></p>
</div>
<div id="b17" class="texter">
<p>The Lock will be stored unencrypted, but if you want it to be encrypted before storage, check the <strong>encr. Locks</strong> box in the <strong>Options</strong> tab before saving the Lock. You can store a number of things besides somebody's Lock: a shared Key, a cover text, a List. In the case of a List, the given name will be bracketed by double dashes. Items that are not Locks are always stored encrypted. (<em>Chrome app only</em>) The item will also be added to the Chrome sync area, so it is available on a different computer after you log into Chrome.</p>
</div>
    </div>
    <hr>

 <div id="aa18" style="cursor:pointer">
<h3>Retrieve a Lock from the local directory</h3>
</div>
      <div id="a18" class="texter">
<p>1. Start writing the name of the Lock in the top box of the <strong>Directory</strong> tab. As you type, the line above the box displays existing names that match what you have typed so far, and the Lock appears in the lower box.</p>
       <ul>
         <li>If the first character in the lower box is '~', the item is encrypted. PassLok can use the Lock in encrypted form, but if you want to see the decrypted version, press the Enter key after the name appears on the upper line.       </li>
       </ul>
       <p>This and more is explained in this video tutorial: <a href="https://www.youtube.com/watch?v=vQrED7eIkLA" target="_blank">https://www.youtube.com/watch?v=vQrED7eIkLA</a></p>
<div id='bb18' style="cursor:pointer">
<p><em>Click here for More:</em></p>
</div>
<div id="b18" class="texter">
<p> You can stop typing once you see the complete name for the Lock you're looking for. The process also works for shared Keys, Lists, and cover texts stored in the local directory. Search is case-insensitive, so if the item does not appear, this probably means that the name is wrong. If the item is a cover text, it loads automatically as new cover text.(<em>Chrome app only</em>) If you type "Enter" after a name that was not found on the local database, PassLok will look for it in its Chrome sync area, which syncs across computers, and then adds it to the local directory.</p>
</div>
      </div>
     <hr>

<div id="aa19" style="cursor:pointer">
 <h3>Delete a stored Lock</h3>
</div>
  <div id="a19" class="texter">
<p>1. Start writing the name of the Lock in the top box of the <strong>Directory</strong> tab. As you type, the line above the box displays existing names that match what you have typed so far, and the encrypted Lock appears in the lower box. </p>
       <p>2. Click the <strong>Delete</strong> button. A message confirms that the Lock has been deleted from the local directory.</p>
       <p>This and more is explained in this video tutorial: <a href="https://www.youtube.com/watch?v=vQrED7eIkLA" target="_blank">https://www.youtube.com/watch?v=vQrED7eIkLA</a></p>
<div id='bb19' style="cursor:pointer">
<p><em>Click here for More:</em></p>
</div>
<div id="b19" class="texter">
<p>You can stop typing once you see the complete name for the Lock you are looking for. This process also works for shared Keys, Lists, and cover texts stored in the local directory. Search is case-insensitive, so if the Lock does not appear, that probably means the name is wrong. (<em>Chrome app only</em>) If the Chrome sync area is accessible from the computer, the item will also be deleted from there, after a confirmation popup.</p>
</div>
  </div>
  <hr>

   <div id="aa20" style="cursor:pointer">
  <h3>Make a video to authenticate your Lock</h3>
  </div>
 <div id="a20" class="texter">
 <p>What should the video include:</p>
	<ul>
	<li> Identify yourself (First and Last name or other).</li>
	<li> Write your Lock on a sign and display it, and read a portion of it out loud (say, the first 12 characters after the initial tag).</li>
	<li>Make sure to distinguish capitals from smallcase letters.</li>
	<li> The video should be short, only a few seconds long (short video).</li>
	<li> Play a song in the background to ensure the video is not tampered with (recommended).</li>
</ul>

<p>What to do with the video: </p>
<ul>
	  <li> Upload the video to the Web.</li>
	  <li> Post the video in the General Directory on the line immediately below  your Lock.</li>
	  <li>For more instructions on this, go to How to add an authentication video under the General Directory help.      </li>
</ul>
<p>This and more is explained in this video tutorial: <a href="https://www.youtube.com/watch?v=zkcqEz3UjnM" target="_blank">https://www.youtube.com/watch?v=zkcqEz3UjnM</a></p>
<div id='bb20' style="cursor:pointer">
<p><em>Click here for More:</em></p>
</div>
<div id="b20" class="texter">
<p>It is highly recommended that you make a video whenever you change your secret Key, so that others can be assured that the matching Lock really belongs to you. When you post your Lock so that people can use it to lock messages for you, write the address of the video on the line immediately below the Lock, to facilitate the verifying process. Video URLs don't affect the function of Locks, so it is OK to handle the Lock and its video address as a unit.</p>
</div>
 </div>
    <hr>

   <div id="aa21" style="cursor:pointer">
  <h3>Authenticate a Lock without using videos</h3>
  </div>
 <div id="a21" class="texter">
   <p>The easy way: call the Lock's owner and ask him/her to read  a substantial portion of the Lock over the phone. But let's say you cannot establish a live conversation. If you are communicating exclusively by email, you can send a person whom you know and who knows you the following message, or something like it:</p>
      <p><br />
        <em>Dear So-and-So:</em><br />
        <em>I just obtained your PassLok Lock from (cite source), but I still wonder if it is authentic since I am unable to view the authenticating video. Therefore, I ask you to help me authenticate it through the interlock protocol. Here's what I want you to do:</em></p>
      <ol>
        <li><em>Write a message asking me to take a picture or video of myself doing something of your choice. Lock the message with my Lock, which is appended to this message, and copy it to a safe place. Then split it in two and send me the first half only.</em></li>
        <li><em>When I receive your first half, I will also write a message asking you to do something in a picture or short video. I'll lock that message with your Lock, and I'll send you half of the locked message first. When you get it, go ahead and send me the other half of your locked message.</em></li>
        <li><em>When I get your second half, I'll put together the two halves together and unlock your message. Then, following your instructions I'll send you the picture or video right away, unlocked, along with the second half of my locked request.</em></li>
        <li><em>When you get it, please verify that what I sent conforms to your instructions. If so, put together the two halves of my locked message to you, unlock it, and send me what I ask in the message as soon as possible, unlocked as well. Then I'll know that your Lock is authentic.</em></li>
   </ol>
      <p><em>Many thanks. Sincerely, This-and-That</em></p>
<div id='bb21' style="cursor:pointer">
<p><em>Click here for More:</em></p>
</div>
<div id="b21" class="texter">
<p>Alternatively, you can ask the other person to use PassLok's built-in Split/Join function, explained in another help item, rather than simply cutting messages in two.  The pictures or videos (or recordings) don't need to be locked. Only the instructions for making them need to be locked and transmitted with this two-step process. There is an article in the <a href="http://passlok.weebly.com/uploads/2/4/1/8/24187628/passlok_manual20.pdf" target="_blank">PassLok manual</a> that explains how this protocol works for authenticating Locks.</p>
</div>
</div>
<hr>

<div id="aa22" style="cursor:pointer">
      <h3>Use the General Directory</h3>
</div>
  <div id="a22" class="texter">
<p> The General Directory is a Web page that can store Locks and authentication videos associated with email addresses.</p>
<p> To get to the General Directory: Click the <strong>Directory</strong> tab. Then click the <strong>General Directory</strong> button.</p>
<ul>
  <li>If you are showing your Lock on the <strong>Main</strong> tab, it gets copied to the General Directory, ready for you to write your email address and click <strong>Post</strong>. </li>
  <li>Once you have found a Lock on the general directory, it gets copied automatically to the lower box of the <strong>Directory</strong> tab, so you only need to give it a name and click <strong>Save</strong>. </li>
</ul>
<p> The General Directory has its own Help page, which is structured like this one.    </p>
<p>This and more  is explained in this video tutorial: <a href="https://www.youtube.com/watch?v=QQQ2df2vPgs" target="_blank">https://www.youtube.com/watch?v=QQQ2df2vPgs</a></p>
<div id='bb22' style="cursor:pointer">
<p><em>Click here for More:</em></p>
</div>
<div id="b22" class="texter">
<p>PassLok does not guarantee the authenticity of the Locks posted on its General Directory. Email confirmation is required to post or update Locks, but this is not completely secure. Since users are encouraged to add authenticating videos and the General Directory has a button to play them, you should watch the video attached to a Lock before you use it.</p>
<p>The General Directory is meant as a convenience, not as a replacement for your local directory. The General Directory is not available when you are offline (the local one is). You cannot post anything but Locks on the General Directory.</p>
</div>
  </div>
  <hr>

  <div id="aa23" style="cursor:pointer">
  <h3>Load a file  to be locked, signed, or split</h3>
  </div>
  <div id="a23" class="texter">
    <p>1. Click the button at the bottom of the <strong>Options</strong> tab. Different browsers put different labels on it, such as <strong>"Browse"</strong>, <strong>"Choose File"</strong>, and so forth.</p>
  <p>2. A dialog will appear so you can navigate to the file. If all goes well, the file or image loads into the <strong>Main</strong> tab as a piece of gibberish text, with some identifying information at the top.</p>
  <p>Now you can lock it, sign it, or split it like a regular piece of text. The process to retrieve the original file is explained in the help item below.</p>
  <p>This and more is explained in this video tutorial: <a href="https://www.youtube.com/watch?v=-ifIkdredqk" target="_blank">https://www.youtube.com/watch?v=-ifIkdredqk</a></p>
<div id='bb23' style="cursor:pointer">
<p><em>Click here for More:</em></p>
</div>
<div id="b23" class="texter">
<p>Many mobile devices, unless they are jailbroken or rooted, restrict the user to images stored in the device or acquired with the built-in camera. Be aware that pictures taken by the camera are usually too large for PassLok to handle.</p>
</div>
  </div>
    <hr>

  <div id="aa24" style="cursor:pointer">
  <h3>Retrieve a file from encoded text</h3>
  </div>
    <div id="a24" class="texter">
      <p>1. Make sure the encoded file, which presumably has been obtained by unlocking or merging parts, is on the <strong>Main</strong> tab.  </p>
  <p>2. Click the <strong>Save file</strong> button at the bottom of the <strong>Options</strong> tab. What happens next depends on the browser. On mobile devices, usually you will be able to do something with the file by  long-clicking.</p>
  <p>This and more is explained in this video tutorial: <a href="https://www.youtube.com/watch?v=-ifIkdredqk" target="_blank">https://www.youtube.com/watch?v=-ifIkdredqk</a></p>
<div id='bb24' style="cursor:pointer">
<p><em>Click here for More:</em></p>
</div>
<div id="b24" class="texter">
<p>Chrome and Firefox will save the file, using the original name if not already taken by another file, into the default download location. Safari does the same, but gives it a generic name that you will have to edit later. Internet Explorer doesn't do anything. Mobile browsers normally open another tab displaying the file contents if the file type is recognized, and from there you can send it to another app.</p>
</div>
  </div>
    <hr>

  <div id="aa25" style="cursor:pointer">
<h3>Lock a second, undetectable message in addition to the main message
  (Decoy mode)</h3>
  </div>
  <div id="a25" class="texter">
    <p>1. On the <strong>Options</strong> tab, check the <strong>Decoy </strong>checkbox.</p>
<p>2. Follow the above instructions for any kind of locking. This also works when adding a signature. A popup will ask for a hidden message and a Decoy Key/Lock to lock it.</p>
<p>3. Input the  hidden message into the top box and the Decoy shared Key or Lock (either kind will work) in the bottom box. Then click <strong>OK</strong>. </p>
<p>The locked
  message containing both the main text and the hidden text will appear in
  the main box, replacing the original text. If it is a signature, it will be appended to the text. Copy it and paste it into your
  communications program.</p>
<p>This and more is explained in this video tutorial: <a href="https://www.youtube.com/watch?v=4WrYEdRp2Q4" target="_blank">https://www.youtube.com/watch?v=4WrYEdRp2Q4</a></p>
<div id='bb25' style="cursor:pointer">
<p><em>Click here for More:</em></p>
</div>
<div id="b25" class="texter">
<p>It is impossible to tell whether or not a locked message contains a hidden message. The length of the hidden message is limited to
  152 ASCII characters in key-locked and signed modes, 87 characters in
  anonymous and PFS modes, 37 characters in short message mode (key-locked or signed only), 40 characters in signatures. Non-ASCII characters
  use 6 spaces each, so avoid them if you can. Any text beyond the limit will be lost. As with regular locked messages, it is okay to
  strip the tags up to the "=" sign, but not recommended. It is also okay to
  split the locked message with spaces, line returns, and punctuation other
  than = + / or %. If a shared Key is used for the second message, the same shared Key is needed to retrieve it; if a Lock was used, its matching Key will be needed.</p>
</div>
</div>
  <hr>

  <div id="aa26" style="cursor:pointer">
<h3>Reveal the hidden text contained within a message locked in Decoy
  mode</h3>
  </div>
  <div id="a26" class="texter">
<p>1. On the <strong>Options</strong> tab, check the <strong>Decoy </strong>checkbox.</p>
<p>2. Follow the instructions for any of the unlocking modes. A popup will ask for a Decoy Key.</p>
<p>3. Input the Decoy Key. If it is a shared Key, leave the <strong>Shared</strong> box checked; if it is a secret Key, matching the Lock that was used to lock the hidden message, uncheck the <strong>Shared</strong> box.</p>
<p>4. Then click <strong>OK</strong>. The hidden message, if it exists,
  will appear above the main box.</p>
<p>This and more is explained in this video tutorial: <a href="https://www.youtube.com/watch?v=4WrYEdRp2Q4" target="_blank">https://www.youtube.com/watch?v=4WrYEdRp2Q4</a></p>
<div id='bb26' style="cursor:pointer">
<p><em>Click here for More:</em></p>
</div>
<div id="b26" class="texter">
<p>Since it is impossible to detect the presence of a hidden message, it is necessary to click the <strong>Decoy</strong> checkbox in order to check for it. In the case of signatures, the hidden message appears in the place normally used by the verification message, so if you still wish to verify the signature, you need to uncheck <strong>Decoy</strong> and click <strong>Sign/Verify</strong> again so the signature verification message is displayed. There is no way to tell whether the sender used a Key or a Lock for locking the hidden message, so the recipient must tell PassLok by checking or unchecking the <strong>Shared</strong> box.</p>
</div>
</div>
  <hr>

  <div id="aa53" style="cursor:pointer">
<h3>Protect a Lock, locked message, signature, or part from accidental errors</h3>
  </div>
  <div id="a53" class="texter">
<p>PassLok includes an error correction code as part of the tags attached to most items. It is located right before the end label. Character changes introduced in transmission will be corrected automatically, so long as the tags are present. But character deletions and additions make the error-correction process fail. If this happens to an item you have received, try it again without its tags.</p>
<p>If you foresee that the item may pick up a lot of errors during transmission, including deletions and additions, send three copies of it, separated by @ signs between them. PassLok will reconstruct the undamaged original out of a damaged triple copy automatically. PassLok will make the triple copies for you if you check <strong>Triple</strong> in the <strong>Options</strong> tab before generating the item.</p>
<div id='bb53' style="cursor:pointer">
<p><em>Click here for More:</em></p>
</div>
<div id="b53" class="texter">
<p>PassLok uses the Reed-Solomon algorithm to correct automatically up to 10 errors per 245-character block. If the item is short, the code at the end of the item, which is offset by &quot;=&quot; signs on either end, will be 20 characters long. The codes attached to longer items  are a multiple of 20 characters long. If three copies are present, PassLok will accept each character as good if it is found in two of the copies.</p>
</div>
  </div>
  <hr>

  <div id="aa27" style="cursor:pointer">
<h3>Access the advanced functions of PassLok</h3>
  </div>
  <div id="a27" class="texter">
<p>PassLok launches first in Basic mode, so you are able to lock and unlock messages and perform the essential Key and Lock management functions. But PassLok has <strong>a lot</strong> more capabilities, which become available when you click the <strong>Advanced</strong> checkbox in the <strong>Options</strong> tab. To get back to Basic mode, click the <strong>Basic</strong> checkbox. PassLok will remember your choice of interface next time you open it.</p>
<p>Some advanced capabilities include:</p>
<ul>
<li>Apply a digital signature to a text, and verify its authenticity.</li>
<li>Hide PassLok's random-looking output inside images or as apparently normal text.</li>
<li>Hide a undetectable second message in addition to the main locked message.</li>
</ul>
<p>This and mode is explained in this video tutorial: <a href="https://www.youtube.com/watch?v=Ttyvb0Qt7h0" target="_blank">https://www.youtube.com/watch?v=Ttyvb0Qt7h0</a></p>
  </div>
  <hr>

	<div id="aa28" style="cursor:pointer">
  <h3>Are there any keyboard shortcuts?</h3>
 </div>
  <div id="a28" class="texter">
    <p>The main functions in PassLok can be accessed directly from the keyboard. The button tooltips tell you what the shortcut is for each button that has a shortcut, but below is a complete list, just in case:    </p>
    <ul>
    <p>Alt-M: <strong>M</strong>ain tab</p>
    <p>Alt-D: <strong>D</strong>irectory tab</p>
    <p>Alt-H: <strong>H</strong>elp tab</p>
    <p>Alt-O: <strong>O</strong>ptions tab</p>
      <p>Alt-G: <strong>G</strong>eneral Lock directory open and close      </p>
      <p>Alt- <strong>.</strong> <em>(period)</em>: extra buttons open and close</p>
      <p>Alt-L: <strong>L</strong>ock or unlock </p>
      <p>Alt-V: sign or <strong>V</strong>erify</p>
      <p>Alt-E: send <strong>E</strong>mail</p>
      <p>Alt-C: start or join <strong>C</strong>hat</p>
      <p>Alt-B: switch <strong>B</strong>asic and Advanced modes      </p>
      <p>Alt-A: set <strong>A</strong>nonymous mode</p>
      <p>Alt-N: set sig<strong>N</strong>ed mode</p>
      <p>Alt-P: set <strong>P</strong>FS mode</p>
      <p>Alt-R: set sho<strong>R</strong>t mode</p>
      <p>Alt-T: set no <strong>T</strong>ags mode</p>
      <p>Alt-Y: set deco<strong>Y</strong> mode      </p>
      <p>Alt-I: <strong>I</strong>mage screen open and close</p>
      <p>Alt-J: split or <strong>J</strong>oin</p>
      <p>Alt-C: display or change <strong>C</strong>over text</p>
      <p>Alt-W: hide as <strong>W</strong>ords, or unhide</p>
      <p>Alt-S: hide as <strong>S</strong>paces, or unhide      </p>
      <p>Alt- <strong>;</strong> <em>(semicolon)</em>: put cursor on main box</p>
    </ul>
<div id='bb28' style="cursor:pointer">
<p><em>Click here for More:</em></p>
</div>
<div id="b28" class="texter">
<p>The list is made for access from Windows or Linux, so that each shortcut is of the form Alt-<em>letter</em>. If you are using a Mac, you should type ctrl-alt-<em>letter</em> instead. Shortcuts do not work on mobile devices.</p>
</div>
  </div>
   <hr>

   <div id="aa29" style="cursor:pointer">
<h3>Check the authenticity of the code</h3>
</div>
<div id="a29" class="texter">
<p>If you got PassLok from an app store, that app store is ensuring that the code you have is what the author gave to them. The following is to check the integrity of an html version of PassLok running in a browser:</p>
<p>1. Direct your browser to "view source." If your browser has a command to save the source (Chrome, Firefox, and Safari do), go ahead and save it to file.</p>
<p>2. Now you have to take the SHA256 of the code using a program different from PassLok. You have several options:</p>
<ul>
<li>Use a local program or online utility to take the SHA256 of the source saved to a file.</li>
<li>Use an online utility where you paste the text on a box and click a button. You must make sure that pasting does not add extra space at the top or the bottom of the file, which would affect the result.</li>
</ul>
<p>3. Look up the SHA256 for this version of PassLok, which is published on the PassLok information website at passlok.weebly.com and a number of other places. If this value and the one obtained in step 2 are not the same, the program has been tampered with.</p>
<p>4. Now, a hacker who could alter the source code at the server might also be able to change the published SHA256 so it matches the tampered code. To make sure that the value is authentic you should watch the one-minute video where the author or PassLok, Francisco Ruiz, reads it aloud. A link to the video usually accompanies the published SHA256 value.</p>
<p>This and more is explained in this video tutorial: <a href="https://www.youtube.com/watch?v=NrAfSo2xjnY" target="_blank">https://www.youtube.com/watch?v=NrAfSo2xjnY</a></p>
<div id='bb29' style="cursor:pointer">
<p><em>Click here for More:</em></p>
</div>
<div id="b29" class="texter">
<p>Typically, you load the source on a separate tab by typing CTRL-U (Windows) or option-cmd-u (OSX). Another way to save the source is to copy it by first selecting the the whole source code (CTRL-A or cmd-a), then copy to clipboard (CTRL-C or cmd-c), and then paste it into a text editor (CTRL-V or cmd-v), and save it from there. DO NOT save the code using the "save" command when the working PassLok page is displayed, since then the browser would modify the source code before saving it. The correct encoding is UTF-8, no BOM (notes: Windows Notepad is unable to save text in the correct format. Cut and paste from Chrome introduces artifacts for big items like the source code).</p>
<p>SHA256 is built into the OS in Linux and OSX, not so in Windows, but there are free programs available, such as Checksum Utility and Bitser. There are also online utilities where you can upload the file and get the hash. Online-convert (http://hash.online-convert.com/sha256-generator), fileformat.info (http://www.fileformat.info/tool/hash.htm) and freeformatter.com (http://www.freeformatter.com/sha256-generator.html) have worked well in our tests.</p>
<p>If you want a clipboard-based SHA256 utility, the one at Xorbin (http://www.xorbin.com/tools/sha256-hash-calculator) has worked quite well in our tests. Don't copy and paste from Chrome, since it introduces artifacts.</p>
<p>PassLok does have the ability to save anything contained in the main box to a text file by clicking the Save button, as well as to take the SHA256 of anything in the Locks screen, but be aware of the danger that these functions might have been tampered with.</p>
</div>
</div>
<hr>

  <div id="aa30" style="cursor:pointer">
<h3>Send a PassLok item by Text messaging (mobile only) <em>(advanced)</em></h3>
  </div>
  <div id="a30" class="texter">
<p>1. Check that the item to be sent is displayed on the <strong>Main</strong> tab.</p>
<p>2. Tap the <strong>Select</strong> button so the text can be selected.</p>
<p>3. Then tap the Copy label as it appears on screen. The item is copied to clipboard.</p>
<p>4. Tap the <strong>&#9660;</strong> button in order to reveal the button dealing with text messaging, which is labeled <strong>SMS</strong>, and tap it. A window appears with the default texting app.</p>
<p>5. Tap the input box and then paste the clipboard. Send the message in the usual way.</p>
<p>This and more is explained in this video tutorial: <a href="https://www.youtube.com/watch?v=LsljKvjAi9I" target="_blank">https://www.youtube.com/watch?v=LsljKvjAi9I</a></p>
<div id='bb30' style="cursor:pointer">
<p><em>Click here for More:</em></p>
</div>
<div id="b30" class="texter">
<p>To unlock a locked message received by texting, you must first copy it to the clipboard, and then paste it on the <strong>Main</strong> tab of PassLok. If you use Short mode to lock a message, steps 2 and 3 are automatic.</p>
</div>
  </div>
<hr>

  <div id="aa31" style="cursor:pointer">
<h3>Sign a text with your secret Key <em>(advanced)</em></h3>
</div>
<div id="a31" class="texter">
<p>1. Write or paste the text to be signed in the lower box of the <strong>Main</strong> tab.</p>
  <p>2. Click the <strong>Sign/Verify</strong>
    button. A signature matching the text and your Key will be appended at the end of the text. Copy
    it or email it from there.</p>
  <p>This and more is explained in this video tutorial: <a href="https://www.youtube.com/watch?v=QZvv1SJGh94" target="_blank">https://www.youtube.com/watch?v=QZvv1SJGh94</a></p>
<div id='bb31' style="cursor:pointer">
<p><em>Click here for More:</em></p>
</div>
<div id="b31" class="texter">
<p>It is okay to strip the tags up to the "="
    sign, but not recommended. PassLok will do this automatically if the No tags checkbox is checked prior to locking.
    It is also okay to split the signature with spaces,
  and punctuation other than line returns or = + or /.</p>
</div>
</div>
  <hr>

  <div id="aa32" style="cursor:pointer">
<h3>Verify a signature attached to a text (signature tags are PL**sig) <em>(advanced)</em></h3>
</div>
<div id="a32" class="texter">
<p>1. If the signer's Lock has been previously stored in the local directory, simply select its name in the top box of the <strong>Main</strong> tab.</p>
<ul>
  <li>If not, go to the <strong>Directory</strong> tab and paste the Lock in the lower box. </li>
</ul>
<p>2. Paste the text, with its signature appended on a separate line at the end, in the lower box of the  <strong>Main</strong> tab.</p>
<p>3. Click the <strong>Sign/Verify</strong> button. A message above the main box will say whether
  or not the signature for that text has been verified.</p>
<p>This and more is explained in this video tutorial: <a href="https://www.youtube.com/watch?v=QZvv1SJGh94" target="_blank">https://www.youtube.com/watch?v=QZvv1SJGh94</a></p>
<div id='bb32' style="cursor:pointer">
<p><em>Click here for More:</em></p>
</div>
<div id="b32" class="texter">
<p>It is okay
  if the signer's Lock is missing its tags up to the "=" signs , or extra spaces, carriage
  returns, or special characters other than = + or / have been added. This also goes for the signature, except that it should not be broken by carriage returns.</p>
</div>
</div>
    <hr>

 <div id="aa33" style="cursor:pointer">
 <h3>Reset the hidden information pertaining to a stored item (PFS, etc.) <em>(advanced)</em></h3>
 </div>
  <div id="a33" class="texter">
<p>1. Start writing the name of the item in the top box of the <strong>Directory</strong> tab. As you type, the line above the box displays existing items matching what you have typed so far, and the encrypted item appears in the lower box. You can stop typing once you see the complete name for the item you're looking for. Search is case-insensitive.</p>
          <p>2. Click the <strong>Reset</strong> button. A message confirms that the PFS data for the item has been deleted. You must reset the data pertaining to the other party whenever a PFS conversation has gone out of sync so the PFS process can be restarted.</p>
<p>This and more is explained in this video tutorial: <a href="https://www.youtube.com/watch?v=VutWfWZW5bY" target="_blank">https://www.youtube.com/watch?v=VutWfWZW5bY</a></p>
</div>
  <hr>

 <div id="aa34" style="cursor:pointer">
      <h3>Display the entire local directory <em>(advanced)</em></h3>
</div>
  <div id="a34" class="texter">
<p>Click the <strong>All</strong> button below the lower box of the <strong>Directory</strong> tab. The complete local directory, including PFS and hidden data, is displayed in the box so you can find items and copy them easily.</p>
     <p>This and more is explained in this video tutorial: <a href="https://www.youtube.com/watch?v=8zo-N5O82iM" target="_blank">https://www.youtube.com/watch?v=8zo-N5O82iM</a></p>
<div id='bb34' style="cursor:pointer">
<p><em>Click here for More:</em></p>
</div>
<div id="b34" class="texter">
<p>The format for each item is the following: name, followed by a colon (:), new line, item data; then two new lines before the next name, and so forth. If a name also has hidden data and PFS data, those follow the item data, occupying consecutive lines. Item 'myself' is special, and contains the Lock matching your secret Key and a collection of settings.</p>
</div>
  </div>
  <hr>

  <div id="aa35" style="cursor:pointer">
  <h3>Move the entire local directory <em>(advanced)</em></h3>
</div>
 <div id="a35" class="texter">
<p>1. Click the <strong>Move</strong> button below the lower box of the <strong>Directory</strong> tab. The entire directory is first locked with your secret Key, and then placed in the <strong>Main</strong> tab.</p>
      <p>2. Then a prompt asks you to confirm deleting it from the device. If you click <strong>OK,</strong> the entire local directory is deleted. If you click <strong>Cancel</strong>, the process ends and the directory contents are not deleted. In both cases the backup on the <strong>Main</strong> tab remains.</p>
      <p>3. To retrieve a backed-up directory (has PL**dir tags), place it in the <strong>Main</strong> tab and click <strong>Lock/Unlock</strong>. The database will be unlocked and placed in the <strong>Directory</strong> tab. Then you can add it to the device's current local directory by clicking <strong>Merge</strong>.</p>
      <p>This and more is explained in this video tutorial: <a href="https://www.youtube.com/watch?v=8zo-N5O82iM" target="_blank">https://www.youtube.com/watch?v=8zo-N5O82iM</a></p>
<div id='bb35' style="cursor:pointer">
<p><em>Click here for More:</em></p>
</div>
<div id="b35" class="texter">
<p>This process is useful whenever you stop using a device or just want to transfer it to another device. (<em>Chrome app only</em>) Even if the local directory is completely deleted, the items in your Chrome sync area remain available.</p>
</div>
 </div>
 <hr>

 <div id="aa36" style="cursor:pointer">
       <h3>Merge additional data into the local directory <em>(advanced)</em></h3>
</div>
  <div id="a36" class="texter">
<p>1. Paste the additional data into the lower box of the <strong>Directory</strong> tab.</p>
     <p>2. Click the <strong>Merge</strong> button. The new data is merged into the local directory.</p>
     <p>This and more is explained in this video tutorial: <a href="https://www.youtube.com/watch?v=8zo-N5O82iM" target="_blank">https://www.youtube.com/watch?v=8zo-N5O82iM</a></p>
<div id='bb36' style="cursor:pointer">
<p><em>Click here for More:</em></p>
</div>
<div id="b36" class="texter">
<p>The format for the additional data must be the following: name, followed by a colon (:), new line, item data; then two new lines before the next name, and so forth. If a name also has hidden data and PFS data, those follow the item data, occupying consecutive lines. If the additional data contains names that were already in use in the directory, the new data replaces the original data. Items are added in encrypted form but are not checked as they are added, so it is possible that different items may need different Keys to be decrypted, if you changed your secret Key in the past. (<em>Chrome app only</em>) If the Chrome sync area is accessible from the computer, the additional data will also be added to that area, so it is accessible from other computers.</p>
</div>
  </div>
  <hr>

 <div id="aa37" style="cursor:pointer">
     <h3>Use the List button <em>(advanced)</em></h3>
 </div>
  <div id="a37" class="texter">
<p>You can always make a List of Locks and shared Keys, in order to lock a message for multiple recipients, by writing the Locks or shared Keys in separate lines of the lower box in the <strong>Directory</strong> tab. Lists can be given names to save them in the local directory. Saved Lists appear highlighted in the top box of the <strong>Main</strong> tab. The <strong>List</strong> button facilitates making Lists this way:</p>
      <p>1. If you put several items on separate lines in the lower box of the <strong>Directory</strong> tab and click the <strong>List</strong> button, PassLok will remember them during the current session.</p>
      <p>2. To add one or several items to the List in memory, put them in the box and click<strong> List</strong> again. Duplicates are removed in the process.</p>
      <p>3. If you click <strong>List</strong> with the box empty, the current List in memory is displayed.</p>
      <p>4. If you click the <strong>Reset</strong> button while a List is displayed in the bottom box, the List in memory is deleted.</p>
      <p>This and more is explained in this video tutorial: <a href="https://www.youtube.com/watch?v=m4Ki9DHTVow" target="_blank">https://www.youtube.com/watch?v=m4Ki9DHTVow</a></p>
<div id='bb37' style="cursor:pointer">
<p><em>Click here for More:</em></p>
</div>
<div id="b37" class="texter">
<p>If you want to store a List permanently, you must first write a name for it in the top box, then write the items  in the lower box or display the List in memory by clicking the<strong> List</strong> button, and then click <strong>Save</strong>. Lists can contain Locks, shared Keys, or names of items in the local directory, but not names of other Lists.</p>
</div>
  </div>
     <hr>

  <div id="aa38" style="cursor:pointer">
  <h3>Make a random Key <em>(advanced)</em></h3>
  </div>
 <div id="a38" class="texter">
<p>PassLok has a built-in way to make a 86-character random Key: </p>
      <p>1. On the <strong>Directory</strong> tab, click <strong>Save</strong> with the lower box empty.</p>
   <p>2. If you actually want to save the random Key, write a name for it in the top box before you click <strong>Save</strong>.   </p>
   <p>This and more is explained in this video tutorial: <a href="https://www.youtube.com/watch?v=3OUpuk3-tRo" target="_blank">https://www.youtube.com/watch?v=3OUpuk3-tRo</a></p>
 </div>
 <hr>

   <div id="aa39" style="cursor:pointer">
  <h3>Combine a Key and a Lock <em>(advanced)</em></h3>
  </div>
 <div id="a39" class="texter">
      <p>This operation, which goes by the technical name of "Diffie-Hellman key exchange,"  is at the core of many PassLok functions. Should you ever want to compute the result manually, here is how to do it:</p>
      <p>1. Write or paste the Key or the Lock on the <strong>Main</strong> tab.</p>
      <p>2. Write or paste the other item in the lower box of the <strong>Directory</strong> tab. If the item is in PassLok's local directory, you can bring it out by starting to type its name in the top box.</p>
      <p>3. Click the <strong>Merge</strong> button. The Key and the Lock will merge and the 86-character result is placed in both the <strong>Main</strong> and <strong>Directory</strong> tabs.</p>
      <p>This and more is explained in this video tutorial: <a href="https://www.youtube.com/watch?v=0EImhN35Tbs" target="_blank">https://www.youtube.com/watch?v=0EImhN35Tbs</a></p>
<div id='bb39' style="cursor:pointer">
<p><em>Click here for More:</em></p>
</div>
<div id="b39" class="texter">
<p>If both items or neither of them is a valid Lock, the merging process fails and a message is displayed. The result of combining your secret Key and someone's Lock is the same as that of combining your Lock and that person's secret Key.</p>
</div>
 </div>
 <hr>

<div id="aa40" style="cursor:pointer">
  <h3>Split an item into several random-looking parts <em>(advanced)</em></h3>
</div>
<div id="a40" class="texter">
  <p>1. Put the item in the lower box of the <strong>Main</strong> tab.</p>
  <p>2. Click the <strong>&#9660;</strong> button, if needed, and then click the <strong>Split/Join</strong> button.  </p>
  <p>3. A popup asks for the total number of parts to be made, and the minimum number required to retrieve the original. Enter those numbers, which must be between 2 and 255, and click <strong>OK</strong>. The parts appear in the main box, replacing the original item, and a message confirms it. Copy the parts one by one and send or store them as needed.</p>
  <p>This and more is explained in this video tutorial: <a href="https://www.youtube.com/watch?v=ZdVHaD-FpSk" target="_blank">https://www.youtube.com/watch?v=ZdVHaD-FpSk</a></p>
<div id='bb40' style="cursor:pointer">
<p><em>Click here for More:</em></p>
</div>
<div id="b40" class="texter">
<p>The parts are enclosed within tags of the PL**p^^^ form, where ^^^ is the minimum number of parts that are needed to reconstruct the original. It is okay to strip the tags of the resulting parts up to the "=" sign, but not recommended. PassLok will do this automatically if the No tags checkbox is checked prior to locking. It is also okay to split the parts with spaces and punctuation other than = + / or line returns.</p>
</div>
</div>
<hr>

<div id="aa41" style="cursor:pointer">
  <h3>Join parts to retrieve the original item (tags are PL**p^^^) <em>(advanced)</em></h3>
</div>
<div id="a41" class="texter">
  <p>1. Paste a sufficient number of parts on separate lines of the lower box in the <strong>Main</strong> tab. Make sure that each part is unique. </p>
  <p>2. Click the <strong>&#9660;</strong> button, if needed, and then the  <strong>Split/Join</strong> button. If all goes well, the reconstructed item appears in the box.</p>
  <p>This and more is explained in this video tutorial: <a href="https://www.youtube.com/watch?v=ZdVHaD-FpSk" target="_blank">https://www.youtube.com/watch?v=ZdVHaD-FpSk</a></p>
<div id='bb41' style="cursor:pointer">
<p><em>Click here for More:</em></p>
</div>
<div id="b41" class="texter">
<p>You need as many parts as the second number entered when the item was split, which is written at the end of each  PL**p^^^ tag. Having more parts than the minimum is okay, so long as they belong to the same set and are not corrupt. They don't need to be placed in any particular order. If nothing happens, likely causes include: insufficient number of parts, incomplete or corrupt parts, parts belonging to different sets.</p>
</div>
</div>
  <hr>

  <div id="aa42" style="cursor:pointer">
<h3>Convert a PassLok item (Lock, message, etc.) into fake text <em>(advanced)</em></h3>
  </div>
  <div id="a42" class="texter">
<p>1. Check that the item to be converted into fake text is on the <strong>Main</strong> tab. Then click the <strong>&#9660;</strong> button, if needed, to show the <strong>Words</strong> and <strong>Spaces</strong> buttons.</p>
<p>2. If you wish to use a cover text different from the default and you have stored it in the local directory, select it on the top box of the <strong>Main</strong> tab. Otherwise you will have to change it using the process described in the help item two places below this one.</p>
<p>3. If now you click the <strong>Words</strong> button, each character of the text is replaced by a word from the cover text. If you click the <strong>Spaces</strong> button, the original text is encoded into the spaces of the cover text.</p>
<p>This and more is explained in this video tutorial: <a href="https://www.youtube.com/watch?v=Px2JweWna6s" target="_blank">https://www.youtube.com/watch?v=Px2JweWna6s</a></p>
<div id='bb42' style="cursor:pointer">
<p><em>Click here for More:</em></p>
</div>
<div id="b42" class="texter">
<p>The recipient of a Words-encoded text must have the same cover text in order to retrieve the original, but this is not necessary for Spaces-encoded text. The output of Spaces encoding is seven times longer than that of Words encoding. If the cover text is not long enough, it will be repeated several times and a warning message will tell you. If you used Spaces encoding, you should be careful not to add or delete any spaces within the encoded text, but it is okay to add more text to complete the last sentence, which may contain additional spaces.</p>
<p>Text-encoding is no substitute for real encryption, and so PassLok will refuse to convert into fake text anything that does not look like genuine PassLok output.</p>
</div>
  </div>
  <hr>

  <div id="aa43" style="cursor:pointer">
<h3>Retrieve the original PassLok item from fake text <em>(advanced)</em></h3>
  </div>
  <div id="a43" class="texter">
<p>1. Put the fake text on the <strong>Main</strong> tab.</p>
<p>2. Click the <strong>&#9660;</strong> button, if needed, followed by either the <strong>Words</strong> or the <strong>Spaces</strong> button (it doesn't matter which). If successful, the fake text is converted back into the original item and displayed in the box, replacing the fake text.</p>
<p>This and more is explained in this video tutorial: <a href="https://www.youtube.com/watch?v=Px2JweWna6s" target="_blank">https://www.youtube.com/watch?v=Px2JweWna6s</a></p>
<div id='bb43' style="cursor:pointer">
<p><em>Click here for More:</em></p>
</div>
<div id="b43" class="texter">
<p>If the fake text was encoded with the Words method using a cover text different from the default, you will have to load first the appropriate cover text by selecting it on the top box of the <strong>Main</strong> tab, if stored in the local directory, or using the process described in the next help item, if not stored.</p>
</div>
</div>
  <hr>

  <div id="aa44" style="cursor:pointer">
<h3>Display or change the cover used for fake text <em>(advanced)</em></h3>
  </div>
  <div id="a44" class="texter">
<p>To display the current cover text (which would be the default cover text if PassLok has just been reloaded), click the <strong>&#9660;</strong> button, if needed, and then the <strong>Cover</strong> button  with the box empty.</p>
<p>To change the cover text:</p>
<p>1. Copy a sufficiently long text (must have at least 70 different words) and paste it into the <strong>Main</strong> tab.</p>
<p>2. Click the <strong>&#9660;</strong> button, if needed, and then the <strong>Cover</strong> button. If the change is successful, the box goes blank, and a message confirms the change.</p>
<p>This and more is explained in this video tutorial: <a href="https://www.youtube.com/watch?v=Px2JweWna6s" target="_blank">https://www.youtube.com/watch?v=Px2JweWna6s</a></p>
<div id='bb44' style="cursor:pointer">
<p><em>Click here for More:</em></p>
</div>
<div id="b44" class="texter">
<p>Cover texts do not have to be in English or even use Latin characters. Anything that can be written in UTF-8 encoded characters can be used (most languages, including Arabic and Chinese, will work fine). If the change is unsuccessful, a message above the box will say why. Typically, failure to change the cover text is due to not having a sufficient number of different words. Use a longer text and try again.</p>
<p>Since the cover text is a (weak) sort of password for a Words-encoded item, it may be good to store often-used cover texts in your local directory so they can be loaded easily from the <strong>Main</strong> tab. To do this, go to the <strong>Directory</strong> tab, write a new name in the upper box, then paste the cover text in the lower box, and click <strong>Save</strong>. The cover text can be retrieved like any other stored item, and it will be automatically loaded after it is extracted from encrypted storage.</p>
</div>
</div>
  <hr>

 <div id="aa45" style="cursor:pointer">
  <h3>Hide a PassLok item inside an image <em>(advanced)</em></h3>
 </div>
  <div id="a45" class="texter">
 <p>1. Make sure the item to be hidden is in the lower box of the <strong>Main</strong> tab.</p>
 <p>2. Click the <strong>&#9660;</strong> button, if needed, and then the <strong>Image</strong> button.</p>
<p>3. A new screen appears where you can load the image where the item is to be hidden. To do so, click the <strong>"Choose File"</strong> or <strong>"Browse"</strong> button (browsers vary on the name). A dialog will appear, where you can navigate to the image and open it. A message will tell you how much data you can hide in the image.</p>
    <p>4. When you see the image, click the <strong>Hide</strong> button. A message will say when processing is completed, although the image will not appear to have changed.</p>
    <p>5. Right-click or long-press on the image in order to save it or send it somewhere.</p>
    <p>This and more is explained in this video tutorial: <a href="https://www.youtube.com/watch?v=_iXIyH6AnMI" target="_blank">https://www.youtube.com/watch?v=_iXIyH6AnMI</a></p>
<div id='bb45' style="cursor:pointer">
<p><em>Click here for More:</em></p>
</div>
<div id="b45" class="texter">
<p>Images only a few kB in size can hide PassLok items with hundreds of characters. Images taken with a mobile camera are usually too large for PassLok to be able to use them for hiding items, because of the processing required.</p>
</div>
  </div>
    <hr>

 <div id="aa46" style="cursor:pointer">
  <h3>Retrieve the PassLok item hidden inside an image <em>(advanced)</em></h3>
 </div>
  <div id="a46" class="texter">
      <p>1. Navigate to the image hiding screen from the <strong>Main</strong> tab by clicking <strong>&#9660;</strong>, if needed, and then <strong>Image</strong>.</p>
      <p>2. Click <strong>Choose File</strong> or <strong>Browse</strong> (browsers vary on this) and open the image containing the hidden item.</p>
      <p>3. When the image displays on the screen, click the <strong>Reveal</strong> button. A message will say when processing is completed and the hidden item has been retrieved, or no hidden item has been found.</p>
      <p>4. Click <strong>Back</strong> to see the item on the <strong>Main</strong> tab.</p>
      <p>This and more is explained in this video tutorial: <a href="https://www.youtube.com/watch?v=_iXIyH6AnMI" target="_blank">https://www.youtube.com/watch?v=_iXIyH6AnMI</a></p>
  </div>
   <hr>

	<div id="aa47" style="cursor:pointer">
  <h3>I have an item that was locked/signed with a previous version of PassLok, and the current version cannot handle it</h3>
 </div>
  <div id="a47" class="texter">
    <p>We do not recommend using old versions for new work. Newer versions have enhanced security and are more user-friendly. But sometimes you may need to handle an item that is incompatible with the current version. Here is a pretty complete list of PassLok versions, with links to them.</p>
    <p><strong>Current version</strong> of PassLok can be obtained from:</p>
<p>source server: <a href="https://passlok.com" target="_blank">https://passlok.com</a></p>
<p>information page: <a href="http://passlok.weebly.com" target="_blank">http://passlok.weebly.com</a></p>
<p>GitHub page: <a href="https://github.com/fruiz500/passlok" target="_blank">https://github.com/fruiz500/passlok</a></p>
<p>Chrome app: <a href="https://chrome.google.com/webstore/detail/passlok-privacy/epcchpdljafmfegifkigklfcmkphfmbh" target="_blank">https://chrome.google.com/webstore/detail/passlok-privacy/epcchpdljafmfegifkigklfcmkphfmbh</a></p>
<p>Android app: <a href="https://play.google.com/store/apps/details?id=com.fruiz500.passlok" target="_blank">https://play.google.com/store/apps/details?id=com.fruiz500.passlok</a></p>
<p>iOS app: <a href="https://itunes.apple.com/us/app/passlok-privacy/id879861603?mt=8&uo=4" target="_blank">https://itunes.apple.com/us/app/passlok-privacy/id879861603?mt=8&amp;uo=4</a></p>
<p>mirrors:</p>
<p><a href="https://www.autistici.org/passlok" target="_blank">https://www.autistici.org/passlok</a> (non-US, self-certified)</p>
<p><a href="https://passlok.site44.com" target="_blank">https://passlok.site44.com</a></p>
<p><a href="https://fruiz500.github.io/passlok" target="_blank">https://fruiz500.github.io/passlok</a></p>
<p>SHA256 for this version and video of the author reading it at:</p>
<p><a href="http://passlok.weebly.com/get-passlok.html" target="_blank">http://passlok.weebly.com/get-passlok.html</a></p>
<p>&nbsp;</p>
<p><strong>Previous versions:</strong></p>
<p><strong>1.7.08</strong> (87a4-fee6-8916-99fb-c59b-9d73-32dd-3023-5af0-3e69-18e0-caa3-d9e7-8a53-2385-957c)</p>
<p><a href="https://passlok.com/archive/passlok17.html" target="_blank">PassLok.com</a></p>
<p><a href="https://www.autistici.org/passlok/archive/passlok17.html" target="_blank">Autistici</a></p>
<p><a href="https://passlok.site44.com/archive/passlok17.html" target="_blank">Site44</a></p>
<p><a href="https://www.youtube.com/watch?v=yhGs76QReRM" target="_blank">Author reading the ID</a></p>
<p><strong>1.6.02</strong> (2c64-63d5-5d68-c7b2-9350-68cc-8bef-1a75-ddc1-1fa0-cd04-4428-f3ef-c079-e14f-4133)</p>
<p><a href="https://passlok.com/archive/passlok16.html" target="_blank">PassLok.com</a></p>
<p><a href="https://www.autistici.org/passlok/archive/passlok16.html" target="_blank">Autistici</a></p>
<p><a href="https://passlok.site44.com/archive/passlok16.html" target="_blank">Site44</a></p>
<p><a href="https://www.youtube.com/watch?v=Z5e9TVGMMsE" target="_blank">Author reading the ID</a></p>
<p><strong>1.5.03</strong>  (0061-4b79-8ba1-8fee-34c5-e243-96e9-4c7c-a0ea-cfc5-82c1-a44d-4cbb-06c4-ca00-985c)</p>
<p><a href="https://passlok.com/archive/passlok15.html" target="_blank">PassLok.com</a></p>
<p><a href="https://www.autistici.org/passlok/archive/passlok15.html" target="_blank">Autistici</a></p>
<p><a href="https://passlok.site44.com/archive/passlok15.html" target="_blank">Site44</a></p>
<p><a href="https://www.youtube.com/watch?v=YQIDRKE_wbI" target="_blank">Author reading the ID</a></p>
<p>The following (except 1.0) were edited so the archived help file works, changing the ID from the original (therefore no video)</p>
<p><strong>1.4.03</strong> (f1cc-8931-1d31-4d65-4dfe-fb0d-5368-f854-3766-b240-f131-c93f-a0e9-8d14-752e-018e)</p>
<p><a href="https://passlok.com/archive/passlok14.html" target="_blank">PassLok.com</a></p>
<p><a href="https://www.autistici.org/passlok/archive/passlok14.html" target="_blank">Autistici</a></p>
<p><a href="https://passlok.site44.com/archive/passlok14.html" target="_blank">Site44</a></p>
<p><strong>1.3.03</strong> (7c6f-3d59-1059-e712-15ea-8dcf-dcde-861a-7359-6508-3b29-5720-41c9-8271-cb69-f01a)</p>
<p><a href="https://passlok.com/archive/passlok13.html" target="_blank">PassLok.com</a></p>
<p><a href="https://www.autistici.org/passlok/archive/passlok13.html" target="_blank">Autistici</a></p>
<p><a href="https://passlok.site44.com/archive/passlok13.html" target="_blank">Site44</a></p>
<p><strong>1.2</strong> (c17b-c529-8757-578a-6bc2-bdc4-122e-c607-8c16-19ef-b9ee-8d4d-75aa-cf0a-b703-e0ec)</p>
<p><a href="https://passlok.com/archive/passlok12.html" target="_blank">PassLok.com</a></p>
<p><a href="https://www.autistici.org/passlok/archive/passlok12.html" target="_blank">Autistici</a></p>
<p><a href="https://passlok.site44.com/archive/passlok12.html" target="_blank">Site44</a></p>
<p><strong>1.1</strong> (8e5c-9714-eec3-cc65-aa8f-640d-d434-2747-aa24-624c-74c5-65ea-4077-0f0f-3b22-cc30)</p>
<p><a href="https://passlok.com/archive/passlok11.html" target="_blank">PassLok.com</a></p>
<p><a href="https://www.autistici.org/passlok/archive/passlok11.html" target="_blank">Autistici</a></p>
<p><a href="https://passlok.site44.com/archive/passlok11.html" target="_blank">Site44</a></p>
<p><strong>1.0</strong> (a907-25eb-50e3-e4a6-5f4b-27c1-684e-f590-6094-6fae-52f3-c7ca-47b1-732c-9eab-3e9b)</p>
<p><a href="https://passlok.com/archive/passlok10.html" target="_blank">PassLok.com</a></p>
<p><a href="https://www.autistici.org/passlok/archive/passlok10.html" target="_blank">Autistici</a></p>
<p><a href="https://passlok.site44.com/archive/passlok10.html" target="_blank">Site44</a></p>
  </div>
   <hr>

  <div id="aa48" style="cursor:pointer">
  <h3>I want to know PassLok in depth. Is there more information?</h3>
 </div>
  <div id="a48" class="texter">
    <p>Another way to learn is to check the <strong>Learn</strong> box in the <strong>Options</strong> tab, which will create a popup explaining what is about to happen, every time a button is clicked. If this is not enough for you, here are a couple more sources you may want to check out:</p>
    <p>The PassLok <a href="http://passlok.weebly.com/uploads/2/4/1/8/24187628/passlok_manual20.pdf" target="_blank">manual in PDF form.</a></p>
    <p>The PassLok informational website at <a href="http://passlok.weebly.com" target="_blank">http://passlok.weebly.com</a>. It contains a number of videos and more PDF documents.</p>
  </div>
   <hr>

   <div id="aa49" style="cursor:pointer">
  <h3>None of the help items answers my question / I want to give feedback</h3>
 </div>
  <div id="a49" class="texter">
    <p>Then you can send us an email at <a href="mailto:passlokprivacy@gmail.com?subject=PassLok support request" target="_blank">passlokprivacy@gmail.com</a> (the link will open your email client). We'll do our best to reply in a timely fashion.</p>
    <p>Good constructive feedback is hard to get, so let us <strong>thank you</strong> right now, before we read your email.</p>
  </div>
   <hr>


<div id="aa51" style="cursor:pointer">
<h3>Privacy Statement</h3>
</div>
<div id="a51" class="texter">
<p>PassLok provides excellent security, since it is a self-contained piece of code that neither relies on servers nor stores secret information to do its job. Therefore:</p>
<p><strong>1. We cannot give your secret Key to anyone</strong> (not even yourself) because we don't have it. Your Key is never stored or transmitted, and by default it gets deleted from memory  after five minutes of not being used.</p>
<p><strong>2. We cannot give your private data to anyone</strong> because PassLok does not send anything out of your device. We only store Locks that have been posted on our General Directory by their owners, and those are public by nature.</p>
<p><strong>3. We will never weaken the cryptography methods contained within PassLok at the request of a third party, private or public.</strong> This also means no backdoors will ever be added. We'd rather shut down PassLok than be forced to do this, which would betray the very essence of the program. If we learn that counterfeit versions of PassLok are circulating, whether placed by hackers or government agencies, we'll make the fact known to users.</p>
<p><strong>Notice:</strong> Since PassLok is distributed a piece of human-readable code, we consider it an expression of free speech protected by the laws of many countries. Putting into circulation tampered versions of PassLok violates free speech and copyright protection laws.</p>
<p>PassLok contains strong cryptographic methods, which may be illegal to use in some countries. Please check the local laws before using PassLok.</p>
</div>
<hr>
	<address>
	PassLok v2.0.04 &#169; F. Ruiz 2014
	</address>
    <ul>
	<li>
	engine: SJCL by Stark, Hamburg, and Boneh 2012</li>
    <li>
    general directory by W. Huang 2014</li>
	<li>
    Shamir secret sharing by A. Stetsyuk 2013</li>
	<li>
    image hiding: steganography.js by Peter Eigenschink 2012</li>
    <li>
    FastClick by FT Labs 2014</li>
    <li>
    file In/Out based on an article from the This Could Be Better blog. 2012</li>
    <li>
    sjcl-scrypt key stretching implementation by joe-invincible 2013</li>
    <li>erc-js Reed-Solomon error correction by cryodex 2014</li>
    <li>webRTC chat by Muaz Khan 2014</li>
    <li>
    testing, help items, interface ideas by the IIT IPRO-379 team 2014</li>
    </ul>
    <address>This document may be used, modified or redistributed under GNU GPL license, version 3.0 or higher.</address>
</div>

<!--Image screen-->
<div id='imagescr' class="block_page" align="center" style="display: none;">
    <button class="cssbutton" id="image2mainButton" value="< Back" title="return to main screen (alt-I)" accesskey="i">&#9668; Back</button>&nbsp;
    <button class="cssbutton" id="encode" value="Hide" title="hide main box contents into image">Hide</button>&nbsp;
    <button class="cssbutton" id="decode" value="Reveal" title="extract hidden content and put it in main box">Reveal</button><br /><br />

    <input class="custom-file-input" type='file' id='imagefile' style="" title="open a dialog to select the cover image"/><br /><br />

    <span id="imagemsg"></span><br /><br />

    <img id="preview" src="" width="100%"/>
</div>

<!--Shadow backdrop-->
<div id="shadow" class="black_overlay" style="display: block;">
</div>

<!--Key dialog-->
<div id="keyscr" class="white_content" align="center" style="display: block;">
    <div align="center">
    <br />
      	<span id="keymsg"><span style="color:red;font-weight:bold">JAVASCRIPT OFF, PASSLOK CANNOT RUN</span></span><br /><br />
		<input type="password" class="cssbox" autocomplete="off" id="pwd" onKeyUp="pwdKeyup(event);" style="" name="text" placeholder="Enter your secret Key here." align="center"><br /><br />
		<input type="checkbox" id="showKey" title="reveal box contents"> Show&nbsp;
       <input type="checkbox" id="never" title="turn off Key timer"> Remember<br /><br />
        <button class="cssbutton" id="cancelKeyButton" value="cancel" style="" title="close Key dialog">Cancel</button>&nbsp;
	 	<button class="cssbutton" id="acceptKeyButton" value="OK" style="" title="accept Key">OK</button>
        <span id="5min"><p>You will need to re-enter your Key if you don't use it for 5 min.</p></span>
        <p><strong>PassLok will be very slow</strong> if your Key is worse than Medium.</p>
        <p>To display your Lock, click myLock on the Main tab.</p>
        <p>Cancel for limited functionality.</p>
	</div>
</div>

<!--email dialog-->
<div id="emailscr" class="white_content" align="center" style="display: none;">
    <div align="center">
    <br />
<span id="emailmsg">Please enter your email or other public data or token you entered when you made your Lock</span><br /><br />
		<button class="cssbutton" id="randomEmailButton" value="random" style="" title="insert random token">Random</button><br /><br />
		<input type="text" class="cssbox" autocomplete="off" id="email" onKeyUp="emailKeyup(event);" style="" name="email" placeholder="Enter your email or some other not secret personal info here." align="center"><br /><br />
       <button class="cssbutton" id="cancelEmailButton" value="cancel" style="" title="close email dialog">Cancel</button>&nbsp;
	 	<button class="cssbutton" id="acceptEmailButton" value="OK" style="" title="accept email">OK</button>
        <p>Your Lock will change if this is not the same you entered before.</p>
        <p>If you use a random token, make sure to back it up from Options.</p>
	</div>
</div>

<!--Intro screen, split into four-->
<div id="introscr" class="block_page" align="center" style="display: none;">
  	<h2 style="color:green">Welcome to PassLok</h2>
  <div align="left" style="width:98%;">
  	<p>If you have three minutes to spare, you may want to begin by watching this fun video, which introduces the essential concepts.</p>
    <div align="center">
    <iframe id="videotutorial" seamless class="youtube-player" type="text/html" src="" frameborder="0" allowfullscreen></iframe></div>
  	<ul>
      <li>PassLok is based on Keys and Locks. You lock something with <strong>someone else's Lock</strong>, so only that person can unlock it with his/her Key.</li>
      <li>Your Key is a short piece of text. It can be anything. You must keep it secret.</li>
  	  <li>The matching Lock is then made from the Key. It is impossible to get a strong Key from its Lock.</li>
     </ul>
<button class="cssbutton" id="gotointro2" value="next" title="continue">Next &#9658;</button>
</div></div>

<div id="introscr2" class="block_page" align="center" style="display: none;">
<div align="left" style="width:98%;">
<button class="cssbutton" id="backtointro1" value="back" title="back to beginning">&#9668; Back</button><br />
  	<p>Now enter your Key in the box below. As you type your Key, a text above it will tell you its strength. Make sure to <strong>use $ymbol$, numb3rs, caPiTals, unusual words and mespelingss</strong>. The Suggest button will get you started with five words.</p>
  	<div align="center">
      		<span id="intromsg" style="color:green">This is where the score will appear</span><br /><br />
		<input type="password" class="cssbox" autocomplete="off" id="pwdIntro" style="width: 90%" name="text" placeholder="Enter your secret Key here" align="center"><br /><br />
        <input type="checkbox" id="showIntroKey" title="reveal box contents"> Show
      <button class="cssbutton" id="suggestIntroButton" value="Suggest" title="suggest a Key made of five common words">Suggest</button>
      <button class="cssbutton" id="clearIntroButton" value="Clear" title="clear box contents">Clear</button>
      <br />
	</div>
      	<p>PassLok compensates for weak Keys by adding computations. If your Key score is below Medium, <strong>PassLok will be very slow.</strong></p>
      	<p>You will <strong>never give this Key to anyone</strong>. Instead, you will give them your <strong>Lock</strong>.</p>
<button class="cssbutton" id="gotointro3" value="next" title="continue">Next &#9658;</button>
</div></div>

<div id="introscr3" class="block_page" align="center" style="display: none;">
<div align="left" style="width:98%;">
<button class="cssbutton" id="backtointro2" value="back" title="back to previous step">&#9668; Back</button><br />
<p>Security will be greatly enhanced if you write in the next box some public piece of data about yourself, such as your email address. PassLok will remember it, but it may ask you again if things get messed up. Your Lock will depend on it as well. You can skip this if you want.</p>
    <div align="center">
    <input type="text" class="cssbox" id="emailIntro" style="width: 90%" name="text" placeholder="Optionally, enter your email or some other not secret personal info here" align="center"><br /><br />
    <button class="cssbutton" id="introRandomButton" value="Random" title="display a random token">Random</button>
      <button class="cssbutton" id="clearIntroRandomButton" value="Clear" title="clear box contents">Clear</button>
      <br />
    </div>
<p>For ultimate security (at the expense of portability), you may want to click the Random button to use a random token instead. Make sure to back it up soon, by going the Options tab.</p>
<button class="cssbutton" id="gotointro4" value="next" title="continue">Next &#9658;</button>
</div></div>

<div id="introscr4" class="block_page" align="center" style="display: none;">
<div align="left" style="width:98%;">
<button class="cssbutton" id="backtointro3" value="back" title="back to previous step">&#9668; Back</button><br />
       <p>When you click the big button below, this screen will close and the Lock matching your Key will appear on PassLok's Main tab. Then you can copy it, email it, text it, and even post it on PassLok's general directory so others can see it.</p>
        <p>You will start in Basic mode, which shows only the most essential functions. If you are looking for more features, go to the Options tab and check the Advanced checkbox.</p>
        <p>You may not see this screen again, but comprehensive help is always available on the Help tab.</p>
    </div>
    <div align="center">
  <button class="cssbutton" id="showlockIntroButton" value="Make Lock" style="color:blue;" align="center" title="make matching Lock and opens main screen">Show Lock in Main Screen</button><br /><br />
  <span id="intromsg2" style="color:red"></span>
  </div>
</div>

<!--Key change dialog-->
<div id="keyChange" class="white_content" align="center" style="">
<br /><br />
        <span id="keychangemsg"></span><br /><br />
    	<input type="password" id="newKey" class="cssbox"  style="" name="newkey" placeholder="Enter the new Key here."/><br /><br />
        <input type="checkbox" id="showNewKey" title="reveal new Key"> Show
        <br /><br />
       <input type="password" id="newKey2" class="cssbox"  onKeyUp="newKey2up(event);" style="" name="newkey2" placeholder="Enter the new Key again."/><br /><br />
    	<button class="cssbutton" id="cancelKeychange" value="Cancel" title="do not change the Key">Cancel</button>&nbsp;
       <button class="cssbutton" id="submitKeychange" value="OK" title="go on with Key change">OK</button>
</div>

<!--Decoy In dialog-->
<div id="decoyIn" class="white_content" align="center">
		<p>Enter the Hidden Message</p>
        <span id="decoymsg"></span><br />
		<textarea id="decoyText" class="cssbox" style="" name="text" rows="3"></textarea>
       <p>Enter the Decoy Key/Lock</p>
    	<input type="password" class="cssbox" id="decoyPwdIn" onKeyUp="decoyKeyup(event);" style="" name="key"/><br />
        <input type="checkbox" id="showdecIn" title="reveal Key">&nbsp; Show
    	<button class="cssbutton" id="cancelDecoyButton" value="Cancel" title="do not lock">Cancel</button>&nbsp;
       <button class="cssbutton" id="submitDecoyButton" value="OK" title="go on with locking">OK</button>
</div>

<!--Decoy Out dialog-->
<div id="decoyOut" class="white_content" align="center">
		<p>Enter the Decoy Key</p>
    	<input type="password" class="cssbox" id="decoyPwdOut" onKeyUp="decoyKeyupOut(event);" style="" name="key"/><br /><br />
        <input type="checkbox" id="showdecOut" title="reveal Password">&nbsp; Show&nbsp;
        <input type="checkbox" id="shareddecOut" title="uncheck if this is not Shared" checked>&nbsp; Shared
        <br /><br />
    	<button class="cssbutton" id="cancelDecoy2Button" value="Cancel" title="stop unlock">Cancel</button>&nbsp;
       <button class="cssbutton" id="submitDecoy2Button" value="OK" title="go on with unlock">OK</button>
    	<p>The Hidden message will appear on the Main tab</p>
</div>

<!--Parts for SSSS dialog-->
<div id="partsIn" class="white_content" align="center">
		<p>Enter the total number of parts (between 2 and 255)</p>
    	<input type="text" class="cssbox" id="partsNumber" onKeyUp="partsKeyup(event);" style="width: 30%" name="text" rows="1"/><br />
		<p>And the number of parts needed to retrieve the item</p>
    	<input type="text" class="cssbox" id="partsQuorum" style="width: 30%" name="text" rows="1"/><br /> <br />
    	<button class="cssbutton" id="cancelPartsButton" value="Cancel" title="do not split">Cancel</button>&nbsp;
       <button class="cssbutton" id="submitPartsButton" value="OK" title="go on with splitting">OK</button>
</div>

<!--Chat dialog, to enter the chat type and date or other information-->
<div id="chatDialog" class="white_content" align="center">
<br><br><br>
		<span id="chatmsg">Choose the type of chat, then write in the box the date and time, if any</span><br/><br />
    	<input type="radio" name="chatmodes" id="datachat"  title="chat with text messages and file exchange" checked/>&nbsp; Text and files&nbsp;&nbsp;
        <input type="radio" name="chatmodes" id="audiochat" title="like Text chat, plus audio"/>&nbsp; Audio&nbsp;&nbsp;
        <input type="radio" name="chatmodes" id="videochat" title="like audio chat, plus video"/>&nbsp; Video
        <br /><br />
        <textarea id="chatdate" class="cssbox" style="" name="chatdate" rows="1" title="additional information" placeholder="Write here the date and time for the chat"></textarea><br /><br />
    	<button class="cssbutton" id="cancelChatButton" value="Cancel" title="cancel chat invitation">Cancel</button>&nbsp;
       <button class="cssbutton" id="submitChatButton" value="OK" title="make chat invitation">OK</button>
</div>

<!--General Directory screen, just an iframe for https://passlok.com/lockdir-->
<div id="lockdir" class="block_page" style="display: none;" align="center">
  <button class="cssbutton" id="closelockdirButton" value="< Back" style="float:left;" title="returns to Locks screen (alt-G)">&#9668; Back to PassLok</button>

    <iframe seamless id="lockdirframe" src="" style="width:100%;height:900px" border=0 frameborder=0> </iframe>

</div>

<!--Chat screen, just an iframe as well-->
<div id="chatscr" class="block_page" style="display: none;" align="center">
<button class="cssbutton" id="closechatButton" value="< Back" style="float:left;" title="returns to Main tab">&#9668; Back to PassLok</button>
<button class="cssbutton" id="resetchatButton" value="Reset" style="float:right;" title="reset the chat">Reset Chat</button>

    <iframe seamless id="chatframe" src="" style="width:100%;height:900px" border=0 frameborder=0 allowfullscreen sandbox="allow-same-origin allow-scripts"></iframe>
  
</div>

<!--Body script: window reformatting, special functions-->
<script>
//this is the part of the javascript code that must be within the body

	sjcl.random.startCollectors();										//start SJCL's built-in entropy collectors

//  Clear out "sorry, no JavaScript" message from first screen.
    document.getElementById('keymsg').innerHTML = "<span style='color:green'><strong>Welcome to PassLok Privacy</strong></span><br />Enter your Key here. Then click OK.";

	var rowheight = document.getElementById('pwd').clientHeight*0.5,	//get title size in pixels, for number of rows calculation. global variables
		isChrome = navigator.userAgent.toLowerCase().indexOf('chrome') > -1,
		isFirefox = typeof InstallTrigger !== 'undefined',   						// Firefox 1.0+
		isSafari = Object.prototype.toString.call(window.HTMLElement).indexOf('Constructor') > 0,       // At least Safari 3+: "[object HTMLElementConstructor]"
		isOpera = !!window.opera || navigator.userAgent.indexOf(' OPR/') >= 0,								// Opera 8.0+ (UA detection to detect Blink/v8-powered Opera)
		isIE = /*@cc_on!@*/false || !!document.documentMode,						 // At least IE6
		isiPad = (navigator.userAgent.match(/iPad/i) != null),
		isiPhone = (navigator.userAgent.match(/iPhone|iPod/i) != null),
		isiOS = (isiPhone || isiPad),
		isAndroid = (isMobile && !isiOS),
		isAndroidTablet = (navigator.userAgent.match(/mobile/i) == null && isAndroid),
		isAndroidPhone= (navigator.userAgent.match(/mobile/i) != null && isAndroid),
		angle = window.orientation;
	if((angle==90)||(angle==-90)){rowheight = rowheight*0.78}				//correction in case device starts in landscape
	if(isAndroid){rowheight = rowheight*1.1}		//Android rows are fatter
	textrows();
	chatResize();

//resizes text boxes so they fit within the window
function textrows(){
	if(isiPad || isAndroidTablet){												//first for iPad. Don't know how to detect other tablets
		if((angle==90)||(angle==-90)){
			document.getElementById('mainBox').rows=document.documentElement.clientHeight/rowheight*3-30				//landscape
		}else{document.getElementById('mainBox').rows=document.documentElement.clientHeight/rowheight*2-30}			//portrait
	}else{
		if((angle==90)||(angle==-90)){
			document.getElementById('mainBox').rows=document.documentElement.clientHeight/rowheight*2-25			//smartphone here and line below
		}else if(isMobile) {document.getElementById('mainBox').rows=document.documentElement.clientHeight/rowheight*2.2-30
		}else{document.getElementById('mainBox').rows=document.documentElement.clientHeight/rowheight*2-30}}				//non-mobile
	document.getElementById('mainBox').rows = document.getElementById('mainBox').rows*0.6;			//tweak factor for development
	if(document.getElementById('lockBox')!=null) document.getElementById('lockBox').rows = document.getElementById('mainBox').rows*1.0
}

function chatResize(){
	document.getElementById('chatframe').height = document.documentElement.clientHeight - 60
}

//functions for reading a file into the box, and for saving it later
function saveURLAsFile()
{
	var URLToWriteSplit = document.getElementById('mainBox').value.trim().split('\n');
	var fileNameToSaveAs = URLToWriteSplit[0].split(':')[1];
	if(URLToWriteSplit.length > 1){
		var content = URLToWriteSplit[1].trim()
	} else {
		var content = URLToWriteSplit[0].trim()
	};
	var downloadLink = document.createElement("a");
	if(content.slice(0,4).toLowerCase()=='data'){							//regular save of encoded file

//first check if the file can lead to problems, and if so request user confirmation	
		var extension = fileNameToSaveAs.toLowerCase().match(/\.\w+$/);
		var suspicious =  ['.exe','.scr','.url','.com','.pif','.bat','.xht','.htm','.html','.xml','.xhtml','.js','.sh','.svg','.gadget','.msi','.msp','.hta','.cpl','.msc','.jar','.cmd','.vb','.vbs','.jse','.ws','.wsf','.wsc','.wsh','.ps1','.ps2','.ps1xml','.ps2xml','.psc1','.scf','.lnk','.inf','.reg','.doc','.xls','.ppt','.pdf','.swf','.fla','.docm','.dotm','.xlsm','.xltm','.xlam','.pptm','.potm','.ppam','.ppsm','.sldm','.dll','.dllx','.rar','.zip','.7z','.gzip','.gzip2','.tar','.fon','.svgz','.jnlp'];
		if(extension){
			var index = suspicious.indexOf(extension[0])
		} else {
			var index = -1
		}
		if(index >= 0){
			var reply = confirm('The file you want to save has the extension: ' + suspicious[index] + '  This file might execute code automatically, which may lead to a loss of security. Do you still want to save it?');
			if(!reply) throw('file save canceled by user')
		}
		
		downloadLink.download = fileNameToSaveAs;
		downloadLink.innerHTML = "Download File";
	} else {																//to save contents as text file
		var textFileAsBlob = new Blob([document.getElementById('mainBox').value.trim()], {type:'text/plain'});
		downloadLink.download = prompt("The box contents will be saved as a text file. Please enter a name for it.");
		downloadLink.innerHTML = "Download File";
		content = window.URL.createObjectURL(textFileAsBlob);
	}
	if (window.webkitURL != null)
	{
		// Chrome allows the link to be clicked
		// without actually adding it to the DOM.
		downloadLink.href = content;
	}
	else
	{
		// Firefox requires the link to be added to the DOM
		// before it can be clicked.
		downloadLink.href = content;
		downloadLink.onclick = destroyClickedElement;
		downloadLink.style.display = "none";
		document.body.appendChild(downloadLink);
	}
	downloadLink.click();
	document.getElementById('filemsg').innerHTML = 'File saved with filename ' + fileNameToSaveAs
}

function destroyClickedElement(event)
{
	document.body.removeChild(event.target);
}

//this one is called by window.onload below
function loadFileAsURL()
{
	var fileToLoad = document.getElementById("fileToLoad").files[0];

	var fileReader = new FileReader();
	fileReader.onload = function(fileLoadedEvent)
	{
		var fileName = fileToLoad.name;
		var URLFromFileLoaded = fileLoadedEvent.target.result;
		document.getElementById('mainBox').value = "filename:" + fileName + "\n" + URLFromFileLoaded;
	};
	fileReader.readAsDataURL(fileToLoad, "UTF-8");
	document.getElementById('mainmsg').innerHTML = 'The file has been loaded in encoded form. It is <strong>not encrypted.</strong>'
	document.getElementById('filemsg').innerHTML = 'File loaded on the Main tab'
}
</script>

<!--initialization, button connections-->
<script>
// initialize things
window.onload = function() {

	if(!isMobile){
		document.getElementById('preview').style.width = "40%";					//smaller image on PCs
	}
	if(!isMobile || isChrome){							//search box in Help tab. Works on Android Chrome, but won't detect right
		document.getElementById('helptopmobile').style.display = 'none';
		document.getElementById('helptop').style.display = 'block';
		document.getElementById('helpspace').style.display = 'block'
	}

	window.addEventListener("resize", function() { textrows();chatResize();}, false)	    	//resize if the window changes

	initTabs();																	//initialize tabs
	fillList();																	//put names in selection box

	//this one for loading files into extra screen
	var fileinput = document.getElementById('fileToLoad');
    fileinput.addEventListener('change', loadFileAsURL, false);
	fileinput.addEventListener('blur', ce);
	fileinput.addEventListener('focus', ce);

    // add action to the file input
    var input = document.getElementById('imagefile');
    input.addEventListener('change', importImage);
	input.addEventListener('blur', ce);
	input.addEventListener('focus', ce);

    // add action to the encode button
    var encodeButton = document.getElementById('encode');
    encodeButton.addEventListener('click', encodeImage);
	encodeButton.addEventListener('blur', ce);
	encodeButton.addEventListener('focus', ce);

    // add action to the decode button
    var decodeButton = document.getElementById('decode');
    decodeButton.addEventListener('click', decodeImage);
	decodeButton.addEventListener('blur', ce);
	decodeButton.addEventListener('focus', ce);

//button code moved from html page, used to be inline

	var showlockButton = document.getElementById('showlockButton');
   	showlockButton.addEventListener('click', showLock);
	showlockButton.addEventListener('blur', ce);
	showlockButton.addEventListener('focus', ce);

	var basicmodeBox = document.getElementById('basicmode');
   	basicmodeBox.addEventListener('click', basic2main);
	basicmodeBox.addEventListener('blur', ce);
	basicmodeBox.addEventListener('focus', ce);

	var advancedmodeBox = document.getElementById('advancedmode');
   	advancedmodeBox.addEventListener('click', basic2main);
	advancedmodeBox.addEventListener('blur', ce);
	advancedmodeBox.addEventListener('focus', ce);

	var clearMainButton = document.getElementById('clearMainButton');
   	clearMainButton.addEventListener('click', clearMain);
	clearMainButton.addEventListener('blur', ce);
	clearMainButton.addEventListener('focus', ce);

	var clearMainButton = document.getElementById('selectMainButton');
   	selectMainButton.addEventListener('click', selectMain);
	selectMainButton.addEventListener('blur', ce);
	selectMainButton.addEventListener('focus', ce);

	var showlockButtonBasic = document.getElementById('showlockButtonBasic');
   	showlockButtonBasic.addEventListener('click', showLock);
	showlockButtonBasic.addEventListener('blur', ce);
	showlockButtonBasic.addEventListener('focus', ce);

	var clearMainButtonBasic = document.getElementById('clearMainButtonBasic');
   	clearMainButtonBasic.addEventListener('click', clearMain);
	clearMainButtonBasic.addEventListener('blur', ce);
	clearMainButtonBasic.addEventListener('focus', ce);

	var selectMainButtonBasic = document.getElementById('selectMainButtonBasic');
   	selectMainButtonBasic.addEventListener('click', selectMain);
	selectMainButtonBasic.addEventListener('blur', ce);
	selectMainButtonBasic.addEventListener('focus', ce);

	var decryptButton = document.getElementById('decryptButton');
   	decryptButton.addEventListener('click', Decrypt_single);
	decryptButton.addEventListener('blur', ce);
	decryptButton.addEventListener('focus', ce);

	var verifyButton = document.getElementById('verifyButton');
   	verifyButton.addEventListener('click', verifySignature);
	verifyButton.addEventListener('blur', ce);
	verifyButton.addEventListener('focus', ce);

	var main2extraButton = document.getElementById('main2extraButton');
   	main2extraButton.addEventListener('click', main2extra);
	main2extraButton.addEventListener('blur', ce);
	main2extraButton.addEventListener('focus', ce);

	var decryptButtonBasic = document.getElementById('decryptButtonBasic');
   	decryptButtonBasic.addEventListener('click', Decrypt_single);
	decryptButtonBasic.addEventListener('blur', ce);
	decryptButtonBasic.addEventListener('focus', ce);

	var extra2mainButton = document.getElementById('extra2mainButton');
   	extra2mainButton.addEventListener('click', main2extra);
	extra2mainButton.addEventListener('blur', ce);
	extra2mainButton.addEventListener('focus', ce);

	var sendMailButton = document.getElementById('sendMailButton');
   	sendMailButton.addEventListener('click', sendMail);
	sendMailButton.addEventListener('blur', ce);
	sendMailButton.addEventListener('focus', ce);
	
	var chatButton = document.getElementById('chatButton');
   	chatButton.addEventListener('click', Chat);
	chatButton.addEventListener('blur', ce);
	chatButton.addEventListener('focus', ce);
	
	var chatButtonBasic = document.getElementById('chatButtonBasic');
   	chatButtonBasic.addEventListener('click', Chat);
	chatButtonBasic.addEventListener('blur', ce);
	chatButtonBasic.addEventListener('focus', ce)

	var sendMailButtonBasic = document.getElementById('sendMailButtonBasic');
   	sendMailButtonBasic.addEventListener('click', sendMail);
	sendMailButtonBasic.addEventListener('blur', ce);
	sendMailButtonBasic.addEventListener('focus', ce);

	var sendSMSButton = document.getElementById('sendSMSButton');
   	sendSMSButton.addEventListener('click', sendSMS);
	sendSMSButton.addEventListener('blur', ce);
	sendSMSButton.addEventListener('focus', ce);

	var imageButton = document.getElementById('imageButton');
   	imageButton.addEventListener('click', main2image);
	imageButton.addEventListener('blur', ce);
	imageButton.addEventListener('focus', ce);

	var secretshareButton = document.getElementById('secretshareButton');
   	secretshareButton.addEventListener('click', secretshare);
	secretshareButton.addEventListener('blur', ce);
	secretshareButton.addEventListener('focus', ce);

	var wordsButton = document.getElementById('wordsButton');
   	wordsButton.addEventListener('click', words);
	wordsButton.addEventListener('blur', ce);
	wordsButton.addEventListener('focus', ce);

	var spacesButton = document.getElementById('spacesButton');
   	spacesButton.addEventListener('click', spaces);
	spacesButton.addEventListener('blur', ce);
	spacesButton.addEventListener('focus', ce);

	var coverButton = document.getElementById('coverButton');
   	coverButton.addEventListener('click', box2cover);
	coverButton.addEventListener('blur', ce);
	coverButton.addEventListener('focus', ce);

	var savefileButton = document.getElementById('savefileButton');
   	savefileButton.addEventListener('click', saveURLAsFile);
	savefileButton.addEventListener('blur', ce);
	savefileButton.addEventListener('focus', ce);

	var image2mainButton = document.getElementById('image2mainButton');
   	image2mainButton.addEventListener('click', image2main);
	image2mainButton.addEventListener('blur', ce);
	image2mainButton.addEventListener('focus', ce);

	var lock2dirButton = document.getElementById('lock2dirButton');
   	lock2dirButton.addEventListener('click', lock2dir);
	lock2dirButton.addEventListener('blur', ce);
	lock2dirButton.addEventListener('focus', ce);

	var clearLocksButton = document.getElementById('clearLocksButton');
   	clearLocksButton.addEventListener('click', clearLocks);
	clearLocksButton.addEventListener('blur', ce);
	clearLocksButton.addEventListener('focus', ce);

	var lock2dirButtonBasic = document.getElementById('lock2dirButtonBasic');
   	lock2dirButtonBasic.addEventListener('click', lock2dir);
	lock2dirButtonBasic.addEventListener('blur', ce);
	lock2dirButtonBasic.addEventListener('focus', ce);

	var clearLocksButtonBasic = document.getElementById('clearLocksButtonBasic');
   	clearLocksButtonBasic.addEventListener('click', clearLocks);
	clearLocksButtonBasic.addEventListener('blur', ce);
	clearLocksButtonBasic.addEventListener('focus', ce);

	var addLockButton = document.getElementById('addLockButton');
   	addLockButton.addEventListener('click', addLock);
	addLockButton.addEventListener('blur', ce);
	addLockButton.addEventListener('focus', ce);

	var removeLockButton = document.getElementById('removeLockButton');
   	removeLockButton.addEventListener('click', removeLock);
	removeLockButton.addEventListener('blur', ce);
	removeLockButton.addEventListener('focus', ce);

	var resetPFSButton = document.getElementById('resetPFSButton');
   	resetPFSButton.addEventListener('click', resetPFS);
	resetPFSButton.addEventListener('blur', ce);
	resetPFSButton.addEventListener('focus', ce);

	var addToListButton = document.getElementById('addToListButton');
   	addToListButton.addEventListener('click', addToList);
	addToListButton.addEventListener('blur', ce);
	addToListButton.addEventListener('focus', ce);

	var addLockButtonBasic = document.getElementById('addLockButtonBasic');
   	addLockButtonBasic.addEventListener('click', addLock);
	addLockButtonBasic.addEventListener('blur', ce);
	addLockButtonBasic.addEventListener('focus', ce);

	var removeLockButtonBasic = document.getElementById('removeLockButtonBasic');
   	removeLockButtonBasic.addEventListener('click', removeLock);
	removeLockButtonBasic.addEventListener('blur', ce);
	removeLockButtonBasic.addEventListener('focus', ce);

	var showLockDBButton = document.getElementById('showLockDBButton');
   	showLockDBButton.addEventListener('click', showLockDB);
	showLockDBButton.addEventListener('blur', ce);
	showLockDBButton.addEventListener('focus', ce);

	var mergeLockDBButton = document.getElementById('mergeLockDBButton');
   	mergeLockDBButton.addEventListener('click', mergeLockDB);
	mergeLockDBButton.addEventListener('blur', ce);
	mergeLockDBButton.addEventListener('focus', ce);

	var moveLockDBButton = document.getElementById('moveLockDBButton');
   	moveLockDBButton.addEventListener('click', moveLockDB);
	moveLockDBButton.addEventListener('blur', ce);
	moveLockDBButton.addEventListener('focus', ce);

	var acceptKeyButton = document.getElementById('acceptKeyButton');
   	acceptKeyButton.addEventListener('click', acceptKey);

	var cancelKeyButton = document.getElementById('cancelKeyButton');
   	cancelKeyButton.addEventListener('click', cancelKey);

	var changeKeyButton = document.getElementById('changeKeyButton');
   	changeKeyButton.addEventListener('click', changeKey);
	changeKeyButton.addEventListener('blur', ce);
	changeKeyButton.addEventListener('focus', ce);
	
	var changeEmailButton = document.getElementById('changeEmailButton');
   	changeEmailButton.addEventListener('click', showEmail);
	changeEmailButton.addEventListener('blur', ce);
	changeEmailButton.addEventListener('focus', ce);

	var backupSettings = document.getElementById('backupSettings');
   	backupSettings.addEventListener('click', moveMyself);
	backupSettings.addEventListener('blur', ce);
	backupSettings.addEventListener('focus', ce);

	var ezLok = document.getElementById('ezLok');
   	ezLok.addEventListener('click', ezLokStore);
	ezLok.addEventListener('blur', ce);
	ezLok.addEventListener('focus', ce);
	
	var encryptLocks = document.getElementById('encryptLocks');
   	encryptLocks.addEventListener('click', encryptLocksStore);
	encryptLocks.addEventListener('blur', ce);
	encryptLocks.addEventListener('focus', ce);

	var showKey = document.getElementById('showKey');
   	showKey.addEventListener('click', showsec);
	showKey.addEventListener('blur', ce);
	showKey.addEventListener('focus', ce);

	var introRandomButton = document.getElementById('introRandomButton');
   	introRandomButton.addEventListener('click', randomToken);
	introRandomButton.addEventListener('blur', ce);
	introRandomButton.addEventListener('blur', ce);

	var randomEmailButton = document.getElementById('randomEmailButton');
   	randomEmailButton.addEventListener('click', randomToken);
	randomEmailButton.addEventListener('blur', ce);
	randomEmailButton.addEventListener('blur', ce);

	var acceptEmailButton = document.getElementById('acceptEmailButton');
   	acceptEmailButton.addEventListener('click', email2any);
	acceptEmailButton.addEventListener('blur', ce);
	acceptEmailButton.addEventListener('blur', ce);

	var cancelEmailButton = document.getElementById('cancelEmailButton');
   	cancelEmailButton.addEventListener('click', cancelEmail);
	cancelEmailButton.addEventListener('blur', ce);
	cancelEmailButton.addEventListener('blur', ce);
	
	var showIntroKey = document.getElementById('showIntroKey');
   	showIntroKey.addEventListener('click', showIntro);
	showIntroKey.addEventListener('blur', ce);
	showIntroKey.addEventListener('focus', ce);

	var clearIntroButton = document.getElementById('clearIntroButton');
   	clearIntroButton.addEventListener('click', clearIntro);
	clearIntroButton.addEventListener('blur', ce);
	clearIntroButton.addEventListener('focus', ce);

	var suggestIntroButton = document.getElementById('suggestIntroButton');
   	suggestIntroButton.addEventListener('click', suggestIntro);
	suggestIntroButton.addEventListener('blur', ce);
	suggestIntroButton.addEventListener('focus', ce);

	var showlockIntroButton = document.getElementById('showlockIntroButton');
   	showlockIntroButton.addEventListener('click', showlockIntro);
	showlockIntroButton.addEventListener('blur', ce);
	showlockIntroButton.addEventListener('focus', ce);

	var showdecIn = document.getElementById('showdecIn');
   	showdecIn.addEventListener('click', showdecoyIn);
	showdecIn.addEventListener('blur', ce);
	showdecIn.addEventListener('focus', ce);

	var submitDecoyButton = document.getElementById('submitDecoyButton');
   	submitDecoyButton.addEventListener('click', submitDecoyIn);
	submitDecoyButton.addEventListener('blur', ce);
	submitDecoyButton.addEventListener('focus', ce);

	var cancelDecoyButton = document.getElementById('cancelDecoyButton');
   	cancelDecoyButton.addEventListener('click', cancelDecoyIn);
	cancelDecoyButton.addEventListener('blur', ce);
	cancelDecoyButton.addEventListener('focus', ce);

	var showdecOut = document.getElementById('showdecOut');
   	showdecOut.addEventListener('click', showdecoyOut);
	showdecOut.addEventListener('blur', ce);
	showdecOut.addEventListener('focus', ce);

	var submitDecoy2Button = document.getElementById('submitDecoy2Button');
   	submitDecoy2Button.addEventListener('click', submitDecoyOut);
	submitDecoy2Button.addEventListener('blur', ce);
	submitDecoy2Button.addEventListener('focus', ce);

	var cancelDecoy2Button = document.getElementById('cancelDecoy2Button');
   	cancelDecoy2Button.addEventListener('click', cancelDecoyOut);
	cancelDecoy2Button.addEventListener('blur', ce);
	cancelDecoy2Button.addEventListener('focus', ce);

	var submitPartsButton = document.getElementById('submitPartsButton');
   	submitPartsButton.addEventListener('click', submitParts);
	submitPartsButton.addEventListener('blur', ce);
	submitPartsButton.addEventListener('focus', ce);

	var cancelPartsButton = document.getElementById('cancelPartsButton');
   	cancelPartsButton.addEventListener('click', cancelPartsIn);
	cancelPartsButton.addEventListener('blur', ce);
	cancelPartsButton.addEventListener('focus', ce);

	var learnmodeCheck = document.getElementById('learnmode');
   	learnmodeCheck.addEventListener('click', setlearnmode);
	learnmodeCheck.addEventListener('blur', ce);
	learnmodeCheck.addEventListener('focus', ce);

	var closelockdirButton = document.getElementById('closelockdirButton');
   	closelockdirButton.addEventListener('click', lock2dir);
	closelockdirButton.addEventListener('blur', ce);
	closelockdirButton.addEventListener('focus', ce);

	var closechatButton = document.getElementById('closechatButton');
   	closechatButton.addEventListener('click', chat2main);
	closechatButton.addEventListener('blur', ce);
	closechatButton.addEventListener('focus', ce);
	
	var resetchatButton = document.getElementById('resetchatButton');
   	resetchatButton.addEventListener('click', resetChat);
	resetchatButton.addEventListener('blur', ce);
	resetchatButton.addEventListener('focus', ce);
	
	var cancelChatButton = document.getElementById('cancelChatButton');
   	cancelChatButton.addEventListener('click', closebox);
	cancelChatButton.addEventListener('blur', ce);
	cancelChatButton.addEventListener('focus', ce);
	
	var submitChatButton = document.getElementById('submitChatButton');
   	submitChatButton.addEventListener('click', makeChat);
	submitChatButton.addEventListener('blur', ce);
	submitChatButton.addEventListener('focus', ce);

	var lockListBox = document.getElementById('locklist');
   	lockListBox.addEventListener('click', ce);
	lockListBox.addEventListener('change', fillBox);
	lockListBox.addEventListener('blur', ce);
	lockListBox.addEventListener('focus', ce);

	var resetListButton = document.getElementById('resetListButton');
   	resetListButton.addEventListener('click', resetList);
	resetListButton.addEventListener('blur', ce);
	resetListButton.addEventListener('focus', ce);

	var submitKeychange = document.getElementById('submitKeychange');
   	submitKeychange.addEventListener('click', changeKey);
	submitKeychange.addEventListener('blur', ce);
	submitKeychange.addEventListener('focus', ce);

	var cancelKeychange = document.getElementById('cancelKeychange');
   	cancelKeychange.addEventListener('click', cancelKeyChange);
	cancelKeychange.addEventListener('blur', ce);
	cancelKeychange.addEventListener('focus', ce);

	var showNewKeyCheckbox = document.getElementById('showNewKey');
   	showNewKeyCheckbox.addEventListener('click', showNewKey);
	showNewKeyCheckbox.addEventListener('blur', ce);
	showNewKeyCheckbox.addEventListener('focus', ce);

	var gotointro2 = document.getElementById('gotointro2');
   	gotointro2.addEventListener('click', go2intro2);
	gotointro2.addEventListener('blur', ce);
	gotointro2.addEventListener('focus', ce);

	var backtointro1 = document.getElementById('backtointro1');
   	backtointro1.addEventListener('click', go2intro2);
	backtointro1.addEventListener('blur', ce);
	backtointro1.addEventListener('focus', ce);
	
	var gotointro3 = document.getElementById('gotointro3');
   	gotointro3.addEventListener('click', go2intro3);
	gotointro3.addEventListener('blur', ce);
	gotointro3.addEventListener('focus', ce);

	var backtointro2 = document.getElementById('backtointro2');
   	backtointro2.addEventListener('click', go2intro3);
	backtointro2.addEventListener('blur', ce);
	backtointro2.addEventListener('focus', ce);
	
	var gotointro4 = document.getElementById('gotointro4');
   	gotointro4.addEventListener('click', go2intro4);
	gotointro4.addEventListener('blur', ce);
	gotointro4.addEventListener('focus', ce);

	var backtointro3 = document.getElementById('backtointro3');
   	backtointro3.addEventListener('click', go2intro4);
	backtointro3.addEventListener('blur', ce);
	backtointro3.addEventListener('focus', ce);

	var mainBox = document.getElementById('mainBox');
   	mainBox.addEventListener('keyup', charsLeft);
	mainBox.addEventListener('keydown', ce);
	mainBox.addEventListener('blur', ce);
	mainBox.addEventListener('focus', ce);
	
	var decoyText = document.getElementById('decoyText');
   	decoyText.addEventListener('keyup', charsLeft);
	decoyText.addEventListener('keydown', ce);
	decoyText.addEventListener('blur', ce);
	decoyText.addEventListener('focus', ce);
	
	var chatdate = document.getElementById('chatdate');
   	chatdate.addEventListener('keyup', charsLeft);
	chatdate.addEventListener('keydown', ce);
	chatdate.addEventListener('blur', ce);
	chatdate.addEventListener('focus', ce)

//Firefox requires the keyup code to be inline if it refers to the event
//but this must be removed for the Chrome app and replaced with those commented below
	var pwdBox = document.getElementById('pwd');
//	pwdBox.addEventListener('keyup', function() {pwdKeyup(event)}, false);

	var pwdIntroBox = document.getElementById('pwdIntro');
   	pwdIntroBox.addEventListener('keyup', introKeyup);
	pwdIntroBox.addEventListener('blur', ce);
	pwdIntroBox.addEventListener('focus', ce);

	var decoyPwdIn = document.getElementById('decoyPwdIn');
//	decoyPwdIn.addEventListener('keyup', function() {decoyKeyup(event)}, false);
	decoyPwdIn.addEventListener('keydown', ce);
	decoyPwdIn.addEventListener('blur', ce);
	decoyPwdIn.addEventListener('focus', ce);

	var decoyPwdOut = document.getElementById('decoyPwdOut');
//	decoyPwdOut.addEventListener('keyup', function() {decoyKeyupOut(event)}, false);
	decoyPwdOut.addEventListener('keydown', ce);
	decoyPwdOut.addEventListener('blur', ce);
	decoyPwdOut.addEventListener('focus', ce);

	var partsIn = document.getElementById('partsIn');
//	partsIn.addEventListener('keyup', function() {partsKeyup(event)}, false);
	partsIn.addEventListener('keydown', ce);
	partsIn.addEventListener('blur', ce);
	partsIn.addEventListener('focus', ce);

	var newKeyBox = document.getElementById('newKey');
	newKeyBox.addEventListener('keyup', newKeyup);
	newKeyBox.addEventListener('keydown', ce);
	newKeyBox.addEventListener('blur', ce);
	newKeyBox.addEventListener('focus', ce);

	var newKey2Box = document.getElementById('newKey2');
//	newKey2Box.addEventListener('keyup', function() {newKey2up(event)}, false);
	newKey2Box.addEventListener('keydown', ce);
	newKey2Box.addEventListener('blur', ce);
	newKey2Box.addEventListener('focus', ce);

	var locknameBox = document.getElementById('locknameBox');
//	locknameBox.addEventListener('keyup', function() {locknameKeyup(event)}, false);
	locknameBox.addEventListener('keydown', ce);
	locknameBox.addEventListener('blur', ce);
	locknameBox.addEventListener('focus', ce);
	
	var lockBox = document.getElementById('lockBox');
	lockBox.addEventListener('keyup', applyRStoLock);
	lockBox.addEventListener('keydown', ce);
	lockBox.addEventListener('blur', ce);
	lockBox.addEventListener('focus', ce);
	lockBox.addEventListener('paste', pasteLock);
	
	function pasteLock() {
    setTimeout(function(){
        applyRStoLock();
    }, 0); //or 4
	}
	
	var emailBox = document.getElementById('email');
//	emailBox.addEventListener('keyup', function() {emailKeyup(event)}, false);
	emailBox.addEventListener('keydown', ce);
	emailBox.addEventListener('blur', ce);
	emailBox.addEventListener('focus', ce);

	var neverbox = document.getElementById('never');
	neverbox.addEventListener('click', hide5min);
	neverbox.addEventListener('blur', ce);
	neverbox.addEventListener('focus', ce);

//for the help screens
	document.getElementById('aa1').addEventListener('click', function() {openClose('a1')});
	document.getElementById('aa2').addEventListener('click', function() {openClose('a2')});
	document.getElementById('aa3').addEventListener('click', function() {openClose('a3')});
	document.getElementById('aa4').addEventListener('click', function() {openClose('a4')});
	document.getElementById('aa5').addEventListener('click', function() {openClose('a5')});
	document.getElementById('aa6').addEventListener('click', function() {openClose('a6')});
	document.getElementById('aa7').addEventListener('click', function() {openClose('a7')});
	document.getElementById('aa8').addEventListener('click', function() {openClose('a8')});
	document.getElementById('aa9').addEventListener('click', function() {openClose('a9')});
	document.getElementById('aa10').addEventListener('click', function() {openClose('a10')});
	document.getElementById('aa11').addEventListener('click', function() {openClose('a11')});
	document.getElementById('aa12').addEventListener('click', function() {openClose('a12')});
	document.getElementById('aa13').addEventListener('click', function() {openClose('a13')});
	document.getElementById('aa14').addEventListener('click', function() {openClose('a14')});
	document.getElementById('aa15').addEventListener('click', function() {openClose('a15')});
	document.getElementById('aa16').addEventListener('click', function() {openClose('a16')});
	document.getElementById('aa17').addEventListener('click', function() {openClose('a17')});
	document.getElementById('aa18').addEventListener('click', function() {openClose('a18')});
	document.getElementById('aa19').addEventListener('click', function() {openClose('a19')});
	document.getElementById('aa20').addEventListener('click', function() {openClose('a20')});
	document.getElementById('aa21').addEventListener('click', function() {openClose('a21')});
	document.getElementById('aa22').addEventListener('click', function() {openClose('a22')});
	document.getElementById('aa23').addEventListener('click', function() {openClose('a23')});
	document.getElementById('aa24').addEventListener('click', function() {openClose('a24')});
	document.getElementById('aa25').addEventListener('click', function() {openClose('a25')});
	document.getElementById('aa26').addEventListener('click', function() {openClose('a26')});
	document.getElementById('aa27').addEventListener('click', function() {openClose('a27')});
	document.getElementById('aa28').addEventListener('click', function() {openClose('a28')});
	document.getElementById('aa29').addEventListener('click', function() {openClose('a29')});
	document.getElementById('aa30').addEventListener('click', function() {openClose('a30')});
	document.getElementById('aa31').addEventListener('click', function() {openClose('a31')});
	document.getElementById('aa32').addEventListener('click', function() {openClose('a32')});
	document.getElementById('aa33').addEventListener('click', function() {openClose('a33')});
	document.getElementById('aa34').addEventListener('click', function() {openClose('a34')});
	document.getElementById('aa35').addEventListener('click', function() {openClose('a35')});
	document.getElementById('aa36').addEventListener('click', function() {openClose('a36')});
	document.getElementById('aa37').addEventListener('click', function() {openClose('a37')});
	document.getElementById('aa38').addEventListener('click', function() {openClose('a38')});
	document.getElementById('aa39').addEventListener('click', function() {openClose('a39')});
	document.getElementById('aa40').addEventListener('click', function() {openClose('a40')});
	document.getElementById('aa41').addEventListener('click', function() {openClose('a41')});
	document.getElementById('aa42').addEventListener('click', function() {openClose('a42')});
	document.getElementById('aa43').addEventListener('click', function() {openClose('a43')});
	document.getElementById('aa44').addEventListener('click', function() {openClose('a44')});
	document.getElementById('aa45').addEventListener('click', function() {openClose('a45')});
	document.getElementById('aa46').addEventListener('click', function() {openClose('a46')});
	document.getElementById('aa47').addEventListener('click', function() {openClose('a47')});
	document.getElementById('aa48').addEventListener('click', function() {openClose('a48')});
	document.getElementById('aa49').addEventListener('click', function() {openClose('a49')});
	document.getElementById('aa50').addEventListener('click', function() {openClose('a50')});
	document.getElementById('aa51').addEventListener('click', function() {openClose('a51')});
	document.getElementById('aa52').addEventListener('click', function() {openClose('a52')});
	document.getElementById('aa53').addEventListener('click', function() {openClose('a53')});
	document.getElementById('aa54').addEventListener('click', function() {openClose('a54')});
	document.getElementById('aa55').addEventListener('click', function() {openClose('a55')});
	document.getElementById('aa56').addEventListener('click', function() {openClose('a56')});

//a few help items don't have extra material, but are ready here just in case. Uncomment as needed

//	document.getElementById('bb1').addEventListener('click', function() {openClose('b1')});
//	document.getElementById('bb2').addEventListener('click', function() {openClose('b2')});
	document.getElementById('bb3').addEventListener('click', function() {openClose('b3')});
//	document.getElementById('bb4').addEventListener('click', function() {openClose('b4')});
	document.getElementById('bb5').addEventListener('click', function() {openClose('b5')});
	document.getElementById('bb6').addEventListener('click', function() {openClose('b6')});
	document.getElementById('bb7').addEventListener('click', function() {openClose('b7')});
	document.getElementById('bb8').addEventListener('click', function() {openClose('b8')});
	document.getElementById('bb9').addEventListener('click', function() {openClose('b9')});
	document.getElementById('bb10').addEventListener('click', function() {openClose('b10')});
	document.getElementById('bb11').addEventListener('click', function() {openClose('b11')});
	document.getElementById('bb12').addEventListener('click', function() {openClose('b12')});
	document.getElementById('bb13').addEventListener('click', function() {openClose('b13')});
	document.getElementById('bb14').addEventListener('click', function() {openClose('b14')});
	document.getElementById('bb15').addEventListener('click', function() {openClose('b15')});
	document.getElementById('bb16').addEventListener('click', function() {openClose('b16')});
	document.getElementById('bb17').addEventListener('click', function() {openClose('b17')});
	document.getElementById('bb18').addEventListener('click', function() {openClose('b18')});
	document.getElementById('bb19').addEventListener('click', function() {openClose('b19')});
	document.getElementById('bb20').addEventListener('click', function() {openClose('b20')});
	document.getElementById('bb21').addEventListener('click', function() {openClose('b21')});
	document.getElementById('bb22').addEventListener('click', function() {openClose('b22')});
	document.getElementById('bb23').addEventListener('click', function() {openClose('b23')});
	document.getElementById('bb24').addEventListener('click', function() {openClose('b24')});
	document.getElementById('bb25').addEventListener('click', function() {openClose('b25')});
	document.getElementById('bb26').addEventListener('click', function() {openClose('b26')});
//	document.getElementById('bb27').addEventListener('click', function() {openClose('b27')});
	document.getElementById('bb28').addEventListener('click', function() {openClose('b28')});
	document.getElementById('bb29').addEventListener('click', function() {openClose('b29')});
	document.getElementById('bb30').addEventListener('click', function() {openClose('b30')});
	document.getElementById('bb31').addEventListener('click', function() {openClose('b31')});
	document.getElementById('bb32').addEventListener('click', function() {openClose('b32')});
//	document.getElementById('bb33').addEventListener('click', function() {openClose('b33')});
	document.getElementById('bb34').addEventListener('click', function() {openClose('b34')});
	document.getElementById('bb35').addEventListener('click', function() {openClose('b35')});
	document.getElementById('bb36').addEventListener('click', function() {openClose('b36')});
	document.getElementById('bb37').addEventListener('click', function() {openClose('b37')});
//	document.getElementById('bb38').addEventListener('click', function() {openClose('b38')});
	document.getElementById('bb39').addEventListener('click', function() {openClose('b39')});
	document.getElementById('bb40').addEventListener('click', function() {openClose('b40')});
	document.getElementById('bb41').addEventListener('click', function() {openClose('b41')});
	document.getElementById('bb42').addEventListener('click', function() {openClose('b42')});
	document.getElementById('bb43').addEventListener('click', function() {openClose('b43')});
	document.getElementById('bb44').addEventListener('click', function() {openClose('b44')});
	document.getElementById('bb45').addEventListener('click', function() {openClose('b45')});
//	document.getElementById('bb46').addEventListener('click', function() {openClose('b46')});
//	document.getElementById('bb47').addEventListener('click', function() {openClose('b47')});
//	document.getElementById('bb48').addEventListener('click', function() {openClose('b48')});
//	document.getElementById('bb49').addEventListener('click', function() {openClose('b49')});
	document.getElementById('bb50').addEventListener('click', function() {openClose('b50')});
//	document.getElementById('bb51').addEventListener('click', function() {openClose('b51')});
	document.getElementById('bb52').addEventListener('click', function() {openClose('b52')});
	document.getElementById('bb53').addEventListener('click', function() {openClose('b53')});
	document.getElementById('bb54').addEventListener('click', function() {openClose('b54')});
//	document.getElementById('bb55').addEventListener('click', function() {openClose('b55')});
	document.getElementById('bb56').addEventListener('click', function() {openClose('b56')});

};

//this one is for iOS only. Remove for the Chrome app
window.addEventListener('load', function() {
    FastClick.attach(document.body);
}, false);

//for general directory
window.addEventListener('message', receiveMessage, false);

//gets Lock from the general directory iframe and puts it in Lock screen
function receiveMessage(evt){
  	if (evt.origin === 'https://www.passlok.com'){
    	document.getElementById('lockBox').value = evt.data;
		suspendFindLock = true;
		document.getElementById('lockmsg').innerHTML='Give a name to this Lock and save it. Otherwise Clear.'
  	}
}

//start with intro screen if "myself" entry in lockDB is empty. Otherwise start with Key input
	if(!lockDB['myself']){
		document.getElementById('videotutorial').src = "https://www.youtube.com/embed/UxgrES_CGcg";
		document.getElementById('introscr').style.display = "block";
		BasicButtons = true;
	} else {
		BasicButtons = (lockDB['myself'][3] != 'advanced');
		if(!BasicButtons){														//retrieve last interface
			openClose("basicbuttonstop");
			openClose("basicbuttonsbot");
			openClose("mainbuttonstop");
			openClose("mainbuttonsbot");
			openClose("basiclockbuttonstop");
			openClose("basiclockbuttonsbot");
			openClose("lockbuttonstop");
			openClose("lockbuttonsbot");
			document.getElementById('basicmode').checked = false;
			document.getElementById('advancedmode').checked = true;
		}
		if(lockDB['myself'][4] == 'ezLok off'){
			document.getElementById('ezLok').checked = false
		} else {
			document.getElementById('ezLok').checked = true
		}
		if(lockDB['myself'][5] == 'encrypt Locks'){
			document.getElementById('encryptLocks').checked = true
		} else {
			document.getElementById('encryptLocks').checked = false
		}
		if(lockDB['myself'][6] == 'limited access'){
			document.getElementById("keymsg").innerHTML = '<span style="color:red"><strong>Warning: last session was limited</strong></span><br />Please enter your secret Key';
			lockDB['myself'][6] = 'full access';
			localStorage.lockDB = JSON.stringify(lockDB);
		}
	}

//end of body script.
</script>

</body>
</html>